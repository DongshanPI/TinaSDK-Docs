<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tina SDK Docs Start Page."><meta name=author content=100askTeam><link href=https://github.com/DongshanPI/TinaSDK-Docs.git/SdkModule/Linux_AudioFrequency_DevelopmentGuide-02/ rel=canonical><link href=../Linux_AudioFrequency_DevelopmentGuide-01/ rel=prev><link href=../Linux_AudioFrequency_DevelopmentGuide-03/ rel=next><link rel=icon href=../../favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>模块介绍 - 全志Linux Tina-SDK开发完全手册</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-LZX4K52CZ1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-LZX4K52CZ1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-LZX4K52CZ1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#2 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=https://tina.100ask.net title="全志Linux Tina-SDK开发完全手册" class="md-header__button md-logo" aria-label="全志Linux Tina-SDK开发完全手册" data-md-component=logo> <svg id=图层_1 data-name="图层 1" xmlns=http://www.w3.org/2000/svg viewbox="0 0 400 400"><defs><style>.cls-1{fill:#151f45;fill-rule:evenodd;}</style></defs><title>东山派1号LOGO定稿</title><path class=cls-1 d=M339.43,62.45A195.41,195.41,0,0,0,61.92,337.64l-.08.2.55.27.67.67A195.41,195.41,0,1,0,339.43,62.45ZM208.26,19.36a181,181,0,0,1,121.26,53c2.44,2.48,4.83,5,7.15,7.59H208.26Zm0,166.87h44.23v-14H208.26v-35.9H269l5.19,0c11.24-.11,20.56-.23,30.47,6.14,20.17,12.89,15.49,40.5,15.49,40.57l-.08.44c-3.18,34.71-41.83,31.18-42,31.18l-.55,0H208.26ZM19.89,200.62A181.39,181.39,0,0,1,194.22,19.36V80H149.68c-4,0-6.06,0-8.22-.08-11-.23-23.75-.47-33.26,1.77C100.61,83.45,92.12,86.91,85,93.52s-12.58,16.31-13.88,30.35h.08a10.59,10.59,0,0,0-.36,1.53c-.15,1.34-.35,3.23-.43,5.51-.39,11.71,2,34.28,23.28,47.3,14.43,8.8,28.58,8.49,43.6,8.14,2.24,0,4.52-.12,8.49-.12h48.4v28.31H20.4C20.05,209.94,19.89,205.3,19.89,200.62Zm174.33-64.33v35.9h-48.4c-1.88,0-5.34.12-8.76.2-12.9.27-25.09.55-36-6.14C85.83,157,84.13,140.11,84.45,131.34l0-1.22.12,0,.47-5C86,115,89.76,108.22,94.59,103.7s11.13-7.08,16.79-8.42c8-1.84,19.74-1.65,29.84-1.45,3.7.08,7.32.16,8.46.16h44.54v28.27H152.67v14ZM22,228.57H194.22v19.07A157.63,157.63,0,0,0,68.88,324.59,180.64,180.64,0,0,1,22,228.57ZM294.92,356c-.59.4-1.18.75-1.81,1.1-.9.55-1.85,1.11-2.79,1.58a6.64,6.64,0,0,1-.95.55,181.66,181.66,0,0,1-176.3,0c-.27-.16-.59-.32-.86-.47-.91-.51-1.81-1.07-2.72-1.58l-2-1.18a180,180,0,0,1-28.31-21.15,143.82,143.82,0,0,1,248.49-4.09A179.72,179.72,0,0,1,294.92,356Zm42.74-35.78a158,158,0,0,0-129.4-72.85V228.57h69.12c4.6.32,52.1,2.52,56.58-43.6.36-2.36,5.27-37.08-21.74-54.38-13.41-8.61-24.65-8.49-38.14-8.33H208.26V94H348a181.41,181.41,0,0,1-10.34,226.19Z /><path class=cls-1 d=M294.92,356a30,30,0,0,1-3.93-2c-11.52-5-17.07-9.2-21.43-12.94-2.28-1.92-6.84-6.13-8.26-8.14-8.81-12.58-9.75-9.86-12-6-1.14,2-8.1,9.59-9.87,11.16a58,58,0,0,1-15.29,9.6,58.91,58.91,0,0,1-31.81,3.93c-33.81-5.35-34.68-28.23-45.1-27.48-3.77,10.34-23.51,25.4-36.25,30.43-1.1.43-2.24.9-3.46,1.37-1.53.59-3.11,1.18-4.8,1.69l-6,1.66c-2.52,1-1.14.35-2.28,1.33,1.37.75-.32.4,1.69.47,2.71.08,10-2.67,13.4-4l1-.39c5.46-2.16,9.55-4.64,13.76-6.8l-8.81,6.45c-.47.31-1.33.82-1.65,1l-1.53,1.3-.59.51,1.45,0,65.7-1.54-8.8-4.24c-2.84-1.77-7.16-5.35-8.65-7.9,15.09,14.15,42.73,17.45,64.12,9.55,4.76-1.77,13.37-6.84,15.77-9.52-6.09,8.22-11.8,9.17-18.13,12.47-1.73.86-.9.39-1.8,1.1l68.09.12h1.5a7.13,7.13,0,0,0-.55-.55c-2.68-2.4-8.34-4.88-11-8.1,3.81,1.69,8.65,4.28,13.8,6.52a62.09,62.09,0,0,0,11.28,3.74,15.82,15.82,0,0,0,2,.24c1.93-.08.47.19,1.77-.44C306,358.79,299.4,357.61,294.92,356Zm-83-76.51c-1.53-2.32-2.83-4.36-4.48-7.35-8.34-15.34-9.87,2.32-22.14,16.12-7.55,8.49-22.1,19.66-32.16,22.84,1.18.95-1.46,5.47,11.6-2.75,3.77-2.36,5.86-3.81,9.16-5.86a.3.3,0,0,1-.16-.08c-.16-.15.12-.74.87-1.73a22.41,22.41,0,0,1,2.08-1.81c1-.74,2-1.49,3-2.16a24,24,0,0,1,4.05-2.2,24.51,24.51,0,0,1,4.95-1.61,24.85,24.85,0,0,1,5-.47h28.74A102.79,102.79,0,0,1,211.88,279.45Zm-24.14,18.76a20.53,20.53,0,0,0-4.41.82,34,34,0,0,0-5.11,1.93,29.38,29.38,0,0,1-3.14,1.37c-1.46,3.23-1.54,2.72-8,7.24-3.18,2.24-7.47,4.24-10.26,6.72,3.07,5.58,12.07,11.29,18.09,14.31,1.3.63,2.71,1.26,4.21,1.85a7.93,7.93,0,0,1,2.12-3.89l3.07-3.3a18.45,18.45,0,0,0,2.47-4.53,39.27,39.27,0,0,0,1.89-6.21A65.14,65.14,0,0,0,189.9,307c.28-2.71.43-4.91.43-6.6v-2.28C189.62,298.13,188.8,298.17,187.74,298.21Zm61.06,14.94.78-1.3a59.82,59.82,0,0,1-11.08-5.94c-.47-.27-.91-.59-1.38-.86-1.22-.75-2.44-1.62-3.66-2.52-.59-.43-.94-.71-.94-.71-2.28-1.81-4.56-3.81-6.76-5.93v2.24h-10.7c-.47,1.81-.82,3.3-1,4.44a53.25,53.25,0,0,0-.63,5.7,71.55,71.55,0,0,0-.23,8.22c0,2.12.15,4.17.35,6.21s.43,3.74.71,5.15a4.23,4.23,0,0,0,1.06,2.6,2.37,2.37,0,0,0,1.34.43,5.31,5.31,0,0,0,2-.47c1-.36,1.57-.63,2-.83a1.43,1.43,0,0,1,.94-.23,1.21,1.21,0,0,1,.71.51c.12.27-.28.7-1.3,1.33a13.2,13.2,0,0,1-1.53.83c-.59.27-1.54.75-2.83,1.41s-2.28,1.18-2.95,1.54a15.09,15.09,0,0,1-1.85.86,1.27,1.27,0,0,1-1.38-.08c-.19-.07-.43-.43-.7-1a12,12,0,0,1-.67-3.3c-.2-1.61-.32-2.95-.4-4.09s-.07-3.34-.11-6.57,0-5.54.11-7a65.82,65.82,0,0,1,1.11-7.7,35.56,35.56,0,0,1,1.53-5.74l.82-2.24h-19c0,.94,0,2.12,0,3.61s-.08,3.86-.2,7.08-.43,6.53-.87,9.75a58.42,58.42,0,0,1-1.73,8.46,30.58,30.58,0,0,1-2.28,6,6.57,6.57,0,0,1-1.29,1.89,58.67,58.67,0,0,0,15.61,2,63,63,0,0,0,26.18-6.33,51.9,51.9,0,0,0,16.16-12l0-.08a7.77,7.77,0,0,1,.63-.66l.08-.08c.23-.28.51-.55.74-.87a7.6,7.6,0,0,0,.56-.59l0,0c-6.88-5.38-16.67-9.24-19.7-15.76,6.72,4.24,11.44,8.1,19.58,11.79A10.52,10.52,0,0,0,248.8,313.15Z /><path class=cls-1 d=M94.4,356.25s1.51,13.27,20.32,7,0,.6,0,.6L152.2,340l-46.33,16.24Z /><polygon class=cls-1 points="285.18 360.33 299.87 364.24 295.9 358.28 280.17 349.47 276.37 351.72 285.18 360.33"/><path class=cls-1 d=M153.67,312.3l6.26,7.88,18.67-4.47-1.21-13-1.32-.66s-3,.14-3,.72S153.67,312.3,153.67,312.3Z /><path class=cls-1 d=M249.32,312.18l-.81,1.34c-.57.9-1.38,2.13-2.23,3.23a7.4,7.4,0,0,1-.52.65c-.25.33-.53.61-.77.9l-.08.08a6.48,6.48,0,0,0-.65.7l0,.08c-.69.61.44-.86.44-.86l-22.8-9.51,2.47-9.11,7.41,2.09,1,.73c1.25.94,2.51,1.84,3.76,2.61.49.29.93.62,1.42.9A61.07,61.07,0,0,0,249.32,312.18Z /><path class=cls-1 d=M109.89,361.78s154.27-.06,184.2,2.46l-8.8-7.65L244,340l-28.67,15.32H186.72L156.21,340s-17.87,12.11-18,12.12S109.89,361.78,109.89,361.78Z /></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 全志Linux Tina-SDK开发完全手册 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 模块介绍 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/en/ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=/zh/ hreflang=zh class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/DongshanPI/TinaSDK-Docs/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> DongshanPI/TinaSDK-Docs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 0.站点指南 </a> </li> <li class=md-tabs__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-01/ class=md-tabs__link> 1.构建工具使用 </a> </li> <li class=md-tabs__item> <a href=../Linux_U-boot_DevelopmentGuide-01/ class=md-tabs__link> 2.Bootloader开发 </a> </li> <li class=md-tabs__item> <a href=../Linux_SID_DevelopmentGuide-01/ class=md-tabs__link> 3.Linux驱动开发 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../Linux_PWM_DevelopmentGuide-01/ class=md-tabs__link> 4.基础组件软件库 </a> </li> <li class=md-tabs__item> <a href=../Linux_Deploy_DevelopmentGuide-01/ class=md-tabs__link> 5.系统开发 </a> </li> <li class=md-tabs__item> <a href=../../ProjectActualCombat/GUI-LvglExample-01/ class=md-tabs__link> 6.应用示例与项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://tina.100ask.net title="全志Linux Tina-SDK开发完全手册" class="md-nav__button md-logo" aria-label="全志Linux Tina-SDK开发完全手册" data-md-component=logo> <svg id=图层_1 data-name="图层 1" xmlns=http://www.w3.org/2000/svg viewbox="0 0 400 400"><defs><style>.cls-1{fill:#151f45;fill-rule:evenodd;}</style></defs><title>东山派1号LOGO定稿</title><path class=cls-1 d=M339.43,62.45A195.41,195.41,0,0,0,61.92,337.64l-.08.2.55.27.67.67A195.41,195.41,0,1,0,339.43,62.45ZM208.26,19.36a181,181,0,0,1,121.26,53c2.44,2.48,4.83,5,7.15,7.59H208.26Zm0,166.87h44.23v-14H208.26v-35.9H269l5.19,0c11.24-.11,20.56-.23,30.47,6.14,20.17,12.89,15.49,40.5,15.49,40.57l-.08.44c-3.18,34.71-41.83,31.18-42,31.18l-.55,0H208.26ZM19.89,200.62A181.39,181.39,0,0,1,194.22,19.36V80H149.68c-4,0-6.06,0-8.22-.08-11-.23-23.75-.47-33.26,1.77C100.61,83.45,92.12,86.91,85,93.52s-12.58,16.31-13.88,30.35h.08a10.59,10.59,0,0,0-.36,1.53c-.15,1.34-.35,3.23-.43,5.51-.39,11.71,2,34.28,23.28,47.3,14.43,8.8,28.58,8.49,43.6,8.14,2.24,0,4.52-.12,8.49-.12h48.4v28.31H20.4C20.05,209.94,19.89,205.3,19.89,200.62Zm174.33-64.33v35.9h-48.4c-1.88,0-5.34.12-8.76.2-12.9.27-25.09.55-36-6.14C85.83,157,84.13,140.11,84.45,131.34l0-1.22.12,0,.47-5C86,115,89.76,108.22,94.59,103.7s11.13-7.08,16.79-8.42c8-1.84,19.74-1.65,29.84-1.45,3.7.08,7.32.16,8.46.16h44.54v28.27H152.67v14ZM22,228.57H194.22v19.07A157.63,157.63,0,0,0,68.88,324.59,180.64,180.64,0,0,1,22,228.57ZM294.92,356c-.59.4-1.18.75-1.81,1.1-.9.55-1.85,1.11-2.79,1.58a6.64,6.64,0,0,1-.95.55,181.66,181.66,0,0,1-176.3,0c-.27-.16-.59-.32-.86-.47-.91-.51-1.81-1.07-2.72-1.58l-2-1.18a180,180,0,0,1-28.31-21.15,143.82,143.82,0,0,1,248.49-4.09A179.72,179.72,0,0,1,294.92,356Zm42.74-35.78a158,158,0,0,0-129.4-72.85V228.57h69.12c4.6.32,52.1,2.52,56.58-43.6.36-2.36,5.27-37.08-21.74-54.38-13.41-8.61-24.65-8.49-38.14-8.33H208.26V94H348a181.41,181.41,0,0,1-10.34,226.19Z /><path class=cls-1 d=M294.92,356a30,30,0,0,1-3.93-2c-11.52-5-17.07-9.2-21.43-12.94-2.28-1.92-6.84-6.13-8.26-8.14-8.81-12.58-9.75-9.86-12-6-1.14,2-8.1,9.59-9.87,11.16a58,58,0,0,1-15.29,9.6,58.91,58.91,0,0,1-31.81,3.93c-33.81-5.35-34.68-28.23-45.1-27.48-3.77,10.34-23.51,25.4-36.25,30.43-1.1.43-2.24.9-3.46,1.37-1.53.59-3.11,1.18-4.8,1.69l-6,1.66c-2.52,1-1.14.35-2.28,1.33,1.37.75-.32.4,1.69.47,2.71.08,10-2.67,13.4-4l1-.39c5.46-2.16,9.55-4.64,13.76-6.8l-8.81,6.45c-.47.31-1.33.82-1.65,1l-1.53,1.3-.59.51,1.45,0,65.7-1.54-8.8-4.24c-2.84-1.77-7.16-5.35-8.65-7.9,15.09,14.15,42.73,17.45,64.12,9.55,4.76-1.77,13.37-6.84,15.77-9.52-6.09,8.22-11.8,9.17-18.13,12.47-1.73.86-.9.39-1.8,1.1l68.09.12h1.5a7.13,7.13,0,0,0-.55-.55c-2.68-2.4-8.34-4.88-11-8.1,3.81,1.69,8.65,4.28,13.8,6.52a62.09,62.09,0,0,0,11.28,3.74,15.82,15.82,0,0,0,2,.24c1.93-.08.47.19,1.77-.44C306,358.79,299.4,357.61,294.92,356Zm-83-76.51c-1.53-2.32-2.83-4.36-4.48-7.35-8.34-15.34-9.87,2.32-22.14,16.12-7.55,8.49-22.1,19.66-32.16,22.84,1.18.95-1.46,5.47,11.6-2.75,3.77-2.36,5.86-3.81,9.16-5.86a.3.3,0,0,1-.16-.08c-.16-.15.12-.74.87-1.73a22.41,22.41,0,0,1,2.08-1.81c1-.74,2-1.49,3-2.16a24,24,0,0,1,4.05-2.2,24.51,24.51,0,0,1,4.95-1.61,24.85,24.85,0,0,1,5-.47h28.74A102.79,102.79,0,0,1,211.88,279.45Zm-24.14,18.76a20.53,20.53,0,0,0-4.41.82,34,34,0,0,0-5.11,1.93,29.38,29.38,0,0,1-3.14,1.37c-1.46,3.23-1.54,2.72-8,7.24-3.18,2.24-7.47,4.24-10.26,6.72,3.07,5.58,12.07,11.29,18.09,14.31,1.3.63,2.71,1.26,4.21,1.85a7.93,7.93,0,0,1,2.12-3.89l3.07-3.3a18.45,18.45,0,0,0,2.47-4.53,39.27,39.27,0,0,0,1.89-6.21A65.14,65.14,0,0,0,189.9,307c.28-2.71.43-4.91.43-6.6v-2.28C189.62,298.13,188.8,298.17,187.74,298.21Zm61.06,14.94.78-1.3a59.82,59.82,0,0,1-11.08-5.94c-.47-.27-.91-.59-1.38-.86-1.22-.75-2.44-1.62-3.66-2.52-.59-.43-.94-.71-.94-.71-2.28-1.81-4.56-3.81-6.76-5.93v2.24h-10.7c-.47,1.81-.82,3.3-1,4.44a53.25,53.25,0,0,0-.63,5.7,71.55,71.55,0,0,0-.23,8.22c0,2.12.15,4.17.35,6.21s.43,3.74.71,5.15a4.23,4.23,0,0,0,1.06,2.6,2.37,2.37,0,0,0,1.34.43,5.31,5.31,0,0,0,2-.47c1-.36,1.57-.63,2-.83a1.43,1.43,0,0,1,.94-.23,1.21,1.21,0,0,1,.71.51c.12.27-.28.7-1.3,1.33a13.2,13.2,0,0,1-1.53.83c-.59.27-1.54.75-2.83,1.41s-2.28,1.18-2.95,1.54a15.09,15.09,0,0,1-1.85.86,1.27,1.27,0,0,1-1.38-.08c-.19-.07-.43-.43-.7-1a12,12,0,0,1-.67-3.3c-.2-1.61-.32-2.95-.4-4.09s-.07-3.34-.11-6.57,0-5.54.11-7a65.82,65.82,0,0,1,1.11-7.7,35.56,35.56,0,0,1,1.53-5.74l.82-2.24h-19c0,.94,0,2.12,0,3.61s-.08,3.86-.2,7.08-.43,6.53-.87,9.75a58.42,58.42,0,0,1-1.73,8.46,30.58,30.58,0,0,1-2.28,6,6.57,6.57,0,0,1-1.29,1.89,58.67,58.67,0,0,0,15.61,2,63,63,0,0,0,26.18-6.33,51.9,51.9,0,0,0,16.16-12l0-.08a7.77,7.77,0,0,1,.63-.66l.08-.08c.23-.28.51-.55.74-.87a7.6,7.6,0,0,0,.56-.59l0,0c-6.88-5.38-16.67-9.24-19.7-15.76,6.72,4.24,11.44,8.1,19.58,11.79A10.52,10.52,0,0,0,248.8,313.15Z /><path class=cls-1 d=M94.4,356.25s1.51,13.27,20.32,7,0,.6,0,.6L152.2,340l-46.33,16.24Z /><polygon class=cls-1 points="285.18 360.33 299.87 364.24 295.9 358.28 280.17 349.47 276.37 351.72 285.18 360.33"/><path class=cls-1 d=M153.67,312.3l6.26,7.88,18.67-4.47-1.21-13-1.32-.66s-3,.14-3,.72S153.67,312.3,153.67,312.3Z /><path class=cls-1 d=M249.32,312.18l-.81,1.34c-.57.9-1.38,2.13-2.23,3.23a7.4,7.4,0,0,1-.52.65c-.25.33-.53.61-.77.9l-.08.08a6.48,6.48,0,0,0-.65.7l0,.08c-.69.61.44-.86.44-.86l-22.8-9.51,2.47-9.11,7.41,2.09,1,.73c1.25.94,2.51,1.84,3.76,2.61.49.29.93.62,1.42.9A61.07,61.07,0,0,0,249.32,312.18Z /><path class=cls-1 d=M109.89,361.78s154.27-.06,184.2,2.46l-8.8-7.65L244,340l-28.67,15.32H186.72L156.21,340s-17.87,12.11-18,12.12S109.89,361.78,109.89,361.78Z /></svg> </a> 全志Linux Tina-SDK开发完全手册 </label> <div class=md-nav__source> <a href=https://github.com/DongshanPI/TinaSDK-Docs/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> DongshanPI/TinaSDK-Docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../.. class="md-nav__link "> <span class=md-ellipsis> 0.站点指南 </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 0.站点指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../SupportHardware/ class=md-nav__link> <span class=md-ellipsis> 配套硬件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 1.构建工具使用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 1.构建工具使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> TinaSDK_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> TinaSDK_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> Tina环境搭建 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Tina编译与烧写 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> uboot与kernel定制开发 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 系统定制开发 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> 2.Bootloader开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 2.Bootloader开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> U-boot_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> U-boot_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 编译方法介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> U-Boot功能与配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> U-Boot常用命令介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 调试方法与烧写 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 常用接口函数 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 3.Linux驱动开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 3.Linux驱动开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> SID_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> SID_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块设计 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 接口设计 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 可测试性与其他说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> GPIO_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> GPIO_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 使用示例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> MIPI_CSI_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> MIPI_CSI_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> V4L2接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> MMC_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> MMC_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> RTC_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> RTC_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> SPI_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> SPI_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> Standby_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Standby_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Standby_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Standby_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Standby_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> <span class=md-ellipsis> TWI_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> TWI_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> <span class=md-ellipsis> UART_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> UART_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> <span class=md-ellipsis> USB_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> USB_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 附录 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_11> <label class=md-nav__link for=__nav_4_11 id=__nav_4_11_label tabindex=0> <span class=md-ellipsis> Key_快速配置使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_11_label aria-expanded=false> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> Key_快速配置使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> GPIO-Key </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> ADC-Key </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> AXP-Key </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_12> <label class=md-nav__link for=__nav_4_12 id=__nav_4_12_label tabindex=0> <span class=md-ellipsis> PMU_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_12_label aria-expanded=false> <label class=md-nav__title for=__nav_4_12> <span class="md-nav__icon md-icon"></span> PMU_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_13> <label class=md-nav__link for=__nav_4_13 id=__nav_4_13_label tabindex=0> <span class=md-ellipsis> Wi-Fi_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_13_label aria-expanded=false> <label class=md-nav__title for=__nav_4_13> <span class="md-nav__icon md-icon"></span> Wi-Fi_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi简介 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi模组移植 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi_manager与Softap介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 常见问题 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> 4.基础组件软件库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 4.基础组件软件库 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> PWM_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> PWM_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_PWM_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PWM_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> MPP_sample_使用说明 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> MPP_sample_使用说明 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-01/ class=md-nav__link> <span class=md-ellipsis> 简述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-02/ class=md-nav__link> <span class=md-ellipsis> 配置编译测试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-03/ class=md-nav__link> <span class=md-ellipsis> 分类情况 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-04/ class=md-nav__link> <span class=md-ellipsis> 各平台支持情况 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-05/ class=md-nav__link> <span class=md-ellipsis> 测试方法 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> Camera_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Camera_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块开发 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 模块调试常见问题 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> camera功能测试 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> E907_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> E907_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 启动E907环境 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> AMP环境搭建 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 开发使用 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 其他 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> LCD_调试指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> LCD_调试指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 硬件参数说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 调试方法 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 总结 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> Display_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Display_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块接口概述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 操作与接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 输出设备介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> IOCTL接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> sysfs接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-08/ class=md-nav__link> <span class=md-ellipsis> 数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-09/ class=md-nav__link> <span class=md-ellipsis> 调试 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> 图形系统_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> 图形系统_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> MiniGUI </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> QT </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> EFL与GTK+ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> WebKitGtk与DirectFB </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> Wayland </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> LVGL </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-08/ class=md-nav__link> <span class=md-ellipsis> Flutter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8 checked> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> 音频_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=true> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> 音频_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 模块介绍 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 模块介绍 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#2 class=md-nav__link> <span class=md-ellipsis> 2 模块介绍 </span> </a> <nav class=md-nav aria-label="2 模块介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> <span class=md-ellipsis> 2.1 驱动框架 </span> </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> <span class=md-ellipsis> 2.2 音频接口介绍. </span> </a> </li> <li class=md-nav__item> <a href=#23-r6 class=md-nav__link> <span class=md-ellipsis> 2.3 R6音频接口 </span> </a> </li> <li class=md-nav__item> <a href=#24-r7s class=md-nav__link> <span class=md-ellipsis> 2.4 R7s音频接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#25-r11 class=md-nav__link> <span class=md-ellipsis> 2.5 R11音频接口 </span> </a> <nav class=md-nav aria-label="2.5 R11音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#251 class=md-nav__link> <span class=md-ellipsis> 2.5.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#252 class=md-nav__link> <span class=md-ellipsis> 2.5.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#253 class=md-nav__link> <span class=md-ellipsis> 2.5.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#254-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.5.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#255-daudio class=md-nav__link> <span class=md-ellipsis> 2.5.5 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#256 class=md-nav__link> <span class=md-ellipsis> 2.5.6 标案音频测试方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#26-r16 class=md-nav__link> <span class=md-ellipsis> 2.6 R16音频接口 </span> </a> <nav class=md-nav aria-label="2.6 R16音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#261 class=md-nav__link> <span class=md-ellipsis> 2.6.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#262 class=md-nav__link> <span class=md-ellipsis> 2.6.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#263 class=md-nav__link> <span class=md-ellipsis> 2.6.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#264-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.6.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#265-daudio class=md-nav__link> <span class=md-ellipsis> 2.6.5 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#266 class=md-nav__link> <span class=md-ellipsis> 2.6.6 标案音频测试方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#27-r18 class=md-nav__link> <span class=md-ellipsis> 2.7 R18音频接口 </span> </a> <nav class=md-nav aria-label="2.7 R18音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#271 class=md-nav__link> <span class=md-ellipsis> 2.7.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#272 class=md-nav__link> <span class=md-ellipsis> 2.7.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#273 class=md-nav__link> <span class=md-ellipsis> 2.7.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#274-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.7.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#275-daudio class=md-nav__link> <span class=md-ellipsis> 2.75 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#276-spdif class=md-nav__link> <span class=md-ellipsis> 2.7.6 SPDIF </span> </a> </li> <li class=md-nav__item> <a href=#277-codecac108 class=md-nav__link> <span class=md-ellipsis> 2.7.7 外挂codec:AC108 </span> </a> </li> <li class=md-nav__item> <a href=#278-tas5731 class=md-nav__link> <span class=md-ellipsis> 2.7.8 外挂数字功放TAS5731. </span> </a> </li> <li class=md-nav__item> <a href=#279-hdmi class=md-nav__link> <span class=md-ellipsis> 2.7.9 HDMI音频接口 </span> </a> </li> <li class=md-nav__item> <a href=#2710 class=md-nav__link> <span class=md-ellipsis> 2.7.10 标案音频测试方法. </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28-r30 class=md-nav__link> <span class=md-ellipsis> 2.8 R30音频接口 </span> </a> <nav class=md-nav aria-label="2.8 R30音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#281 class=md-nav__link> <span class=md-ellipsis> 2.8.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#282 class=md-nav__link> <span class=md-ellipsis> 2.8.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#283 class=md-nav__link> <span class=md-ellipsis> 2.8.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#284-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.8.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#285-daudio class=md-nav__link> <span class=md-ellipsis> 2.8.5 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#286-dmic class=md-nav__link> <span class=md-ellipsis> 2.8.6 DMIC </span> </a> </li> <li class=md-nav__item> <a href=#287 class=md-nav__link> <span class=md-ellipsis> 2.8.7 标案音频测试方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#29-r328 class=md-nav__link> <span class=md-ellipsis> 2.9 R328音频接口. </span> </a> <nav class=md-nav aria-label="2.9 R328音频接口."> <ul class=md-nav__list> <li class=md-nav__item> <a href=#291 class=md-nav__link> <span class=md-ellipsis> 2.9.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#292 class=md-nav__link> <span class=md-ellipsis> 2.9.2 时钟源. </span> </a> </li> <li class=md-nav__item> <a href=#293 class=md-nav__link> <span class=md-ellipsis> 2.9.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#294-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.9.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#2145-daudio class=md-nav__link> <span class=md-ellipsis> 2.14.5 Daudio </span> </a> </li> <li class=md-nav__item> <a href=#2146-dmic class=md-nav__link> <span class=md-ellipsis> 2.14.6 Dmic </span> </a> </li> <li class=md-nav__item> <a href=#2147-spdif class=md-nav__link> <span class=md-ellipsis> 2.14.7 SPDIF </span> </a> </li> <li class=md-nav__item> <a href=#2148-mad class=md-nav__link> <span class=md-ellipsis> 2.14.8 MAD </span> </a> </li> <li class=md-nav__item> <a href=#2149-vad class=md-nav__link> <span class=md-ellipsis> 2.14.9 VAD. </span> </a> </li> <li class=md-nav__item> <a href=#21410 class=md-nav__link> <span class=md-ellipsis> 2.14.10标案音频测试方法. </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#220-v853 class=md-nav__link> <span class=md-ellipsis> 2.20 V853音频接口 </span> </a> <nav class=md-nav aria-label="2.20 V853音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2201 class=md-nav__link> <span class=md-ellipsis> 2.20.1 时钟源. </span> </a> </li> <li class=md-nav__item> <a href=#2202 class=md-nav__link> <span class=md-ellipsis> 2.20.2 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#2203-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.20.3 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#2204-daudio class=md-nav__link> <span class=md-ellipsis> 2.20.4 Daudio </span> </a> </li> <li class=md-nav__item> <a href=#2205-dmic class=md-nav__link> <span class=md-ellipsis> 2.20.5 DMIC. </span> </a> </li> <li class=md-nav__item> <a href=#2206-rx_sync class=md-nav__link> <span class=md-ellipsis> 2.20.6 RX_SYNC多声卡同步功能 </span> </a> </li> <li class=md-nav__item> <a href=#2207 class=md-nav__link> <span class=md-ellipsis> 2.20.7 标案音频测试方法. </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#221-f133 class=md-nav__link> <span class=md-ellipsis> 2.21 F133音频接口 </span> </a> <nav class=md-nav aria-label="2.21 F133音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2211 class=md-nav__link> <span class=md-ellipsis> 2.21.1 时钟源. </span> </a> </li> <li class=md-nav__item> <a href=#2212-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.21.2 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#2213-daudio class=md-nav__link> <span class=md-ellipsis> 2.21.3 Daudio </span> </a> </li> <li class=md-nav__item> <a href=#2214-dmic class=md-nav__link> <span class=md-ellipsis> 2.21.4 DMIC. </span> </a> </li> <li class=md-nav__item> <a href=#2215-spdif class=md-nav__link> <span class=md-ellipsis> 2.21.5 SPDIF </span> </a> </li> <li class=md-nav__item> <a href=#2216 class=md-nav__link> <span class=md-ellipsis> 2.21.6 标案音频测试方法. </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 常用工具及调试方法 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 常用接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 开机音乐功能 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 各平台音频模块注意事项 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> WiFi_RF测试_使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> WiFi_RF测试_使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> WiFi测试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> XRADIO系列模组 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> RTL系列模组 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> SRRC认证 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex=0> <span class=md-ellipsis> 各平台多媒体格式支持列表 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> 各平台多媒体格式支持列表 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Support_List_Multimedia_Formats_Each_Platform-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Support_List_Multimedia_Formats_Each_Platform-02/ class=md-nav__link> <span class=md-ellipsis> 芯片 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex=0> <span class=md-ellipsis> 配网_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> 配网_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Distribution_Network_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Distribution_Network_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> wifimanager-v2.0配网 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Distribution_Network_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 测试说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> 网络性能_参考指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> 网络性能_参考指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Network_Performance_Reference_Guide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Network_Performance_Reference_Guide-02/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi性能测试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Network_Performance_Reference_Guide-03/ class=md-nav__link> <span class=md-ellipsis> 蓝牙与WIFI蓝牙共存测试 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 5.系统开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 5.系统开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 系统配置_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 系统配置_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 系统配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 设备树介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 设备树的使用与调试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 分区表说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 系统调试_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 系统调试_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SystemDebug_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemDebug_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 调试方法及工具 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 系统裁剪_参考指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 系统裁剪_参考指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SystemClipping_Reference_Guide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemClipping_Reference_Guide-02/ class=md-nav__link> <span class=md-ellipsis> 系统裁剪介绍 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 启动优化_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 启动优化_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_systemStartup_Optimization-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_systemStartup_Optimization-02/ class=md-nav__link> <span class=md-ellipsis> 启动速度优化简介 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_systemStartup_Optimization-03/ class=md-nav__link> <span class=md-ellipsis> Tina启动速度优化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> SPINAND_UBI_离线烧录_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> SPINAND_UBI_离线烧录_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Spinubi_OfflineBurning_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Spinubi_OfflineBurning_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 数据布局说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Spinubi_OfflineBurning_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 调整内存说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> NOR_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> NOR_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 使用例子 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_7> <label class=md-nav__link for=__nav_6_7 id=__nav_6_7_label tabindex=0> <span class=md-ellipsis> SPINAND 开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_7_label aria-expanded=false> <label class=md-nav__title for=__nav_6_7> <span class="md-nav__icon md-icon"></span> SPINAND 开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SPINAND_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPINAND_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 流程设计 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPINAND_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_8> <label class=md-nav__link for=__nav_6_8 id=__nav_6_8_label tabindex=0> <span class=md-ellipsis> 存储_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_8_label aria-expanded=false> <label class=md-nav__title for=__nav_6_8> <span class="md-nav__icon md-icon"></span> 存储_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 分区管理 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 系统挂载 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 文件系统支持情况 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> UBI_VS._NFTL </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> rootfs_data及UDISK </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> 关键数据保护 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_9> <label class=md-nav__link for=__nav_6_9 id=__nav_6_9_label tabindex=0> <span class=md-ellipsis> OTA_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_9_label aria-expanded=false> <label class=md-nav__title for=__nav_6_9> <span class="md-nav__icon md-icon"></span> OTA_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> ota-burnboot介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Tina_SWUpdate_OTA介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> Tina_misc-upgrade介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> Tina_upgrade_app介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 注意事项与问题排查 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_10> <label class=md-nav__link for=__nav_6_10 id=__nav_6_10_label tabindex=0> <span class=md-ellipsis> syslog_使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_10_label aria-expanded=false> <label class=md-nav__title for=__nav_6_10> <span class="md-nav__icon md-icon"></span> syslog_使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> syslog相关软件工具 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> 不同syslog方案的对比 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> 其他注意事项 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> 在Tina中使用syslog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_11> <label class=md-nav__link for=__nav_6_11 id=__nav_6_11_label tabindex=0> <span class=md-ellipsis> 安全_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_11_label aria-expanded=false> <label class=md-nav__title for=__nav_6_11> <span class="md-nav__icon md-icon"></span> 安全_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 安全系统基础 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 安全启动 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 安全操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> TA/CA开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 安全存储 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> 安全性增强的Linux </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-08/ class=md-nav__link> <span class=md-ellipsis> 量产工具 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-09/ class=md-nav__link> <span class=md-ellipsis> 参考资料 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_12> <label class=md-nav__link for=__nav_6_12 id=__nav_6_12_label tabindex=0> <span class=md-ellipsis> 功耗管理_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_12_label aria-expanded=false> <label class=md-nav__title for=__nav_6_12> <span class="md-nav__icon md-icon"></span> 功耗管理_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> Tina功耗管理框架概述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Tina休眠唤醒系统简介 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 差异化方案说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ问题及处理方法 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_13> <label class=md-nav__link for=__nav_6_13 id=__nav_6_13_label tabindex=0> <span class=md-ellipsis> 内存优化_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_13_label aria-expanded=false> <label class=md-nav__title for=__nav_6_13> <span class="md-nav__icon md-icon"></span> 内存优化_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Memory_Optimization_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Memory_Optimization_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 内存使用情况分析 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Memory_Optimization_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 内存优化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_14> <label class=md-nav__link for=__nav_6_14 id=__nav_6_14_label tabindex=0> <span class=md-ellipsis> 存储性能_参考指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_14_label aria-expanded=false> <label class=md-nav__title for=__nav_6_14> <span class="md-nav__icon md-icon"></span> 存储性能_参考指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-02/ class=md-nav__link> <span class=md-ellipsis> 经验性能值 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-03/ class=md-nav__link> <span class=md-ellipsis> 顺序与随机读写性能 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-04/ class=md-nav__link> <span class=md-ellipsis> 读写性能的影响因素 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_15> <label class=md-nav__link for=__nav_6_15 id=__nav_6_15_label tabindex=0> <span class=md-ellipsis> 打包流程_说明指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_15_label aria-expanded=false> <label class=md-nav__title for=__nav_6_15> <span class="md-nav__icon md-icon"></span> 打包流程_说明指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-02/ class=md-nav__link> <span class=md-ellipsis> 打包工具介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-03/ class=md-nav__link> <span class=md-ellipsis> 打包脚本分析 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-04/ class=md-nav__link> <span class=md-ellipsis> 获得打包后的分区镜像文件 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-05/ class=md-nav__link> <span class=md-ellipsis> 打包常见问题FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-06/ class=md-nav__link> <span class=md-ellipsis> 打包流程总结 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_16> <label class=md-nav__link for=__nav_6_16 id=__nav_6_16_label tabindex=0> <span class=md-ellipsis> 量产测试_使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_16_label aria-expanded=false> <label class=md-nav__title for=__nav_6_16> <span class="md-nav__icon md-icon"></span> 量产测试_使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> 测试环境搭建 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> 量产测试流程 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> 各平台Tinatest场景验证表 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> 6.应用示例与项目 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 6.应用示例与项目 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> LVGL开发实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> LVGL开发实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ProjectActualCombat/GUI-LvglExample-01/ class=md-nav__link> <span class=md-ellipsis> 2048小游戏 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#2 class=md-nav__link> <span class=md-ellipsis> 2 模块介绍 </span> </a> <nav class=md-nav aria-label="2 模块介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> <span class=md-ellipsis> 2.1 驱动框架 </span> </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> <span class=md-ellipsis> 2.2 音频接口介绍. </span> </a> </li> <li class=md-nav__item> <a href=#23-r6 class=md-nav__link> <span class=md-ellipsis> 2.3 R6音频接口 </span> </a> </li> <li class=md-nav__item> <a href=#24-r7s class=md-nav__link> <span class=md-ellipsis> 2.4 R7s音频接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#25-r11 class=md-nav__link> <span class=md-ellipsis> 2.5 R11音频接口 </span> </a> <nav class=md-nav aria-label="2.5 R11音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#251 class=md-nav__link> <span class=md-ellipsis> 2.5.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#252 class=md-nav__link> <span class=md-ellipsis> 2.5.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#253 class=md-nav__link> <span class=md-ellipsis> 2.5.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#254-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.5.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#255-daudio class=md-nav__link> <span class=md-ellipsis> 2.5.5 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#256 class=md-nav__link> <span class=md-ellipsis> 2.5.6 标案音频测试方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#26-r16 class=md-nav__link> <span class=md-ellipsis> 2.6 R16音频接口 </span> </a> <nav class=md-nav aria-label="2.6 R16音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#261 class=md-nav__link> <span class=md-ellipsis> 2.6.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#262 class=md-nav__link> <span class=md-ellipsis> 2.6.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#263 class=md-nav__link> <span class=md-ellipsis> 2.6.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#264-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.6.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#265-daudio class=md-nav__link> <span class=md-ellipsis> 2.6.5 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#266 class=md-nav__link> <span class=md-ellipsis> 2.6.6 标案音频测试方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#27-r18 class=md-nav__link> <span class=md-ellipsis> 2.7 R18音频接口 </span> </a> <nav class=md-nav aria-label="2.7 R18音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#271 class=md-nav__link> <span class=md-ellipsis> 2.7.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#272 class=md-nav__link> <span class=md-ellipsis> 2.7.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#273 class=md-nav__link> <span class=md-ellipsis> 2.7.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#274-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.7.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#275-daudio class=md-nav__link> <span class=md-ellipsis> 2.75 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#276-spdif class=md-nav__link> <span class=md-ellipsis> 2.7.6 SPDIF </span> </a> </li> <li class=md-nav__item> <a href=#277-codecac108 class=md-nav__link> <span class=md-ellipsis> 2.7.7 外挂codec:AC108 </span> </a> </li> <li class=md-nav__item> <a href=#278-tas5731 class=md-nav__link> <span class=md-ellipsis> 2.7.8 外挂数字功放TAS5731. </span> </a> </li> <li class=md-nav__item> <a href=#279-hdmi class=md-nav__link> <span class=md-ellipsis> 2.7.9 HDMI音频接口 </span> </a> </li> <li class=md-nav__item> <a href=#2710 class=md-nav__link> <span class=md-ellipsis> 2.7.10 标案音频测试方法. </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28-r30 class=md-nav__link> <span class=md-ellipsis> 2.8 R30音频接口 </span> </a> <nav class=md-nav aria-label="2.8 R30音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#281 class=md-nav__link> <span class=md-ellipsis> 2.8.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#282 class=md-nav__link> <span class=md-ellipsis> 2.8.2 时钟源 </span> </a> </li> <li class=md-nav__item> <a href=#283 class=md-nav__link> <span class=md-ellipsis> 2.8.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#284-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.8.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#285-daudio class=md-nav__link> <span class=md-ellipsis> 2.8.5 Daudio. </span> </a> </li> <li class=md-nav__item> <a href=#286-dmic class=md-nav__link> <span class=md-ellipsis> 2.8.6 DMIC </span> </a> </li> <li class=md-nav__item> <a href=#287 class=md-nav__link> <span class=md-ellipsis> 2.8.7 标案音频测试方法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#29-r328 class=md-nav__link> <span class=md-ellipsis> 2.9 R328音频接口. </span> </a> <nav class=md-nav aria-label="2.9 R328音频接口."> <ul class=md-nav__list> <li class=md-nav__item> <a href=#291 class=md-nav__link> <span class=md-ellipsis> 2.9.1 硬件资源 </span> </a> </li> <li class=md-nav__item> <a href=#292 class=md-nav__link> <span class=md-ellipsis> 2.9.2 时钟源. </span> </a> </li> <li class=md-nav__item> <a href=#293 class=md-nav__link> <span class=md-ellipsis> 2.9.3 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#294-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.9.4 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#2145-daudio class=md-nav__link> <span class=md-ellipsis> 2.14.5 Daudio </span> </a> </li> <li class=md-nav__item> <a href=#2146-dmic class=md-nav__link> <span class=md-ellipsis> 2.14.6 Dmic </span> </a> </li> <li class=md-nav__item> <a href=#2147-spdif class=md-nav__link> <span class=md-ellipsis> 2.14.7 SPDIF </span> </a> </li> <li class=md-nav__item> <a href=#2148-mad class=md-nav__link> <span class=md-ellipsis> 2.14.8 MAD </span> </a> </li> <li class=md-nav__item> <a href=#2149-vad class=md-nav__link> <span class=md-ellipsis> 2.14.9 VAD. </span> </a> </li> <li class=md-nav__item> <a href=#21410 class=md-nav__link> <span class=md-ellipsis> 2.14.10标案音频测试方法. </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#220-v853 class=md-nav__link> <span class=md-ellipsis> 2.20 V853音频接口 </span> </a> <nav class=md-nav aria-label="2.20 V853音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2201 class=md-nav__link> <span class=md-ellipsis> 2.20.1 时钟源. </span> </a> </li> <li class=md-nav__item> <a href=#2202 class=md-nav__link> <span class=md-ellipsis> 2.20.2 代码结构 </span> </a> </li> <li class=md-nav__item> <a href=#2203-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.20.3 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#2204-daudio class=md-nav__link> <span class=md-ellipsis> 2.20.4 Daudio </span> </a> </li> <li class=md-nav__item> <a href=#2205-dmic class=md-nav__link> <span class=md-ellipsis> 2.20.5 DMIC. </span> </a> </li> <li class=md-nav__item> <a href=#2206-rx_sync class=md-nav__link> <span class=md-ellipsis> 2.20.6 RX_SYNC多声卡同步功能 </span> </a> </li> <li class=md-nav__item> <a href=#2207 class=md-nav__link> <span class=md-ellipsis> 2.20.7 标案音频测试方法. </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#221-f133 class=md-nav__link> <span class=md-ellipsis> 2.21 F133音频接口 </span> </a> <nav class=md-nav aria-label="2.21 F133音频接口"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2211 class=md-nav__link> <span class=md-ellipsis> 2.21.1 时钟源. </span> </a> </li> <li class=md-nav__item> <a href=#2212-audiocodec class=md-nav__link> <span class=md-ellipsis> 2.21.2 AudioCodec </span> </a> </li> <li class=md-nav__item> <a href=#2213-daudio class=md-nav__link> <span class=md-ellipsis> 2.21.3 Daudio </span> </a> </li> <li class=md-nav__item> <a href=#2214-dmic class=md-nav__link> <span class=md-ellipsis> 2.21.4 DMIC. </span> </a> </li> <li class=md-nav__item> <a href=#2215-spdif class=md-nav__link> <span class=md-ellipsis> 2.21.5 SPDIF </span> </a> </li> <li class=md-nav__item> <a href=#2216 class=md-nav__link> <span class=md-ellipsis> 2.21.6 标案音频测试方法. </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>模块介绍</h1> <h2 id=2>2 模块介绍</h2> <p>Linux中的音频子系统采用ALSA架构实现。ALSA目前已经成为了Linux的主流音频体系结构。在内核设备驱动层，ALSA提供了alsa-driver，同时在应用层，ALSA为我们提供了alsa-lib，应用程序只要调用alsa-lib提供的API，即可以完成对底层音频硬件的控制。</p> <h3 id=21>2.1 驱动框架</h3> <p>Tina SDK对各个平台的音频设备驱动均采用ASoC架构实现。ASoC是建立在标准alsa驱动层上，为了更好地支持嵌入式处理器和移动设备中的音频codec的一套软件体系，ASoC将音频系统分为 3 部分：Codec，Platform和Machine。</p> <ol> <li>Codec驱动</li> </ol> <p>ASoC中的一个重要设计原则就是要求Codec驱动是平台无关的,它包含了一些音频的控件(Controls),音频接口,DAMP(动态音频电源管理)的定义和某些Codec IO功能。为了保证硬件无关性,任何特定于平台和机器的代码都要移到Platform和Machine驱动中。 所有的Codec驱动都要提供以下特性：</p> <div class=highlight><pre><span></span><code>   - Codec DAI (Digital Audio Interface)和PCM的配置信息；
   - Codec的IO控制方式(I2C,SPI等);
   - Mixer和其他的音频控件;
   - Codec和ALSA音频操作接口;
</code></pre></div> <ol> <li>Platform驱动</li> </ol> <p>它包含了该SoC平台的音频DMA和音频接口的配置和控制（I2S，PCM，AC97等等）； 一般不包含与板子或codec相关的代码。</p> <ol> <li>Machine驱动单独的Platform和Codec驱动是不能工作的，它必须由Machine驱动把它们结合在一起才能完成整个设备的音频处理工作。</li> </ol> <p><img alt="图2-1: ASoC框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-1.jpg></p> <h3 id=22>2.2 音频接口介绍.</h3> <p>我们提供的音频接口有:</p> <ul> <li>AudioCodec</li> <li>Daudio(I2S)</li> <li>Dmic</li> <li>Spdif</li> <li>MAD</li> </ul> <p>不同芯片平台的音频接口资源会有差异；不同版本的内核，对应的ALSA驱动也有所不同；下面会对各个芯片作详细介绍。</p> <h3 id=23-r6>2.3 R6音频接口</h3> <h4 id=231>2.3.1 硬件资源</h4> <p>R6包含 2 个音频模块，分别是内置audiocodec以及daudio0。</p> <p><img alt="图2-2: R6音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-2.jpg></p> <h4 id=232>2.3.2 时钟源</h4> <p>R6中， 2 个音频模块的时钟源均来自pll_audio。</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播放录音。</p> <p><img alt="图2-3: R6时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-3.jpg></p> <h4 id=233>2.3.3 代码结构</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>linux-3.10/sound/soc/sunxi/
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a>├── sun3iw1_ac101.c // daudio+ac101的machine驱动
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a>├── sun3iw1_codec.c // codec 驱动
<a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a>├── sun3iw1_codec.h
<a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a>├── sun3iw1_daudio.c // daudio的platform驱动
<a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a>├── sun3iw1_daudio.h
<a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a>├── sun3iw1_sndcodec.c // codec machine驱动
<a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a>├── sunxi_cpudai.c // codec platform驱动
<a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a>├── sunxi_cpudai.h
<a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a>├── sunxi_dma.c //通用文件，提供注册platform驱动的接口及相关函数集
<a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a>├── sunxi_dma.h
<a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a>├── sunxi_rw_func.c //通用文件，读写模拟/数字寄存器的接口
<a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a>└── sunxi_rw_func.h
<a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a>
<a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a>linux-3.10/sound/soc/codecs/
<a href=#__codelineno-0-16 id=__codelineno-0-16 name=__codelineno-0-16></a>├── ac101.c // daudio+ac101的codec驱动
<a href=#__codelineno-0-17 id=__codelineno-0-17 name=__codelineno-0-17></a>└── ac101.h
</code></pre></div> <h4 id=234-audiocodec>2.3.4 Audiocodec.</h4> <p>硬件特性</p> <ul> <li> <p>两路DAC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~192KHz采样率</p> </li> <li> <p>一路ADC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~48KHz采样率</p> </li> <li> <p>一路模拟输出：一路立体声headphone输出(HPL, HPR)</p> </li> <li>四路模拟输入：MIC,FMINL,FMINR,LINEIN</li> <li>支持同时playback和record(全双工模式)</li> </ul> <h5 id=2341>2.3.4.1 内核配置</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>Device Drivers ---&gt;
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a>    &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a>        &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a>            &lt;*&gt; ASoC support for SUNXI ---&gt;
<a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a>                &lt;*&gt; ASoC support for sun3iw1 audiocodec
<a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a>                &lt;*&gt; ASoC support for internal-codec cpudai
<a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a>                &lt;*&gt; ASoC support for sun3iw1 audiocodec machine
</code></pre></div> <h5 id=2342-sys_config>2.3.4.2 sys_config配置.</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>[sndcodec]
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>sndcodec_used = 0x1
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>;------------------------------------------------------------------------------
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a>[cpudai]
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a>cpudai_used = 0x1
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>;------------------------------------------------------------------------------
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a>[codec]
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a>codec_used = 0x1
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a>headphonevol = 0x3b
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a>maingain = 0
<a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a>pa_sleep_time = 30
<a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a>gpio-spk = port:PD03&lt;1&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a>gpio_shdn = 1
</code></pre></div> <p>sndcodec配置，即machine驱动的相关配置。</p> <table> <thead> <tr> <th style="text-align: left;">sndcodec配置</th> <th style="text-align: left;">sndcodec配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">sndcodec_used</td> <td style="text-align: left;">是否使用sndcodec驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>cpudai配置，即platform驱动的相关配置。</p> <table> <thead> <tr> <th style="text-align: left;">cpudai配置</th> <th style="text-align: left;">cpudai配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">cpudai_used 是否使用cpudai驱动。</td> <td style="text-align: left;">0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>codec配置，即内置audiocodec驱动的相关配置。</p> <table> <thead> <tr> <th style="text-align: left;">codec配置</th> <th style="text-align: left;">codec配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">codec_used</td> <td style="text-align: left;">是否使用codec驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td style="text-align: left;">headphonevol</td> <td style="text-align: left;">headphone volume，可设定范围0~0x3f, 0表示mute, 1<sub>63表示-62dB</sub>0dB, 1dB/step</td> </tr> <tr> <td style="text-align: left;">micgain</td> <td style="text-align: left;">mic增益，可设定范围0~0x7, 0:0dB, 1<sub>7:15</sub>33dB, 3dB/step,一般设置0x4,即24dB.如果作为aec回路，则需要设置为0dB</td> </tr> <tr> <td style="text-align: left;">pa_sleep_time</td> <td style="text-align: left;">操作PA之后的延时时间(用来避免pop音),单位ms</td> </tr> <tr> <td style="text-align: left;">gpio-spk</td> <td style="text-align: left;">PA使能引脚</td> </tr> <tr> <td style="text-align: left;">gpio_shdn</td> <td style="text-align: left;">PA引脚使能方式。0:低电平有效； 1 ：高电平有效</td> </tr> </tbody> </table> <blockquote> <p>说明</p> </blockquote> <ul> <li>如果想要正常加载audiocodec 声卡， 需要把codec,platform,machine 驱动都选上， 即codec_used,cpudai_used,sndcodec_used 都置为1；</li> <li>headphonevol 等值会在驱动初始化的时候设置，进入系统后还可以通过amixer 工具对应控件进行再次修改；</li> <li>注意gpio-spk 是否配置正确，是否有其他模块复用了该gpio;</li> <li>除了gpio-spk 指定pa 使能引脚外，驱动中也会检测gpio_num 字段，所以可以直接将gpio 号赋值gpio_num;</li> <li>注意gpio_shdn，实际功放的PA 引脚是高电平有效，还是低电平有效</li> </ul> <h5 id=2343-codec>2.3.4.3 codec数据通路</h5> <p><img alt="图2-4: R6音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-4.jpg></p> <p>R6平台的audiocodec驱动会在播歌的时候自动设置相关通路，默认audio map:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>播歌
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a>DACL --&gt; HP_L Mux --&gt; HPOUTL
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a>DACR --&gt; HP_R Mux --&gt; HPOUTR
</code></pre></div> <p>录音功能则根据需要操作对应空间使能通路:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a>录制单MIC数据
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>MICIN --&gt; ADC Mixer -&gt; ADC
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a>录制内部AEC数据(不需要外围回采电路)
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a>Left Output Mixer --&gt; ADC Mixer -&gt; ADC
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a>Right Output Mixer --&gt; ADC Mixer -&gt; ADC
</code></pre></div> <p>R6相关控件如下表：</p> <table> <thead> <tr> <th style="text-align: left;">控件名称</th> <th style="text-align: left;">功能</th> <th style="text-align: left;">数值</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">ADC INPUT GAIN control</td> <td style="text-align: left;">ADC增益</td> <td style="text-align: left;">0–7,表示-4.5–6dB</td> </tr> <tr> <td style="text-align: left;">ADC MIC Boost AMP</td> <td style="text-align: left;">enMIC Boost AMP使能</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">ADC MIC Boost AMP</td> <td style="text-align: left;">gain control MIC增益</td> <td style="text-align: left;">0–7, 0:0dB, 1~7:15–33dB</td> </tr> <tr> <td style="text-align: left;">ADC PA speed select</td> <td style="text-align: left;">PA速度选择 0:normal; 1:fast</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">ADC mixer mute for FML</td> <td style="text-align: left;">ADC Mixer设置，使能FML通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">ADC mixer mute for FMR</td> <td style="text-align: left;">ADC Mixer设置，使能FMR通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">ADC mixer mute for left output</td> <td style="text-align: left;">ADC Mixer设置，使能left output Mixer通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">ADC mixer mute for linein</td> <td style="text-align: left;">ADC Mixer设置，使能linein通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">ADC mixer mute for mic</td> <td style="text-align: left;">ADC Mixer设置，使能mic通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">ADC mixer mute for right output</td> <td style="text-align: left;"></td> <td style="text-align: left;">ADC Mixer设置，使能right output Mixer通路</td> </tr> <tr> <td style="text-align: left;">LINEIN GAIN control</td> <td style="text-align: left;">linein到output mixer的增益</td> <td style="text-align: left;">0–7, 0~7:0–14dB,2dB/step</td> </tr> <tr> <td style="text-align: left;">MICIN GAIN control</td> <td style="text-align: left;">MIC到outpu mixer的增益</td> <td style="text-align: left;">0–7,表示-4.5–6dB</td> </tr> <tr> <td style="text-align: left;">dac digital volume</td> <td style="text-align: left;">DAC数字音量</td> <td style="text-align: left;">0<sub>63,表示0</sub>-73.08dB,-1.16dB/step</td> </tr> <tr> <td style="text-align: left;">head phone volume</td> <td style="text-align: left;">headphone音量</td> <td style="text-align: left;">0 表示mute, 1<sub>63表示-62dB</sub>0dB, -1dB/step</td> </tr> </tbody> </table> <p>录音通路设置举例：</p> <ol> <li>录音单声道数据</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>通过MICIN录音：
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>amixer -D hw:audiocodec cset name='ADC MIC Boost AMP en' 1
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a>amixer -D hw:audiocodec cset name='ADC mixer mute for mic' 1
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a>amixer -D hw:audiocodec cset name='ADC MIC Boost AMP gain control' 4
</code></pre></div> <ol> <li>内部AEC(可省去外部AEC电路)</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>amixer -D hw:audiocodec cset name='ADC mixer mute for left ouput' 1
</code></pre></div> <h4 id=235-daudio>2.3.5 Daudio.</h4> <p>硬件特性</p> <ul> <li>一路I2S/PCM；</li> <li>支持主从模式</li> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持mono和stereo模式，最高支持 2 通道</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> </ul> <h5 id=2351>2.3.5.1 内核配置</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>Device Drivers ---&gt;
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a>        &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>            &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>                &lt;*&gt; ASoC support for SUNXI ---&gt;
<a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a>                    &lt;*&gt; ASoC support for daudio platform
<a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a>                    &lt;*&gt; ASoC support for sun3iw1 &amp; ac101 daudio machine
</code></pre></div> <h5 id=2352-sys_config>2.3.5.2 sys_config配置.</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>[snddaudio0]
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>snddaudio0_used = 1
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>over_sample_rate = 128
<a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a>[daudio0]
<a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a>daudio0_used = 1
<a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a>word_select_size = 32
<a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a>pcm_sync_period = 32
<a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a>pcm_lsb_first = 0
<a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a>over_sample_rate = 128
<a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a>slot_width_select = 16
<a href=#__codelineno-8-11 id=__codelineno-8-11 name=__codelineno-8-11></a>pcm_sync_type = 0
<a href=#__codelineno-8-12 id=__codelineno-8-12 name=__codelineno-8-12></a>pcm_start_slot = 0
<a href=#__codelineno-8-13 id=__codelineno-8-13 name=__codelineno-8-13></a>tdm_config = 1
</code></pre></div> <p>snddaudio0配置，即daudio0 machine驱动的相关配置</p> <table> <thead> <tr> <th style="text-align: left;">snddaudio配置</th> <th style="text-align: left;">snddaudio配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">snddaudio0_used</td> <td style="text-align: left;">是否使用snddaudio驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td style="text-align: left;">over_sample_rate</td> <td style="text-align: left;">支持128fs/192fs/256fs/384fs/512fs/768fs</td> </tr> </tbody> </table> <p>daudio0配置，即daudio0 platform驱动的相关配置</p> <table> <thead> <tr> <th style="text-align: left;">snddaudio配置</th> <th style="text-align: left;">snddaudio配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">daudio0_used</td> <td style="text-align: left;">是否使用daudio驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td style="text-align: left;">word_select_size</td> <td style="text-align: left;">支持16bits/20bits/24bits/32bits</td> </tr> <tr> <td style="text-align: left;">pcm_sync_period</td> <td style="text-align: left;">16/32/64/128/256</td> </tr> </tbody> </table> <table> <thead> <tr> <th style="text-align: left;">snddaudio配置</th> <th style="text-align: left;">snddaudio配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">pcm_lsb_first</td> <td style="text-align: left;">0: msb first; 1: lsb first</td> </tr> <tr> <td style="text-align: left;">over_sample_rate</td> <td style="text-align: left;">支持128fs/192fs/256fs/384fs/512fs/768fs</td> </tr> <tr> <td style="text-align: left;">slot_width_select</td> <td style="text-align: left;">16bits/20bits/24bits/32bits</td> </tr> <tr> <td style="text-align: left;">pcm_sync_type</td> <td style="text-align: left;">0: long frame sync; 1: short frame sync</td> </tr> <tr> <td style="text-align: left;">pcm_start_slot</td> <td style="text-align: left;">0: 1<sup>st</sup> slot; 1: 2<sup>nd</sup> slot; 2: 3th slot; 3:4<sup>th</sup> slot</td> </tr> <tr> <td style="text-align: left;">tdm_config</td> <td style="text-align: left;">0:pcm 1:i2s</td> </tr> </tbody> </table> <h4 id=236-codecac101>2.3.6 外挂codec:AC101</h4> <p>R6标案使用的AC101作双声道录音，audiocodec则录制回路作AEC下面对R6如何配置使用AC101作简单介绍</p> <h5 id=2361>2.3.6.1 内核配置</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>Device Drivers ---&gt;
<a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a>    &lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a>        &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a>            &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a>                &lt;*&gt; AC101 Codec
<a href=#__codelineno-9-6 id=__codelineno-9-6 name=__codelineno-9-6></a>                &lt;*&gt; ASoC support for SUNXI ---&gt;
<a href=#__codelineno-9-7 id=__codelineno-9-7 name=__codelineno-9-7></a>                    &lt;*&gt; ASoC support for daudio platform
<a href=#__codelineno-9-8 id=__codelineno-9-8 name=__codelineno-9-8></a>                    &lt;*&gt; ASoC support for sun3iw1 &amp; ac101 daudio machine
</code></pre></div> <h5 id=2362-sys_configdts>2.3.6.2 sys_config&amp;dts配置.</h5> <p>R6通过TWI1控制AC101,而I2S0用于音频数据的传输TWI部分配置,可通过dts进行配置:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a>linux-3.10/arch/arm/boot/dts/sun3iw1p1-sitar-mic2.dts
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>twi1: twi@0x01c27400{
<a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a>    ac101@1a {
<a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a>        compatible = "x-powers,ac101";
<a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a>        reg = &lt;0x1a&gt;;
<a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a>        audio_int_ctrl = &lt;&amp;pio PL 12 6 1 1 0&gt;;
<a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a>        audio_pa_ctrl = &lt;&amp;pio PG 13 1 1 1 0&gt;;
<a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a>        speaker_val = &lt;0x1b&gt;;
<a href=#__codelineno-10-9 id=__codelineno-10-9 name=__codelineno-10-9></a>        headset_val = &lt;0x3b&gt;;
<a href=#__codelineno-10-10 id=__codelineno-10-10 name=__codelineno-10-10></a>        single_speaker_val = &lt;0x19&gt;;
<a href=#__codelineno-10-11 id=__codelineno-10-11 name=__codelineno-10-11></a>        double_speaker_val = &lt;0x1b&gt;;
<a href=#__codelineno-10-12 id=__codelineno-10-12 name=__codelineno-10-12></a>        speaker_double_used = &lt;1&gt;;
<a href=#__codelineno-10-13 id=__codelineno-10-13 name=__codelineno-10-13></a>        earpiece_val = &lt;0x1e&gt;;
<a href=#__codelineno-10-14 id=__codelineno-10-14 name=__codelineno-10-14></a>        mainmic_val = &lt;0x4&gt;;
<a href=#__codelineno-10-15 id=__codelineno-10-15 name=__codelineno-10-15></a>        headsetmic_val = &lt;0x4&gt;;
<a href=#__codelineno-10-16 id=__codelineno-10-16 name=__codelineno-10-16></a>        dmic_used = &lt;0&gt;;
<a href=#__codelineno-10-17 id=__codelineno-10-17 name=__codelineno-10-17></a>        adc_digital_val = &lt;0xb0b0&gt;;
<a href=#__codelineno-10-18 id=__codelineno-10-18 name=__codelineno-10-18></a>        agc_used = &lt;0&gt;;
<a href=#__codelineno-10-19 id=__codelineno-10-19 name=__codelineno-10-19></a>        drc_used = &lt;1&gt;;
<a href=#__codelineno-10-20 id=__codelineno-10-20 name=__codelineno-10-20></a>        linein_to_spk_used = &lt;0&gt;;
<a href=#__codelineno-10-21 id=__codelineno-10-21 name=__codelineno-10-21></a>        linein_to_hp_used = &lt;0&gt;;
<a href=#__codelineno-10-22 id=__codelineno-10-22 name=__codelineno-10-22></a>        linein_to_aif2_used = &lt;0&gt;;
<a href=#__codelineno-10-23 id=__codelineno-10-23 name=__codelineno-10-23></a>        };
<a href=#__codelineno-10-24 id=__codelineno-10-24 name=__codelineno-10-24></a>}
</code></pre></div> <p>I2S部分配置可以通过dts配置，也可以通过sys_config覆盖dts的配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a>[snddaudio0]
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a>snddaudio0_used = 1
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a>over_sample_rate = 128
<a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a>sunxi,snddaudio-codec = "ac101.1-001a"
<a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a>sunxi,snddaudio-codec-dai = "ac101"
<a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a>
<a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a>[daudio0]
<a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a>daudio0_used = 1
<a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a>word_select_size = 32
<a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a>pcm_sync_period = 32
<a href=#__codelineno-11-11 id=__codelineno-11-11 name=__codelineno-11-11></a>pcm_lsb_first = 0
<a href=#__codelineno-11-12 id=__codelineno-11-12 name=__codelineno-11-12></a>over_sample_rate = 128
<a href=#__codelineno-11-13 id=__codelineno-11-13 name=__codelineno-11-13></a>slot_width_select = 16
<a href=#__codelineno-11-14 id=__codelineno-11-14 name=__codelineno-11-14></a>pcm_sync_type = 0
<a href=#__codelineno-11-15 id=__codelineno-11-15 name=__codelineno-11-15></a>pcm_start_slot = 0
<a href=#__codelineno-11-16 id=__codelineno-11-16 name=__codelineno-11-16></a>tdm_config = 1
</code></pre></div> <p>i2s相关格式需要根据AC101 spec进行配置</p> <p>而snddaudio0中，注意codec的名称，需要与实际AC101的dev name相匹配,而codec-dai名称则与AC101驱动中设置的dai name相匹配</p> <h4 id=237>2.3.7 标案音频测试方法</h4> <p>该章节主要介绍在标案上进行播歌，录音的测试命令。</p> <h5 id=2371>2.3.7.1 播放</h5> <p>如《R6 AudioCodec数据通路》章节所说，驱动代码中已固定配置了播放通路进入系统后直接通过aplay工具进行播放即可，如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <p>可通过下面命令调节硬件上的模拟音量:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a>amixer -Dhw:audiocodec cset name='headphone volume' 50
</code></pre></div> <h5 id=2372>2.3.7.2 录音</h5> <p>标案使用AC101进行双声道录音录音前需要配置AC101的音频通路，SDK默认在启动时会进行设置，相关配置脚本在:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a>/etc/init.d/rc.final
</code></pre></div> <p>可以直接通过arecord命令进行录音:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>arecord -Dhw:sndac1011001a -f S16_LE -r 16000 -c 2 /tmp/test.wav
</code></pre></div> <h3 id=24-r7s>2.4 R7s音频接口</h3> <h4 id=241>2.4.1 硬件资源</h4> <p>R7s包含 2 个音频模块，分别是内置AudioCodec以及Daudio0。</p> <p><img alt="图2-5: R7s音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-5.jpg></p> <h4 id=242>2.4.2 时钟源</h4> <p>R7s中， 2 个音频模块的时钟源均来自pll_audio。</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播放录音。</p> <p><img alt="图2-6: R7s时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-6.jpg></p> <h4 id=243>2.4.3 代码结构</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a>linux-4.9/sound/soc/sunxi/
<a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a>├── sunxi-pcm.c //提供注册platform驱动的接口及相关函数集
<a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a>├── sunxi-pcm.h
<a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a>├── sun8iw8
<a href=#__codelineno-16-5 id=__codelineno-16-5 name=__codelineno-16-5></a>│   ├── sunxi_codec.c // cpudai驱动
<a href=#__codelineno-16-6 id=__codelineno-16-6 name=__codelineno-16-6></a>│   ├── sunxi_codecdma.c // codec platform驱动
<a href=#__codelineno-16-7 id=__codelineno-16-7 name=__codelineno-16-7></a>│   ├── sun8iw8_sndcodec_new.c // codec驱动
<a href=#__codelineno-16-8 id=__codelineno-16-8 name=__codelineno-16-8></a>│   └── sunxi_sndcodec.c // codec machine驱动
<a href=#__codelineno-16-9 id=__codelineno-16-9 name=__codelineno-16-9></a>├── sunxi-daudio.c // daudio platform驱动
<a href=#__codelineno-16-10 id=__codelineno-16-10 name=__codelineno-16-10></a>└── sunxi-snddaudio.c // daudio machine驱动
<a href=#__codelineno-16-11 id=__codelineno-16-11 name=__codelineno-16-11></a>
<a href=#__codelineno-16-12 id=__codelineno-16-12 name=__codelineno-16-12></a>linux-4.9/sound/soc/soc-utils.c // daudio codec驱动
</code></pre></div> <h4 id=244-audiocodec>2.4.4 Audiocodec.</h4> <p>硬件特性</p> <ul> <li> <p>两路DAC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~192KHz采样率</p> </li> <li> <p>两路ADC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~48KHz采样率</p> </li> <li> <p>两路模拟输出:</p> </li> <li> <p>一路立体声LINEOUT输出(LINEOUTP, LINEOUTN)</p> </li> <li> <p>一路立体声headphone输出(HPOUTL, HPOUTR)</p> </li> <li> <p>两路模拟输入：MIC1,MIC2</p> </li> <li> <p>支持同时playback和record(全双工模式)</p> </li> <li>支持ADC的AGC,DRC功能</li> <li>支持DAC的DRC功能</li> </ul> <h5 id=2441>2.4.4.1 内核配置</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a>Device Drivers ---&gt;
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a>    &lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-17-3 id=__codelineno-17-3 name=__codelineno-17-3></a>        &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-17-4 id=__codelineno-17-4 name=__codelineno-17-4></a>            &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-17-5 id=__codelineno-17-5 name=__codelineno-17-5></a>                &lt;*&gt; Audiocodec for the SUNXI chips
</code></pre></div> <h5 id=2442-sys_config>2.4.4.2 sys_config配置.</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a>[codec]
<a href=#__codelineno-18-2 id=__codelineno-18-2 name=__codelineno-18-2></a>headphone_vol = 0x3b
<a href=#__codelineno-18-3 id=__codelineno-18-3 name=__codelineno-18-3></a>lineout_vol = 0x1a
<a href=#__codelineno-18-4 id=__codelineno-18-4 name=__codelineno-18-4></a>audio_pa_ctrl = port:PB05&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
<a href=#__codelineno-18-5 id=__codelineno-18-5 name=__codelineno-18-5></a>adcagc_used = 0
<a href=#__codelineno-18-6 id=__codelineno-18-6 name=__codelineno-18-6></a>adcdrc_used = 0
<a href=#__codelineno-18-7 id=__codelineno-18-7 name=__codelineno-18-7></a>dacdrc_used = 0
<a href=#__codelineno-18-8 id=__codelineno-18-8 name=__codelineno-18-8></a>adchpf_used = 0
<a href=#__codelineno-18-9 id=__codelineno-18-9 name=__codelineno-18-9></a>dachpf_used = 0
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">codec配置</th> <th style="text-align: left;">codec配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">headphone_vol</td> <td style="text-align: left;">headphone volume，可设定范围0~0x3f, 0表示mute, 1<sub>63表示-62dB</sub>0dB, 1dB/step</td> </tr> <tr> <td style="text-align: left;">audio_pa_ctrl</td> <td style="text-align: left;">PA使能引脚</td> </tr> <tr> <td style="text-align: left;">adcagc_used</td> <td style="text-align: left;">1:use adcagc 0:no use</td> </tr> <tr> <td style="text-align: left;">adcdrc_used</td> <td style="text-align: left;">1:use adcdrc 0:no use</td> </tr> <tr> <td style="text-align: left;">dacdrc_used</td> <td style="text-align: left;">1:use dacdrc 0:no use</td> </tr> <tr> <td style="text-align: left;">adchpf_used</td> <td style="text-align: left;">1:use adchpf 0:no use</td> </tr> <tr> <td style="text-align: left;">dachpf_used</td> <td style="text-align: left;">1:use dachpf 0:no use</td> </tr> </tbody> </table> <h5 id=2443-codec>2.4.4.3 codec数据通路</h5> <p><img alt="图2-7: R7s音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-4.jpg></p> <div class=highlight><pre><span></span><code><a href=#__codelineno-19-1 id=__codelineno-19-1 name=__codelineno-19-1></a>播歌
<a href=#__codelineno-19-2 id=__codelineno-19-2 name=__codelineno-19-2></a>DACL --&gt; Left Output Mixer --&gt; LINEOUTL
<a href=#__codelineno-19-3 id=__codelineno-19-3 name=__codelineno-19-3></a>DACR --&gt; Right Output Mixer --&gt; LINEOUTR
<a href=#__codelineno-19-4 id=__codelineno-19-4 name=__codelineno-19-4></a>
<a href=#__codelineno-19-5 id=__codelineno-19-5 name=__codelineno-19-5></a>录音
<a href=#__codelineno-19-6 id=__codelineno-19-6 name=__codelineno-19-6></a>MIC1P --&gt; LADC input Mixer --&gt; ADCL
<a href=#__codelineno-19-7 id=__codelineno-19-7 name=__codelineno-19-7></a>MIC2P --&gt; RADC input Mixer --&gt; ADCR
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">控件名称</th> <th style="text-align: left;">功能</th> <th style="text-align: left;">数值</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">Lineout volume</td> <td style="text-align: left;">lineout音量设置</td> <td style="text-align: left;">0–31,表示-43.5–0dB</td> </tr> <tr> <td style="text-align: left;">ADC input gain control</td> <td style="text-align: left;">ADC增益 0–7,表示-4.5–6dB</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">HP_L Mux HP_L</td> <td style="text-align: left;">Mux设置</td> <td style="text-align: left;">0:DACL HPL Switch; 1:MIXER_L Switch</td> </tr> <tr> <td style="text-align: left;">HP_R Mux HP_R</td> <td style="text-align: left;">Mux设置</td> <td style="text-align: left;">0:DACR HPR Switch; 1:MIXER_R Switch</td> </tr> <tr> <td style="text-align: left;">LADC input Mixer MIC1 boost Switch</td> <td style="text-align: left;">LADC input Mixer设置，使能MIC1通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">LADC input Mixer MIC2 boost Switch</td> <td style="text-align: left;">LADC input Mixer设置，使能MIC2通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">LADC input Mixer l_output mixer Switch</td> <td style="text-align: left;">LADC input Mixer设置，使能l_output通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">LADC input Mixer r_output mixer Switch</td> <td style="text-align: left;">LADC input Mixer设置，使能r_output通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Left Output Mixer DACL Switch</td> <td style="text-align: left;">Left Output Mixer设置，使能DACL通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Left Output Mixer DACR Switch</td> <td style="text-align: left;">Left Output Mixer设置，使能DACR通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Left Output Mixer MIC1Booststage Switch</td> <td style="text-align: left;">Left Output Mixer设置，使能MIC1通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Left Output Mixer MIC2Booststage Switch</td> <td style="text-align: left;">Left Output Mixer设置，使能MIC2通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">MIC1 boost AMP gain control</td> <td style="text-align: left;">MIC1增益</td> <td style="text-align: left;">0–7, 0:0dB,1~7:24–42dB,3dB/step</td> </tr> <tr> <td style="text-align: left;">MIC1_G boost stageoutput mixer control</td> <td style="text-align: left;">MIC1 to L or R output Mixer增益</td> <td style="text-align: left;">0–7,表示-4.5–6dB</td> </tr> <tr> <td style="text-align: left;">MIC2 SRC</td> <td style="text-align: left;">MIC2 SRC设置</td> <td style="text-align: left;">0:MIC3; 1:MIC2</td> </tr> <tr> <td style="text-align: left;">MIC2 boost AMP gain control</td> <td style="text-align: left;">MIC2增益</td> <td style="text-align: left;">0–7, 0:0dB,1~7:24–42dB,3dB/step</td> </tr> <tr> <td style="text-align: left;">MIC2_G boost stage output mixer control</td> <td style="text-align: left;">MIC2 to L or R output Mixer增益</td> <td style="text-align: left;">0–7,表示-4.5–6dB</td> </tr> <tr> <td style="text-align: left;">RADC input Mixer MIC1 boost Switch</td> <td style="text-align: left;">RADC input Mixer设置，使能MIC1通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">RADC input Mixer MIC2 boost Switch</td> <td style="text-align: left;">RADC input Mixer设置，使能MIC2通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">RADC input Mixer l_output mixer Switch</td> <td style="text-align: left;">RADC input Mixer设置，使能l_output通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">RADC input Mixer r_output mixer Switch</td> <td style="text-align: left;">RADC input Mixer设置，使能r_output通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Right Output Mixer DACL Switch</td> <td style="text-align: left;">Right Output Mixer设置，使能DACL通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Right Output Mixer DACR Switch</td> <td style="text-align: left;">Right Output Mixer设置，使能DACR通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Right Output Mixer MIC1Booststage Switch</td> <td style="text-align: left;">Right Output Mixer设置， 使能MIC1通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">Right Output Mixer MIC2Booststage Switch</td> <td style="text-align: left;">Right Output Mixer设置，使能MIC2通路</td> <td style="text-align: left;">0:关闭; 1:开启</td> </tr> <tr> <td style="text-align: left;">SPK_L Mux</td> <td style="text-align: left;">SPK_L Mux设置</td> <td style="text-align: left;">0:MIXER_L Switch; 1:MIXR+MIXL</td> </tr> <tr> <td style="text-align: left;">SPK_R Mux</td> <td style="text-align: left;">SPK_R Mux设置</td> <td style="text-align: left;">0:MIXER_L Switch; 1:MIXR+MIXL</td> </tr> <tr> <td style="text-align: left;">digital volume</td> <td style="text-align: left;">数字音量设置</td> <td style="text-align: left;">0–63,表示-73.08–0dB</td> </tr> <tr> <td style="text-align: left;">headphone volume</td> <td style="text-align: left;">headphone音量设置</td> <td style="text-align: left;">0–63,0表示mute; 1~63表示-62dB–0dB</td> </tr> </tbody> </table> <p>通路设置举例：</p> <ol> <li>播放通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a>通过lineout播放：
<a href=#__codelineno-20-2 id=__codelineno-20-2 name=__codelineno-20-2></a>amixer -D hw:audiocodec cset name='SPK_L Mux' 1
<a href=#__codelineno-20-3 id=__codelineno-20-3 name=__codelineno-20-3></a>amixer -D hw:audiocodec cset name='SPK_R Mux' 1
<a href=#__codelineno-20-4 id=__codelineno-20-4 name=__codelineno-20-4></a>amixer -D hw:audiocodec cset name='Right Output Mixer DACR Switch' 1
<a href=#__codelineno-20-5 id=__codelineno-20-5 name=__codelineno-20-5></a>amixer -D hw:audiocodec cset name='Left Output Mixer DACL Switch' 1
<a href=#__codelineno-20-6 id=__codelineno-20-6 name=__codelineno-20-6></a>amixer -D hw:audiocodec cset name='digital volume' 6
</code></pre></div> <ol> <li>录音通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a>通过MIC1,MIC2录音:
<a href=#__codelineno-21-2 id=__codelineno-21-2 name=__codelineno-21-2></a>amixer -D hw:audiocodec cset name='LADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-21-3 id=__codelineno-21-3 name=__codelineno-21-3></a>amixer -D hw:audiocodec cset name='RADC input Mixer MIC2 boost Switch' 1
<a href=#__codelineno-21-4 id=__codelineno-21-4 name=__codelineno-21-4></a>amixer -D hw:audiocodec cset name='MIC2 SRC' 0
<a href=#__codelineno-21-5 id=__codelineno-21-5 name=__codelineno-21-5></a>amixer -D hw:audiocodec cset name='MIC1 boost AMP gain control' 4
<a href=#__codelineno-21-6 id=__codelineno-21-6 name=__codelineno-21-6></a>amixer -D hw:audiocodec cset name='MIC2 boost AMP gain control' 4
</code></pre></div> <h4 id=245-daudio>2.4.5 Daudio.</h4> <p>硬件特性</p> <ul> <li>一路I2S/PCM；</li> <li>支持主从模式</li> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持mono和stereo模式</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> </ul> <h5 id=2451>2.4.5.1 内核配置</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a>Device Drivers ---&gt;
<a href=#__codelineno-22-2 id=__codelineno-22-2 name=__codelineno-22-2></a>    &lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-22-3 id=__codelineno-22-3 name=__codelineno-22-3></a>        &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-22-4 id=__codelineno-22-4 name=__codelineno-22-4></a>            &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-22-5 id=__codelineno-22-5 name=__codelineno-22-5></a>                &lt;*&gt; Allwinner Digital Audio Support
</code></pre></div> <h5 id=2452-sys_config>2.4.5.2 sys_config配置.</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a>[tdm0]
<a href=#__codelineno-23-2 id=__codelineno-23-2 name=__codelineno-23-2></a>daudio_used = 0
<a href=#__codelineno-23-3 id=__codelineno-23-3 name=__codelineno-23-3></a>daudio_master = 4
<a href=#__codelineno-23-4 id=__codelineno-23-4 name=__codelineno-23-4></a>daudio_select = 1
<a href=#__codelineno-23-5 id=__codelineno-23-5 name=__codelineno-23-5></a>audio_format = 1
<a href=#__codelineno-23-6 id=__codelineno-23-6 name=__codelineno-23-6></a>signal_inversion = 1
<a href=#__codelineno-23-7 id=__codelineno-23-7 name=__codelineno-23-7></a>sample_resolution = 16
<a href=#__codelineno-23-8 id=__codelineno-23-8 name=__codelineno-23-8></a>slot_width_select = 16
<a href=#__codelineno-23-9 id=__codelineno-23-9 name=__codelineno-23-9></a>pcm_lrck_period = 32
<a href=#__codelineno-23-10 id=__codelineno-23-10 name=__codelineno-23-10></a>pcm_lrckr_period = 1
<a href=#__codelineno-23-11 id=__codelineno-23-11 name=__codelineno-23-11></a>msb_lsb_first = 0
<a href=#__codelineno-23-12 id=__codelineno-23-12 name=__codelineno-23-12></a>sign_extend = 0
<a href=#__codelineno-23-13 id=__codelineno-23-13 name=__codelineno-23-13></a>tx_data_mode = 0
<a href=#__codelineno-23-14 id=__codelineno-23-14 name=__codelineno-23-14></a>rx_data_mode = 0
<a href=#__codelineno-23-15 id=__codelineno-23-15 name=__codelineno-23-15></a>;i2s_mclk = port:PB08&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-23-16 id=__codelineno-23-16 name=__codelineno-23-16></a>i2s_bclk = port:PG11&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-23-17 id=__codelineno-23-17 name=__codelineno-23-17></a>i2s_lrclk = port:PG10&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-23-18 id=__codelineno-23-18 name=__codelineno-23-18></a>i2s_dout0 = port:PG12&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-23-19 id=__codelineno-23-19 name=__codelineno-23-19></a>i2s_dout1 =
<a href=#__codelineno-23-20 id=__codelineno-23-20 name=__codelineno-23-20></a>i2s_dout2 =
<a href=#__codelineno-23-21 id=__codelineno-23-21 name=__codelineno-23-21></a>i2s_dout3 =
<a href=#__codelineno-23-22 id=__codelineno-23-22 name=__codelineno-23-22></a>i2s_din = port:PG13&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">tdm0配置</th> <th style="text-align: left;">tdm0配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">daudio_master</td> <td style="text-align: left;">1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRM master),即daudio接口作为slave, codec作为master2: SND_SOC_DAIFMT_CBS_CFM(codec clk slave &amp; FRMmaster),一般不用3: SND_SOC_DAIFMT_CBM_CFS(codec clk master &amp; frameslave),一般不用4: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM slave),即daudio接口作为master, codec作为slave</td> </tr> <tr> <td style="text-align: left;">daudio_select</td> <td style="text-align: left;">0: pcm mode; 1: i2s mode</td> </tr> <tr> <td style="text-align: left;">audio_format</td> <td style="text-align: left;">1: SND_SOC_DAIFMT_I2S(standard i2s format)2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)3: SND_SOC_DAIFMT_LEFT_J(left justfied format)4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available on 2ndBCLK rising edge after LRC rising edge)5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available on 1ndBCLK rising edge after LRC rising edge)</td> </tr> <tr> <td style="text-align: left;">signal_inversion</td> <td style="text-align: left;">1: SND_SOC_DAIFMT_NB_NF(normal bit clock + frame)2: SND_SOC_DAIFMT_NB_IF(normal BCLK + inv FRM)3: SND_SOC_DAIFMT_IB_NF(invert BCLK + nor FRM)4: SND_SOC_DAIFMT_IB_IF(invert BCLK + FRM)</td> </tr> <tr> <td style="text-align: left;">sample_resolution</td> <td style="text-align: left;">采样精度,16bit, 24bit,32bit</td> </tr> <tr> <td style="text-align: left;">slot_width_select</td> <td style="text-align: left;">支持8bit, 16bit, 32bit宽度</td> </tr> <tr> <td style="text-align: left;">pcm_lrck_period</td> <td style="text-align: left;">可配置16/32/64/128/256个bclk</td> </tr> <tr> <td style="text-align: left;">pcm_lrckr_period</td> <td style="text-align: left;">可配置16/32/64/128/256个bclk</td> </tr> <tr> <td style="text-align: left;">msb_lsb_first</td> <td style="text-align: left;">0: msb first; 1: lsb first</td> </tr> <tr> <td style="text-align: left;">sign_extend</td> <td style="text-align: left;">0: zero pending; 1: sign extend</td> </tr> <tr> <td style="text-align: left;">tx_data_mode</td> <td style="text-align: left;">0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law</td> </tr> <tr> <td style="text-align: left;">rx_data_mode</td> <td style="text-align: left;">0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law</td> </tr> <tr> <td style="text-align: left;">i2s_bclk</td> <td style="text-align: left;">i2s_bclk引脚</td> </tr> <tr> <td style="text-align: left;">i2s_lrclk</td> <td style="text-align: left;">i2s_lrclk引脚</td> </tr> <tr> <td style="text-align: left;">i2s_dout0</td> <td style="text-align: left;">i2s_dout引脚</td> </tr> <tr> <td style="text-align: left;">i2s_din</td> <td style="text-align: left;">i2s_din引脚</td> </tr> </tbody> </table> <h4 id=246>2.4.6 标案音频测试方法</h4> <p>该章节主要介绍在标案上进行播歌，录音的测试命令。</p> <h4 id=2461>2.4.6.1 播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-24-1 id=__codelineno-24-1 name=__codelineno-24-1></a>amixer -D hw:audiocodec cset name='SPK_L Mux' 1
<a href=#__codelineno-24-2 id=__codelineno-24-2 name=__codelineno-24-2></a>amixer -D hw:audiocodec cset name='SPK_R Mux' 1
<a href=#__codelineno-24-3 id=__codelineno-24-3 name=__codelineno-24-3></a>amixer -D hw:audiocodec cset name='Lineout volume' 24
<a href=#__codelineno-24-4 id=__codelineno-24-4 name=__codelineno-24-4></a>amixer -D hw:audiocodec cset name='Right Output Mixer DACR Switch' 1
<a href=#__codelineno-24-5 id=__codelineno-24-5 name=__codelineno-24-5></a>amixer -D hw:audiocodec cset name='Left Output Mixer DACL Switch' 1
<a href=#__codelineno-24-6 id=__codelineno-24-6 name=__codelineno-24-6></a>amixer -D hw:audiocodec cset name='digital volume' 0
<a href=#__codelineno-24-7 id=__codelineno-24-7 name=__codelineno-24-7></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <p>可通过下面命令调节硬件上的模拟音量:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-25-1 id=__codelineno-25-1 name=__codelineno-25-1></a>amixer -Dhw:audiocodec cset name='Lineout volume' 50
</code></pre></div> <h4 id=2462>2.4.6.2 录音</h4> <p>表示下使用audiocodec进行MIC1,MIC2录音。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-26-1 id=__codelineno-26-1 name=__codelineno-26-1></a>amixer -D hw:audiocodec cset name='LADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-26-2 id=__codelineno-26-2 name=__codelineno-26-2></a>amixer -D hw:audiocodec cset name='RADC input Mixer MIC2 boost Switch' 1
<a href=#__codelineno-26-3 id=__codelineno-26-3 name=__codelineno-26-3></a>amixer -D hw:audiocodec cset name='MIC1 boost AMP gain control' 4
<a href=#__codelineno-26-4 id=__codelineno-26-4 name=__codelineno-26-4></a>amixer -D hw:audiocodec cset name='MIC2 SRC' 0
<a href=#__codelineno-26-5 id=__codelineno-26-5 name=__codelineno-26-5></a>amixer -D hw:audiocodec cset name='MIC2 boost AMP gain control' 4
<a href=#__codelineno-26-6 id=__codelineno-26-6 name=__codelineno-26-6></a>
<a href=#__codelineno-26-7 id=__codelineno-26-7 name=__codelineno-26-7></a>arecord -Dhw:audiocodec -f S16_LE -r 16000 -c 2 /tmp/test.wav
</code></pre></div> <h2 id=25-r11>2.5 R11音频接口</h2> <h3 id=251>2.5.1 硬件资源</h3> <p>R11包含 2 个音频模块，分别是内置AudioCodec以及Daudio0。</p> <p><img alt="图2-8: R11音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-8.jpg></p> <h3 id=252>2.5.2 时钟源</h3> <p>R11中， 2 个音频模块的时钟源均来自pll_audio。</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播放录音。</p> <p><img alt="图2-9: R11时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-9.jpg></p> <h3 id=253>2.5.3 代码结构</h3> <div class=highlight><pre><span></span><code><a href=#__codelineno-27-1 id=__codelineno-27-1 name=__codelineno-27-1></a>linux-3.4/sound/soc/sunxi/
<a href=#__codelineno-27-2 id=__codelineno-27-2 name=__codelineno-27-2></a>├── audiocodec
<a href=#__codelineno-27-3 id=__codelineno-27-3 name=__codelineno-27-3></a>│ ├── sun8iw8_sndcodec_new.c // codec 驱动
<a href=#__codelineno-27-4 id=__codelineno-27-4 name=__codelineno-27-4></a>│ ├── sun8iw8_sndcodec.h
<a href=#__codelineno-27-5 id=__codelineno-27-5 name=__codelineno-27-5></a>│ ├── sunxi_codec.c // cpu dai驱动
<a href=#__codelineno-27-6 id=__codelineno-27-6 name=__codelineno-27-6></a>│ ├── sunxi_sndcodec.c // codec machine驱动
<a href=#__codelineno-27-7 id=__codelineno-27-7 name=__codelineno-27-7></a>│ ├── sunxi_codecdma.c // codec platform驱动
<a href=#__codelineno-27-8 id=__codelineno-27-8 name=__codelineno-27-8></a>│ └── sunxi_codecdma.h
<a href=#__codelineno-27-9 id=__codelineno-27-9 name=__codelineno-27-9></a>└── daudio0
<a href=#__codelineno-27-10 id=__codelineno-27-10 name=__codelineno-27-10></a>    ├── snddaudio0.c // daudio codec驱动
<a href=#__codelineno-27-11 id=__codelineno-27-11 name=__codelineno-27-11></a>    ├── sunxi-daudio0.c // daudio cpu dai驱动
<a href=#__codelineno-27-12 id=__codelineno-27-12 name=__codelineno-27-12></a>    ├── sunxi-daudio0.h
<a href=#__codelineno-27-13 id=__codelineno-27-13 name=__codelineno-27-13></a>    ├── sunxi-daudiodma0.c // daudio platform 驱动
<a href=#__codelineno-27-14 id=__codelineno-27-14 name=__codelineno-27-14></a>    ├── sunxi-daudiodma0.h
<a href=#__codelineno-27-15 id=__codelineno-27-15 name=__codelineno-27-15></a>    └── sunxi-snddaudio0.c // daudio machine驱动
</code></pre></div> <h3 id=254-audiocodec>2.5.4 AudioCodec</h3> <p>硬件特性</p> <ul> <li> <p>两路DAC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~192KHz采样率</p> </li> <li> <p>两路ADC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~48KHz采样率</p> </li> <li> <p>一路模拟输出:一路立体声LINEOUT输出(LINEOUTP, LINEOUTN)</p> </li> <li>一路路模拟输入：MIC1</li> <li>支持同时playback和record(全双工模式)</li> <li>支持ADC的AGC,DRC功能</li> <li>支持DAC的DRC功能</li> </ul> <h4 id=2541>2.5.4.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-28-1 id=__codelineno-28-1 name=__codelineno-28-1></a>Device Drivers ---&gt;
<a href=#__codelineno-28-2 id=__codelineno-28-2 name=__codelineno-28-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-28-3 id=__codelineno-28-3 name=__codelineno-28-3></a>    &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-28-4 id=__codelineno-28-4 name=__codelineno-28-4></a>        &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-28-5 id=__codelineno-28-5 name=__codelineno-28-5></a>            &lt;*&gt; Audiocodec for the SUNXI chips
<a href=#__codelineno-28-6 id=__codelineno-28-6 name=__codelineno-28-6></a>            &lt;*&gt; Audiocodec Machine for codec chips
<a href=#__codelineno-28-7 id=__codelineno-28-7 name=__codelineno-28-7></a>            &lt;*&gt; Audiocodec for the SUN8IW8 chips
</code></pre></div> <h4 id=2542-sys_config>2.5.4.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-29-1 id=__codelineno-29-1 name=__codelineno-29-1></a>[audio0]
<a href=#__codelineno-29-2 id=__codelineno-29-2 name=__codelineno-29-2></a>headphone_vol = 0x3b
<a href=#__codelineno-29-3 id=__codelineno-29-3 name=__codelineno-29-3></a>lineout_vol = 0x1a
<a href=#__codelineno-29-4 id=__codelineno-29-4 name=__codelineno-29-4></a>audio_pa_ctrl = port:PB05&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
<a href=#__codelineno-29-5 id=__codelineno-29-5 name=__codelineno-29-5></a>audio_pa_active_level = 1
<a href=#__codelineno-29-6 id=__codelineno-29-6 name=__codelineno-29-6></a>adcagc_used = 0
<a href=#__codelineno-29-7 id=__codelineno-29-7 name=__codelineno-29-7></a>adcdrc_used = 0
<a href=#__codelineno-29-8 id=__codelineno-29-8 name=__codelineno-29-8></a>dacdrc_used = 0
<a href=#__codelineno-29-9 id=__codelineno-29-9 name=__codelineno-29-9></a>adchpf_used = 0
<a href=#__codelineno-29-10 id=__codelineno-29-10 name=__codelineno-29-10></a>dachpf_used = 0
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">audio0配置</th> <th style="text-align: left;">audio0配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">headphone_vol</td> <td style="text-align: left;">headphone volume，可设定范围0~0x3f, 0表示mute,1<sub>63表示-62dB</sub>0dB, 1dB/step</td> </tr> <tr> <td style="text-align: left;">lineout_vol</td> <td style="text-align: left;">lineout volume，可设定范围0~0x1f, 0或者 1 表示mute,2<sub>31表示-43.5dB</sub>0dB, 1.5dB/step</td> </tr> <tr> <td style="text-align: left;">audio_pa_ctrl</td> <td style="text-align: left;">PA使能引脚</td> </tr> <tr> <td style="text-align: left;">audio_pa_active_level</td> <td style="text-align: left;">1:high level active; 0:low level active</td> </tr> <tr> <td style="text-align: left;">adcagc_used</td> <td style="text-align: left;">1:use adcagc 0:no use</td> </tr> <tr> <td style="text-align: left;">adcdrc_used</td> <td style="text-align: left;">1:use adcdrc 0:no use</td> </tr> <tr> <td style="text-align: left;">dacdrc_used</td> <td style="text-align: left;">1:use dacdrc 0:no use</td> </tr> <tr> <td style="text-align: left;">adchpf_used</td> <td style="text-align: left;">1:use adchpf 0:no use</td> </tr> <tr> <td style="text-align: left;">dachpf_used</td> <td style="text-align: left;">1:use dachpf 0:no use</td> </tr> </tbody> </table> <h4 id=2543-codec>2.5.4.3 codec数据通路</h4> <p><img alt="图2-10: R11音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-10.jpg></p> <div class=highlight><pre><span></span><code><a href=#__codelineno-30-1 id=__codelineno-30-1 name=__codelineno-30-1></a>播歌
<a href=#__codelineno-30-2 id=__codelineno-30-2 name=__codelineno-30-2></a>DACL --&gt; Left Output Mixer --&gt; LINEOUTL
<a href=#__codelineno-30-3 id=__codelineno-30-3 name=__codelineno-30-3></a>DACR --&gt; Right Output Mixer --&gt; LINEOUTR
<a href=#__codelineno-30-4 id=__codelineno-30-4 name=__codelineno-30-4></a>
<a href=#__codelineno-30-5 id=__codelineno-30-5 name=__codelineno-30-5></a>录音
<a href=#__codelineno-30-6 id=__codelineno-30-6 name=__codelineno-30-6></a>MIC1P --&gt; LADC input Mixer --&gt; ADCL
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">控件名称</th> <th style="text-align: left;">功能</th> <th style="text-align: left;">数值</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">Lineout volume</td> <td style="text-align: left;">lineout 音量设置0–31, 表示-43.5–0dB</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">ADC input gain control</td> <td style="text-align: left;">ADC 增益0–7, 表示-4.5–6dB</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">LADC input Mixer MIC1 boost Switch</td> <td style="text-align: left;">LADC input Mixer 设置，使能MIC 通路 0: 关闭; 1: 开启</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">Left Output Mixer DACL Switch</td> <td style="text-align: left;">Left Output Mixer 设置，使能DACL 通路 0: 关闭; 1: 开启</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">Left Output Mixer DACR Switch</td> <td style="text-align: left;">Left Output Mixer 设置，使能DACR 通路 0: 关闭; 1: 开启</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">Left Output Mixer MIC1Booststage Switch</td> <td style="text-align: left;">Left Output Mixer 设置，使能MIC1 通路 0: 关闭; 1: 开启</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">MIC1 boost AMP gain control</td> <td style="text-align: left;">MIC1 增益0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">MIC1_G boost stage output mixer control</td> <td style="text-align: left;">MIC1 to L or R output Mixer 增益0–7, 表示-4.5–6dB</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">Right Output Mixer DACL Switch</td> <td style="text-align: left;">Right Output Mixer 设置，使能DACL 通路</td> <td style="text-align: left;">0: 关闭; 1: 开启</td> </tr> <tr> <td style="text-align: left;">Right Output Mixer DACR Switch</td> <td style="text-align: left;">Right Output Mixer 设置， 使能DACR 通路 0: 关闭; 1: 开启</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">Right Output Mixer MIC1Booststage Switch</td> <td style="text-align: left;">Right Output Mixer 设置， 使能MIC1 通路 0: 关闭; 1: 开启</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">SPK_L Mux SPK_L Mux</td> <td style="text-align: left;">设置0:MIXER_L Switch; 1:MIXR+MIXL</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">SPK_R Mux SPK_R Mux</td> <td style="text-align: left;">设置0:MIXER_L Switch; 1:MIXR+MIXL</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">digital volume</td> <td style="text-align: left;">数字音量设置0–63, 表示-73.08–0dB</td> <td style="text-align: left;"></td> </tr> </tbody> </table> <p>通路设置举例：</p> <ol> <li>播放通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-31-1 id=__codelineno-31-1 name=__codelineno-31-1></a>通过lineout播放：
<a href=#__codelineno-31-2 id=__codelineno-31-2 name=__codelineno-31-2></a>amixer -D hw:audiocodec cset name='SPK_L Mux' 1
<a href=#__codelineno-31-3 id=__codelineno-31-3 name=__codelineno-31-3></a>amixer -D hw:audiocodec cset name='SPK_R Mux' 1
<a href=#__codelineno-31-4 id=__codelineno-31-4 name=__codelineno-31-4></a>amixer -D hw:audiocodec cset name='Right Output Mixer DACR Switch' 1
<a href=#__codelineno-31-5 id=__codelineno-31-5 name=__codelineno-31-5></a>amixer -D hw:audiocodec cset name='Left Output Mixer DACL Switch' 1
<a href=#__codelineno-31-6 id=__codelineno-31-6 name=__codelineno-31-6></a>amixer -D hw:audiocodec cset name='digital volume' 0
</code></pre></div> <ol> <li>录音通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-32-1 id=__codelineno-32-1 name=__codelineno-32-1></a>通过MIC1录音:
<a href=#__codelineno-32-2 id=__codelineno-32-2 name=__codelineno-32-2></a>amixer -D hw:audiocodec cset name='LADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-32-3 id=__codelineno-32-3 name=__codelineno-32-3></a>amixer -D hw:audiocodec cset name='MIC1 boost AMP gain control' 4
</code></pre></div> <h3 id=255-daudio>2.5.5 Daudio.</h3> <p>硬件特性</p> <ul> <li>一路I2S/PCM；</li> <li>支持主从模式</li> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持mono和stereo模式，最高支持 2 通道</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> </ul> <h4 id=2551>2.5.5.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-33-1 id=__codelineno-33-1 name=__codelineno-33-1></a>Device Drivers ---&gt;
<a href=#__codelineno-33-2 id=__codelineno-33-2 name=__codelineno-33-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-33-3 id=__codelineno-33-3 name=__codelineno-33-3></a>    &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-33-4 id=__codelineno-33-4 name=__codelineno-33-4></a>        &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-33-5 id=__codelineno-33-5 name=__codelineno-33-5></a>            &lt;*&gt; SoC daudio0 tdm interface for SUNXI chips
<a href=#__codelineno-33-6 id=__codelineno-33-6 name=__codelineno-33-6></a>            &lt;*&gt; Daudio0 Public Machine for SUNXI chips
</code></pre></div> <h4 id=2552-sys_config>2.5.5.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-34-1 id=__codelineno-34-1 name=__codelineno-34-1></a>[tdm0]
<a href=#__codelineno-34-2 id=__codelineno-34-2 name=__codelineno-34-2></a>daudio_used = 1
<a href=#__codelineno-34-3 id=__codelineno-34-3 name=__codelineno-34-3></a>daudio_master = 4
<a href=#__codelineno-34-4 id=__codelineno-34-4 name=__codelineno-34-4></a>daudio_select = 1
<a href=#__codelineno-34-5 id=__codelineno-34-5 name=__codelineno-34-5></a>audio_format = 1
<a href=#__codelineno-34-6 id=__codelineno-34-6 name=__codelineno-34-6></a>signal_inversion = 1
<a href=#__codelineno-34-7 id=__codelineno-34-7 name=__codelineno-34-7></a>sample_resolution = 16
<a href=#__codelineno-34-8 id=__codelineno-34-8 name=__codelineno-34-8></a>slot_width_select = 16
<a href=#__codelineno-34-9 id=__codelineno-34-9 name=__codelineno-34-9></a>pcm_lrck_period = 32
<a href=#__codelineno-34-10 id=__codelineno-34-10 name=__codelineno-34-10></a>pcm_lrckr_period = 1
<a href=#__codelineno-34-11 id=__codelineno-34-11 name=__codelineno-34-11></a>msb_lsb_first = 0
<a href=#__codelineno-34-12 id=__codelineno-34-12 name=__codelineno-34-12></a>sign_extend = 0
<a href=#__codelineno-34-13 id=__codelineno-34-13 name=__codelineno-34-13></a>tx_data_mode = 0
<a href=#__codelineno-34-14 id=__codelineno-34-14 name=__codelineno-34-14></a>rx_data_mode = 0
<a href=#__codelineno-34-15 id=__codelineno-34-15 name=__codelineno-34-15></a>;i2s_mclk = port:PB08&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-34-16 id=__codelineno-34-16 name=__codelineno-34-16></a>i2s_bclk = port:PG11&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-34-17 id=__codelineno-34-17 name=__codelineno-34-17></a>i2s_lrclk = port:PG10&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-34-18 id=__codelineno-34-18 name=__codelineno-34-18></a>i2s_dout0 = port:PG12&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-34-19 id=__codelineno-34-19 name=__codelineno-34-19></a>i2s_dout1 =
<a href=#__codelineno-34-20 id=__codelineno-34-20 name=__codelineno-34-20></a>i2s_dout2 =
<a href=#__codelineno-34-21 id=__codelineno-34-21 name=__codelineno-34-21></a>i2s_dout3 =
<a href=#__codelineno-34-22 id=__codelineno-34-22 name=__codelineno-34-22></a>i2s_din = port:PG13&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">tdm0配置</th> <th style="text-align: left;">tdm0配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">daudio_master</td> <td style="text-align: left;">1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRM master),即daudio接口作为slave, codec作为master2: SND_SOC_DAIFMT_CBS_CFM(codec clk slave &amp; FRMmaster),一般不用3: SND_SOC_DAIFMT_CBM_CFS(codec clk master &amp; frameslave),一般不用4: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM slave),即daudio接口作为master, codec作为slave</td> </tr> <tr> <td style="text-align: left;">daudio_select</td> <td style="text-align: left;">0: pcm mode; 1: i2s mode</td> </tr> </tbody> </table> <p>deaudio_format |1: SND_SOC_DAIFMT_I2S(standard i2s format)2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)3: SND_SOC_DAIFMT_LEFT_J(left justfied format)4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available on 2ndBCLK rising edge after LRC rising edge)5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available on 1nd BCLK rising edge after LRC rising edge)| |signal_inversion |1: SND_SOC_DAIFMT_NB_NF(normal bit clock + frame)2: SND_SOC_DAIFMT_NB_IF(normal BCLK + inv FRM)3: SND_SOC_DAIFMT_IB_NF(invert BCLK + nor FRM)4: SND_SOC_DAIFMT_IB_IF(invert BCLK + FRM)| | sample_resolution |采样精度,16bit, 24bit,32bit| | slot_width_select| 支持8bit, 16bit, 32bit宽度| | pcm_lrck_period |可配置16/32/64/128/256个bclk| | pcm_lrckr_period |可配置16/32/64/128/256个bclk| | msb_lsb_first |0: msb first; 1: lsb first| | sign_extend |0: zero pending; 1: sign extend| | tx_data_mode |0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law| | rx_data_mode |0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law| | i2s_bclk |i2s_bclk引脚| | i2s_lrclk |i2s_lrclk引脚| | i2s_dout0 |i2s_dout引脚| | i2s_din| i2s_din引脚|</p> <h3 id=256>2.5.6 标案音频测试方法</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令。</p> <h4 id=2561>2.5.6.1 播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-35-1 id=__codelineno-35-1 name=__codelineno-35-1></a>amixer -D hw:audiocodec cset name='SPK_L Mux' 1
<a href=#__codelineno-35-2 id=__codelineno-35-2 name=__codelineno-35-2></a>amixer -D hw:audiocodec cset name='SPK_R Mux' 1
<a href=#__codelineno-35-3 id=__codelineno-35-3 name=__codelineno-35-3></a>amixer -D hw:audiocodec cset name='Lineout volume' 24
<a href=#__codelineno-35-4 id=__codelineno-35-4 name=__codelineno-35-4></a>amixer -D hw:audiocodec cset name='Right Output Mixer DACR Switch' 1
<a href=#__codelineno-35-5 id=__codelineno-35-5 name=__codelineno-35-5></a>amixer -D hw:audiocodec cset name='Left Output Mixer DACL Switch' 1
<a href=#__codelineno-35-6 id=__codelineno-35-6 name=__codelineno-35-6></a>amixer -D hw:audiocodec cset name='digital volume' 0
<a href=#__codelineno-35-7 id=__codelineno-35-7 name=__codelineno-35-7></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <p>可通过下面命令调节硬件上的模拟音量:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-36-1 id=__codelineno-36-1 name=__codelineno-36-1></a>amixer -Dhw:audiocodec cset name='Lineout volume' 50
</code></pre></div> <h4 id=2562>2.5.6.2 录音</h4> <p>表示下使用AudioCodec进行单声道录音</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-37-1 id=__codelineno-37-1 name=__codelineno-37-1></a>amixer -D hw:audiocodec cset name='LADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-37-2 id=__codelineno-37-2 name=__codelineno-37-2></a>amixer -D hw:audiocodec cset name='MIC1 boost AMP gain control' 4
<a href=#__codelineno-37-3 id=__codelineno-37-3 name=__codelineno-37-3></a>
<a href=#__codelineno-37-4 id=__codelineno-37-4 name=__codelineno-37-4></a>arecord -Dhw:audiocodec -f S16_LE -r 16000 -c 1 /tmp/test.wav
</code></pre></div> <h2 id=26-r16>2.6 R16音频接口</h2> <h3 id=261>2.6.1 硬件资源</h3> <p>R16包含 3 个音频模块，分别是内置AudioCodec,I2S0以及I2S1。</p> <p><img alt="图2-11: R16音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-11.jpg></p> <h3 id=262>2.6.2 时钟源</h3> <p>R16中， 3 个音频模块的时钟源均来自pll_audio。</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播放录音。</p> <p><img alt="图2-12: R16时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-12.jpg></p> <h3 id=263>2.6.3 代码结构</h3> <div class=highlight><pre><span></span><code><a href=#__codelineno-38-1 id=__codelineno-38-1 name=__codelineno-38-1></a>linux-3.4/sound/soc/sunxi/
<a href=#__codelineno-38-2 id=__codelineno-38-2 name=__codelineno-38-2></a>├── audiocodec
<a href=#__codelineno-38-3 id=__codelineno-38-3 name=__codelineno-38-3></a>│   ├── sun8iw5_machine.c // codec machine驱动
<a href=#__codelineno-38-4 id=__codelineno-38-4 name=__codelineno-38-4></a>│   ├── sun8iw5_sndcodec.c // codec驱动
<a href=#__codelineno-38-5 id=__codelineno-38-5 name=__codelineno-38-5></a>│   ├── sun8iw5_sndcodec.h
<a href=#__codelineno-38-6 id=__codelineno-38-6 name=__codelineno-38-6></a>│   ├── sunxi_codecdma.c // codec platform驱动
<a href=#__codelineno-38-7 id=__codelineno-38-7 name=__codelineno-38-7></a>│   ├── sunxi_codecdma.h
<a href=#__codelineno-38-8 id=__codelineno-38-8 name=__codelineno-38-8></a>│   └── sunxi_codec.c // cpu dai驱动
<a href=#__codelineno-38-9 id=__codelineno-38-9 name=__codelineno-38-9></a>├── i2s0
<a href=#__codelineno-38-10 id=__codelineno-38-10 name=__codelineno-38-10></a>│ ├── sndi2s0.c // i2s codec驱动
<a href=#__codelineno-38-11 id=__codelineno-38-11 name=__codelineno-38-11></a>│ ├── sunxi-i2s0dma.c // i2s platform驱动
<a href=#__codelineno-38-12 id=__codelineno-38-12 name=__codelineno-38-12></a>│ ├── sunxi-i2s0dma.h
<a href=#__codelineno-38-13 id=__codelineno-38-13 name=__codelineno-38-13></a>│ ├── sunxi-i2s0.c // i2s cpu dai驱动
<a href=#__codelineno-38-14 id=__codelineno-38-14 name=__codelineno-38-14></a>│ ├── sunxi-i2s0.h
<a href=#__codelineno-38-15 id=__codelineno-38-15 name=__codelineno-38-15></a>│ └── sunxi-sndi2s0.c // i2s machine驱动
<a href=#__codelineno-38-16 id=__codelineno-38-16 name=__codelineno-38-16></a>└── i2s1
<a href=#__codelineno-38-17 id=__codelineno-38-17 name=__codelineno-38-17></a>    ├── sndi2s1.c // i2s codec驱动
<a href=#__codelineno-38-18 id=__codelineno-38-18 name=__codelineno-38-18></a>    ├── sunxi-i2s1dma.c // i2s platform驱动
<a href=#__codelineno-38-19 id=__codelineno-38-19 name=__codelineno-38-19></a>    ├── sunxi-i2s1dma.h
<a href=#__codelineno-38-20 id=__codelineno-38-20 name=__codelineno-38-20></a>    ├── sunxi-i2s1.c // i2s cpu dai驱动
<a href=#__codelineno-38-21 id=__codelineno-38-21 name=__codelineno-38-21></a>    ├── sunxi-i2s1.h
<a href=#__codelineno-38-22 id=__codelineno-38-22 name=__codelineno-38-22></a>    └── sunxi-sndi2s1.c // i2s machine驱动
</code></pre></div> <h3 id=264-audiocodec>2.6.4 AudioCodec</h3> <p>硬件特性</p> <ul> <li> <p>两路DAC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~192KHz采样率</p> </li> <li> <p>两路ADC</p> </li> <li> <p>支持16bit,24bit采样精度</p> </li> <li> <p>支持8KHz~48KHz采样率</p> </li> <li> <p>两路模拟输出:</p> </li> <li> <p>一路立体声headphone输出(HPOUTL,HPOUTR)</p> </li> <li> <p>一路立体声phoneout输出(PHONEOUTP,PHONEOUTN)</p> </li> <li> <p>四路路模拟输入：MIC1,MIC2,linein,phonein</p> </li> <li>支持headphone驱动</li> <li>支持同时playback和record(全双工模式)</li> </ul> <h4 id=2641>2.6.4.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-39-1 id=__codelineno-39-1 name=__codelineno-39-1></a>Device Drivers ---&gt;
<a href=#__codelineno-39-2 id=__codelineno-39-2 name=__codelineno-39-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-39-3 id=__codelineno-39-3 name=__codelineno-39-3></a>    &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-39-4 id=__codelineno-39-4 name=__codelineno-39-4></a>        &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-39-5 id=__codelineno-39-5 name=__codelineno-39-5></a>            &lt;*&gt; Audiocodec for the SUNXI chips
<a href=#__codelineno-39-6 id=__codelineno-39-6 name=__codelineno-39-6></a>            &lt;*&gt; Audiocodec Machine for sun8iw5 chips
<a href=#__codelineno-39-7 id=__codelineno-39-7 name=__codelineno-39-7></a>            &lt;*&gt; Audiocodec for the SUN8IW5 chips
</code></pre></div> <h4 id=2642-sys_config>2.6.4.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-40-1 id=__codelineno-40-1 name=__codelineno-40-1></a>[audio0]
<a href=#__codelineno-40-2 id=__codelineno-40-2 name=__codelineno-40-2></a>audio_used = 1
<a href=#__codelineno-40-3 id=__codelineno-40-3 name=__codelineno-40-3></a>headphone_vol = 0x3b
<a href=#__codelineno-40-4 id=__codelineno-40-4 name=__codelineno-40-4></a>pa_double_used = 1
<a href=#__codelineno-40-5 id=__codelineno-40-5 name=__codelineno-40-5></a>headphone_direct_used = 1
<a href=#__codelineno-40-6 id=__codelineno-40-6 name=__codelineno-40-6></a>headset_mic_vol = 3
<a href=#__codelineno-40-7 id=__codelineno-40-7 name=__codelineno-40-7></a>main_mic_vol = 1
<a href=#__codelineno-40-8 id=__codelineno-40-8 name=__codelineno-40-8></a>;audio_linein_detect = port:PB07&lt;0&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
<a href=#__codelineno-40-9 id=__codelineno-40-9 name=__codelineno-40-9></a>audio_pa_ctrl = port:PD11&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
<a href=#__codelineno-40-10 id=__codelineno-40-10 name=__codelineno-40-10></a>pa_gpio_reverse = 0
<a href=#__codelineno-40-11 id=__codelineno-40-11 name=__codelineno-40-11></a>aif2_used = 0
<a href=#__codelineno-40-12 id=__codelineno-40-12 name=__codelineno-40-12></a>aif3_used = 0
<a href=#__codelineno-40-13 id=__codelineno-40-13 name=__codelineno-40-13></a>headphone_mute_used = 0
<a href=#__codelineno-40-14 id=__codelineno-40-14 name=__codelineno-40-14></a>aif1_lrlk_div = 0x40
</code></pre></div> <table> <thead> <tr> <th style="text-align: left;">audio0配置</th> <th style="text-align: left;">audio0配置说明</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">audio0</td> <td style="text-align: left;">是否使用audiocodec驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td style="text-align: left;">headphone_vol</td> <td style="text-align: left;">headphone volume，可设定范围0~0x3f, 0表示mute,1<sub>63表示-62dB</sub>0dB, 1dB/step</td> </tr> <tr> <td style="text-align: left;">pa_double_used</td> <td style="text-align: left;">是否同时使用两个DAC， 0 ：不使用； 1 ：使用</td> </tr> <tr> <td style="text-align: left;">headphone_direct_used</td> <td style="text-align: left;">是否使用headphone输出， 0 ：不使用； 1 ：使用</td> </tr> <tr> <td style="text-align: left;">main_mic_vol</td> <td style="text-align: left;">MIC1默认增益, 0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td style="text-align: left;">headset_mic_vol</td> <td style="text-align: left;">MIC2默认增益, 0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td style="text-align: left;">audio_pa_ctrl</td> <td style="text-align: left;">PA使能引脚</td> </tr> <tr> <td style="text-align: left;">pa_gpio_reverse</td> <td style="text-align: left;">PA使能引脚是否颠倒, 0:正常,即high level active; 1:颠倒,即low level active</td> </tr> <tr> <td style="text-align: left;">aif1_lrlk_div</td> <td style="text-align: left;">aif1的lrck分频系数</td> </tr> </tbody> </table> <h4 id=2643-codec>2.6.4.3 codec数据通路</h4> <p><img alt="图2-13: R16音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-13.jpg></p> <div class=highlight><pre><span></span><code><a href=#__codelineno-41-1 id=__codelineno-41-1 name=__codelineno-41-1></a>通过HPOUTL/R播歌
<a href=#__codelineno-41-2 id=__codelineno-41-2 name=__codelineno-41-2></a>AIF1DACL --&gt; AIF1IN0L Mux --&gt; DACL Mixer --&gt; Left Output Mixer --&gt; HP_L Mux --&gt; HPOUTL
<a href=#__codelineno-41-3 id=__codelineno-41-3 name=__codelineno-41-3></a>AIF1DACR --&gt; AIF1IN0R Mux --&gt; DACR Mixer --&gt; Right Output Mixer --&gt; HP_R Mux --&gt; HPOUTR
<a href=#__codelineno-41-4 id=__codelineno-41-4 name=__codelineno-41-4></a>
<a href=#__codelineno-41-5 id=__codelineno-41-5 name=__codelineno-41-5></a>通过MIC1录音
<a href=#__codelineno-41-6 id=__codelineno-41-6 name=__codelineno-41-6></a>AIF1ADCL &lt;-- AIF1OUT0L Mux &lt;-- AIF1 AD0L Mixer &lt;-- ADCL Mux &lt;-- LEFT ADC input Mixer &lt;--
<a href=#__codelineno-41-7 id=__codelineno-41-7 name=__codelineno-41-7></a>MIC1 PGA &lt;-- MIC1P/N
</code></pre></div> <p>R16相关控件如下表：</p> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>Headphone<br>Switch</td> <td>Headphone通路使能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>ADC input gain</td> <td>ADC增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>ADC volume</td> <td>ADCL/ADCR音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>ADCL Mux</td> <td>ADCL Mux设置,只支持0:ADC</td> <td>0:ADC</td> </tr> <tr> <td>ADCR Mux</td> <td>ADCR Mux设置,只支持0:ADC</td> <td>0:ADC</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>ADCL Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF1 DA0L Switch</td> <td>AIF1 AD0L Mixer设置，使能AIF1 DA0L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD0L Mixer设置，使能AIF2 DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF2 DACR<br>Switch</td> <td>AIF1 AD0L Mixer设置，使能AIF2 DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>ADCR Switch</td> <td>AIF1 AD0R Mixer设置，使能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF1 DA0R Switch</td> <td>AIF1 AD0R Mixer设置，使能AIF1 DA0R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD0R Mixer设置，使能AIF2 DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF2 DACR<br>Switch</td> <td>AIF1 AD0R Mixer设置，使能AIF2 DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1L Mixer<br>ADCL Switch</td> <td>AIF1 AD1L Mixer设置，使能ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1L Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD1L Mixer设置，使能AIF2 DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1R Mixer<br>ADCR Switch</td> <td>AIF1 AD1R Mixer设置，使能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1R Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD1R Mixer设置，使能AIF2 DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 ADC timeslot<br>0 mixer gain</td> <td>AIF1 ADC0L/ADC0R Mixer,数字增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于ADC0L Mixer,<br>bit0:AIF2 DACR;<br>bit1:ADCL;<br>bit2:AIF2 DACL;<br>bit3:AIF2 DA0L;<br>对于ADC0R Mixer,<br>bit0:AIF2 DACL;<br>bit1:ADCR;<br>bit2:AIF2 DACR;<br>bit3:AIF2 DA0R;<br></td> </tr> <tr> <td>AIF1 ADC timeslot<br>0 volume</td> <td>AIF1 ADC0L/ADC0R音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 ADC timeslot<br>1 mixer gain</td> <td>AIF1 ADC1L/ADC1R Mixer,数字增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于ADC1L Mixer,<br>bit0:ADCL;<br>bit1:AIF2 DACL;<br>对于ADC1R Mixer,<br>bit0:ADCR;<br>bit1:AIF2 DACR;</td> </tr> <tr> <td>AIF1 ADC timeslot<br>1 volume</td> <td>AIF1 ADC1L/ADC1R 音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 DAC timeslot<br>0 volume</td> <td>AIF1 DAC0L/DAC0R 音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 DAC timeslot<br>1 volume</td> <td>AIF1 DAC1L/DAC1R 音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1IN0L Mux</td> <td>AIF1IN0L Mux设置</td> <td>0:AIF1_DA0L; 1:AIF1_DA0R;<br>2:SUM_AIF1DA0L_AIF1DA0R;<br>3:AVE_AIF1DA0L_AIF1DA0R</td> </tr> <tr> <td>AIF1IN0R Mux</td> <td>AIF1IN0R Mux设置</td> <td>0:AIF1_DA0R; 1:AIF1_DA0L;<br>2:SUM_AIF1DA0L_AIF1DA0R;<br>3:AVE_AIF1DA0L_AIF1DA0R</td> </tr> <tr> <td>AIF1IN1L Mux</td> <td>AIF1IN1L Mux设置</td> <td>0:AIF1_DA1L; 1:AIF1_DA1R;<br>2:SUM_AIF1DA1L_AIF1DA1R;<br>3:AVE_AIF1DA1L_AIF1DA1R</td> </tr> <tr> <td>AIF1IN1R Mux</td> <td>AIF1IN1R Mux设置</td> <td>0:AIF1_DA1R; 1:AIF1_DA1L;<br>2:SUM_AIF1DA1L_AIF1DA1R;<br>3:AVE_AIF1DA1L_AIF1DA1R</td> </tr> <tr> <td>AIF1OUT0L Mux</td> <td>AIF1OUT0L Mux设置</td> <td>0:AIF1_AD0L; 1:AIF1_AD0R;<br>2:SUM_AIF1AD0L_AIF1AD0R;<br>3:AVE_AIF1AD0L_AIF1AD0R</td> </tr> <tr> <td>AIF1OUT0R Mux</td> <td>AIF1OUT0R Mux设置</td> <td>0:AIF1_AD0R; 1:AIF1_AD0L;<br>2:SUM_AIF1AD0L_AIF1AD0R;<br>3:AVE_AIF1AD0L_AIF1AD0R</td> </tr> <tr> <td>AIF1OUT1L Mux</td> <td>AIF1OUT1L Mux设置</td> <td>0:AIF1_AD1L; 1:AIF1_AD1R;<br>2:SUM_AIF1AD1L_AIF1AD1R;<br>3:AVE_AIF1AD1L_AIF1AD1R</td> </tr> <tr> <td>AIF1OUT1R Mux</td> <td>AIF1OUT1R Mux设置</td> <td>0:AIF1_AD1R; 1:AIF1_AD1L;<br>2:SUM_AIF1AD1L_AIF1AD1R;<br>3:AVE_AIF1AD1L_AIF1AD1R</td> </tr> <tr> <td>DAC mixer gain</td> <td>DAC mixer增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于DACL Mixer,<br>bit0:ADCL;<br>bit1:AIF2 DACL;<br>bit2:AIF1 DAC1L;<br>bit3:AIF1 DAC0L;<br>对于DACR Mixer,<br>bit0:ADCR;<br>bit1:AIF2 DACR;<br>bit2:AIF1 DAC1R;<br>bit3:AIF1 DAC0R;</td> </tr> <tr> <td>DAC volume</td> <td>DACL/DACR音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>DACL Mixer<br>ADCL Switch</td> <td>DACL Mixer设置，使能<br>ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF1DA0L Switch</td> <td>DACL Mixer设置，使能<br>AIF1DA0L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF1DA1L Switch</td> <td>DACL Mixer设置，使能<br>AIF1DA1L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF2DACL Switch</td> <td>DACL Mixer设置，使能<br>AIF2DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>ADCR Switch</td> <td>DACR Mixer设置，使<br>能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF1DA0R Switch</td> <td>DACR Mixer设置，使<br>能AIF1DA0R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF1DA1R Switch</td> <td>DACR Mixer设置，使<br>能AIF1DA1R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF2DACR Switch</td> <td>DACR Mixer设置，使<br>能AIF2DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>External Speaker<br>Switch</td> <td>使能Headphone以及<br>PA</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>HP_L Mux</td> <td>HP_L Mux设置</td> <td>0:DACL ; 1:Left Output Mixer</td> </tr> <tr> <td>HP_R Mux</td> <td>HP_R Mux设置</td> <td>0:DACR ; 1:Right Output Mixer</td> </tr> <tr> <td>LEFT ADC input<br>Mixer<br>Lout_Mixer_Switch</td> <td>LEFT ADC input Mixer<br>设置，使能Lout Mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LEFT ADC input<br>Mixer MIC1 boost<br>Switch</td> <td>LEFT ADC input Mixer<br>设置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LEFT ADC input<br>Mixer MIC2 boost<br>Switch</td> <td>LEFT ADC input Mixer<br>设置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LEFT ADC input<br>Mixer<br>Rout_Mixer_Switch</td> <td>LEFT ADC input Mixer<br>设置，使能Rout Mixer<br>通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>DACL Switch</td> <td>Left Output Mixer设<br>置，使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>DACR Switch</td> <td>Left Output Mixer设<br>置，使能DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>MIC1Booststage<br>Switch</td> <td>Left Output Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>MIC2Booststage<br>Switch</td> <td>Left Output Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>MIC1 boost<br>amplifier gain</td> <td>MIC1增益</td> <td>0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>MIC2 SRC</td> <td>MIC2 SRC设置</td> <td>0:MIC3; 1:MIC2</td> </tr> <tr> <td>MIC2 boost<br>amplifier gain</td> <td>MIC2增益</td> <td>0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>RIGHT ADC input<br>Mixer<br>Lout_Mixer_Switch</td> <td>RIGHT ADC input<br>Mixer设置，使能Lout<br>Mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RIGHT ADC input<br>Mixer MIC1 boost<br>Switch</td> <td>RIGHT ADC input<br>Mixer设置，使能MIC1<br>通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RIGHT ADC input<br>Mixer MIC2 boost<br>Switch</td> <td>RIGHT ADC input<br>Mixer设置，使能MIC2<br>通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RIGHT ADC input<br>Mixer<br>Rout_Mixer_Switch</td> <td>RIGHT ADC input<br>Mixer设置，使能Rout<br>Mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output<br>Mixer DACL<br>Switch</td> <td>Right Output Mixer设<br>置，使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output<br>Mixer DACR<br>Switch</td> <td>Right Output Mixer设<br>置，使能DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output<br>Mixer<br>MIC1Booststage<br>Switch</td> <td>Right Output Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output<br>Mixer<br>MIC2Booststage<br>Switch</td> <td>Right Output Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>digital volume</td> <td>数字音量设置</td> <td>0–63,表示-73.08–0dB</td> </tr> <tr> <td>headphone<br>volume</td> <td>headphone音量设置</td> <td>0–63,0表示mute; 1~63表<br>示-62dB–0dB</td> </tr> </tbody> </table> <h3 id=265-daudio>2.6.5 Daudio.</h3> <p>硬件特性</p> <p>• 两路I2S/PCM；</p> <p>• 支持主从模式</p> <ul> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持mono和stereo模式，支持 8 通道输出和 2 通道输入</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> </ul> <h4 id=2651>2.6.5.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-42-1 id=__codelineno-42-1 name=__codelineno-42-1></a>Device Drivers ---&gt;
<a href=#__codelineno-42-2 id=__codelineno-42-2 name=__codelineno-42-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-42-3 id=__codelineno-42-3 name=__codelineno-42-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-42-4 id=__codelineno-42-4 name=__codelineno-42-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-42-5 id=__codelineno-42-5 name=__codelineno-42-5></a>&lt;*&gt; SoC i2s0 interface for SUNXI chips
<a href=#__codelineno-42-6 id=__codelineno-42-6 name=__codelineno-42-6></a>&lt;*&gt; SoC i2s1 interface for SUNXI chips
</code></pre></div> <h4 id=2652-sys_config>2.6.5.2 sys_config配置.</h4> <p>I2S0,I2S1的配置方法是一样的，下面仅描述I2S0</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-43-1 id=__codelineno-43-1 name=__codelineno-43-1></a>[i2s0]
<a href=#__codelineno-43-2 id=__codelineno-43-2 name=__codelineno-43-2></a>i1s0_used = 1
<a href=#__codelineno-43-3 id=__codelineno-43-3 name=__codelineno-43-3></a>i2s0_channel = 2
<a href=#__codelineno-43-4 id=__codelineno-43-4 name=__codelineno-43-4></a>i2s0_master = 4
<a href=#__codelineno-43-5 id=__codelineno-43-5 name=__codelineno-43-5></a>i2s0_select = 1
<a href=#__codelineno-43-6 id=__codelineno-43-6 name=__codelineno-43-6></a>audio_format = 1
<a href=#__codelineno-43-7 id=__codelineno-43-7 name=__codelineno-43-7></a>signal_inversion = 1
<a href=#__codelineno-43-8 id=__codelineno-43-8 name=__codelineno-43-8></a>over_sample_rate = 512
<a href=#__codelineno-43-9 id=__codelineno-43-9 name=__codelineno-43-9></a>sample_resolution = 16
<a href=#__codelineno-43-10 id=__codelineno-43-10 name=__codelineno-43-10></a>word_select_size = 32
<a href=#__codelineno-43-11 id=__codelineno-43-11 name=__codelineno-43-11></a>pcm_sync_period = 256
<a href=#__codelineno-43-12 id=__codelineno-43-12 name=__codelineno-43-12></a>msb_lsb_first = 0
<a href=#__codelineno-43-13 id=__codelineno-43-13 name=__codelineno-43-13></a>slot_index = 0
<a href=#__codelineno-43-14 id=__codelineno-43-14 name=__codelineno-43-14></a>slot_width = 16
<a href=#__codelineno-43-15 id=__codelineno-43-15 name=__codelineno-43-15></a>frame_width = 1
<a href=#__codelineno-43-16 id=__codelineno-43-16 name=__codelineno-43-16></a>tx_data_mode = 1
<a href=#__codelineno-43-17 id=__codelineno-43-17 name=__codelineno-43-17></a>rx_data_mode = 1
<a href=#__codelineno-43-18 id=__codelineno-43-18 name=__codelineno-43-18></a>i2s0_mclk =
<a href=#__codelineno-43-19 id=__codelineno-43-19 name=__codelineno-43-19></a>i2s0_bclk = port:PB05&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-43-20 id=__codelineno-43-20 name=__codelineno-43-20></a>i2s0_lrclk = port:PB04&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-43-21 id=__codelineno-43-21 name=__codelineno-43-21></a>i2s0_dout0 = port:PB06&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-43-22 id=__codelineno-43-22 name=__codelineno-43-22></a>i2s0_dout1 =
<a href=#__codelineno-43-23 id=__codelineno-43-23 name=__codelineno-43-23></a>i2s0_dout2 =
<a href=#__codelineno-43-24 id=__codelineno-43-24 name=__codelineno-43-24></a>i2s0_dout3 =
<a href=#__codelineno-43-25 id=__codelineno-43-25 name=__codelineno-43-25></a>i2s0_din = port:PB07&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
</code></pre></div> <table> <thead> <tr> <th>i2s0配置</th> <th>i2s0配置说明</th> </tr> </thead> <tbody> <tr> <td>i2s0_used</td> <td>是否使用i2s驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>i2s0_master</td> <td>1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRMmaster),<br>即daudio接口作为slave, codec作为master<br>2: SND_SOC_DAIFMT_CBS_CFM(codec clk slave &amp;<br>FRM master),一般不用<br>3: SND_SOC_DAIFMT_CBM_CFS(codec clk master &amp;<br>frame slave),一般不用<br>4: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM<br>slave),即daudio接口作为master, codec作为slave</td> </tr> <tr> <td>audio_format</td> <td>1: SND_SOC_DAIFMT_I2S(standard i2s format)<br>2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)<br>3: SND_SOC_DAIFMT_LEFT_J(left justfied format)<br>4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available<br>on 2<sup>nd</sup> BCLK rising edge after LRC rising edge)<br>5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available<br>on 1nd BCLK rising edge after LRC rising edge)</td> </tr> <tr> <td>signal_inversion</td> <td>1: SND_SOC_DAIFMT_NB_NF(normal bit clock +<br>frame)<br>2: SND_SOC_DAIFMT_NB_IF(normal BCLK + inv<br>FRM)<br>3: SND_SOC_DAIFMT_IB_NF(invert BCLK + nor FRM)<br>4: SND_SOC_DAIFMT_IB_IF(invert BCLK + FRM)<br></td> </tr> <tr> <td>over_sample_rate</td> <td>支持128fs/192fs/256fs/384fs/512fs/768fs</td> </tr> <tr> <td>sample_resolution</td> <td>采样精度,16bit, 24bit,32bit</td> </tr> <tr> <td>word_select_size</td> <td>支持16bits/20bits/24bits/32bits</td> </tr> <tr> <td>pcm_sync_period</td> <td>16/32/64/128/256</td> </tr> <tr> <td>msb_lsb_first</td> <td>0: msb first; 1: lsb first</td> </tr> <tr> <td>slot_index</td> <td>0: 1<sup>st</sup> slot; 1: 2<sup>nd</sup> slot; 2: 3th slot; 3:4<sup>th</sup> slot</td> </tr> <tr> <td>slot_width</td> <td>8: 8 clocks width; 16: 16 clocks width</td> </tr> <tr> <td>frame_width</td> <td>0: long frame sync; 1: short frame sync</td> </tr> <tr> <td>tx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law</td> </tr> <tr> <td>rx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law</td> </tr> <tr> <td>i2s0_mclk</td> <td>i2s0_mclk引脚</td> </tr> <tr> <td>i2s0_bclk</td> <td>i2s0_bclk引脚</td> </tr> <tr> <td>i2s0_lrclk</td> <td>i2s0_lrclk引脚</td> </tr> <tr> <td>i2s0_dout0</td> <td>i2s0_dout引脚</td> </tr> <tr> <td>i2s0_din</td> <td>i2s0_din引脚</td> </tr> </tbody> </table> <h3 id=266>2.6.6 标案音频测试方法</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令。</p> <h4 id=2661>2.6.6.1 播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-44-1 id=__codelineno-44-1 name=__codelineno-44-1></a>通过speaker播放
<a href=#__codelineno-44-2 id=__codelineno-44-2 name=__codelineno-44-2></a>amixer cset name='AIF1IN0L Mux' 'AIF1_DA0L';
<a href=#__codelineno-44-3 id=__codelineno-44-3 name=__codelineno-44-3></a>amixer cset name='AIF1IN0R Mux' 'AIF1_DA0R';
<a href=#__codelineno-44-4 id=__codelineno-44-4 name=__codelineno-44-4></a>amixer cset name='DACL Mixer AIF1DA0L Switch' 1;
<a href=#__codelineno-44-5 id=__codelineno-44-5 name=__codelineno-44-5></a>amixer cset name='DACR Mixer AIF1DA0R Switch' 1;
<a href=#__codelineno-44-6 id=__codelineno-44-6 name=__codelineno-44-6></a>amixer cset name='HP_L Mux' 'DACL HPL Switch' ;
<a href=#__codelineno-44-7 id=__codelineno-44-7 name=__codelineno-44-7></a>amixer cset name='HP_R Mux' 'DACR HPR Switch';
<a href=#__codelineno-44-8 id=__codelineno-44-8 name=__codelineno-44-8></a>amixer cset name='External Speaker Switch' 1;
<a href=#__codelineno-44-9 id=__codelineno-44-9 name=__codelineno-44-9></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-45-1 id=__codelineno-45-1 name=__codelineno-45-1></a>mixer cset name='AIF1IN0L Mux' 'AIF1_DA0L';
<a href=#__codelineno-45-2 id=__codelineno-45-2 name=__codelineno-45-2></a>amixer cset name='AIF1IN0R Mux' 'AIF1_DA0R';
<a href=#__codelineno-45-3 id=__codelineno-45-3 name=__codelineno-45-3></a>amixer cset name='DACL Mixer AIF1DA0L Switch' 1;
<a href=#__codelineno-45-4 id=__codelineno-45-4 name=__codelineno-45-4></a>amixer cset name='DACR Mixer AIF1DA0R Switch' 1;
<a href=#__codelineno-45-5 id=__codelineno-45-5 name=__codelineno-45-5></a>amixer cset name='HP_L Mux' 'DACL HPL Switch' ;
<a href=#__codelineno-45-6 id=__codelineno-45-6 name=__codelineno-45-6></a>amixer cset name='HP_R Mux' 'DACR HPR Switch';
<a href=#__codelineno-45-7 id=__codelineno-45-7 name=__codelineno-45-7></a>amixer cset name='Headphone Switch' 1;
<a href=#__codelineno-45-8 id=__codelineno-45-8 name=__codelineno-45-8></a>aplay -Dhw:sndcodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <p>可通过下面命令调节硬件上的模拟音量:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-46-1 id=__codelineno-46-1 name=__codelineno-46-1></a>amixer -Dhw:sndcodec cset name='headphone volume' 58
</code></pre></div> <h4 id=2662>2.6.6.2 录音</h4> <p>表示下使用audiocodec进行单声道录音</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-47-1 id=__codelineno-47-1 name=__codelineno-47-1></a>amixer cset name='LEFT ADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-47-2 id=__codelineno-47-2 name=__codelineno-47-2></a>amixer cset name='AIF1 AD0L Mixer ADCL Switch' 1
<a href=#__codelineno-47-3 id=__codelineno-47-3 name=__codelineno-47-3></a>amixer cset name='AIF1OUT0L Mux' 'AIF1_AD0L'
<a href=#__codelineno-47-4 id=__codelineno-47-4 name=__codelineno-47-4></a>amixer cset name='MIC1 boost amplifier gain' 4
<a href=#__codelineno-47-5 id=__codelineno-47-5 name=__codelineno-47-5></a>arecord -Dhw:sndcodec -f S16_LE -r 16000 -c 1 /tmp/test.wav
</code></pre></div> <h2 id=27-r18>2.7 R18音频接口</h2> <h3 id=271>2.7.1 硬件资源</h3> <p>R18包含 4 个音频模块，分别是内置AudioCodec以及Daudio0,Daudio1,Daudio2。</p> <p><img alt="图2-14: R18音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-14.jpg></p> <h3 id=272>2.7.2 时钟源</h3> <p>R18中， 4 个音频模块的时钟源均来自pll_audio</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播放录音。</p> <p><img alt="图2-15: R18时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-15.jpg></p> <h3 id=273>2.7.3 代码结构</h3> <div class=highlight><pre><span></span><code><a href=#__codelineno-48-1 id=__codelineno-48-1 name=__codelineno-48-1></a>linux-4.4/sound/soc/sunxi/
<a href=#__codelineno-48-2 id=__codelineno-48-2 name=__codelineno-48-2></a>├── sun50iw1-codec.c // codec驱动
<a href=#__codelineno-48-3 id=__codelineno-48-3 name=__codelineno-48-3></a>├── sun50iw1-codec.h
<a href=#__codelineno-48-4 id=__codelineno-48-4 name=__codelineno-48-4></a>├── sun50iw1-sndcodec.c // codec machine驱动
<a href=#__codelineno-48-5 id=__codelineno-48-5 name=__codelineno-48-5></a>├── sunxi-inter-i2s.c // codec platform驱动
<a href=#__codelineno-48-6 id=__codelineno-48-6 name=__codelineno-48-6></a>├── sunxi-daudio.c // daudio platform驱动
<a href=#__codelineno-48-7 id=__codelineno-48-7 name=__codelineno-48-7></a>├── sunxi-daudio.h
<a href=#__codelineno-48-8 id=__codelineno-48-8 name=__codelineno-48-8></a>├── sunxi-snddaudio.c // daudio machine驱动
<a href=#__codelineno-48-9 id=__codelineno-48-9 name=__codelineno-48-9></a>├── sunxi-snddaudio.h
<a href=#__codelineno-48-10 id=__codelineno-48-10 name=__codelineno-48-10></a>├── sunxi-pcm.c //通用文件，提供注册platform驱动的接口及相关函数集
<a href=#__codelineno-48-11 id=__codelineno-48-11 name=__codelineno-48-11></a>├── sunxi-pcm.h
<a href=#__codelineno-48-12 id=__codelineno-48-12 name=__codelineno-48-12></a>├── sunxi_rw_func.c //通用文件，读写模拟/数字寄存器的接口
<a href=#__codelineno-48-13 id=__codelineno-48-13 name=__codelineno-48-13></a>├── sunxi_rw_func.h
<a href=#__codelineno-48-14 id=__codelineno-48-14 name=__codelineno-48-14></a>├── spdif-utils.c // spdif codec驱动
<a href=#__codelineno-48-15 id=__codelineno-48-15 name=__codelineno-48-15></a>├── sunxi-sndspdif.c // spdif machine驱动
<a href=#__codelineno-48-16 id=__codelineno-48-16 name=__codelineno-48-16></a>├── sunxi-spdif.c // spdif platform驱动
<a href=#__codelineno-48-17 id=__codelineno-48-17 name=__codelineno-48-17></a>├── sunxi-spdif.h
<a href=#__codelineno-48-18 id=__codelineno-48-18 name=__codelineno-48-18></a>├── sunxi-hdmi.c // hdmi codec驱动
<a href=#__codelineno-48-19 id=__codelineno-48-19 name=__codelineno-48-19></a>└── sunxi-sndhdmi.c // hdmi machine驱动
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-49-1 id=__codelineno-49-1 name=__codelineno-49-1></a>hdmi platform模型使用的是sunxi-daudio.c
<a href=#__codelineno-49-2 id=__codelineno-49-2 name=__codelineno-49-2></a>linux-4.4/sound/soc/soc-utils.c // snd-soc-dummmy驱动,可用于daudio codec模型
<a href=#__codelineno-49-3 id=__codelineno-49-3 name=__codelineno-49-3></a>linux-4.4/sound/soc/codecs/ac108.c // ac108 codec驱动
<a href=#__codelineno-49-4 id=__codelineno-49-4 name=__codelineno-49-4></a>linux-4.4/sound/soc/codecs/tas5731.c // tas5731数字功放codec驱动
</code></pre></div> <h3 id=274-audiocodec>2.7.4 AudioCodec</h3> <p>硬件特性</p> <p>• 两路DAC</p> <ul> <li>支持16bit,24bit采样精度</li> <li>支持8KHz~192KHz采样率</li> <li>两路ADC</li> <li>支持16bit,24bit采样精度</li> <li>支持8KHz~48KHz采样率</li> <li>四路模拟输出:</li> <li>一路立体声earpiece输出(EAROUTP,EAROUTN)</li> <li>一路立体声phoneout输出(PHONEOUTP,PHONEOUTN)</li> <li>一路立体声headphone输出(HPOUTL,HPOUTR)</li> <li>一路立体声lineout输出(LINEOUTL,LINEOUTR)</li> <li>四路路模拟输入：MIC1,MIC2,linein,phonein</li> <li>支持headphone驱动</li> <li>支持earpiece驱动</li> <li>支持同时playback和record(全双工模式)</li> <li>支持适用于DAC的DRC功能</li> <li>支持适用于ADC的AGC,DRC功能</li> </ul> <h4 id=2741>2.7.4.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-50-1 id=__codelineno-50-1 name=__codelineno-50-1></a>Device Drivers ---&gt;
<a href=#__codelineno-50-2 id=__codelineno-50-2 name=__codelineno-50-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-50-3 id=__codelineno-50-3 name=__codelineno-50-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-50-4 id=__codelineno-50-4 name=__codelineno-50-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-50-5 id=__codelineno-50-5 name=__codelineno-50-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-50-6 id=__codelineno-50-6 name=__codelineno-50-6></a>&lt;*&gt; Allwinner Sun50iw1 Codec Support
</code></pre></div> <h4 id=2742-sys_config>2.7.4.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-51-1 id=__codelineno-51-1 name=__codelineno-51-1></a>[sndcodec]
<a href=#__codelineno-51-2 id=__codelineno-51-2 name=__codelineno-51-2></a>sndcodec_used = 0x1
<a href=#__codelineno-51-3 id=__codelineno-51-3 name=__codelineno-51-3></a>aif2fmt = 0x3
<a href=#__codelineno-51-4 id=__codelineno-51-4 name=__codelineno-51-4></a>aif3fmt = 0x3
<a href=#__codelineno-51-5 id=__codelineno-51-5 name=__codelineno-51-5></a>aif2master = 0x1
<a href=#__codelineno-51-6 id=__codelineno-51-6 name=__codelineno-51-6></a>linein_detect = port:PH05&lt;6&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
<a href=#__codelineno-51-7 id=__codelineno-51-7 name=__codelineno-51-7></a>hp_detect_case = 0x1
<a href=#__codelineno-51-8 id=__codelineno-51-8 name=__codelineno-51-8></a>;------------------------------------------------------------------------------
<a href=#__codelineno-51-9 id=__codelineno-51-9 name=__codelineno-51-9></a>[i2s]
<a href=#__codelineno-51-10 id=__codelineno-51-10 name=__codelineno-51-10></a>i2s_used = 0x1
<a href=#__codelineno-51-11 id=__codelineno-51-11 name=__codelineno-51-11></a>;-------------------------------------------------------------------------------
<a href=#__codelineno-51-12 id=__codelineno-51-12 name=__codelineno-51-12></a>[codec]
<a href=#__codelineno-51-13 id=__codelineno-51-13 name=__codelineno-51-13></a>codec_used = 0x1
<a href=#__codelineno-51-14 id=__codelineno-51-14 name=__codelineno-51-14></a>headphonevol = 0x38
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-52-1 id=__codelineno-52-1 name=__codelineno-52-1></a>spkervol = 0x1d
<a href=#__codelineno-52-2 id=__codelineno-52-2 name=__codelineno-52-2></a>earpiecevol = 0x1e
<a href=#__codelineno-52-3 id=__codelineno-52-3 name=__codelineno-52-3></a>maingain = 0x4
<a href=#__codelineno-52-4 id=__codelineno-52-4 name=__codelineno-52-4></a>headsetmicgain = 0x4
<a href=#__codelineno-52-5 id=__codelineno-52-5 name=__codelineno-52-5></a>adcagc_cfg = 0x0
<a href=#__codelineno-52-6 id=__codelineno-52-6 name=__codelineno-52-6></a>adcdrc_cfg = 0x0
<a href=#__codelineno-52-7 id=__codelineno-52-7 name=__codelineno-52-7></a>adchpf_cfg = 0x1
<a href=#__codelineno-52-8 id=__codelineno-52-8 name=__codelineno-52-8></a>dacdrc_cfg = 0x0
<a href=#__codelineno-52-9 id=__codelineno-52-9 name=__codelineno-52-9></a>dachpf_cfg = 0x0
<a href=#__codelineno-52-10 id=__codelineno-52-10 name=__codelineno-52-10></a>aif2config = 0x0
<a href=#__codelineno-52-11 id=__codelineno-52-11 name=__codelineno-52-11></a>aif3config = 0x0
<a href=#__codelineno-52-12 id=__codelineno-52-12 name=__codelineno-52-12></a>aif1_lrlk_div = 0x40
<a href=#__codelineno-52-13 id=__codelineno-52-13 name=__codelineno-52-13></a>aif2_lrlk_div = 0x40
<a href=#__codelineno-52-14 id=__codelineno-52-14 name=__codelineno-52-14></a>pa_sleep_time = 0x0a
<a href=#__codelineno-52-15 id=__codelineno-52-15 name=__codelineno-52-15></a>dac_digital_vol = 0x9898
<a href=#__codelineno-52-16 id=__codelineno-52-16 name=__codelineno-52-16></a>gpio-spk =
</code></pre></div> <p>sndcodec配置，即machine驱动的相关配置</p> <table> <thead> <tr> <th>sndcodec配置</th> <th>sndcodec配置说明</th> </tr> </thead> <tbody> <tr> <td>sndcodec_used 是否使用sndcodec驱动。</td> <td>0 ：不使用； 1 ：使用</td> </tr> <tr> <td>linein_detect</td> <td>linein检测引脚</td> </tr> <tr> <td>hp_detect_case</td> <td>jack irq level, 0:low; 1:high</td> </tr> </tbody> </table> <p>codec配置，即内置audiocodec驱动的相关配置</p> <table> <thead> <tr> <th>codec配置</th> <th>codec配置说明</th> </tr> </thead> <tbody> <tr> <td>codec_used</td> <td>是否使用codec驱动。0 ：不使用； 1 ：使用</td> </tr> <tr> <td>headphonevol</td> <td>headphone volume，可设定范围0~0x3f, 0表示mute, 1<sub>63表<br>示-62dB</sub>0dB, 1dB/step</td> </tr> <tr> <td>spkervol</td> <td>spk(lineout) volume,可设定范围0~0x1f, 0或者 1 表示mute, 2<sub>31<br>表示-43.5dB</sub>0dB, 1.5dB/step</td> </tr> <tr> <td>earpiecevol</td> <td>earpiece volume,可设定范围0~0x1f, 0或者 1 表示mute, 2<sub>31表<br>示-43.5dB</sub>0dB, 1.5dB/step</td> </tr> <tr> <td>maingain</td> <td>MIC1默认增益, 0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>headsetmicgain</td> <td>MIC2默认增益, 0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>adcagc_cfg</td> <td>是否使用adcagc. 0:不适用； 1 ：使用</td> </tr> <tr> <td>adcdrc_cfg</td> <td>是否使用adcdrc. 0:不适用； 1 ：使用</td> </tr> <tr> <td>adchpf_cfg</td> <td>是否使用adchpf. 0:不适用； 1 ：使用</td> </tr> <tr> <td>dacdrc_cfg</td> <td>是否使用dacdrc. 0:不适用； 1 ：使用</td> </tr> <tr> <td>dachpf_cfg</td> <td>是否使用dachpf. 0:不适用； 1 ：使用</td> </tr> <tr> <td>aif1_lrlk_div</td> <td>aif1的lrck分频系数</td> </tr> <tr> <td>pa_sleep_time</td> <td>使能pa之前等待的时间，单位ms</td> </tr> <tr> <td>dac_digital_vol</td> <td>DACL/DACR数字音量,0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB, 0.75dB/step,如0xA0表示0dB, 0x98表示-6dB</td> </tr> </tbody> </table> <table> <thead> <tr> <th>codec配置</th> <th>codec配置说明</th> </tr> </thead> <tbody> <tr> <td>gpio-spk</td> <td>PA使能引脚</td> </tr> </tbody> </table> <h4 id=2743-codec>2.7.4.3 codec数据通路</h4> <p><img alt="图2-16: R18音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-16.jpg></p> <div class=highlight><pre><span></span><code><a href=#__codelineno-53-1 id=__codelineno-53-1 name=__codelineno-53-1></a>通过HPOUTL/R播歌
<a href=#__codelineno-53-2 id=__codelineno-53-2 name=__codelineno-53-2></a>AIF1DACL --&gt; AIF1IN0L Mux --&gt; DACL Mixer --&gt; HP_L Mux --&gt; HPOUTL
<a href=#__codelineno-53-3 id=__codelineno-53-3 name=__codelineno-53-3></a>AIF1DACR --&gt; AIF1IN0R Mux --&gt; DACR Mixer --&gt; HP_R Mux --&gt; HPOUTR
<a href=#__codelineno-53-4 id=__codelineno-53-4 name=__codelineno-53-4></a>通过MIC1,2录音
<a href=#__codelineno-53-5 id=__codelineno-53-5 name=__codelineno-53-5></a>AIF1ADCL &lt;-- AIF1OUT0L Mux &lt;-- AIF1 AD0L Mixer &lt;-- ADCL Mux &lt;-- LADC input Mixer &lt;-- MIC1
<a href=#__codelineno-53-6 id=__codelineno-53-6 name=__codelineno-53-6></a>PGA &lt;-- MIC1P/N
<a href=#__codelineno-53-7 id=__codelineno-53-7 name=__codelineno-53-7></a>AIF1ADCR &lt;-- AIF1OUT0R Mux &lt;-- AIF1 AD0R Mixer &lt;-- ADCR Mux &lt;-- RADC input Mixer &lt;-- MIC2
<a href=#__codelineno-53-8 id=__codelineno-53-8 name=__codelineno-53-8></a>PGA &lt;-- MIC2P/N
</code></pre></div> <p>R18相关控件如下表：</p> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>Headphone Switch</td> <td>Headphone通路使能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Linein_detect<br>Switch</td> <td>Linein检测使能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>ADC input gain<br>control</td> <td>ADC增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>ADC volume</td> <td>ADCL/ADCR音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>ADCL Mux</td> <td>ADCL Mux设置,只支持<br>0:ADC</td> <td>0:ADC</td> </tr> <tr> <td>ADCR Mux</td> <td>ADCR Mux设置,只支持<br>0:ADC</td> <td>0:ADC</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>ADCL Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF1 DA0L Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能AIF1 DA0L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能AIF2 DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能AIF2 DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>ADCR Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF1 DA0R Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能AIF1 DA0R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能AIF2 DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能AIF2 DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1L Mixer<br>ADCL Switch</td> <td>AIF1 AD1L Mixer设<br>置，使能ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1L Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD1L Mixer设<br>置，使能AIF2 DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1R Mixer<br>ADCR Switch</td> <td>AIF1 AD1R Mixer设<br>置，使能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1R Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD1R Mixer设<br>置，使能AIF2 DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 ADC timeslot<br>0 mixer gain</td> <td>AIF1 ADC0L/ADC0R <br>Mixer,数字增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于ADC0L Mixer,<br>bit0:AIF2 DACR;<br>bit1:ADCL;<br>bit2:AIF2 DACL;<br>bit3:AIF2 DA0L;<br>对于ADC0R Mixer,<br>bit0:AIF2 DACL;<br>bit1:ADCR;<br>bit2:AIF2 DACR;<br>bit3:AIF2 DA0R;</td> </tr> <tr> <td>AIF1 ADC timeslot<br>0 volume</td> <td>AIF1 ADC0L/ADC0R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 ADC timeslot<br>1 mixer gain</td> <td>AIF1 ADC1L/ADC1R<br>Mixer,数字增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于ADC1L Mixer,<br>bit0:ADCL;<br>bit1:AIF2 DACL;<br>对于ADC1R Mixer,<br>bit0:ADCR;<br>bit1:AIF2 DACR;</td> </tr> <tr> <td>AIF1 ADC timeslot<br>1 volume</td> <td>AIF1 ADC1L/ADC1R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 DAC timeslot<br>0 volume</td> <td>AIF1 DAC0L/DAC0R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 DAC timeslot<br>1 volume</td> <td>AIF1 DAC1L/DAC1R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1IN0L Mux</td> <td>AIF1IN0L Mux设置</td> <td>0:AIF1_DA0L; 1:AIF1_DA0R;<br>2:SUM_AIF1DA0L_AIF1DA0R;<br>3:AVE_AIF1DA0L_AIF1DA0R</td> </tr> <tr> <td>AIF1IN0R Mux</td> <td>AIF1IN0R Mux设置</td> <td>0:AIF1_DA0R; 1:AIF1_DA0L;<br>2:SUM_AIF1DA0L_AIF1DA0R;<br>3:AVE_AIF1DA0L_AIF1DA0R</td> </tr> <tr> <td>AIF1IN1L Mux</td> <td>AIF1IN1L Mux设置</td> <td>0:AIF1_DA1L; 1:AIF1_DA1R;<br>2:SUM_AIF1DA1L_AIF1DA1R;<br>3:AVE_AIF1DA1L_AIF1DA1R</td> </tr> <tr> <td>AIF1IN1R Mux</td> <td>AIF1IN1R Mux设置</td> <td>0:AIF1_DA1R; 1:AIF1_DA1L;<br>2:SUM_AIF1DA1L_AIF1DA1R;<br>3:AVE_AIF1DA1L_AIF1DA1R</td> </tr> <tr> <td>AIF1OUT0L Mux</td> <td>AIF1OUT0L Mux设置</td> <td>0:AIF1_AD0L; 1:AIF1_AD0R;<br>2:SUM_AIF1AD0L_AIF1AD0R;<br>3:AVE_AIF1AD0L_AIF1AD0R</td> </tr> <tr> <td>AIF1OUT0R Mux</td> <td>AIF1OUT0R Mux设置</td> <td>0:AIF1_AD0R; 1:AIF1_AD0L;<br>2:SUM_AIF1AD0L_AIF1AD0R;<br>3:AVE_AIF1AD0L_AIF1AD0R</td> </tr> <tr> <td>AIF1OUT1L Mux</td> <td>AIF1OUT1L Mux设置</td> <td>0:AIF1_AD1L; 1:AIF1_AD1R;<br>2:SUM_AIF1AD1L_AIF1AD1R;<br>3:AVE_AIF1AD1L_AIF1AD1R</td> </tr> <tr> <td>AIF1OUT1R Mux</td> <td>AIF1OUT1R Mux设置</td> <td>0:AIF1_AD1R; 1:AIF1_AD1L;<br>2:SUM_AIF1AD1L_AIF1AD1R;<br>3:AVE_AIF1AD1L_AIF1AD1R</td> </tr> <tr> <td>DAC mixer gain</td> <td>DAC mixer增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于DACL Mixer,<br>bit0:ADCL;<br>bit1:AIF2 DACL;<br>bit2:AIF1 DAC1L;<br>bit3:AIF1 DAC0L;<br>对于DACR Mixer,<br>bit0:ADCR;<br>bit1:AIF2 DACR;<br>bit2:AIF1 DAC1R;<br>bit3:AIF1 DAC0R;</td> </tr> <tr> <td>DAC volume</td> <td>DACL/DACR音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>DACL Mixer ADCL<br>Switch</td> <td>DACL Mixer设置，使能<br>ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF1DA0L Switch</td> <td>DACL Mixer设置，使能<br>AIF1DA0L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF1DA1L Switch</td> <td>DACL Mixer设置，使能<br>AIF1DA1L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF2DACL Switch</td> <td>DACL Mixer设置，使能<br>AIF2DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer ADCR<br>Switch</td> <td>DACR Mixer设置，使<br>能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF1DA0R Switch</td> <td>DACR Mixer设置，使<br>能AIF1DA0R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF1DA1R Switch</td> <td>DACR Mixer设置，使<br>能AIF1DA1R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF2DACR Switch</td> <td>DACR Mixer设置，使<br>能AIF2DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>EAR Mux</td> <td>EAR Mux设置</td> <td>0:DACR; 1:DACL; 2:Right Analog<br>Mixer; 3:Left Analog Mixer</td> </tr> <tr> <td>Earpiece Switch</td> <td>Earpiece通路使能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>External Speaker<br>Switch</td> <td>使能Headphone以及<br>PA</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>HP_L Mux</td> <td>HP_L Mux设置</td> <td>0:DACL ; 1:Left Output Mixer</td> </tr> <tr> <td>HP_R Mux</td> <td>HP_R Mux设置</td> <td>0:DACR ; 1:Right Output Mixer</td> </tr> <tr> <td>LADC input Mixer<br>LINEINL</td> <td>LADC input Mixer设<br>置，使能LINEINL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>MIC1 boost Switch</td> <td>LADC input Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>MIC2 boost Switch</td> <td>LADC input Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>l_output mixer<br>Switch</td> <td>LADC input Mixer设<br>置，使能l_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>r_output mixer<br>Switch</td> <td>LADC input Mixer设<br>置，使能r_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LINEINL/R to L_R<br>output mixer gain<br>Left Output Mixer<br>DACL Switch</td> <td>Left Output Mixer设<br>置，使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>DACR Switch</td> <td>Left Output Mixer设<br>置，使能DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>LINEINL Switch</td> <td>Left Output Mixer设<br>置，使能LINEINL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>MIC1Booststage<br>Switch</td> <td>Left Output Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>MIC2Booststage<br>Switch</td> <td>Left Output Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>MIC1 boost<br>amplifier gain</td> <td>MIC1增益</td> <td>0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>MIC1_G boost<br>stage output mixer<br>control</td> <td>MIC1 to L or R output<br>Mixer增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>MIC2 BST stage to<br>L_R outp mixer<br>gain</td> <td>MIC2 to L or R output<br>Mixer增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>MIC2 SRC</td> <td>MIC2 SRC设置</td> <td>0:MIC3; 1:MIC2</td> </tr> <tr> <td>MIC2 boost AMP<br>gain control</td> <td>MIC2增益</td> <td>0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>RADC input Mixer<br>LINEINR Switch</td> <td>RADC input Mixer设<br>置，使能LINEINR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>MIC1 boost Switch</td> <td>RADC input Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>MIC2 boost Switch</td> <td>RADC input Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>l_output mixer<br>Switch</td> <td>RADC input Mixer设<br>置，使能l_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>l_output Switch</td> <td>RADC input Mixer设<br>置，使能l_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>DACL Switch</td> <td>Right Output Mixer设<br>置，使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>DACR Switch</td> <td>Right Output Mixer设<br>置，使能DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>LINEINR Switch</td> <td>Right Output Mixer设<br>置，使能LINEINR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>MIC1Booststage<br>Switch</td> <td>Right Output Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>MIC2Booststage<br>Switch</td> <td>Right Output Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>SPK_L Mux</td> <td>SPK_L Mux设置</td> <td>0:MIXEL Switch; 1:MIXL MIXR<br>Switch</td> </tr> <tr> <td>SPK_R Mux</td> <td>SPK_R Mux设置</td> <td>0:MIXER Switch; 1:MIXR MIXL<br>Switch</td> </tr> <tr> <td>digital volume</td> <td>数字音量设置</td> <td>0–63,表示-73.08–0dB</td> </tr> <tr> <td>earpiece volume</td> <td>earpiece音量设置</td> <td>0–31,表示-43.5–0dB</td> </tr> <tr> <td>headphone volume</td> <td>headphone音量设置</td> <td>0–63,0表示mute; 1~63表<br>示-62dB–0dB</td> </tr> <tr> <td>speaker volume</td> <td>speaker(lineout)音量设置</td> <td>0–31,表示-43.5–0dB</td> </tr> </tbody> </table> <h3 id=275-daudio>2.75 Daudio.</h3> <p>硬件特性</p> <p>• 三路I2S/PCM；</p> <p>• 支持主从模式</p> <ul> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> </ul> <h4 id=2751>2.7.5.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-54-1 id=__codelineno-54-1 name=__codelineno-54-1></a>Device Drivers ---&gt;
<a href=#__codelineno-54-2 id=__codelineno-54-2 name=__codelineno-54-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-54-3 id=__codelineno-54-3 name=__codelineno-54-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-54-4 id=__codelineno-54-4 name=__codelineno-54-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-54-5 id=__codelineno-54-5 name=__codelineno-54-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-54-6 id=__codelineno-54-6 name=__codelineno-54-6></a>&lt;*&gt; Allwinner Digital Audio Support
</code></pre></div> <h4 id=2752-sys_config>2.7.5.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-55-1 id=__codelineno-55-1 name=__codelineno-55-1></a>[snddaudio0]
<a href=#__codelineno-55-2 id=__codelineno-55-2 name=__codelineno-55-2></a>snddaudio0_used = 1
<a href=#__codelineno-55-3 id=__codelineno-55-3 name=__codelineno-55-3></a>;-----------------------------------------------------------------------------
<a href=#__codelineno-55-4 id=__codelineno-55-4 name=__codelineno-55-4></a>[daudio0]
<a href=#__codelineno-55-5 id=__codelineno-55-5 name=__codelineno-55-5></a>daudio0_used = 1
<a href=#__codelineno-55-6 id=__codelineno-55-6 name=__codelineno-55-6></a>pcm_lrck_period = 0x60
<a href=#__codelineno-55-7 id=__codelineno-55-7 name=__codelineno-55-7></a>pcm_lrckr_period = 0x01
<a href=#__codelineno-55-8 id=__codelineno-55-8 name=__codelineno-55-8></a>slot_width_select = 0x18
<a href=#__codelineno-55-9 id=__codelineno-55-9 name=__codelineno-55-9></a>pcm_lsb_first = 0x0
<a href=#__codelineno-55-10 id=__codelineno-55-10 name=__codelineno-55-10></a>tx_data_mode = 0x0
<a href=#__codelineno-55-11 id=__codelineno-55-11 name=__codelineno-55-11></a>rx_data_mode = 0x0
<a href=#__codelineno-55-12 id=__codelineno-55-12 name=__codelineno-55-12></a>daudio_master = 0x04
<a href=#__codelineno-55-13 id=__codelineno-55-13 name=__codelineno-55-13></a>audio_format = 0x01
<a href=#__codelineno-55-14 id=__codelineno-55-14 name=__codelineno-55-14></a>signal_inversion = 0x01
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-56-1 id=__codelineno-56-1 name=__codelineno-56-1></a>frametype = 0x0
<a href=#__codelineno-56-2 id=__codelineno-56-2 name=__codelineno-56-2></a>tdm_config = 0x01
<a href=#__codelineno-56-3 id=__codelineno-56-3 name=__codelineno-56-3></a>clk_active = 0x0
</code></pre></div> <p>snddaudio0配置，即daudio0 machine驱动的相关配置</p> <table> <thead> <tr> <th>snddaudio配置</th> <th>snddaudio配置说明</th> </tr> </thead> <tbody> <tr> <td>snddaudio0_used</td> <td>是否使用snddaudio驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>daudio0配置，即daudio0 platform驱动的相关配置</p> <table> <thead> <tr> <th>daudio配置</th> <th>daudio配置说明</th> </tr> </thead> <tbody> <tr> <td>daudio0_used</td> <td>是否使用daudio驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>daudio_master</td> <td>1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRM<br>master),即daudio接口作为slave, codec作为master<br>2: SND_SOC_DAIFMT_CBS_CFM(codec clk slave &amp;<br>FRM master),一般不用<br>3: SND_SOC_DAIFMT_CBM_CFS(codec clk master &amp;<br>frame slave),一般不用<br>4: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM<br>slave),即daudio接口作为master, codec作为slave</td> </tr> <tr> <td>audio_format</td> <td>1: SND_SOC_DAIFMT_I2S(standard i2s format)<br>2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)<br>3: SND_SOC_DAIFMT_LEFT_J(left justfied format)<br>4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available<br>on 2<sup>nd</sup> BCLK rising edge after LRC rising edge)<br>5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available<br>on 1nd BCLK rising edge after LRC rising edge)</td> </tr> <tr> <td>signal_inversion</td> <td>1: SND_SOC_DAIFMT_NB_NF(normal bit clock +<br>frame)<br>2: SND_SOC_DAIFMT_NB_IF(normal BCLK + inv<br>FRM)<br>3: SND_SOC_DAIFMT_IB_NF(invert BCLK + nor FRM)<br>4: SND_SOC_DAIFMT_IB_IF(invert BCLK + FRM)</td> </tr> <tr> <td>slot_width_select</td> <td>支持8bit, 16bit, 32bit宽度</td> </tr> <tr> <td>pcm_lrck_period</td> <td>一般可配置16/32/64/128/256个bclk</td> </tr> <tr> <td>msb_lsb_first</td> <td>0: msb first; 1: lsb first</td> </tr> <tr> <td>frametype</td> <td>0: short frame = 1 clock width; 1: long frame = 2 clock width</td> </tr> <tr> <td>tdm_config</td> <td>0: pcm mode; 1: i2s mode</td> </tr> <tr> <td>tx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit<br>a-law</td> </tr> </tbody> </table> <table> <thead> <tr> <th>daudio配置</th> <th>daudio配置说明</th> </tr> </thead> <tbody> <tr> <td>rx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit a-law</td> </tr> </tbody> </table> <p>具体Daudio外接codec,数字功放的配置，可参考《R18外挂codec:ac108》《R18外挂数字功放TAS5731》</p> <h3 id=276-spdif>2.7.6 SPDIF</h3> <p>硬件特性</p> <p>• 支持S/PDIF_OUT</p> <ul> <li>支持mono和stereo模式</li> <li>输出支持22.05kHz, 24kHz, 32kHz, 44.1kHz, 48kHz, 88.2kHz, 96kHz, 176.4kHz, 192kHz采样率</li> <li>支持16bit,24bit采样精度</li> </ul> <h4 id=2761>2.7.6.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-57-1 id=__codelineno-57-1 name=__codelineno-57-1></a>Device Drivers ---&gt;
<a href=#__codelineno-57-2 id=__codelineno-57-2 name=__codelineno-57-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-57-3 id=__codelineno-57-3 name=__codelineno-57-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-57-4 id=__codelineno-57-4 name=__codelineno-57-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-57-5 id=__codelineno-57-5 name=__codelineno-57-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-57-6 id=__codelineno-57-6 name=__codelineno-57-6></a>&lt;*&gt; Allwinner SPDIF Support
</code></pre></div> <h4 id=2762-sys_config>2.7.6.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-58-1 id=__codelineno-58-1 name=__codelineno-58-1></a>[spdif]
<a href=#__codelineno-58-2 id=__codelineno-58-2 name=__codelineno-58-2></a>spdif_used = 0
<a href=#__codelineno-58-3 id=__codelineno-58-3 name=__codelineno-58-3></a>[sndspdif]
<a href=#__codelineno-58-4 id=__codelineno-58-4 name=__codelineno-58-4></a>sndspdif_used = 0
</code></pre></div> <p>spdif配置，即platform驱动的相关配置</p> <table> <thead> <tr> <th>spdif配置</th> <th>spdif配置说明</th> </tr> </thead> <tbody> <tr> <td>spdif_used</td> <td>是否使用spdif驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>sndspdif配置，即machine驱动的相关配置</p> <table> <thead> <tr> <th>sndspdif配置</th> <th>sndspdif配置说明</th> </tr> </thead> <tbody> <tr> <td>sndspdif_used</td> <td>是否使用sndspdif驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <ul> <li>sys_config中不需要配置codec驱动相关信息</li> </ul> <p>因为machine驱动代码中默认配置了”spdif-utils”作为codec驱动,代码路径：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-59-1 id=__codelineno-59-1 name=__codelineno-59-1></a>linux-4.4/sound/soc/sunxi/spdif-utils.c
</code></pre></div> <h3 id=277-codecac108>2.7.7 外挂codec:AC108</h3> <p>R18标案tulip-noma搭配了MIC子板，含有两片AC108,每片最高可录 4 通道</p> <p>下面对R18如何配置使用AC108作简单介绍</p> <h4 id=2771>2.7.7.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-60-1 id=__codelineno-60-1 name=__codelineno-60-1></a>Device Drivers ---&gt;
<a href=#__codelineno-60-2 id=__codelineno-60-2 name=__codelineno-60-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-60-3 id=__codelineno-60-3 name=__codelineno-60-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-60-4 id=__codelineno-60-4 name=__codelineno-60-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-60-5 id=__codelineno-60-5 name=__codelineno-60-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-60-6 id=__codelineno-60-6 name=__codelineno-60-6></a>&lt;*&gt; Allwinner Digital Audio Support
<a href=#__codelineno-60-7 id=__codelineno-60-7 name=__codelineno-60-7></a>CODEC drivers ---&gt;
<a href=#__codelineno-60-8 id=__codelineno-60-8 name=__codelineno-60-8></a>&lt;*&gt; Sunxi AC108 Codec
</code></pre></div> <h4 id=2772-sys_configdts>2.7.7.2 sys_config&amp;dts配置.</h4> <p>R18通过twi1控制AC108,而i2s0用于音频数据的传输</p> <p>twi部分配置,可通过dts进行配置:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-61-1 id=__codelineno-61-1 name=__codelineno-61-1></a>twi1: twi@0x01c2b000 {
<a href=#__codelineno-61-2 id=__codelineno-61-2 name=__codelineno-61-2></a>status = "okay";
<a href=#__codelineno-61-3 id=__codelineno-61-3 name=__codelineno-61-3></a>ac108@35{
<a href=#__codelineno-61-4 id=__codelineno-61-4 name=__codelineno-61-4></a>compatible = "Allwinnertech,MicArray_1";
<a href=#__codelineno-61-5 id=__codelineno-61-5 name=__codelineno-61-5></a>debug_mode = &lt;0&gt;;
<a href=#__codelineno-61-6 id=__codelineno-61-6 name=__codelineno-61-6></a>pga_gain = &lt;0x32&gt;;
<a href=#__codelineno-61-7 id=__codelineno-61-7 name=__codelineno-61-7></a>ref_pga_gain = &lt;0x08&gt;;
<a href=#__codelineno-61-8 id=__codelineno-61-8 name=__codelineno-61-8></a>ref_chip_addr = &lt;0x3b&gt;;
<a href=#__codelineno-61-9 id=__codelineno-61-9 name=__codelineno-61-9></a>ref_channel_num = &lt;0x2&gt;;
<a href=#__codelineno-61-10 id=__codelineno-61-10 name=__codelineno-61-10></a>pa_double_used = &lt;0x1&gt;;
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-62-1 id=__codelineno-62-1 name=__codelineno-62-1></a>codec_mic_used = &lt;0x0&gt;;
<a href=#__codelineno-62-2 id=__codelineno-62-2 name=__codelineno-62-2></a>gpio-power = &lt;&amp;r_pio PL 12 1 1 1 1&gt;;
<a href=#__codelineno-62-3 id=__codelineno-62-3 name=__codelineno-62-3></a>twi_bus = &lt;1&gt;;
<a href=#__codelineno-62-4 id=__codelineno-62-4 name=__codelineno-62-4></a>voltage_enable = "nocare";
<a href=#__codelineno-62-5 id=__codelineno-62-5 name=__codelineno-62-5></a>power_vol = &lt;0x0&gt;;
<a href=#__codelineno-62-6 id=__codelineno-62-6 name=__codelineno-62-6></a>slot_width = &lt;0x18&gt;;
<a href=#__codelineno-62-7 id=__codelineno-62-7 name=__codelineno-62-7></a>reg = &lt;0x35&gt;;
<a href=#__codelineno-62-8 id=__codelineno-62-8 name=__codelineno-62-8></a>};
<a href=#__codelineno-62-9 id=__codelineno-62-9 name=__codelineno-62-9></a>ac108@3b{
<a href=#__codelineno-62-10 id=__codelineno-62-10 name=__codelineno-62-10></a>compatible = "Allwinnertech,MicArray_0";
<a href=#__codelineno-62-11 id=__codelineno-62-11 name=__codelineno-62-11></a>reg = &lt;0x3b&gt;;
<a href=#__codelineno-62-12 id=__codelineno-62-12 name=__codelineno-62-12></a>debug_mode = &lt;0&gt;;
<a href=#__codelineno-62-13 id=__codelineno-62-13 name=__codelineno-62-13></a>pga_gain = &lt;0x32&gt;;
<a href=#__codelineno-62-14 id=__codelineno-62-14 name=__codelineno-62-14></a>ref_pga_gain = &lt;0x08&gt;;
<a href=#__codelineno-62-15 id=__codelineno-62-15 name=__codelineno-62-15></a>ref_chip_addr = &lt;0x3b&gt;;
<a href=#__codelineno-62-16 id=__codelineno-62-16 name=__codelineno-62-16></a>ref_channel_num = &lt;0x2&gt;;
<a href=#__codelineno-62-17 id=__codelineno-62-17 name=__codelineno-62-17></a>pa_double_used = &lt;0x1&gt;;
<a href=#__codelineno-62-18 id=__codelineno-62-18 name=__codelineno-62-18></a>codec_mic_used = &lt;0x0&gt;;
<a href=#__codelineno-62-19 id=__codelineno-62-19 name=__codelineno-62-19></a>twi_bus = &lt;1&gt;;
<a href=#__codelineno-62-20 id=__codelineno-62-20 name=__codelineno-62-20></a>voltage_enable = "nocare";
<a href=#__codelineno-62-21 id=__codelineno-62-21 name=__codelineno-62-21></a>gpio-power = &lt;&amp;r_pio PL 12 1 1 1 1&gt;;
<a href=#__codelineno-62-22 id=__codelineno-62-22 name=__codelineno-62-22></a>power_vol = &lt;0x0&gt;;
<a href=#__codelineno-62-23 id=__codelineno-62-23 name=__codelineno-62-23></a>slot_width = &lt;0x18&gt;;
<a href=#__codelineno-62-24 id=__codelineno-62-24 name=__codelineno-62-24></a>};
<a href=#__codelineno-62-25 id=__codelineno-62-25 name=__codelineno-62-25></a>};
</code></pre></div> <p>I2S部分需要配置sys_config以及dts</p> <ul> <li>sys_config部分主要涉及i2s相关格式，需要根据AC108spec进行配置，sdk默认daudio0 配置可正常运行AC108</li> <li>dts部分主要需要指定ASOC codec以及codec-dai驱动的名称，如</li> </ul> <div class=highlight><pre><span></span><code><a href=#__codelineno-63-1 id=__codelineno-63-1 name=__codelineno-63-1></a>snddaudio0:sound@1 {
<a href=#__codelineno-63-2 id=__codelineno-63-2 name=__codelineno-63-2></a>sunxi,snddaudio-codec = "ac108.1-0035";
<a href=#__codelineno-63-3 id=__codelineno-63-3 name=__codelineno-63-3></a>sunxi,snddaudio-codec-dai = "ac108-pcm1";
<a href=#__codelineno-63-4 id=__codelineno-63-4 name=__codelineno-63-4></a>};
</code></pre></div> <h4 id=2773>2.7.7.3 使用</h4> <p>进入系统后,通过命令cat /proc/asound/cards列出当前声卡信息，如果发现ac108相关声 卡，说明已经正常加载驱动</p> <p>无需额外设置音频通路，可直接用下面命令进行录音:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-64-1 id=__codelineno-64-1 name=__codelineno-64-1></a>arecord -Dhw:sndac10810035 -f S16_LE -r 16000 -c 8 /tmp/test.wav
</code></pre></div> <h3 id=278-tas5731>2.7.8 外挂数字功放TAS5731.</h3> <p>R18标案tulip-noma搭配了一片数字功放TAS5731</p> <p>下面对R18如何配置使用tas5731作简单介绍</p> <h4 id=2781>2.7.8.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-65-1 id=__codelineno-65-1 name=__codelineno-65-1></a>Device Drivers ---&gt;
<a href=#__codelineno-65-2 id=__codelineno-65-2 name=__codelineno-65-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-65-3 id=__codelineno-65-3 name=__codelineno-65-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-65-4 id=__codelineno-65-4 name=__codelineno-65-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-65-5 id=__codelineno-65-5 name=__codelineno-65-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-65-6 id=__codelineno-65-6 name=__codelineno-65-6></a>&lt;*&gt; Allwinner Digital Audio Support
<a href=#__codelineno-65-7 id=__codelineno-65-7 name=__codelineno-65-7></a>CODEC drivers ---&gt;
<a href=#__codelineno-65-8 id=__codelineno-65-8 name=__codelineno-65-8></a>&lt;*&gt; TAS5731 PA
</code></pre></div> <h4 id=2782-sys_configdts>2.7.8.2 sys_config&amp;dts配置.</h4> <p>R18通过TWI0控制数字功放,而I2S1用于音频数据的传输</p> <p>twi部分配置,可通过dts进行配置:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-66-1 id=__codelineno-66-1 name=__codelineno-66-1></a>twi0: twi@0x01c2ac00 {
<a href=#__codelineno-66-2 id=__codelineno-66-2 name=__codelineno-66-2></a>status = "okay";
<a href=#__codelineno-66-3 id=__codelineno-66-3 name=__codelineno-66-3></a>tas5731-codec@1b{
<a href=#__codelineno-66-4 id=__codelineno-66-4 name=__codelineno-66-4></a>compatible = "Allwinnertech,tas5731_PA";
<a href=#__codelineno-66-5 id=__codelineno-66-5 name=__codelineno-66-5></a>tas5731_power = &lt;&amp;pio PH 8 1 1 1 1&gt;;
<a href=#__codelineno-66-6 id=__codelineno-66-6 name=__codelineno-66-6></a>tas5731_reset = &lt;&amp;pio PB 2 1 1 1 1&gt;;
<a href=#__codelineno-66-7 id=__codelineno-66-7 name=__codelineno-66-7></a>amp_poweren = &lt;&amp;r_pio PL 7 1 1 1 1&gt;;
<a href=#__codelineno-66-8 id=__codelineno-66-8 name=__codelineno-66-8></a>regulator_name = "vcc-amp";
<a href=#__codelineno-66-9 id=__codelineno-66-9 name=__codelineno-66-9></a>reg = &lt;0x1b&gt;;
<a href=#__codelineno-66-10 id=__codelineno-66-10 name=__codelineno-66-10></a>};
<a href=#__codelineno-66-11 id=__codelineno-66-11 name=__codelineno-66-11></a>};
</code></pre></div> <p>I2S部分需要配置sys_config以及dts</p> <ul> <li>sys_config部分主要涉及i2s相关格式，需要根据具体数字功放进行配置，sdk默认daudio1 配置可正常运行tas5731</li> <li>dts部分主要需要指定ASOC codec以及codec-dai驱动的名称，如</li> </ul> <div class=highlight><pre><span></span><code><a href=#__codelineno-67-1 id=__codelineno-67-1 name=__codelineno-67-1></a>snddaudio1:sound@2 {
<a href=#__codelineno-67-2 id=__codelineno-67-2 name=__codelineno-67-2></a>sunxi,snddaudio-codec = "tas5731-codec.0-001b";
<a href=#__codelineno-67-3 id=__codelineno-67-3 name=__codelineno-67-3></a>sunxi,snddaudio-codec-dai = "tas5731_audio";
<a href=#__codelineno-67-4 id=__codelineno-67-4 name=__codelineno-67-4></a>};
</code></pre></div> <h4 id=2783>2.7.8.3 使用</h4> <p>进入系统后,通过命令cat /proc/asound/cards列出当前声卡信息，如果发现tas5731相关声 卡，说明已经正常加载驱动</p> <p>无需额外设置音频通路，可直接用下面命令进行播歌:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-68-1 id=__codelineno-68-1 name=__codelineno-68-1></a>aplay -Dhw:sndtas5731codec /mnt/UDISK/16000-stere-10s.wav
</code></pre></div> <h3 id=279-hdmi>2.7.9 HDMI音频接口</h3> <p>R18使用I2S2将音频数据传输到HDMI模块，并且I2S2也只能用于HDMI。</p> <h4 id=2791>2.7.9.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-69-1 id=__codelineno-69-1 name=__codelineno-69-1></a>Device Drivers ---&gt;
<a href=#__codelineno-69-2 id=__codelineno-69-2 name=__codelineno-69-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-69-3 id=__codelineno-69-3 name=__codelineno-69-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-69-4 id=__codelineno-69-4 name=__codelineno-69-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-69-5 id=__codelineno-69-5 name=__codelineno-69-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-69-6 id=__codelineno-69-6 name=__codelineno-69-6></a>&lt;*&gt; Allwinner HDMI Audio Support
<a href=#__codelineno-69-7 id=__codelineno-69-7 name=__codelineno-69-7></a>&lt;*&gt; Allwinner Digital Audio Support
</code></pre></div> <h4 id=2792-sys_config>2.7.9.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-70-1 id=__codelineno-70-1 name=__codelineno-70-1></a>[daudio2]
<a href=#__codelineno-70-2 id=__codelineno-70-2 name=__codelineno-70-2></a>daudio2_used = 1
<a href=#__codelineno-70-3 id=__codelineno-70-3 name=__codelineno-70-3></a>[sndhdmi]
<a href=#__codelineno-70-4 id=__codelineno-70-4 name=__codelineno-70-4></a>sndhdmi_used = 1
</code></pre></div> <p>daudio2配置，即daudio2 platform驱动的相关配置</p> <table> <thead> <tr> <th>daudio2配置</th> <th>daudio2配置说明</th> </tr> </thead> <tbody> <tr> <td>daudio2_used</td> <td>是否使用daudio2驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>sndhdmi配置，即sndhdmi machine驱动的相关配置</p> <table> <thead> <tr> <th>sndhdmi配置</th> <th>sndhdmi配置说明</th> </tr> </thead> <tbody> <tr> <td>sndhdmi_used</td> <td>是否使用sndhdmi驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <h3 id=2710>2.7.10 标案音频测试方法.</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令。</p> <h4 id=27101>2.7.10.1播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-71-1 id=__codelineno-71-1 name=__codelineno-71-1></a>amixer -Dhw:audiocodec cset name='AIF1IN0L Mux' 'AIF1_DA0L'
<a href=#__codelineno-71-2 id=__codelineno-71-2 name=__codelineno-71-2></a>amixer -Dhw:audiocodec cset name='AIF1IN0R Mux' 'AIF1_DA0R'
<a href=#__codelineno-71-3 id=__codelineno-71-3 name=__codelineno-71-3></a>amixer -Dhw:audiocodec cset name='DACL Mixer AIF1DA0L Switch' 1
<a href=#__codelineno-71-4 id=__codelineno-71-4 name=__codelineno-71-4></a>amixer -Dhw:audiocodec cset name='DACR Mixer AIF1DA0R Switch' 1
<a href=#__codelineno-71-5 id=__codelineno-71-5 name=__codelineno-71-5></a>amixer -Dhw:audiocodec cset name='HP_R Mux' 'DACR HPR Switch'
<a href=#__codelineno-71-6 id=__codelineno-71-6 name=__codelineno-71-6></a>amixer -Dhw:audiocodec cset name='HP_L Mux' 'DACL HPL Switch'
<a href=#__codelineno-71-7 id=__codelineno-71-7 name=__codelineno-71-7></a>amixer -Dhw:audiocodec cset name='Headphone Switch' 1
<a href=#__codelineno-71-8 id=__codelineno-71-8 name=__codelineno-71-8></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <p>可通过下面命令调节硬件上的模拟音量:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-72-1 id=__codelineno-72-1 name=__codelineno-72-1></a>amixer -Dhw:audiocodec cset name='headphone volume' 60
</code></pre></div> <h4 id=27102>2.7.10.2录音</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-73-1 id=__codelineno-73-1 name=__codelineno-73-1></a>amixer -Dhw:audiocodec cset name='LADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-73-2 id=__codelineno-73-2 name=__codelineno-73-2></a>amixer -Dhw:audiocodec cset name='RADC input Mixer MIC2 boost Switch' 1
<a href=#__codelineno-73-3 id=__codelineno-73-3 name=__codelineno-73-3></a>amixer -Dhw:audiocodec cset name='AIF1 AD0L Mixer ADCL Switch' 1
<a href=#__codelineno-73-4 id=__codelineno-73-4 name=__codelineno-73-4></a>amixer -Dhw:audiocodec cset name='AIF1 AD0R Mixer ADCR Switch' 1
<a href=#__codelineno-73-5 id=__codelineno-73-5 name=__codelineno-73-5></a>amixer -Dhw:audiocodec cset name='AIF1OUT0L Mux' 'AIF1_AD0L'
<a href=#__codelineno-73-6 id=__codelineno-73-6 name=__codelineno-73-6></a>amixer -Dhw:audiocodec cset name='AIF1OUT0R Mux' 'AIF1_AD0R'
<a href=#__codelineno-73-7 id=__codelineno-73-7 name=__codelineno-73-7></a>arecord -Dhw:audiocodec -f S16_LE -r 16000 -c 2 /tmp/test.wav
</code></pre></div> <h2 id=28-r30>2.8 R30音频接口</h2> <h3 id=281>2.8.1 硬件资源</h3> <p>R30包含 5 个音频模块，分别是内置AudioCodec,Daudio0,Daudio1,Daudio2以及Dmic</p> <p><img alt="图2-17: R30音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-17.jpg></p> <h3 id=282>2.8.2 时钟源</h3> <p>R30中， 5 个音频模块的时钟源均来自pll_audio。</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播 放录音。</p> <p><img alt="图2-18: R30时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-18.jpg></p> <h3 id=283>2.8.3 代码结构</h3> <div class=highlight><pre><span></span><code><a href=#__codelineno-74-1 id=__codelineno-74-1 name=__codelineno-74-1></a>linux-4.9/sound/soc/sunxi/
<a href=#__codelineno-74-2 id=__codelineno-74-2 name=__codelineno-74-2></a>├── sun50iw3-codec.c // codec驱动
<a href=#__codelineno-74-3 id=__codelineno-74-3 name=__codelineno-74-3></a>├── sun50iw3-codec.h
<a href=#__codelineno-74-4 id=__codelineno-74-4 name=__codelineno-74-4></a>├── sun50iw3-sndcodec.c // codec machine驱动
<a href=#__codelineno-74-5 id=__codelineno-74-5 name=__codelineno-74-5></a>├── sunxi-inter-i2s.c // codec platform驱动
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-75-1 id=__codelineno-75-1 name=__codelineno-75-1></a>├── sunxi-inter-i2s.h
<a href=#__codelineno-75-2 id=__codelineno-75-2 name=__codelineno-75-2></a>├── sunxi-daudio.c // daudio platform驱动
<a href=#__codelineno-75-3 id=__codelineno-75-3 name=__codelineno-75-3></a>├── sunxi-daudio.h
<a href=#__codelineno-75-4 id=__codelineno-75-4 name=__codelineno-75-4></a>├── sunxi-dmic.c // dmic platform驱动
<a href=#__codelineno-75-5 id=__codelineno-75-5 name=__codelineno-75-5></a>├── sunxi-dmic.h
<a href=#__codelineno-75-6 id=__codelineno-75-6 name=__codelineno-75-6></a>├── sunxi-pcm.c //通用文件，提供注册platform驱动的接口及相关函数集
<a href=#__codelineno-75-7 id=__codelineno-75-7 name=__codelineno-75-7></a>├── sunxi-pcm.h
<a href=#__codelineno-75-8 id=__codelineno-75-8 name=__codelineno-75-8></a>├── sunxi_rw_func.c //通用文件，读写模拟/数字寄存器的接口
<a href=#__codelineno-75-9 id=__codelineno-75-9 name=__codelineno-75-9></a>├── sunxi_rw_func.h
<a href=#__codelineno-75-10 id=__codelineno-75-10 name=__codelineno-75-10></a>├── sunxi-snddaudio.c // daudio machine驱动
<a href=#__codelineno-75-11 id=__codelineno-75-11 name=__codelineno-75-11></a>├── sunxi-snddaudio.h
<a href=#__codelineno-75-12 id=__codelineno-75-12 name=__codelineno-75-12></a>├── sunxi-snddmic.c // dmic machine驱动
<a href=#__codelineno-75-13 id=__codelineno-75-13 name=__codelineno-75-13></a>└── sunxi-snddmic.h
<a href=#__codelineno-75-14 id=__codelineno-75-14 name=__codelineno-75-14></a>linux-4.9/sound/soc/codecs/dmic.c // dmic codec驱动
<a href=#__codelineno-75-15 id=__codelineno-75-15 name=__codelineno-75-15></a>linux-4.9/sound/soc/soc-utils.c // daudio codec驱动
</code></pre></div> <h3 id=284-audiocodec>2.8.4 AudioCodec</h3> <p>硬件特性</p> <p>• 两路DAC</p> <ul> <li>支持16bit,24bit采样精度</li> <li>支持8KHz~192KHz采样率</li> <li>两路ADC</li> <li>支持16bit,24bit采样精度</li> <li>支持8KHz~48KHz采样率</li> <li>四路模拟输出:</li> <li>一路立体声earpiece输出(EAROUTP,EAROUTN)</li> <li>一路立体声phoneout输出(PHONEOUTP,PHONEOUTN)</li> <li>一路立体声headphone输出(HPOUTL,HPOUTR)</li> <li>一路立体声lineout输出(LINEOUTL,LINEOUTR)</li> <li>四路路模拟输入：MIC1,MIC2,linein,phonein</li> <li>支持headphone驱动</li> <li>支持earpiece驱动</li> <li>支持同时playback和record(全双工模式)</li> <li>支持适用于DAC的DRC功能</li> <li>支持适用于ADC的AGC,DRC功能</li> </ul> <h4 id=2841>2.8.4.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-76-1 id=__codelineno-76-1 name=__codelineno-76-1></a>Device Drivers ---&gt;
<a href=#__codelineno-76-2 id=__codelineno-76-2 name=__codelineno-76-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-76-3 id=__codelineno-76-3 name=__codelineno-76-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-76-4 id=__codelineno-76-4 name=__codelineno-76-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-76-5 id=__codelineno-76-5 name=__codelineno-76-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-76-6 id=__codelineno-76-6 name=__codelineno-76-6></a>&lt;*&gt; Allwinner Sun50iw3 Codec Support
</code></pre></div> <h4 id=2842-sys_config>2.8.4.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-77-1 id=__codelineno-77-1 name=__codelineno-77-1></a>[sndcodec]
<a href=#__codelineno-77-2 id=__codelineno-77-2 name=__codelineno-77-2></a>sndcodec_used = 0x1
<a href=#__codelineno-77-3 id=__codelineno-77-3 name=__codelineno-77-3></a>aif2fmt = 0x3
<a href=#__codelineno-77-4 id=__codelineno-77-4 name=__codelineno-77-4></a>aif3fmt = 0x3
<a href=#__codelineno-77-5 id=__codelineno-77-5 name=__codelineno-77-5></a>aif2master = 0x1
<a href=#__codelineno-77-6 id=__codelineno-77-6 name=__codelineno-77-6></a>hp_detect_case = 0x0
<a href=#__codelineno-77-7 id=__codelineno-77-7 name=__codelineno-77-7></a>;------------------------------------------------------------------------------
<a href=#__codelineno-77-8 id=__codelineno-77-8 name=__codelineno-77-8></a>[i2s]
<a href=#__codelineno-77-9 id=__codelineno-77-9 name=__codelineno-77-9></a>i2s_used = 0x1
<a href=#__codelineno-77-10 id=__codelineno-77-10 name=__codelineno-77-10></a>;-------------------------------------------------------------------------------
<a href=#__codelineno-77-11 id=__codelineno-77-11 name=__codelineno-77-11></a>[codec]
<a href=#__codelineno-77-12 id=__codelineno-77-12 name=__codelineno-77-12></a>codec_used = 0x1
<a href=#__codelineno-77-13 id=__codelineno-77-13 name=__codelineno-77-13></a>headphonevol = 0x3b
<a href=#__codelineno-77-14 id=__codelineno-77-14 name=__codelineno-77-14></a>spkervol = 0x1b
<a href=#__codelineno-77-15 id=__codelineno-77-15 name=__codelineno-77-15></a>maingain = 0x4
<a href=#__codelineno-77-16 id=__codelineno-77-16 name=__codelineno-77-16></a>headsetmicgain = 0x4
<a href=#__codelineno-77-17 id=__codelineno-77-17 name=__codelineno-77-17></a>adcagc_cfg = 0x0
<a href=#__codelineno-77-18 id=__codelineno-77-18 name=__codelineno-77-18></a>adcdrc_cfg = 0x0
<a href=#__codelineno-77-19 id=__codelineno-77-19 name=__codelineno-77-19></a>adchpf_cfg = 0x0
<a href=#__codelineno-77-20 id=__codelineno-77-20 name=__codelineno-77-20></a>dacdrc_cfg = 0x0
<a href=#__codelineno-77-21 id=__codelineno-77-21 name=__codelineno-77-21></a>dachpf_cfg = 0x0
<a href=#__codelineno-77-22 id=__codelineno-77-22 name=__codelineno-77-22></a>aif2config = 0x0
<a href=#__codelineno-77-23 id=__codelineno-77-23 name=__codelineno-77-23></a>aif3config = 0x0
<a href=#__codelineno-77-24 id=__codelineno-77-24 name=__codelineno-77-24></a>gpio-spk = port:PB3&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
</code></pre></div> <p>sndcodec配置，即machine驱动的相关配置</p> <table> <thead> <tr> <th>sndcodec配置</th> <th>sndcodec配置说明</th> </tr> </thead> <tbody> <tr> <td>sndcodec_used</td> <td>是否使用sndcodec驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>aif2fmt</td> <td>1: SND_SOC_DAIFMT_I2S(standard i2s format)<br>2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)<br>3: SND_SOC_DAIFMT_LEFT_J(left justfied format)<br>4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available on 2<sup>nd</sup><br>BCLK rising edge after LRC rising edge)<br>5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available on 1nd<br>BCLK rising edge after LRC rising edge)</td> </tr> <tr> <td>aif3fmt</td> <td>1: SND_SOC_DAIFMT_I2S(standard i2s format)<br>2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)<br>3: SND_SOC_DAIFMT_LEFT_J(left justfied format)<br>4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available on 2<sup>nd</sup><br>BCLK rising edge after LRC rising edge)<br>5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available on 1nd<br>BCLK rising edge after LRC rising edge)</td> </tr> <tr> <td>aif2master</td> <td>1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRM master),<br>即aif接口选择master模式<br>2: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM slave),即aif<br>接口选择slave模式</td> </tr> <tr> <td>hp_detect_case</td> <td>jack irq level, 0:low; 1:high</td> </tr> </tbody> </table> <p>I2S配置，即audiocodec platform驱动的相关配置,内部aif接口用的I2S(与I2S0,I2S1接口无关)</p> <table> <thead> <tr> <th>i2s配置</th> <th>i2s配置说明</th> </tr> </thead> <tbody> <tr> <td>i2s_used</td> <td>是否使用i2s驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>codec配置，即内置audiocodec驱动的相关配置</p> <table> <thead> <tr> <th>codec配置</th> <th>codec配置说明</th> </tr> </thead> <tbody> <tr> <td>codec_used</td> <td>是否使用codec驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>headphonevol</td> <td>初始化headphone volume，可设定范围0<sub>0x3f,表示0</sub>-62dB,<br>-1dB/step</td> </tr> <tr> <td>spkervol</td> <td>初始化speaker volume，可设定范围0~0x1f, 0或者 1 表示mute,<br>2<sub>31表示-43.5dB</sub>0dB, 1.5dB/step</td> </tr> <tr> <td>headsetmicgain</td> <td>指的是MIC2增益,可设定范围0~0x7, 0:0dB, 1<sub>7:15</sub>33dB,<br>3dB/step,一般设置0x4,即24dB</td> </tr> <tr> <td>adcinputgain</td> <td>adc增益，可设定范围0<sub>0x7,表示-4.5</sub>6dB, 1.5dB/step,一般设置0x3,即0dB</td> </tr> <tr> <td>adcagc_cfg</td> <td>是否使用adcagc. 0:不使用； 1 ：使用</td> </tr> <tr> <td>adcdrc_cfg</td> <td>是否使用adcdrc. 0:不使用； 1 ：使用</td> </tr> <tr> <td>adchpf_cfg</td> <td>是否使用adchpf. 0:不使用； 1 ：使用</td> </tr> <tr> <td>dacdrc_cfg</td> <td>是否使用dacdrc. 0:不使用； 1 ：使用</td> </tr> <tr> <td>aif2config</td> <td>是否使用aif2. 0:不使用； 1 ：使用</td> </tr> <tr> <td>aif3config</td> <td>是否使用aif3. 0:不使用； 1 ：使用</td> </tr> <tr> <td>gpio-spk</td> <td>PA使能引脚</td> </tr> </tbody> </table> <h4 id=2843-codec>2.8.4.3 codec数据通路</h4> <p><img alt="图2-19: R30音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-19.jpg></p> <div class=highlight><pre><span></span><code><a href=#__codelineno-78-1 id=__codelineno-78-1 name=__codelineno-78-1></a>通过SPKL/R播歌
<a href=#__codelineno-78-2 id=__codelineno-78-2 name=__codelineno-78-2></a>AIF1DACL --&gt; AIF1IN0L Mux --&gt; DACL Mixer --&gt; Left Output Mixer --&gt; SPK_L Mux --&gt; SPKL
<a href=#__codelineno-78-3 id=__codelineno-78-3 name=__codelineno-78-3></a>AIF1DACR --&gt; AIF1IN0R Mux --&gt; DACR Mixer --&gt; Right Output Mixer --&gt; SPK_R Mux --&gt; SPKR
<a href=#__codelineno-78-4 id=__codelineno-78-4 name=__codelineno-78-4></a>通过LINEOUTL/R播歌
<a href=#__codelineno-78-5 id=__codelineno-78-5 name=__codelineno-78-5></a>AIF1DACL --&gt; AIF1IN0L Mux --&gt; DACL Mixer --&gt; Left Output Mixer --&gt; LINEOUTL Mux --&gt;
<a href=#__codelineno-78-6 id=__codelineno-78-6 name=__codelineno-78-6></a>LINEOUTL
<a href=#__codelineno-78-7 id=__codelineno-78-7 name=__codelineno-78-7></a>AIF1DACR --&gt; AIF1IN0R Mux --&gt; DACR Mixer --&gt; Right Output Mixer --&gt; LINEOUTR Mux --&gt;
<a href=#__codelineno-78-8 id=__codelineno-78-8 name=__codelineno-78-8></a>LINEOUTR
<a href=#__codelineno-78-9 id=__codelineno-78-9 name=__codelineno-78-9></a>通过HPOUTL/R播歌
<a href=#__codelineno-78-10 id=__codelineno-78-10 name=__codelineno-78-10></a>AIF1DACL --&gt; AIF1IN0L Mux --&gt; DACL Mixer --&gt; HP_L Mux --&gt; HPOUTL
<a href=#__codelineno-78-11 id=__codelineno-78-11 name=__codelineno-78-11></a>AIF1DACR --&gt; AIF1IN0R Mux --&gt; DACR Mixer --&gt; HP_R Mux --&gt; HPOUTR
<a href=#__codelineno-78-12 id=__codelineno-78-12 name=__codelineno-78-12></a>通过MIC1,2录音
<a href=#__codelineno-78-13 id=__codelineno-78-13 name=__codelineno-78-13></a>AIF1ADCL &lt;-- AIF1OUT0L Mux &lt;-- AIF1 AD0L Mixer &lt;-- LADC input Mixer &lt;-- MIC1 PGA &lt;-- MIC1P/
<a href=#__codelineno-78-14 id=__codelineno-78-14 name=__codelineno-78-14></a>N
<a href=#__codelineno-78-15 id=__codelineno-78-15 name=__codelineno-78-15></a>AIF1ADCR &lt;-- AIF1OUT0R Mux &lt;-- AIF1 AD0R Mixer &lt;-- RADC input Mixer &lt;-- MIC2 PGA &lt;-- MIC2P/
<a href=#__codelineno-78-16 id=__codelineno-78-16 name=__codelineno-78-16></a>N
<a href=#__codelineno-78-17 id=__codelineno-78-17 name=__codelineno-78-17></a>通过LINEINL/R录音
<a href=#__codelineno-78-18 id=__codelineno-78-18 name=__codelineno-78-18></a>AIF1ADCL &lt;-- AIF1OUT0L Mux &lt;-- AIF1 AD0L Mixer &lt;-- LADC input Mixer &lt;-- LINEINN
<a href=#__codelineno-78-19 id=__codelineno-78-19 name=__codelineno-78-19></a>AIF1ADCR &lt;-- AIF1OUT0R Mux &lt;-- AIF1 AD0R Mixer &lt;-- RADC input Mixer &lt;-- LINEINP
</code></pre></div> <p>R30相关控件如下表：</p> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>Headphone Switch</td> <td>Headphone通路使能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Lineout Switch</td> <td>Lineout通路使能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>ADC input gain<br>control</td> <td>ADC增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>ADC volume</td> <td>ADCL/ADCR音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>ADCL Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF1 DA0L Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能AIF1 DA0L通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能AIF2 DACL通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0L Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD0L Mixer设<br>置，使能AIF2 DACR通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>ADCR Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF1 DA0R Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能AIF1 DA0R通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能AIF2 DACL通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD0R Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD0R Mixer设<br>置，使能AIF2 DACR通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1L Mixer<br>ADCL Switch</td> <td>AIF1 AD1L Mixer设<br>置，使能ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1L Mixer<br>AIF2 DACL Switch</td> <td>AIF1 AD1L Mixer设<br>置，使能AIF2 DACL通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1R Mixer<br>ADCR Switch</td> <td>AIF1 AD1R Mixer设<br>置，使能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 AD1R Mixer<br>AIF2 DACR Switch</td> <td>AIF1 AD1R Mixer设<br>置，使能AIF2 DACR通<br>路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>AIF1 ADC timeslot<br>0 mixer gain</td> <td>AIF1 ADC0L/ADC0R<br>Mixer,数字增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于ADC0L Mixer,<br>bit0:AIF2 DACR;<br>bit1:ADCL;<br>bit2:AIF2 DACL;<br>bit3:AIF2 DA0L;<br>对于ADC0R Mixer,<br>bit0:AIF2 DACL;<br>bit1:ADCR;<br>bit2:AIF2 DACR;<br>bit3:AIF2 DA0R;</td> </tr> <tr> <td>AIF1 ADC timeslot<br>0 volume</td> <td>AIF1 ADC0L/ADC0R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 ADC timeslot<br>1 mixer gain</td> <td>AIF1 ADC1L/ADC1R<br>Mixer,数字增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于ADC1L Mixer,<br>bit0:ADCL;<br>bit1:AIF2 DACL;<br>对于ADC1R Mixer,<br>bit0:ADCR;<br>bit1:AIF2 DACR;</td> </tr> <tr> <td>AIF1 ADC timeslot<br>1 volume</td> <td>AIF1 ADC1L/ADC1R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 DAC timeslot<br>0 volume</td> <td>AIF1 DAC0L/DAC0R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1 DAC timeslot<br>1 volume</td> <td>AIF1 DAC1L/DAC1R<br>音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>AIF1IN0L Mux</td> <td>AIF1IN0L Mux设置</td> <td>0:AIF1_DA0L; 1:AIF1_DA0R;<br>2:SUM_AIF1DA0L_AIF1DA0R;<br>3:AVE_AIF1DA0L_AIF1DA0R</td> </tr> <tr> <td>AIF1IN0R Mux</td> <td>AIF1IN0R Mux设置</td> <td>0:AIF1_DA0R; 1:AIF1_DA0L;<br>2:SUM_AIF1DA0L_AIF1DA0R;<br>3:AVE_AIF1DA0L_AIF1DA0R</td> </tr> <tr> <td>AIF1IN1L Mux</td> <td>AIF1IN1L Mux设置</td> <td>0:AIF1_DA1L; 1:AIF1_DA1R;<br>2:SUM_AIF1DA1L_AIF1DA1R;<br>3:AVE_AIF1DA1L_AIF1DA1R</td> </tr> <tr> <td>AIF1IN1R Mux</td> <td>AIF1IN1R Mux设置</td> <td>0:AIF1_DA1R; 1:AIF1_DA1L;<br>2:SUM_AIF1DA1L_AIF1DA1R;<br>3:AVE_AIF1DA1L_AIF1DA1R</td> </tr> <tr> <td>AIF1OUT0L Mux</td> <td>AIF1OUT0L Mux设置</td> <td>0:AIF1_AD0L; 1:AIF1_AD0R;<br>2:SUM_AIF1AD0L_AIF1AD0R;<br>3:AVE_AIF1AD0L_AIF1AD0R</td> </tr> <tr> <td>AIF1OUT0R Mux</td> <td>AIF1OUT0R Mux设置</td> <td>0:AIF1_AD0R; 1:AIF1_AD0L;<br>2:SUM_AIF1AD0L_AIF1AD0R;<br>3:AVE_AIF1AD0L_AIF1AD0R</td> </tr> <tr> <td>AIF1OUT1L Mux</td> <td>AIF1OUT1L Mux设置</td> <td>0:AIF1_AD1L; 1:AIF1_AD1R;<br>2:SUM_AIF1AD1L_AIF1AD1R;<br>3:AVE_AIF1AD1L_AIF1AD1R</td> </tr> <tr> <td>AIF1OUT1R Mux</td> <td>AIF1OUT1R Mux设置</td> <td>0:AIF1_AD1R; 1:AIF1_AD1L;<br>2:SUM_AIF1AD1L_AIF1AD1R;<br>3:AVE_AIF1AD1L_AIF1AD1R</td> </tr> <tr> <td>DAC mixer gain</td> <td>DAC mixer增益</td> <td>0:0dB; 1:-6dB;</td> </tr> <tr> <td></td> <td></td> <td>对于DACL Mixer,<br>bit0:ADCL;<br>bit1:AIF2 DACL;<br>bit2:AIF1 DAC1L;<br>bit3:AIF1 DAC0L;<br>对于DACR Mixer,<br>bit0:ADCR;<br>bit1:AIF2 DACR;<br>bit2:AIF1 DAC1R;<br>bit3:AIF1 DAC0R;</td> </tr> <tr> <td>DAC volume</td> <td>DACL/DACR音量设置</td> <td>0–0xff, 0表示mute, 0x1<sub>0xff表<br>示-119.25dB</sub>71.25dB,<br>0.75dB/step,如0xA0表示0dB</td> </tr> <tr> <td>DACL Mixer ADCL<br>Switch</td> <td>DACL Mixer设置，使能<br>ADCL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF1DA0L Switch</td> <td>DACL Mixer设置，使能<br>AIF1DA0L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF1DA1L Switch</td> <td>DACL Mixer设置，使能<br>AIF1DA1L通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACL Mixer<br>AIF2DACL Switch</td> <td>DACL Mixer设置，使能<br>AIF2DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer ADCR<br>Switch</td> <td>DACR Mixer设置，使<br>能ADCR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF1DA0R Switch</td> <td>DACR Mixer设置，使<br>能AIF1DA0R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF1DA1R Switch</td> <td>DACR Mixer设置，使<br>能AIF1DA1R通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>DACR Mixer<br>AIF2DACR Switch</td> <td>DACR Mixer设置，使<br>能AIF2DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>External Speaker<br>Switch</td> <td>使能Headphone以及<br>PA</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>HP_L Mux</td> <td>HP_L Mux设置</td> <td>0:DACL ; 1:Left Output Mixer</td> </tr> <tr> <td>HP_R Mux</td> <td>HP_R Mux设置</td> <td>0:DACR ; 1:Right Output Mixer</td> </tr> <tr> <td>LADC input Mixer<br>LINEINL</td> <td>LADC input Mixer设<br>置，使能LINEINL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>MIC1 boost Switch</td> <td>LADC input Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>MIC2 boost Switch</td> <td>LADC input Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>l_output mixer<br>Switch</td> <td>LADC input Mixer设<br>置，使能l_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LADC input Mixer<br>r_output mixer<br>Switch</td> <td>LADC input Mixer设<br>置，使能r_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LINEINL/R to L_R<br>output mixer gain</td> <td>LINEINL/R to L or R<br>output Mixer增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>LINEOUTL Mux</td> <td>LINEOUTL Mux设置</td> <td>0:left output mixer; 1:left+right<br>output mixer</td> </tr> <tr> <td>LINEOUTR Mux</td> <td>LINEOUTR Mux设置</td> <td>0:right output mixer; 1:left+right<br>output mixer</td> </tr> <tr> <td>Left Output Mixer<br>DACL Switch</td> <td>Left Output Mixer设<br>置，使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>DACR Switch</td> <td>Left Output Mixer设<br>置，使能DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>LINEINL Switch</td> <td>Left Output Mixer设<br>置，使能LINEINL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>MIC1Booststage<br>Switch</td> <td>Left Output Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Output Mixer<br>MIC2Booststage<br>Switch</td> <td>Left Output Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>MIC1 boost AMP<br>gain control</td> <td>MIC1增益</td> <td>0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>MIC1_G boost<br>stage output mixer<br>control</td> <td>MIC1 to L or R output<br>Mixer增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>MIC2 BST stage to<br>L_R outp mixer<br>gain</td> <td>MIC2 to L or R output<br>Mixer增益</td> <td>0–7,表示-4.5–6dB</td> </tr> <tr> <td>MIC2 SRC</td> <td>MIC2 SRC设置</td> <td>0:MIC3; 1:MIC2</td> </tr> <tr> <td>MIC2 boost AMP<br>gain control</td> <td>MIC2增益</td> <td>0–7, 0:0dB, 1~7:24–42dB,3dB/step</td> </tr> <tr> <td>RADC input Mixer<br>LINEINR Switch</td> <td>RADC input Mixer设<br>置，使能LINEINR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>MIC1 boost Switch</td> <td>RADC input Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>MIC2 boost Switch</td> <td>RADC input Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>l_output mixer<br>Switch</td> <td>RADC input Mixer设<br>置，使能l_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>RADC input Mixer<br>l_output Switch</td> <td>RADC input Mixer设<br>置，使能l_output<br>mixer通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>DACL Switch</td> <td>Right Output Mixer设<br>置，使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>DACR Switch</td> <td>Right Output Mixer设<br>置，使能DACR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>LINEINR Switch</td> <td>Right Output Mixer设<br>置，使能LINEINR通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>MIC1Booststage<br>Switch</td> <td>Right Output Mixer设<br>置，使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Output Mixer<br>MIC2Booststage<br>Switch</td> <td>Right Output Mixer设<br>置，使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>SPK_L Mux</td> <td>SPK_L Mux设置</td> <td>0:MIXEL Switch; 1:MIXL MIXR<br>Switch</td> </tr> <tr> <td>SPK_R Mux</td> <td>SPK_R Mux设置</td> <td>0:MIXER Switch; 1:MIXR MIXL<br>Switch</td> </tr> <tr> <td>digital volume</td> <td>数字音量设置</td> <td>0–63,表示-73.08–0dB</td> </tr> <tr> <td>headphone volume</td> <td>headphone音量设置</td> <td>0–63,0表示mute; 1~63表<br>示-62dB–0dB</td> </tr> <tr> <td>lineout volume</td> <td>lineout音量设置</td> <td>0–31,表示-43.5–0dB</td> </tr> <tr> <td>speaker volume</td> <td>speaker(lineout)音量<br>设置</td> <td>0–31,表示-43.5–0dB</td> </tr> </tbody> </table> <h3 id=285-daudio>2.8.5 Daudio.</h3> <p>硬件特性</p> <p>• 三路I2S/PCM；</p> <p>• 支持主从模式</p> <ul> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> </ul> <h4 id=2851>2.8.5.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-79-1 id=__codelineno-79-1 name=__codelineno-79-1></a>Device Drivers ---&gt;
<a href=#__codelineno-79-2 id=__codelineno-79-2 name=__codelineno-79-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-79-3 id=__codelineno-79-3 name=__codelineno-79-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-79-4 id=__codelineno-79-4 name=__codelineno-79-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-79-5 id=__codelineno-79-5 name=__codelineno-79-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-79-6 id=__codelineno-79-6 name=__codelineno-79-6></a>&lt;*&gt; Allwinner Digital Audio Support
</code></pre></div> <h4 id=2852-sys_config>2.8.5.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-80-1 id=__codelineno-80-1 name=__codelineno-80-1></a>[snddaudio0]
<a href=#__codelineno-80-2 id=__codelineno-80-2 name=__codelineno-80-2></a>snddaudio0_used = 1
<a href=#__codelineno-80-3 id=__codelineno-80-3 name=__codelineno-80-3></a>[daudio0]
<a href=#__codelineno-80-4 id=__codelineno-80-4 name=__codelineno-80-4></a>pcm_lrck_period = 0x80
<a href=#__codelineno-80-5 id=__codelineno-80-5 name=__codelineno-80-5></a>slot_width_select = 0x20
<a href=#__codelineno-80-6 id=__codelineno-80-6 name=__codelineno-80-6></a>pcm_lsb_first = 0x0
<a href=#__codelineno-80-7 id=__codelineno-80-7 name=__codelineno-80-7></a>tx_data_mode = 0x0
<a href=#__codelineno-80-8 id=__codelineno-80-8 name=__codelineno-80-8></a>rx_data_mode = 0x0
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-81-1 id=__codelineno-81-1 name=__codelineno-81-1></a>daudio_master = 0x04
<a href=#__codelineno-81-2 id=__codelineno-81-2 name=__codelineno-81-2></a>audio_format = 0x01
<a href=#__codelineno-81-3 id=__codelineno-81-3 name=__codelineno-81-3></a>signal_inversion = 0x01
<a href=#__codelineno-81-4 id=__codelineno-81-4 name=__codelineno-81-4></a>frametype = 0x0
<a href=#__codelineno-81-5 id=__codelineno-81-5 name=__codelineno-81-5></a>tdm_config = 0x01
<a href=#__codelineno-81-6 id=__codelineno-81-6 name=__codelineno-81-6></a>mclk_div = 0x1
<a href=#__codelineno-81-7 id=__codelineno-81-7 name=__codelineno-81-7></a>daudio0_used = 1
</code></pre></div> <p>snddaudio0配置，即daudio0 machine驱动的相关配置</p> <table> <thead> <tr> <th>snddaudio配置</th> <th>snddaudio配置说明</th> </tr> </thead> <tbody> <tr> <td>snddaudio0_used</td> <td>是否使用snddaudio驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>daudio0配置，即daudio0 platform驱动的相关配置</p> <table> <thead> <tr> <th>daudio配置</th> <th>daudio配置说明</th> </tr> </thead> <tbody> <tr> <td>daudio0_used</td> <td>是否使用daudio驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>daudio_master</td> <td>1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRM<br>master),即daudio接口作为slave, codec作为master<br>2: SND_SOC_DAIFMT_CBS_CFM(codec clk slave &amp;<br>FRM master),一般不用<br>3: SND_SOC_DAIFMT_CBM_CFS(codec clk master &amp;<br>frame slave),一般不用<br>4: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM<br>slave),即daudio接口作为master, codec作为slave</td> </tr> <tr> <td>audio_format</td> <td>1: SND_SOC_DAIFMT_I2S(standard i2s format)<br>2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)<br>3: SND_SOC_DAIFMT_LEFT_J(left justfied format)<br>4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available<br>on 2<sup>nd</sup> BCLK rising edge after LRC rising edge)<br>5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available<br>on 1nd BCLK rising edge after LRC rising edge)</td> </tr> <tr> <td>signal_inversion</td> <td>1: SND_SOC_DAIFMT_NB_NF(normal bit clock +<br>frame)<br>2: SND_SOC_DAIFMT_NB_IF(normal BCLK + inv<br>FRM)<br>3: SND_SOC_DAIFMT_IB_NF(invert BCLK + nor FRM)<br>4: SND_SOC_DAIFMT_IB_IF(invert BCLK + FRM)</td> </tr> <tr> <td>slot_width_select</td> <td>支持8bit, 16bit, 32bit宽度</td> </tr> <tr> <td>pcm_lrck_period</td> <td>一般可配置16/32/64/128/256个bclk</td> </tr> <tr> <td>msb_lsb_first</td> <td>0: msb first; 1: lsb first</td> </tr> <tr> <td>frametype</td> <td>0: short frame = 1 clock width; 1: long frame = 2<br>clock width</td> </tr> <tr> <td>tdm_config</td> <td>0: pcm mode; 1: i2s mode</td> </tr> </tbody> </table> <table> <thead> <tr> <th>daudio配置</th> <th>daudio配置说明</th> </tr> </thead> <tbody> <tr> <td>tx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit<br>a-law</td> </tr> <tr> <td>rx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit<br>a-law</td> </tr> </tbody> </table> <h3 id=286-dmic>2.8.6 DMIC</h3> <p>硬件特性</p> <p>• 支持 8 路输入</p> <ul> <li>支持8~48KHz采样率</li> <li>支持16/24bit采样精度</li> </ul> <h4 id=2861>2.8.6.1 内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-82-1 id=__codelineno-82-1 name=__codelineno-82-1></a>Device Drivers ---&gt;
<a href=#__codelineno-82-2 id=__codelineno-82-2 name=__codelineno-82-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-82-3 id=__codelineno-82-3 name=__codelineno-82-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-82-4 id=__codelineno-82-4 name=__codelineno-82-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-82-5 id=__codelineno-82-5 name=__codelineno-82-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-82-6 id=__codelineno-82-6 name=__codelineno-82-6></a>&lt;*&gt; Allwinner DMIC Support
</code></pre></div> <h4 id=2862-sys_config>2.8.6.2 sys_config配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-83-1 id=__codelineno-83-1 name=__codelineno-83-1></a>[dmic]
<a href=#__codelineno-83-2 id=__codelineno-83-2 name=__codelineno-83-2></a>dmic_used = 0
<a href=#__codelineno-83-3 id=__codelineno-83-3 name=__codelineno-83-3></a>[snddmic]
<a href=#__codelineno-83-4 id=__codelineno-83-4 name=__codelineno-83-4></a>snddmic_used = 0
</code></pre></div> <p>dmic配置，即platform驱动的相关配置</p> <table> <thead> <tr> <th>dmic配置</th> <th>dmic配置说明</th> </tr> </thead> <tbody> <tr> <td>dmic_used</td> <td>是否使用dmic驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>snddmic配置，即machine驱动的相关配置</p> <table> <thead> <tr> <th>snddmic配置</th> <th>snddmic配置说明</th> </tr> </thead> <tbody> <tr> <td>snddmic_used</td> <td>是否使用snddmic驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <h3 id=287>2.8.7 标案音频测试方法</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令。</p> <h4 id=2871>2.8.7.1 播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-84-1 id=__codelineno-84-1 name=__codelineno-84-1></a>通过SPKL/R播歌,例如喇叭播歌
<a href=#__codelineno-84-2 id=__codelineno-84-2 name=__codelineno-84-2></a>amixer -Dhw:audiocodec cset name='AIF1IN0L Mux' 'AIF1_DA0L'
<a href=#__codelineno-84-3 id=__codelineno-84-3 name=__codelineno-84-3></a>amixer -Dhw:audiocodec cset name='AIF1IN0R Mux' 'AIF1_DA0R'
<a href=#__codelineno-84-4 id=__codelineno-84-4 name=__codelineno-84-4></a>amixer -Dhw:audiocodec cset name='DACL Mixer AIF1DA0L Switch' 1
<a href=#__codelineno-84-5 id=__codelineno-84-5 name=__codelineno-84-5></a>amixer -Dhw:audiocodec cset name='DACR Mixer AIF1DA0R Switch' 1
<a href=#__codelineno-84-6 id=__codelineno-84-6 name=__codelineno-84-6></a>amixer -Dhw:audiocodec cset name='Left Output Mixer DACL Switch' 1
<a href=#__codelineno-84-7 id=__codelineno-84-7 name=__codelineno-84-7></a>amixer -Dhw:audiocodec cset name='Right Output Mixer DACR Switch' 1
<a href=#__codelineno-84-8 id=__codelineno-84-8 name=__codelineno-84-8></a>amixer -Dhw:audiocodec cset name='SPK_R Mux' 'MIXER_Switch'
<a href=#__codelineno-84-9 id=__codelineno-84-9 name=__codelineno-84-9></a>amixer -Dhw:audiocodec cset name='SPK_L Mux' 'MIXEL_Switch'
<a href=#__codelineno-84-10 id=__codelineno-84-10 name=__codelineno-84-10></a>amixer -Dhw:audiocodec cset name='External Speaker Switch' 1
<a href=#__codelineno-84-11 id=__codelineno-84-11 name=__codelineno-84-11></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
<a href=#__codelineno-84-12 id=__codelineno-84-12 name=__codelineno-84-12></a>可通过下面命令调节硬件上的模拟音量:
<a href=#__codelineno-84-13 id=__codelineno-84-13 name=__codelineno-84-13></a>amixer -Dhw:audiocodec cset name='speaker volume' 28
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-85-1 id=__codelineno-85-1 name=__codelineno-85-1></a>通过LINEOUTL/R播歌
<a href=#__codelineno-85-2 id=__codelineno-85-2 name=__codelineno-85-2></a>amixer -Dhw:audiocodec cset name='AIF1IN0L Mux' 'AIF1_DA0L'
<a href=#__codelineno-85-3 id=__codelineno-85-3 name=__codelineno-85-3></a>amixer -Dhw:audiocodec cset name='AIF1IN0R Mux' 'AIF1_DA0R'
<a href=#__codelineno-85-4 id=__codelineno-85-4 name=__codelineno-85-4></a>amixer -Dhw:audiocodec cset name='DACL Mixer AIF1DA0L Switch' 1
<a href=#__codelineno-85-5 id=__codelineno-85-5 name=__codelineno-85-5></a>amixer -Dhw:audiocodec cset name='DACR Mixer AIF1DA0R Switch' 1
<a href=#__codelineno-85-6 id=__codelineno-85-6 name=__codelineno-85-6></a>amixer -Dhw:audiocodec cset name='Left Output Mixer DACL Switch' 1
<a href=#__codelineno-85-7 id=__codelineno-85-7 name=__codelineno-85-7></a>amixer -Dhw:audiocodec cset name='Right Output Mixer DACR Switch' 1
<a href=#__codelineno-85-8 id=__codelineno-85-8 name=__codelineno-85-8></a>amixer -Dhw:audiocodec cset name='LINEOUTL Mux' 'LOMIX'
<a href=#__codelineno-85-9 id=__codelineno-85-9 name=__codelineno-85-9></a>amixer -Dhw:audiocodec cset name='LINEOUTR Mux' 'ROMIX'
<a href=#__codelineno-85-10 id=__codelineno-85-10 name=__codelineno-85-10></a>amixer -Dhw:audiocodec cset name='Lineout Switch' 1
<a href=#__codelineno-85-11 id=__codelineno-85-11 name=__codelineno-85-11></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
<a href=#__codelineno-85-12 id=__codelineno-85-12 name=__codelineno-85-12></a>可通过下面命令调节硬件上的模拟音量:
<a href=#__codelineno-85-13 id=__codelineno-85-13 name=__codelineno-85-13></a>amixer -Dhw:audiocodec cset name='lineout volume' 28
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-86-1 id=__codelineno-86-1 name=__codelineno-86-1></a>通过HPOUTL/R播歌,例如耳机
<a href=#__codelineno-86-2 id=__codelineno-86-2 name=__codelineno-86-2></a>amixer -Dhw:audiocodec cset name='AIF1IN0L Mux' 'AIF1_DA0L'
<a href=#__codelineno-86-3 id=__codelineno-86-3 name=__codelineno-86-3></a>amixer -Dhw:audiocodec cset name='AIF1IN0R Mux' 'AIF1_DA0R'
<a href=#__codelineno-86-4 id=__codelineno-86-4 name=__codelineno-86-4></a>amixer -Dhw:audiocodec cset name='DACL Mixer AIF1DA0L Switch' 1
<a href=#__codelineno-86-5 id=__codelineno-86-5 name=__codelineno-86-5></a>amixer -Dhw:audiocodec cset name='DACR Mixer AIF1DA0R Switch' 1
<a href=#__codelineno-86-6 id=__codelineno-86-6 name=__codelineno-86-6></a>amixer -Dhw:audiocodec cset name='HP_R Mux' 'DACR HPR Switch'
<a href=#__codelineno-86-7 id=__codelineno-86-7 name=__codelineno-86-7></a>amixer -Dhw:audiocodec cset name='HP_L Mux' 'DACL HPL Switch'
<a href=#__codelineno-86-8 id=__codelineno-86-8 name=__codelineno-86-8></a>amixer -Dhw:audiocodec cset name='Headphone Switch' 1
<a href=#__codelineno-86-9 id=__codelineno-86-9 name=__codelineno-86-9></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-87-1 id=__codelineno-87-1 name=__codelineno-87-1></a>可通过下面命令调节硬件上的模拟音量:
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-88-1 id=__codelineno-88-1 name=__codelineno-88-1></a>amixer -Dhw:audiocodec cset name='headphone volume' 60
</code></pre></div> <h4 id=2872>2.8.7.2 录音</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-89-1 id=__codelineno-89-1 name=__codelineno-89-1></a>通过MIC1,MIC2录音
<a href=#__codelineno-89-2 id=__codelineno-89-2 name=__codelineno-89-2></a>amixer -Dhw:audiocodec cset name='LADC input Mixer MIC1 boost Switch' 1
<a href=#__codelineno-89-3 id=__codelineno-89-3 name=__codelineno-89-3></a>amixer -Dhw:audiocodec cset name='RADC input Mixer MIC2 boost Switch' 1
<a href=#__codelineno-89-4 id=__codelineno-89-4 name=__codelineno-89-4></a>amixer -Dhw:audiocodec cset name='AIF1 AD0L Mixer ADCL Switch' 1
<a href=#__codelineno-89-5 id=__codelineno-89-5 name=__codelineno-89-5></a>amixer -Dhw:audiocodec cset name='AIF1 AD0R Mixer ADCR Switch' 1
<a href=#__codelineno-89-6 id=__codelineno-89-6 name=__codelineno-89-6></a>amixer -Dhw:audiocodec cset name='AIF1OUT0L Mux' 'AIF1_AD0L'
<a href=#__codelineno-89-7 id=__codelineno-89-7 name=__codelineno-89-7></a>amixer -Dhw:audiocodec cset name='AIF1OUT0R Mux' 'AIF1_AD0R'
<a href=#__codelineno-89-8 id=__codelineno-89-8 name=__codelineno-89-8></a>amixer -Dhw:audiocodec cset name='MIC1 boost AMP gain control' 4
<a href=#__codelineno-89-9 id=__codelineno-89-9 name=__codelineno-89-9></a>amixer -Dhw:audiocodec cset name='MIC2 boost AMP gain control' 4
<a href=#__codelineno-89-10 id=__codelineno-89-10 name=__codelineno-89-10></a>arecord -Dhw:audiocodec -f S16_LE -r 16000 -c 2 /tmp/test.wav
</code></pre></div> <h2 id=29-r328>2.9 R328音频接口.</h2> <h3 id=291>2.9.1 硬件资源</h3> <p>R328音频接口丰富，包含 6 个音频模块，分别是内置AudioCodec,Daudio0,Daudio1,Daudio2, Dmic,Spdif。</p> <p>另外还支持MAD作语音唤醒检测(详细请看R328 MAD章节)。</p> <p><img alt="图2-34: R328音频硬件框图" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-34.jpg></p> <h3 id=292>2.9.2 时钟源.</h3> <p>R328中， 6 个音频模块的时钟源均来自pll_audio。</p> <p>pll_audio可以输出24.576M或者22.5792M的时钟，分别支持48k系列，44.1k系列的播 放录音。</p> <p><img alt="图2-35: R328时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-35.jpg></p> <h3 id=293>2.9.3 代码结构</h3> <div class=highlight><pre><span></span><code><a href=#__codelineno-90-1 id=__codelineno-90-1 name=__codelineno-90-1></a>linux-4.9/sound/soc/sunxi/
<a href=#__codelineno-90-2 id=__codelineno-90-2 name=__codelineno-90-2></a>├── spdif-utils.c // spdif codec驱动
<a href=#__codelineno-90-3 id=__codelineno-90-3 name=__codelineno-90-3></a>├── sun8iw18-codec.c // codec驱动
<a href=#__codelineno-90-4 id=__codelineno-90-4 name=__codelineno-90-4></a>├── sun8iw18-codec.h
<a href=#__codelineno-90-5 id=__codelineno-90-5 name=__codelineno-90-5></a>├── sun8iw18-sndcodec.c // codec machine驱动
<a href=#__codelineno-90-6 id=__codelineno-90-6 name=__codelineno-90-6></a>├── sunxi-cpudai.c // codec platform驱动
<a href=#__codelineno-90-7 id=__codelineno-90-7 name=__codelineno-90-7></a>├── sunxi-daudio.c // daudio platform驱动
<a href=#__codelineno-90-8 id=__codelineno-90-8 name=__codelineno-90-8></a>├── sunxi-daudio.h
<a href=#__codelineno-90-9 id=__codelineno-90-9 name=__codelineno-90-9></a>├── sunxi-dmic.c // dmic platform驱动
<a href=#__codelineno-90-10 id=__codelineno-90-10 name=__codelineno-90-10></a>├── sunxi-dmic.h
<a href=#__codelineno-90-11 id=__codelineno-90-11 name=__codelineno-90-11></a>├── sunxi-mad.c //提供MAD相关功能接口
<a href=#__codelineno-90-12 id=__codelineno-90-12 name=__codelineno-90-12></a>├── sunxi-mad.h
<a href=#__codelineno-90-13 id=__codelineno-90-13 name=__codelineno-90-13></a>├── sunxi-pcm.c //通用文件，提供注册platform驱动的接口及相关函数集
<a href=#__codelineno-90-14 id=__codelineno-90-14 name=__codelineno-90-14></a>├── sunxi-pcm.h
<a href=#__codelineno-90-15 id=__codelineno-90-15 name=__codelineno-90-15></a>├── sunxi_rw_func.c //通用文件，读写模拟/数字寄存器的接口
<a href=#__codelineno-90-16 id=__codelineno-90-16 name=__codelineno-90-16></a>├── sunxi_rw_func.h
<a href=#__codelineno-90-17 id=__codelineno-90-17 name=__codelineno-90-17></a>├── sunxi-snddaudio.c // daudio machine驱动
<a href=#__codelineno-90-18 id=__codelineno-90-18 name=__codelineno-90-18></a>├── sunxi-snddaudio.h
<a href=#__codelineno-90-19 id=__codelineno-90-19 name=__codelineno-90-19></a>├── sunxi-snddmic.c // dmic machine驱动
<a href=#__codelineno-90-20 id=__codelineno-90-20 name=__codelineno-90-20></a>├── sunxi-snddmic.h
<a href=#__codelineno-90-21 id=__codelineno-90-21 name=__codelineno-90-21></a>├── sunxi-sndspdif.c // spdif machine驱动
<a href=#__codelineno-90-22 id=__codelineno-90-22 name=__codelineno-90-22></a>├── sunxi-spdif.c // spdif platform驱动
<a href=#__codelineno-90-23 id=__codelineno-90-23 name=__codelineno-90-23></a>└── sunxi-spdif.h
<a href=#__codelineno-90-24 id=__codelineno-90-24 name=__codelineno-90-24></a>linux-4.9/sound/soc/codecs/dmic.c // dmic codec驱动
<a href=#__codelineno-90-25 id=__codelineno-90-25 name=__codelineno-90-25></a>linux-4.9/sound/soc/soc-utils.c // daudio codec驱动
</code></pre></div> <h3 id=294-audiocodec>2.9.4 AudioCodec</h3> <p>硬件特性</p> <p>• 一路DAC</p> <ul> <li>支持16bit,24bit采样精度</li> <li>支持8KHz~192KHz采样率</li> <li>三路ADC</li> <li>支持16bit,24bit采样精度</li> <li>支持8KHz~48KHz采样率</li> <li>一路模拟输出：一路差分输出lineoutP/N，支持单端lineout输出</li> <li>三路模拟输入：MIC1,MIC2,MIC3</li> <li>支持同时playback和record(全双工模式)</li> <li>DAC及ADC均支持 5 段DRC</li> <li>DAC FIFO长度128*24bits, ADC FIFO长度128*24bits</li> </ul> <h4 id=2941>2.9.4.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-91-1 id=__codelineno-91-1 name=__codelineno-91-1></a>Device Drivers ---&gt;
<a href=#__codelineno-91-2 id=__codelineno-91-2 name=__codelineno-91-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-91-3 id=__codelineno-91-3 name=__codelineno-91-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-91-4 id=__codelineno-91-4 name=__codelineno-91-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-91-5 id=__codelineno-91-5 name=__codelineno-91-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-91-6 id=__codelineno-91-6 name=__codelineno-91-6></a>&lt;*&gt; Allwinner Sun8iw18 Codec Support
</code></pre></div> <h4 id=2942-sys_config>2.9.4.2 sys_config配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-92-1 id=__codelineno-92-1 name=__codelineno-92-1></a>[sndcodec]
<a href=#__codelineno-92-2 id=__codelineno-92-2 name=__codelineno-92-2></a>sndcodec_used = 0x1
<a href=#__codelineno-92-3 id=__codelineno-92-3 name=__codelineno-92-3></a>;------------------------------------------------------------------------------
<a href=#__codelineno-92-4 id=__codelineno-92-4 name=__codelineno-92-4></a>[cpudai]
<a href=#__codelineno-92-5 id=__codelineno-92-5 name=__codelineno-92-5></a>cpudai_used = 0x1
<a href=#__codelineno-92-6 id=__codelineno-92-6 name=__codelineno-92-6></a>;-------------------------------------------------------------------------------
<a href=#__codelineno-92-7 id=__codelineno-92-7 name=__codelineno-92-7></a>[codec]
<a href=#__codelineno-92-8 id=__codelineno-92-8 name=__codelineno-92-8></a>codec_used = 0x1
<a href=#__codelineno-92-9 id=__codelineno-92-9 name=__codelineno-92-9></a>digital_vol = 0x0
<a href=#__codelineno-92-10 id=__codelineno-92-10 name=__codelineno-92-10></a>lineout_vol =0x1a
<a href=#__codelineno-92-11 id=__codelineno-92-11 name=__codelineno-92-11></a>mic1gain = 0x4
<a href=#__codelineno-92-12 id=__codelineno-92-12 name=__codelineno-92-12></a>mic2gain = 0x4
<a href=#__codelineno-92-13 id=__codelineno-92-13 name=__codelineno-92-13></a>mic3gain = 0x0
<a href=#__codelineno-92-14 id=__codelineno-92-14 name=__codelineno-92-14></a>adcgain = 0x3
<a href=#__codelineno-92-15 id=__codelineno-92-15 name=__codelineno-92-15></a>adcagc_cfg = 0x0
<a href=#__codelineno-92-16 id=__codelineno-92-16 name=__codelineno-92-16></a>adcdrc_cfg = 0x0
<a href=#__codelineno-92-17 id=__codelineno-92-17 name=__codelineno-92-17></a>adchpf_cfg = 0x0
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-93-1 id=__codelineno-93-1 name=__codelineno-93-1></a>dacdrc_cfg = 0x0
<a href=#__codelineno-93-2 id=__codelineno-93-2 name=__codelineno-93-2></a>dachpf_cfg = 0x0
<a href=#__codelineno-93-3 id=__codelineno-93-3 name=__codelineno-93-3></a>pa_ctl_level = 0x1
<a href=#__codelineno-93-4 id=__codelineno-93-4 name=__codelineno-93-4></a>pa_msleep_time = 160
<a href=#__codelineno-93-5 id=__codelineno-93-5 name=__codelineno-93-5></a>gpio-spk = port:PH9&lt;1&gt;&lt;1&gt;&lt;1&gt;&lt;1&gt;
</code></pre></div> <p>sndcodec配置，即machine驱动的相关配置</p> <table> <thead> <tr> <th>sndcodec配置</th> <th>sndcodec配置说明</th> </tr> </thead> <tbody> <tr> <td>sndcodec_used</td> <td>是否使用sndcodec驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>cpudai配置，即platform驱动的相关配置</p> <table> <thead> <tr> <th>cpudai配置</th> <th>cpudai配置说明</th> </tr> </thead> <tbody> <tr> <td>cpudai_used</td> <td>是否使用cpudai驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <p>codec配置，即内置audiocodec驱动的相关配置</p> <table> <thead> <tr> <th>codec配置</th> <th>codec配置说明</th> </tr> </thead> <tbody> <tr> <td>codec_used</td> <td>是否使用codec驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>digital_vol</td> <td>初始化digital volume，可设定范围0<sub>0x3f,表示0</sub>-73.08dB,<br>-1.16dB/step</td> </tr> <tr> <td>lineout_vol</td> <td>lineout volume，可设定范围0<sub>0x1f,表示-43.5dB</sub>0dB, 1.5dB/step</td> </tr> <tr> <td>mic1gain</td> <td>mic1增益，可设定范围0~0x7, 0:0dB, 1<sub>7:15</sub>33dB, 3dB/step,一<br>般设置0x4,即24dB</td> </tr> <tr> <td>mic2gain</td> <td>mic2增益，可设定范围0~0x7, 0:0dB, 1<sub>7:15</sub>33dB, 3dB/step,一<br>般设置0x4,即24dB</td> </tr> <tr> <td>mic3gain</td> <td>mic3增益，可设定范围0~0x7, 0:0dB, 1<sub>7:15</sub>33dB, 3dB/step,一<br>般设置0x4,即24dB.如果作为aec回路，则需要设置为0dB</td> </tr> <tr> <td>adcgain</td> <td>adc增益，可设定范围0<sub>0x7,表示-4.5</sub>6dB, 1.5dB/step,一般设置<br>0x3,即0dB</td> </tr> <tr> <td>adcdrc_cfg</td> <td>是否使用adcdrc. 0:不适用； 1 ：使用</td> </tr> <tr> <td>adchpf_cfg</td> <td>是否使用adchpf. 0:不适用； 1 ：使用</td> </tr> <tr> <td>dacdrc_cfg</td> <td>是否使用dacdrc. 0:不适用； 1 ：使用</td> </tr> <tr> <td>dachpf_cfg</td> <td>是否使用dachpf. 0:不适用； 1 ：使用</td> </tr> <tr> <td>pa_ctl_level</td> <td>PA引脚使能方式。0:低电平有效； 1 ：高电平有效</td> </tr> <tr> <td>pa_msleep_time</td> <td>操作PA之后的延时时间(用来避免pop音)</td> </tr> <tr> <td>gpio-spk</td> <td>PA使能引脚</td> </tr> </tbody> </table> <p><strong>说明</strong></p> <ul> <li><strong>如果想要正常加载</strong> <strong><em>audiocodec</em></strong> <strong>声卡，需要把</strong> <strong><em>codec,platform,machine</em></strong> <strong>驱动都选上，即</strong> <strong><em>codec_used,cpudai_used,sndcodec_used</em></strong> <strong>都置为</strong> <strong><em>1</em></strong> <strong>；</strong></li> <li><strong><em>digital_vol,lineout_vol</em></strong> <strong>等值会在驱动初始化的时候设置，进入系统后还可以通过</strong> <strong><em>amixer</em></strong> <strong>工具对应控件进行再次修改；</strong></li> <li><strong>注意</strong> <strong><em>gpio-spk</em></strong> <strong>是否配置正确，是否有其他模块复用了该</strong> <strong><em>gpio;</em></strong></li> <li><strong>注意</strong> <strong><em>pa_ctl_level</em></strong> <strong>，实际功放的</strong> <strong><em>PA</em></strong> <strong>引脚是高电平有效，还是低电平有效</strong></li> </ul> <h4 id=2943-codec>2.9.4.3 codec数据通路</h4> <p><img alt="图2-36: R328音频通路" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-36.jpg></p> <div class=highlight><pre><span></span><code><a href=#__codelineno-94-1 id=__codelineno-94-1 name=__codelineno-94-1></a>播歌
<a href=#__codelineno-94-2 id=__codelineno-94-2 name=__codelineno-94-2></a>Playback --&gt; DACL --&gt; Left LINEOUT Mux --&gt; LINEOUTL --&gt; External Speaker
<a href=#__codelineno-94-3 id=__codelineno-94-3 name=__codelineno-94-3></a>Playback --&gt; DACR --&gt; Right LINEOUT Mux --&gt; LINEOUTR --&gt; External Speaker
<a href=#__codelineno-94-4 id=__codelineno-94-4 name=__codelineno-94-4></a>录音
<a href=#__codelineno-94-5 id=__codelineno-94-5 name=__codelineno-94-5></a>MIC1 --&gt; MIC1 PGA ---&gt; Left Input Mixer --&gt; ADCL --&gt; Capture
<a href=#__codelineno-94-6 id=__codelineno-94-6 name=__codelineno-94-6></a>MIC2 --&gt; MIC2 PGA ---&gt; Right Input Mixer --&gt; ADCL --&gt; Capture
<a href=#__codelineno-94-7 id=__codelineno-94-7 name=__codelineno-94-7></a>MIC3 --&gt; MIC3 PGA ---&gt; Xadc Input Mixer --&gt; ADCL --&gt; Capture
</code></pre></div> <p>R328所有控件如下表：</p> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>Lineout Switch</td> <td>使能lineout</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>ADC gain volume</td> <td>ADC增益</td> <td>0–7,表示-4.5–6dB,具体计<br>算请看注释 1</td> </tr> <tr> <td>External Speaker Switch</td> <td>使能lineout以及PA</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>LINEOUT volume</td> <td>lineout音量设置</td> <td>0–31,表示-43.5–0dB,具体<br>计算请看注释 2</td> </tr> <tr> <td>Left Input Mixer DACL<br>Switch</td> <td>Left Input Mixer设置，使<br>能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Input Mixer MIC1<br>Boost Switch</td> <td>Left Input Mixer设置，使<br>能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Input Mixer MIC2<br>Boost Switch</td> <td>Left Input Mixer设置，使<br>能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left Input Mixer MIC3<br>Boost Switch</td> <td>Left Input Mixer设置，使<br>能MIC3通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Left LINEOUT Mux</td> <td>Left Lineout Mux设置</td> <td>0:DACL; 1:NULL(空)</td> </tr> <tr> <td>Right LINEOUT Mux</td> <td>Right Lineout Mux设置</td> <td>0:NULL(空); 1:DACL</td> </tr> <tr> <td>MIC1 gain volume</td> <td>MIC1 Boost AMP gain</td> <td>0–7, 0:0dB, 1~7:15–33dB,<br>具体计算请看注释 3</td> </tr> <tr> <td>MIC2 gain volume</td> <td>MIC2 Boost AMP gain</td> <td>与MIC1 gain volume设置<br>一样</td> </tr> <tr> <td>MIC3 gain volume</td> <td>MIC3 Boost AMP gain</td> <td>与MIC1 gain volume设置<br>一样</td> </tr> <tr> <td>Right Input Mixer DACL<br>Switch</td> <td>Right Input Mixer设置，<br>使能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Input Mixer MIC1<br>Boost Switch</td> <td>Right Input Mixer设置，<br>使能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Input Mixer MIC2<br>Boost Switch</td> <td>Right Input Mixer设置，<br>使能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Right Input Mixer MIC3<br>Boost Switch</td> <td>Right Input Mixer设置，<br>使能MIC3通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Xadc Input Mixer DACL<br>Switch</td> <td>Xadc Input Mixer设置，使<br>能DACL通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Xadc Input Mixer MIC1<br>Boost Switch</td> <td>Xadc Input Mixer设置，使<br>能MIC1通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Xadc Input Mixer MIC2<br>Boost Switch</td> <td>Xadc Input Mixer设置，使<br>能MIC2通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>Xadc Input Mixer MIC3<br>Boost Switch</td> <td>Xadc Input Mixer设置，使<br>能MIC3通路</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>codec hub mode</td> <td>使能audiocodec hub功能</td> <td>0:关闭; 1:开启</td> </tr> <tr> <td>digital volume</td> <td>数字端音量设置</td> <td>0–63,表示-73.08–0dB,具<br>体计算请看注释 4</td> </tr> </tbody> </table> <p>• 注释 1</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-95-1 id=__codelineno-95-1 name=__codelineno-95-1></a>ADC gain volume计算方法：
<a href=#__codelineno-95-2 id=__codelineno-95-2 name=__codelineno-95-2></a>应用层可设置范围:0～ 7
<a href=#__codelineno-95-3 id=__codelineno-95-3 name=__codelineno-95-3></a>对应实际硬件设置的范围:-4.5~6dB, step: 1.5dB
<a href=#__codelineno-95-4 id=__codelineno-95-4 name=__codelineno-95-4></a>换算方法:-4.5+(n\*1.5)
<a href=#__codelineno-95-5 id=__codelineno-95-5 name=__codelineno-95-5></a>举例，设置0dB:
<a href=#__codelineno-95-6 id=__codelineno-95-6 name=__codelineno-95-6></a>-4.5+(n\*1.5) = 0
<a href=#__codelineno-95-7 id=__codelineno-95-7 name=__codelineno-95-7></a>n = 3
<a href=#__codelineno-95-8 id=__codelineno-95-8 name=__codelineno-95-8></a>所以应用层上输入下面命令设置为0dB:
<a href=#__codelineno-95-9 id=__codelineno-95-9 name=__codelineno-95-9></a>amixer -D hw:audiocodec cset name='ADC gain volume' 3
</code></pre></div> <p>• 注释 2</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-96-1 id=__codelineno-96-1 name=__codelineno-96-1></a>LINEOUT volume计算方法：
<a href=#__codelineno-96-2 id=__codelineno-96-2 name=__codelineno-96-2></a>应用层可设置范围： 0 ～31 (设置为 0 或者 1 时，就是mute)
<a href=#__codelineno-96-3 id=__codelineno-96-3 name=__codelineno-96-3></a>对应实际硬件设置的范围：-43.5~0dB, step：1.5dB
<a href=#__codelineno-96-4 id=__codelineno-96-4 name=__codelineno-96-4></a>换算方法:-43.5+((n-2)\*1.5)
<a href=#__codelineno-96-5 id=__codelineno-96-5 name=__codelineno-96-5></a>举例 1 ，设置0dB:
<a href=#__codelineno-96-6 id=__codelineno-96-6 name=__codelineno-96-6></a>-43.5+((n-2)\*1.5) = 0
<a href=#__codelineno-96-7 id=__codelineno-96-7 name=__codelineno-96-7></a>n = 31
<a href=#__codelineno-96-8 id=__codelineno-96-8 name=__codelineno-96-8></a>所以应用层上输入下面命令设置为0dB:
<a href=#__codelineno-96-9 id=__codelineno-96-9 name=__codelineno-96-9></a>amixer -D hw:audiocodec cset name='LINEOUT volume' 31
<a href=#__codelineno-96-10 id=__codelineno-96-10 name=__codelineno-96-10></a>举例 2 ，设置-6dB:
<a href=#__codelineno-96-11 id=__codelineno-96-11 name=__codelineno-96-11></a>-43.5+((n-2)\*1.5) = -6
<a href=#__codelineno-96-12 id=__codelineno-96-12 name=__codelineno-96-12></a>n = 27
<a href=#__codelineno-96-13 id=__codelineno-96-13 name=__codelineno-96-13></a>所以应用层上输入下面命令设置为-6dB:
<a href=#__codelineno-96-14 id=__codelineno-96-14 name=__codelineno-96-14></a>amixer -D hw:audiocodec cset name='LINEOUT volume' 27
</code></pre></div> <p>• 注释 3</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-97-1 id=__codelineno-97-1 name=__codelineno-97-1></a>MIC1 gain volume计算方法：
<a href=#__codelineno-97-2 id=__codelineno-97-2 name=__codelineno-97-2></a>应用层可设置范围： 0 ～7 (设置为 0 时，就是0dB)
<a href=#__codelineno-97-3 id=__codelineno-97-3 name=__codelineno-97-3></a>对应实际硬件设置的范围：0dB或者15~33dB, step：3dB
<a href=#__codelineno-97-4 id=__codelineno-97-4 name=__codelineno-97-4></a>换算方法:15+((n-1)*3)
<a href=#__codelineno-97-5 id=__codelineno-97-5 name=__codelineno-97-5></a>举例，设置24dB:
<a href=#__codelineno-97-6 id=__codelineno-97-6 name=__codelineno-97-6></a>15+((n-1)*3) = 24
<a href=#__codelineno-97-7 id=__codelineno-97-7 name=__codelineno-97-7></a>n = 4
<a href=#__codelineno-97-8 id=__codelineno-97-8 name=__codelineno-97-8></a>所以应用层上输入下面命令设置为24dB:
<a href=#__codelineno-97-9 id=__codelineno-97-9 name=__codelineno-97-9></a>amixer -D hw:audiocodec cset name='MIC1 gain volume' 4
</code></pre></div> <p>• 注释 4</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-98-1 id=__codelineno-98-1 name=__codelineno-98-1></a>digital volume计算方法：
<a href=#__codelineno-98-2 id=__codelineno-98-2 name=__codelineno-98-2></a>应用层可设置范围： 0 ～ 63
<a href=#__codelineno-98-3 id=__codelineno-98-3 name=__codelineno-98-3></a>对应实际硬件设置的范围：-73.08~0dB, step：1.16dB
<a href=#__codelineno-98-4 id=__codelineno-98-4 name=__codelineno-98-4></a>换算方法:-73.08+(n*1.16)
<a href=#__codelineno-98-5 id=__codelineno-98-5 name=__codelineno-98-5></a>举例 1 ，设置0dB:
<a href=#__codelineno-98-6 id=__codelineno-98-6 name=__codelineno-98-6></a>-73.08+(n*1.16) = 0
<a href=#__codelineno-98-7 id=__codelineno-98-7 name=__codelineno-98-7></a>n = 63
<a href=#__codelineno-98-8 id=__codelineno-98-8 name=__codelineno-98-8></a>所以应用层上输入下面命令设置为0dB:
<a href=#__codelineno-98-9 id=__codelineno-98-9 name=__codelineno-98-9></a>amixer -D hw:audiocodec cset name='digital volume' 63
<a href=#__codelineno-98-10 id=__codelineno-98-10 name=__codelineno-98-10></a>举例 2 ，设置-5.8dB:
<a href=#__codelineno-98-11 id=__codelineno-98-11 name=__codelineno-98-11></a>-73.08+(n*1.16) = -5.8
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-99-1 id=__codelineno-99-1 name=__codelineno-99-1></a>n = 58
<a href=#__codelineno-99-2 id=__codelineno-99-2 name=__codelineno-99-2></a>所以应用层上输入下面命令设置为-5.8dB:
<a href=#__codelineno-99-3 id=__codelineno-99-3 name=__codelineno-99-3></a>amixer -D hw:audiocodec cset name='digital volume' 58
</code></pre></div> <p>通路设置举例：</p> <ol> <li>播放通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-100-1 id=__codelineno-100-1 name=__codelineno-100-1></a>通过Speaker播放，差分输出：
<a href=#__codelineno-100-2 id=__codelineno-100-2 name=__codelineno-100-2></a>amixer -D hw:audiocodec cset name='External Speaker Switch' 1
<a href=#__codelineno-100-3 id=__codelineno-100-3 name=__codelineno-100-3></a>amixer -D hw:audiocodec cset name='digital volume' 63
<a href=#__codelineno-100-4 id=__codelineno-100-4 name=__codelineno-100-4></a>amixer -D hw:audiocodec cset name='LINEOUT volume' 25
<a href=#__codelineno-100-5 id=__codelineno-100-5 name=__codelineno-100-5></a>amixer -D hw:audiocodec cset name='Right LINEOUT Mux' 1
</code></pre></div> <ol> <li>录音通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-101-1 id=__codelineno-101-1 name=__codelineno-101-1></a>通过模拟MIC1, MIC2录音：
<a href=#__codelineno-101-2 id=__codelineno-101-2 name=__codelineno-101-2></a>amixer -D hw:audiocodec cset name='Left Input Mixer MIC1 Boost Switch' 1
<a href=#__codelineno-101-3 id=__codelineno-101-3 name=__codelineno-101-3></a>amixer -D hw:audiocodec cset name='Right Input Mixer MIC2 Boost Switch' 1
<a href=#__codelineno-101-4 id=__codelineno-101-4 name=__codelineno-101-4></a>amixer -D hw:audiocodec cset name='MIC1 gain volume' 4
<a href=#__codelineno-101-5 id=__codelineno-101-5 name=__codelineno-101-5></a>amixer -D hw:audiocodec cset name='MIC2 gain volume' 4
</code></pre></div> <ol> <li>常用AEC通路</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-102-1 id=__codelineno-102-1 name=__codelineno-102-1></a>有两种AEC回路方式，具体看硬件如何设计
<a href=#__codelineno-102-2 id=__codelineno-102-2 name=__codelineno-102-2></a>1)外部AEC
<a href=#__codelineno-102-3 id=__codelineno-102-3 name=__codelineno-102-3></a>MIC1,MIC2录音；MIC3作为AEC,外部SPKP/N连接到MIC3.
<a href=#__codelineno-102-4 id=__codelineno-102-4 name=__codelineno-102-4></a>amixer -D hw:audiocodec cset name='Left Input Mixer MIC1 Boost Switch' 1
<a href=#__codelineno-102-5 id=__codelineno-102-5 name=__codelineno-102-5></a>amixer -D hw:audiocodec cset name='Right Input Mixer MIC2 Boost Switch' 1
<a href=#__codelineno-102-6 id=__codelineno-102-6 name=__codelineno-102-6></a>amixer -D hw:audiocodec cset name='Xadc Input Mixer MIC3 Boost Switch' 1
<a href=#__codelineno-102-7 id=__codelineno-102-7 name=__codelineno-102-7></a>amixer -D hw:audiocodec cset name='MIC1 gain volume' 4
<a href=#__codelineno-102-8 id=__codelineno-102-8 name=__codelineno-102-8></a>amixer -D hw:audiocodec cset name='MIC2 gain volume' 4
<a href=#__codelineno-102-9 id=__codelineno-102-9 name=__codelineno-102-9></a>amixer -D hw:audiocodec cset name='MIC3 gain volume' 0
<a href=#__codelineno-102-10 id=__codelineno-102-10 name=__codelineno-102-10></a>2)内部AEC(可省去外部AEC电路)
<a href=#__codelineno-102-11 id=__codelineno-102-11 name=__codelineno-102-11></a>MIC1,MIC2录音；MIC3作为AEC,使能内部DACL到MIC3的通路.
<a href=#__codelineno-102-12 id=__codelineno-102-12 name=__codelineno-102-12></a>amixer -D hw:audiocodec cset name='Left Input Mixer MIC1 Boost Switch' 1
<a href=#__codelineno-102-13 id=__codelineno-102-13 name=__codelineno-102-13></a>amixer -D hw:audiocodec cset name='Right Input Mixer MIC2 Boost Switch' 1
<a href=#__codelineno-102-14 id=__codelineno-102-14 name=__codelineno-102-14></a>amixer -D hw:audiocodec cset name='Xadc Input Mixer DACL Switch' 1
<a href=#__codelineno-102-15 id=__codelineno-102-15 name=__codelineno-102-15></a>amixer -D hw:audiocodec cset name='MIC1 gain volume' 4
<a href=#__codelineno-102-16 id=__codelineno-102-16 name=__codelineno-102-16></a>amixer -D hw:audiocodec cset name='MIC2 gain volume' 4
</code></pre></div> <h3 id=2145-daudio>2.14.5 Daudio</h3> <p>硬件特性</p> <p>• 三路I2S/PCM,可用于蓝牙通话，语音采集，数字功放；</p> <p>• 支持主从模式</p> <ul> <li> <p>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</p> </li> <li> <p>支持i2s,pcm协议格式配置</p> </li> <li>支持mono和stereo模式，最高支持 8 通道</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> <li>支持 3 路MCLK输出</li> </ul> <h4 id=21451>2.14.5.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-103-1 id=__codelineno-103-1 name=__codelineno-103-1></a>Device Drivers ---&gt;
<a href=#__codelineno-103-2 id=__codelineno-103-2 name=__codelineno-103-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-103-3 id=__codelineno-103-3 name=__codelineno-103-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-103-4 id=__codelineno-103-4 name=__codelineno-103-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-103-5 id=__codelineno-103-5 name=__codelineno-103-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-103-6 id=__codelineno-103-6 name=__codelineno-103-6></a>&lt;*&gt; Allwinner Digital Audio Support
</code></pre></div> <h4 id=21452-sys_config>2.14.5.2 sys_config配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-104-1 id=__codelineno-104-1 name=__codelineno-104-1></a>[snddaudio0]
<a href=#__codelineno-104-2 id=__codelineno-104-2 name=__codelineno-104-2></a>snddaudio0_used = 0
<a href=#__codelineno-104-3 id=__codelineno-104-3 name=__codelineno-104-3></a>daudio_master = 4
<a href=#__codelineno-104-4 id=__codelineno-104-4 name=__codelineno-104-4></a>audio_format = 1
<a href=#__codelineno-104-5 id=__codelineno-104-5 name=__codelineno-104-5></a>signal_inversion = 1
<a href=#__codelineno-104-6 id=__codelineno-104-6 name=__codelineno-104-6></a>[daudio0]
<a href=#__codelineno-104-7 id=__codelineno-104-7 name=__codelineno-104-7></a>daudio0_used = 0
<a href=#__codelineno-104-8 id=__codelineno-104-8 name=__codelineno-104-8></a>slot_width_select = 32
<a href=#__codelineno-104-9 id=__codelineno-104-9 name=__codelineno-104-9></a>pcm_lrck_period = 128
<a href=#__codelineno-104-10 id=__codelineno-104-10 name=__codelineno-104-10></a>msb_lsb_first = 0
<a href=#__codelineno-104-11 id=__codelineno-104-11 name=__codelineno-104-11></a>sign_extend = 0
<a href=#__codelineno-104-12 id=__codelineno-104-12 name=__codelineno-104-12></a>frametype = 0
<a href=#__codelineno-104-13 id=__codelineno-104-13 name=__codelineno-104-13></a>mclk_div = 1
<a href=#__codelineno-104-14 id=__codelineno-104-14 name=__codelineno-104-14></a>tdm_config = 1
<a href=#__codelineno-104-15 id=__codelineno-104-15 name=__codelineno-104-15></a>tx_data_mode = 0
<a href=#__codelineno-104-16 id=__codelineno-104-16 name=__codelineno-104-16></a>rx_data_mode = 0
</code></pre></div> <p>snddaudio0配置，即daudio0 machine驱动的相关配置</p> <table> <thead> <tr> <th>snddaudio配置</th> <th>snddaudio配置说明</th> </tr> </thead> <tbody> <tr> <td>snddaudio0_used</td> <td>是否使用snddaudio驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>daudio_master</td> <td>1: SND_SOC_DAIFMT_CBM_CFM(codec clk &amp; FRM<br>master),即daudio接口作为slave, codec作为master<br>2: SND_SOC_DAIFMT_CBS_CFM(codec clk slave &amp;<br>FRM master),一般不用<br>3: SND_SOC_DAIFMT_CBM_CFS(codec clk master &amp;<br>frame slave),一般不用<br>4: SND_SOC_DAIFMT_CBS_CFS(codec clk &amp; FRM<br>slave),即daudio接口作为master, codec作为slave</td> </tr> <tr> <td>audio_format</td> <td>1: SND_SOC_DAIFMT_I2S(standard i2s format)<br>2: SND_SOC_DAIFMT_RIGHT_J(right justfied format)<br>3: SND_SOC_DAIFMT_LEFT_J(left justfied format)<br>4: SND_SOC_DAIFMT_DSP_A(pcm. MSB is available<br>on 2<sup>nd</sup> BCLK rising edge after LRC rising edge)<br>5: SND_SOC_DAIFMT_DSP_B(pcm. MSB is available<br>on 1nd BCLK rising edge after LRC rising edge)</td> </tr> <tr> <td>signal_inversion</td> <td>1: SND_SOC_DAIFMT_NB_NF(normal bit clock +<br>frame)<br>2: SND_SOC_DAIFMT_NB_IF(normal BCLK + inv<br>FRM)<br>3: SND_SOC_DAIFMT_IB_NF(invert BCLK + nor FRM)<br>4: SND_SOC_DAIFMT_IB_IF(invert BCLK + FRM)</td> </tr> </tbody> </table> <p>daudio0配置，即daudio0 platform驱动的相关配置</p> <table> <thead> <tr> <th>daudio配置</th> <th>daudio配置说明</th> </tr> </thead> <tbody> <tr> <td>daudio0_used</td> <td>是否使用daudio驱动。 0 ：不使用； 1 ：使用</td> </tr> <tr> <td>slot_width_select</td> <td>支持8bit, 16bit, 32bit宽度</td> </tr> <tr> <td>pcm_lrck_period</td> <td>一般可配置16/32/64/128/256个bclk</td> </tr> <tr> <td>msb_lsb_first</td> <td>0: msb first; 1: lsb first</td> </tr> <tr> <td>sign_extend</td> <td>0: zero pending; 1: sign extend</td> </tr> <tr> <td>frametype</td> <td>0: short frame = 1 clock width; 1: long frame = 2<br>clock width</td> </tr> <tr> <td>mclk_div</td> <td>0: not output(normal setting this);<br>½/4/6/8/12/16/24/32/48/64/96/128/176/192:给外部<br>codec提供时钟，频率是pll_audio/mclk_div</td> </tr> <tr> <td>tdm_config</td> <td>0: pcm mode; 1: i2s mode</td> </tr> <tr> <td>tx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit<br>a-law</td> </tr> <tr> <td>rx_data_mode</td> <td>0: 16bit linear PCM;1: reserved;2: 8bit u-law;3: 8bit<br>a-law</td> </tr> </tbody> </table> <p>注意事项：</p> <ul> <li> <p>daudio machine驱动的配置(snddaudio),一般来说还需要配置codec name以及codec dai name</p> </li> <li> <p>例如daudio0使用了AC108作为外挂codec:</p> </li> </ul> <div class=highlight><pre><span></span><code><a href=#__codelineno-105-1 id=__codelineno-105-1 name=__codelineno-105-1></a>[snddaudio0]
<a href=#__codelineno-105-2 id=__codelineno-105-2 name=__codelineno-105-2></a>snddaudio0_used = 1
<a href=#__codelineno-105-3 id=__codelineno-105-3 name=__codelineno-105-3></a>sunxi,snddaudio-codec = "ac108.1-003b";
<a href=#__codelineno-105-4 id=__codelineno-105-4 name=__codelineno-105-4></a>sunxi,snddaudio-codec-dai = "ac108-pcm0";
<a href=#__codelineno-105-5 id=__codelineno-105-5 name=__codelineno-105-5></a>daudio_master = 4
<a href=#__codelineno-105-6 id=__codelineno-105-6 name=__codelineno-105-6></a>audio_format = 1
<a href=#__codelineno-105-7 id=__codelineno-105-7 name=__codelineno-105-7></a>signal_inversion = 2
<a href=#__codelineno-105-8 id=__codelineno-105-8 name=__codelineno-105-8></a>[daudio0]
<a href=#__codelineno-105-9 id=__codelineno-105-9 name=__codelineno-105-9></a>daudio0_used = 1
<a href=#__codelineno-105-10 id=__codelineno-105-10 name=__codelineno-105-10></a>slot_width_select = 32
<a href=#__codelineno-105-11 id=__codelineno-105-11 name=__codelineno-105-11></a>pcm_lrck_period = 128
<a href=#__codelineno-105-12 id=__codelineno-105-12 name=__codelineno-105-12></a>msb_lsb_first = 0
<a href=#__codelineno-105-13 id=__codelineno-105-13 name=__codelineno-105-13></a>sign_extend = 0
<a href=#__codelineno-105-14 id=__codelineno-105-14 name=__codelineno-105-14></a>frametype = 0
<a href=#__codelineno-105-15 id=__codelineno-105-15 name=__codelineno-105-15></a>mclk_div = 1
<a href=#__codelineno-105-16 id=__codelineno-105-16 name=__codelineno-105-16></a>tdm_config = 1
<a href=#__codelineno-105-17 id=__codelineno-105-17 name=__codelineno-105-17></a>tx_data_mode = 0
<a href=#__codelineno-105-18 id=__codelineno-105-18 name=__codelineno-105-18></a>rx_data_mode = 0
<a href=#__codelineno-105-19 id=__codelineno-105-19 name=__codelineno-105-19></a>注意名称需要与codec驱动中配置的名称一致，如ac108驱动，路径：
<a href=#__codelineno-105-20 id=__codelineno-105-20 name=__codelineno-105-20></a>linux-4.9/sound/soc/codecs/ac108.c
<a href=#__codelineno-105-21 id=__codelineno-105-21 name=__codelineno-105-21></a>代码中snd_soc_register_codec注册codec驱动，其中codec device name为ac108.1-003b,
<a href=#__codelineno-105-22 id=__codelineno-105-22 name=__codelineno-105-22></a>codec dai name为ac108-pcm0
</code></pre></div> <ol> <li>例如daudio2与bluetooth模组相连(没有实际的codec驱动)，那么这时候codec</li> </ol> <div class=highlight><pre><span></span><code><a href=#__codelineno-106-1 id=__codelineno-106-1 name=__codelineno-106-1></a>name, codec dai name需要配置为dummy codec,可以如下配置：
<a href=#__codelineno-106-2 id=__codelineno-106-2 name=__codelineno-106-2></a>   [snddaudio2]
<a href=#__codelineno-106-3 id=__codelineno-106-3 name=__codelineno-106-3></a>   snddaudio2_used = 1
<a href=#__codelineno-106-4 id=__codelineno-106-4 name=__codelineno-106-4></a>   sunxi,snddaudio-codec = "snd-soc-dummy"
<a href=#__codelineno-106-5 id=__codelineno-106-5 name=__codelineno-106-5></a>   sunxi,snddaudio-codec-dai = "snd-soc-dummy-dai"
<a href=#__codelineno-106-6 id=__codelineno-106-6 name=__codelineno-106-6></a>   daudio_master = 1
<a href=#__codelineno-106-7 id=__codelineno-106-7 name=__codelineno-106-7></a>   audio_format = 5
<a href=#__codelineno-106-8 id=__codelineno-106-8 name=__codelineno-106-8></a>   signal_inversion = 2
<a href=#__codelineno-106-9 id=__codelineno-106-9 name=__codelineno-106-9></a>因为驱动中解析snddaudio-codec等字段时，判断出错的时候则使用默认codec"snd-soc-dummy",
<a href=#__codelineno-106-10 id=__codelineno-106-10 name=__codelineno-106-10></a>所以如果sunxi,snddaudio-codec和sunxi,snddaudio-codec-dai不配置，或者配置为空的时候，
<a href=#__codelineno-106-11 id=__codelineno-106-11 name=__codelineno-106-11></a>则默认使用dummy codec:
<a href=#__codelineno-106-12 id=__codelineno-106-12 name=__codelineno-106-12></a>[snddaudio2]
<a href=#__codelineno-106-13 id=__codelineno-106-13 name=__codelineno-106-13></a>snddaudio2_used = 1
<a href=#__codelineno-106-14 id=__codelineno-106-14 name=__codelineno-106-14></a>daudio_master = 1
<a href=#__codelineno-106-15 id=__codelineno-106-15 name=__codelineno-106-15></a>audio_format = 5
<a href=#__codelineno-106-16 id=__codelineno-106-16 name=__codelineno-106-16></a>signal_inversion = 2
<a href=#__codelineno-106-17 id=__codelineno-106-17 name=__codelineno-106-17></a>或者
<a href=#__codelineno-106-18 id=__codelineno-106-18 name=__codelineno-106-18></a>[snddaudio2]
<a href=#__codelineno-106-19 id=__codelineno-106-19 name=__codelineno-106-19></a>snddaudio2_used = 1
<a href=#__codelineno-106-20 id=__codelineno-106-20 name=__codelineno-106-20></a>sunxi,snddaudio-codec =
<a href=#__codelineno-106-21 id=__codelineno-106-21 name=__codelineno-106-21></a>sunxi,snddaudio-codec-dai =
<a href=#__codelineno-106-22 id=__codelineno-106-22 name=__codelineno-106-22></a>daudio_master = 1
<a href=#__codelineno-106-23 id=__codelineno-106-23 name=__codelineno-106-23></a>audio_format = 5
<a href=#__codelineno-106-24 id=__codelineno-106-24 name=__codelineno-106-24></a>signal_inversion = 2
</code></pre></div> <h3 id=2146-dmic>2.14.6 Dmic</h3> <p>硬件特性</p> <p>• 支持 8 路输入</p> <ul> <li>支持8~48KHz采样率</li> <li>支持16/24bit采样精度</li> </ul> <h4 id=21461>2.14.6.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-107-1 id=__codelineno-107-1 name=__codelineno-107-1></a>Device Drivers ---&gt;
<a href=#__codelineno-107-2 id=__codelineno-107-2 name=__codelineno-107-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-107-3 id=__codelineno-107-3 name=__codelineno-107-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-107-4 id=__codelineno-107-4 name=__codelineno-107-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-107-5 id=__codelineno-107-5 name=__codelineno-107-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-107-6 id=__codelineno-107-6 name=__codelineno-107-6></a>&lt;*&gt; Allwinner DMIC Support
</code></pre></div> <h4 id=21462-sys_config>2.14.6.2 sys_config配置</h4> <p>配置如下:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-108-1 id=__codelineno-108-1 name=__codelineno-108-1></a>[dmic]
<a href=#__codelineno-108-2 id=__codelineno-108-2 name=__codelineno-108-2></a>dmic_used = 0
<a href=#__codelineno-108-3 id=__codelineno-108-3 name=__codelineno-108-3></a>[snddmic]
<a href=#__codelineno-108-4 id=__codelineno-108-4 name=__codelineno-108-4></a>snddmic_used = 0
</code></pre></div> <p>dmic配置，即platform驱动的相关配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-109-1 id=__codelineno-109-1 name=__codelineno-109-1></a>dmic配置 dmic配置说明
<a href=#__codelineno-109-2 id=__codelineno-109-2 name=__codelineno-109-2></a>dmic_used 是否使用dmic驱动。 0 ：不使用； 1 ：使用
</code></pre></div> <p>snddmic配置，即machine驱动的相关配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-110-1 id=__codelineno-110-1 name=__codelineno-110-1></a>snddmic配置 snddmic配置说明
<a href=#__codelineno-110-2 id=__codelineno-110-2 name=__codelineno-110-2></a>snddmic_used 是否使用snddmic驱动。 0 ：不使用； 1 ：使用
</code></pre></div> <ul> <li>sys_config中不需要配置codec驱动相关信息</li> </ul> <p>因为machine驱动代码中默认配置了”dmic-codec”作为codec驱动,代码路径：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-111-1 id=__codelineno-111-1 name=__codelineno-111-1></a>linux-4.9/sound/soc/codecs/dmic.c
</code></pre></div> <h3 id=2147-spdif>2.14.7 SPDIF</h3> <p>硬件特性</p> <p>• 支持S/PDIF_OUT和S/PDIF_IN</p> <ul> <li>支持mono和stereo模式(mono模式下由硬件自动拓展为stereo)</li> <li>输出支持22.05kHz, 24kHz, 32kHz, 44.1kHz, 48kHz, 88.2kHz, 96kHz, 176.4kHz, 192kHz采样率</li> <li>输入支持44.1KHz,48KHz采样率</li> <li>输出和输入支持16bit,24bit采样精度</li> </ul> <h4 id=21471>2.14.7.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-112-1 id=__codelineno-112-1 name=__codelineno-112-1></a>Device Drivers ---&gt;
<a href=#__codelineno-112-2 id=__codelineno-112-2 name=__codelineno-112-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-112-3 id=__codelineno-112-3 name=__codelineno-112-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-112-4 id=__codelineno-112-4 name=__codelineno-112-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-112-5 id=__codelineno-112-5 name=__codelineno-112-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-112-6 id=__codelineno-112-6 name=__codelineno-112-6></a>&lt;*&gt; Allwinner SPDIF Support
</code></pre></div> <h4 id=21472-sys_config>2.14.7.2 sys_config配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-113-1 id=__codelineno-113-1 name=__codelineno-113-1></a>[sndspdif]
<a href=#__codelineno-113-2 id=__codelineno-113-2 name=__codelineno-113-2></a>sndspdif_used = 0
<a href=#__codelineno-113-3 id=__codelineno-113-3 name=__codelineno-113-3></a>[spdif]
<a href=#__codelineno-113-4 id=__codelineno-113-4 name=__codelineno-113-4></a>spdif_used = 0
</code></pre></div> <p>spdif配置，即platform驱动的相关配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-114-1 id=__codelineno-114-1 name=__codelineno-114-1></a>spdif配置 spdif配置说明|
<a href=#__codelineno-114-2 id=__codelineno-114-2 name=__codelineno-114-2></a>spdif_used 是否使用spdif驱动。 0 ：不使用； 1 ：使用|
</code></pre></div> <p>sndspdif配置，即machine驱动的相关配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-115-1 id=__codelineno-115-1 name=__codelineno-115-1></a>sndspdif配置sndspdif配置说明
</code></pre></div> <p>sndspdif_used是否使用sndspdif驱动。 0 ：不使用； 1 ：使用</p> <ul> <li>sys_config中不需要配置codec驱动相关信息</li> </ul> <p>因为machine驱动代码中默认配置了”spdif-utils”作为codec驱动,代码路径：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-116-1 id=__codelineno-116-1 name=__codelineno-116-1></a>linux-4.9/sound/soc/sunxi/spdif-utils.c
</code></pre></div> <h3 id=2148-mad>2.14.8 MAD</h3> <p>硬件特性</p> <ul> <li>支持三路I2S，一路DMIC PCM音频传输接口，时分复用，固定16bit</li> <li>支持16KHz,48KHz采样率</li> <li>支持基于能量识别的语音检测模块LPSD</li> <li>支持一块128KB的SRAM,可用于保存音频数据</li> </ul> <h4 id=21481>2.14.8.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-117-1 id=__codelineno-117-1 name=__codelineno-117-1></a>Device Drivers ---&gt;
<a href=#__codelineno-117-2 id=__codelineno-117-2 name=__codelineno-117-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-117-3 id=__codelineno-117-3 name=__codelineno-117-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-117-4 id=__codelineno-117-4 name=__codelineno-117-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-117-5 id=__codelineno-117-5 name=__codelineno-117-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-117-6 id=__codelineno-117-6 name=__codelineno-117-6></a>&lt;*&gt; Allwinner Mad Support
</code></pre></div> <h4 id=21482-sys_config>2.14.8.2 sys_config配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-118-1 id=__codelineno-118-1 name=__codelineno-118-1></a>[mad]
<a href=#__codelineno-118-2 id=__codelineno-118-2 name=__codelineno-118-2></a>mad_used = 1
<a href=#__codelineno-118-3 id=__codelineno-118-3 name=__codelineno-118-3></a>lpsd_clk_src_cfg = 0
<a href=#__codelineno-118-4 id=__codelineno-118-4 name=__codelineno-118-4></a>standby_sram_io_type = 1
</code></pre></div> <table> <thead> <tr> <th>mad配置</th> <th>mad配置说明</th> </tr> </thead> <tbody> <tr> <td>mad_used</td> <td>是否使用mad驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <h4 id=21483-mixer>2.14.8.3 mixer控件说明</h4> <ol> <li>mad绑定到I2S</li> </ol> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>daudio bind mad Function</td> <td>是否绑定MAD功能</td> <td>0:不绑定; 1:绑定</td> </tr> <tr> <td>lpsd channel sel Function</td> <td>选择作为能量唤醒的通道</td> <td>0:通道0; 1:通道1;</td> </tr> <tr> <td></td> <td></td> <td>如此类推，最高可指定通道7</td> </tr> <tr> <td>mad_standby channel sel<br>Function</td> <td>设定休眠时mad录音通<br>道数</td> <td>0:表示使用实际录音通道数;</td> </tr> </tbody> </table> <ol> <li>mad绑定到dmic</li> </ol> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>dmic bind mad Function</td> <td>是否绑定MAD功能</td> <td>0:不绑定; 1:绑定</td> </tr> <tr> <td>lpsd channel sel Function</td> <td>选择作为能量唤醒的通道</td> <td>0:通道0; 1:通道1;</td> </tr> <tr> <td></td> <td></td> <td>如此类推，最高可指定通道 7</td> </tr> <tr> <td>mad_standby channel sel<br>Function</td> <td>设定休眠时mad录音通道数</td> <td>0:表示使用实际录音通道数; <br>1:表示只录制两通道<br>2:表示只录制四通道</td> </tr> </tbody> </table> <h4 id=21484>2.14.8.4使用说明</h4> <p>固件上的配置，只要修改sys_config以及内核配置即可。</p> <p>应用上需要使能MAD相关的mixer control。</p> <p>I2S设置举例，例如使用的是AC108:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-119-1 id=__codelineno-119-1 name=__codelineno-119-1></a>mad使能,绑定mad到daudio中
<a href=#__codelineno-119-2 id=__codelineno-119-2 name=__codelineno-119-2></a>amixer -Dhw:sndac1081003b cset name='daudio bind mad Function' 1
<a href=#__codelineno-119-3 id=__codelineno-119-3 name=__codelineno-119-3></a>设置通道 0 作为唤醒通道
<a href=#__codelineno-119-4 id=__codelineno-119-4 name=__codelineno-119-4></a>amixer -Dhw:sndac1081003b cset name='lpsd channel sel Function' 0
<a href=#__codelineno-119-5 id=__codelineno-119-5 name=__codelineno-119-5></a>设定mad standby时,录音的通道数
<a href=#__codelineno-119-6 id=__codelineno-119-6 name=__codelineno-119-6></a>amixer -Dhw:sndac1081003b cset name='mad_standby channel sel Function' 2
</code></pre></div> <p>DMIC设置举例:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-120-1 id=__codelineno-120-1 name=__codelineno-120-1></a>amixer -Dhw:snddmic cset name='dmic bind mad Function' 1
<a href=#__codelineno-120-2 id=__codelineno-120-2 name=__codelineno-120-2></a>amixer -Dhw:snddmic cset name='lpsd channel sel Function' 0
<a href=#__codelineno-120-3 id=__codelineno-120-3 name=__codelineno-120-3></a>amixer -Dhw:snddmic cset name='mad_standby channel sel Function' 0
</code></pre></div> <p>然后应用正常进行录音即可，如果需要进入休眠，有下面几点必须实现的:</p> <ol> <li> <p>暂定录音、播放。snd_pcm_pause将playback,capture均暂停;</p> </li> <li> <p>设置wakeup_count。更新当前唤醒次数;</p> </li> <li>进入休眠。写mem到/sys/power/state即可;</li> </ol> <p>Tina SDK中有一个能量唤醒demo可供参考。</p> <p>make menuconfig选中mad-demo软件包</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-121-1 id=__codelineno-121-1 name=__codelineno-121-1></a>Allwinner ---&gt;
<a href=#__codelineno-121-2 id=__codelineno-121-2 name=__codelineno-121-2></a>    &lt;*&gt; mad-demo
</code></pre></div> <p>执行mad-ac108-demo，默认配置(脚本/usr/bin/mad-ac108-demo上设定了默认配置):</p> <p>• 使用通道 0 作为唤醒通道;</p> <ul> <li>录制 4 通道，16bit, 16K;</li> <li>每次录音5s后进入休眠，可通过语音能量唤醒;</li> </ul> <p>执行mad-dmic-demo，默认配置(脚本/usr/bin/mad-dmic-demo上设定了默认配置):</p> <p>• 使用通道 0 作为唤醒通道;</p> <ul> <li>录制 4 通道，16bit, 16K;</li> <li>每次录音5s后进入休眠，可通过语音能量唤醒;</li> </ul> <p>如果想查看录音数据，可以增加 dump 参数, 例如mad-dmic-demo dump, 录音文件保存 在/mnt/UDISK/目录下。</p> <h4 id=21485>2.14.8.5能量唤醒阈值参数</h4> <p>能量唤醒模块lpsd，识别能量主要有两个方向，瞬时能量和累计能量（前者比如是关门声，后者 比如是不断说话）能量检测参数配置均在/sys/module/sunxi_mad/parameters/目录下</p> <p>lpsd_rrun和lpsd_rstop的推荐值：</p> <table> <thead> <tr> <th>lpsd_rrun</th> <th>lpsd_rstop</th> </tr> </thead> <tbody> <tr> <td>77</td> <td>88</td> </tr> <tr> <td>77</td> <td>108</td> </tr> <tr> <td>77</td> <td>128</td> </tr> <tr> <td>77</td> <td>148</td> </tr> </tbody> </table> <ol> <li> <p>瞬时能量检测参数，主要是lpsd_rrun和lpsd_rstop。</p> </li> <li> <p>一般我们只对stop值进行修改;</p> </li> <li>如果录音数据经常缺少唤醒词的第一个字，则可以尝试降低stop值，可以有效提高唤醒词数据 的完整性。但同时会提高误唤醒率，环境噪音也会很容易触发能量检测，唤醒系统;</li> <li>如果想要降低误唤醒率(环境噪音造成唤醒)，则可以尝试提高stop值。同样的，这会导致一些 唤醒词录音数据不完整，例如一些音量较低，音调较低的语料;</li> <li> <p>唤醒词识别率以及误唤醒率无法同时兼得，客户需要根据实际需求、场景，权衡配置参数;</p> </li> <li> <p>累积能量检测参数，主要是lpsd_th。</p> </li> </ol> <p>• 我们建议使用默认值 1200 。建议修改范围50~1200;</p> <h4 id=21486>2.14.8.6注意事项</h4> <ol> <li> <p>MAD绑定动作，需要在应用打开声卡前就设置好;</p> </li> <li> <p>应用操作上的一些要求，具体请查看《MAD使用说明》章节;</p> </li> <li> <p>如果读取wakeup_count时一直阻塞，说明当前仍有wake_lock处于激活状态，例如usb 线连接着PC，usb驱动会保持一个wake_lock，不让系统进入休眠，所以需要拔掉usb或 者连接到usb适配器上，或者改动代码，去掉usb驱动中wake_lock的使用;</p> </li> </ol> <h3 id=2149-vad>2.14.9 VAD.</h3> <p>VAD是基于MAD实现的，可以通过内部AudioCodec的ADC采集音频数据，并作能量唤醒。 由于硬件上MAD功能只能用于I2S或者DMIC，内部codec无法直接关联到MAD，因此通 过I2S作为音频数据的桥梁，实现了VAD功能，使得模拟MIC也可以利用MAD功能作能量唤 醒。</p> <p>VAD完整的数据通路：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-122-1 id=__codelineno-122-1 name=__codelineno-122-1></a>ADC RxFiFo ---&gt; I2S TxFiFo ---&gt; I2S RxFiFo ---&gt; MAD SRAM ---&gt; MEM
</code></pre></div> <h4 id=21491>2.14.9.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-123-1 id=__codelineno-123-1 name=__codelineno-123-1></a>Device Drivers ---&gt;
<a href=#__codelineno-123-2 id=__codelineno-123-2 name=__codelineno-123-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-123-3 id=__codelineno-123-3 name=__codelineno-123-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-123-4 id=__codelineno-123-4 name=__codelineno-123-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-123-5 id=__codelineno-123-5 name=__codelineno-123-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-123-6 id=__codelineno-123-6 name=__codelineno-123-6></a>[*] Allwinner I2S PCM DMA MAP Support
<a href=#__codelineno-123-7 id=__codelineno-123-7 name=__codelineno-123-7></a>&lt;*&gt; Allwinner Mad Support
<a href=#__codelineno-123-8 id=__codelineno-123-8 name=__codelineno-123-8></a>&lt;*&gt; Allwinner Sun8iw18 Codec Support
<a href=#__codelineno-123-9 id=__codelineno-123-9 name=__codelineno-123-9></a>&lt;*&gt; Allwinner Digital Audio Support
</code></pre></div> <h4 id=21492-sys_config>2.14.9.2 sys_config配置</h4> <p>需要使能MAD配置:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-124-1 id=__codelineno-124-1 name=__codelineno-124-1></a>[mad]
<a href=#__codelineno-124-2 id=__codelineno-124-2 name=__codelineno-124-2></a>mad_used = 1
<a href=#__codelineno-124-3 id=__codelineno-124-3 name=__codelineno-124-3></a>lpsd_clk_src_cfg = 0
<a href=#__codelineno-124-4 id=__codelineno-124-4 name=__codelineno-124-4></a>standby_sram_io_type = 1
</code></pre></div> <table> <thead> <tr> <th>mad配置</th> <th>mad配置说明</th> </tr> </thead> <tbody> <tr> <td>mad_used</td> <td>是否使用mad驱动。 0 ：不使用； 1 ：使用</td> </tr> </tbody> </table> <h4 id=21493-mixer>2.14.9.3 mixer控件说明</h4> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>codec I2S Port</td> <td>指定VAD使用的I2S</td> <td>0:不适用; 1:使用I2S0;<br> 2:使用I2S1;<br>3:使用I2S2</td> </tr> <tr> <td>sndcodec bind mad Function</td> <td>是否绑定MAD功能</td> <td>0:不绑定; 1:绑定</td> </tr> <tr> <td>lpsd channel sel Function</td> <td>选择作为能量唤醒的通道</td> <td>0:通道0; 1:通道1;</td> </tr> <tr> <td></td> <td></td> <td>如此类推，最高可指定<br>通道 7</td> </tr> <tr> <td>mad_standby channel sel<br>Function</td> <td>设定休眠时mad录音通道数</td> <td>0:表示使用实际录音通<br>道数; 1:表示只录制两<br>通道2:表示只录制四通道</td> </tr> </tbody> </table> <p>注意：</p> <p>对于控件“codec I2S Port”，需要指定实际没有使用(sys_config没有使能的)的一路I2S。设置举例：</p> <ul> <li>实际没有使用I2S0(sys_config中snddaudio0,audio0均没有配置),那么这里可以设置为1,表示VAD使用I2S0;</li> <li>实际没有使用I2S1(sys_config中snddaudio1,audio1均没有配置),那么这里可以设置为2,表示VAD使用I2S1;</li> </ul> <p>设置举例:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-125-1 id=__codelineno-125-1 name=__codelineno-125-1></a>amixer -Dhw:audiocodec cset name='codec I2S Port' 2
<a href=#__codelineno-125-2 id=__codelineno-125-2 name=__codelineno-125-2></a>amixer -Dhw:audiocodec cset name='sndcodec bind mad Function' 1
<a href=#__codelineno-125-3 id=__codelineno-125-3 name=__codelineno-125-3></a>amixer -Dhw:audiocodec cset name='lpsd channel sel Function' 0
<a href=#__codelineno-125-4 id=__codelineno-125-4 name=__codelineno-125-4></a>amixer -Dhw:audiocodec cset name='mad_standby channel sel Function' 0
</code></pre></div> <h4 id=21494>2.14.9.4使用说明</h4> <p>VAD的使用与MAD类似。</p> <p>固件上的配置，只要修改sys_config以及内核配置即可。</p> <p>应用上除了打开内部audiocodec的录音通路之外，还需要下面一些配置：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-126-1 id=__codelineno-126-1 name=__codelineno-126-1></a>vad需要使用一路i2s,这里指定使用i2s1
<a href=#__codelineno-126-2 id=__codelineno-126-2 name=__codelineno-126-2></a>amixer -Dhw:audiocodec cset name='codec I2S Port' 2
<a href=#__codelineno-126-3 id=__codelineno-126-3 name=__codelineno-126-3></a>使能mad,绑定mad到audiocodec中
<a href=#__codelineno-126-4 id=__codelineno-126-4 name=__codelineno-126-4></a>amixer -Dhw:audiocodec cset name='sndcodec bind mad Function' 1
<a href=#__codelineno-126-5 id=__codelineno-126-5 name=__codelineno-126-5></a>设置通道 0 作为唤醒通道
<a href=#__codelineno-126-6 id=__codelineno-126-6 name=__codelineno-126-6></a>amixer -Dhw:audiocodec cset name='lpsd channel sel Function' 0
</code></pre></div> <p>然后应用正常进行录音即可，如果需要进入休眠，有下面几点必须实现的：</p> <ol> <li>暂定录音、播放。snd_pcm_pause将playback,capture均暂停</li> <li>设置wakeup_count。更新当前唤醒次数</li> <li>进入休眠。写mem到/sys/power/state即可</li> </ol> <p>Tina SDK中有一个能量唤醒demo可供参考make menuconfig选中mad-demo软件包</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-127-1 id=__codelineno-127-1 name=__codelineno-127-1></a>Allwinner ---&gt;
<a href=#__codelineno-127-2 id=__codelineno-127-2 name=__codelineno-127-2></a>    &lt;*&gt; mad-demo
</code></pre></div> <p>执行vad-demo，默认配置(脚本/usr/bin/vad-demo上设定了默认配置):</p> <p>• 使用I2S1</p> <ul> <li>录制 2 通道，16bit, 16K</li> <li>每次录音5s后进入休眠，可通过语音能量唤醒</li> </ul> <p>如果想查看录音数据，可以执行vad-demo dump,录音文件保存在/mnt/UDISK/vad-test.wav能量唤醒阈值的调整，可以参考《能量唤醒阈值参数》</p> <h4 id=21495>2.14.9.5注意事项</h4> <p>VAD同样需要注意MAD注意事项章节中提到的几点。</p> <p>另外需要注意，VAD隐式使用了一路I2S，所以硬件上需要保留一路I2S，并且sys_config中不能使能该I2S配置</p> <h3 id=21410>2.14.10标案音频测试方法.</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令</p> <h4 id=214101>2.14.10.1播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-128-1 id=__codelineno-128-1 name=__codelineno-128-1></a>通过Speaker播放
<a href=#__codelineno-128-2 id=__codelineno-128-2 name=__codelineno-128-2></a>amixer -D hw:audiocodec cset name='External Speaker Switch' 1
<a href=#__codelineno-128-3 id=__codelineno-128-3 name=__codelineno-128-3></a>amixer -D hw:audiocodec cset name='Right LINEOUT Mux' 1
<a href=#__codelineno-128-4 id=__codelineno-128-4 name=__codelineno-128-4></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <h4 id=214102>2.14.10.2录音</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-129-1 id=__codelineno-129-1 name=__codelineno-129-1></a>通过MIC1,MIC2录制两通道
<a href=#__codelineno-129-2 id=__codelineno-129-2 name=__codelineno-129-2></a>amixer -D hw:audiocodec cset name='Left Input Mixer MIC1 Boost Switch' 1
<a href=#__codelineno-129-3 id=__codelineno-129-3 name=__codelineno-129-3></a>amixer -D hw:audiocodec cset name='Right Input Mixer MIC2 Boost Switch' 1
<a href=#__codelineno-129-4 id=__codelineno-129-4 name=__codelineno-129-4></a>amixer -D hw:audiocodec cset name='MIC1 boost volume' 4
<a href=#__codelineno-129-5 id=__codelineno-129-5 name=__codelineno-129-5></a>amixer -D hw:audiocodec cset name='MIC2 boost volume' 4
<a href=#__codelineno-129-6 id=__codelineno-129-6 name=__codelineno-129-6></a>arecord -Dhw:audiocodec -f S16_LE -r 16000 -c 2 /tmp/test.wav
</code></pre></div> <h4 id=_1></h4> <h2 id=220-v853>2.20 V853音频接口</h2> <p>V853包含多个音频模块，分别是内置AudioCodec,I2S0,I2S1,DMIC。</p> <h3 id=2201>2.20.1 时钟源.</h3> <p>V853中，音频模块的时钟源来自pll_audio0。</p> <p>pll_audio0可输出22.5792M和24.576M频率的时钟，分别支持44.1k系列、48k系列的播放录音，但无法同时输出。</p> <p><img alt="图2-48: V853时钟源" src=https://photos.100ask.net/Tina-Sdk/OpenRemoved_Tina_Linux_Audio_development_Guide-2-48.jpg></p> <h3 id=2202>2.20.2 代码结构</h3> <div class=highlight><pre><span></span><code><a href=#__codelineno-130-1 id=__codelineno-130-1 name=__codelineno-130-1></a>linux-4.9/sound/soc/sunxi_v2/
<a href=#__codelineno-130-2 id=__codelineno-130-2 name=__codelineno-130-2></a>├── snd_sun8iw21_codec.c // codec驱动
<a href=#__codelineno-130-3 id=__codelineno-130-3 name=__codelineno-130-3></a>├── snd_sun8iw21_codec.h
<a href=#__codelineno-130-4 id=__codelineno-130-4 name=__codelineno-130-4></a>├── snd_sunxi_aaudio.c
<a href=#__codelineno-130-5 id=__codelineno-130-5 name=__codelineno-130-5></a>├── snd_sunxi_common.c
<a href=#__codelineno-130-6 id=__codelineno-130-6 name=__codelineno-130-6></a>├── snd_sunxi_common.h
<a href=#__codelineno-130-7 id=__codelineno-130-7 name=__codelineno-130-7></a>├── snd_sunxi_daudio.c //daudio platform驱动
<a href=#__codelineno-130-8 id=__codelineno-130-8 name=__codelineno-130-8></a>├── snd_sunxi_daudio.h
<a href=#__codelineno-130-9 id=__codelineno-130-9 name=__codelineno-130-9></a>├── snd_sunxi_dmic.c // dmic platform驱动
<a href=#__codelineno-130-10 id=__codelineno-130-10 name=__codelineno-130-10></a>├── snd_sunxi_dmic.h
<a href=#__codelineno-130-11 id=__codelineno-130-11 name=__codelineno-130-11></a>├── snd_sunxi_log.h
<a href=#__codelineno-130-12 id=__codelineno-130-12 name=__codelineno-130-12></a>├── snd_sunxi_mach.c
<a href=#__codelineno-130-13 id=__codelineno-130-13 name=__codelineno-130-13></a>├── snd_sunxi_mach.h
<a href=#__codelineno-130-14 id=__codelineno-130-14 name=__codelineno-130-14></a>├── snd_sunxi_mach_utils.c
<a href=#__codelineno-130-15 id=__codelineno-130-15 name=__codelineno-130-15></a>├── snd_sunxi_mach_utils.h
<a href=#__codelineno-130-16 id=__codelineno-130-16 name=__codelineno-130-16></a>├── snd_sunxi_pcm.c
<a href=#__codelineno-130-17 id=__codelineno-130-17 name=__codelineno-130-17></a>├── snd_sunxi_pcm.h
<a href=#__codelineno-130-18 id=__codelineno-130-18 name=__codelineno-130-18></a>├── snd_sunxi_rxsync.c
<a href=#__codelineno-130-19 id=__codelineno-130-19 name=__codelineno-130-19></a>├── snd_sunxi_rxsync.h
<a href=#__codelineno-130-20 id=__codelineno-130-20 name=__codelineno-130-20></a>├── snd_sunxi_txhub.c
<a href=#__codelineno-130-21 id=__codelineno-130-21 name=__codelineno-130-21></a>└── snd_sunxi_txhub.h
</code></pre></div> <h3 id=2203-audiocodec>2.20.3 AudioCodec</h3> <h4 id=22031>2.20.3.1硬件特性</h4> <p>• 一路DAC</p> <ul> <li>支持16bit,20bit有效采样精度</li> <li>支持8KHz~192KHz采样率</li> <li>两路ADC</li> <li>支持16bit,20bit有效采样精度</li> <li>支持8KHz~48KHz采样率</li> <li>一路模拟输出：</li> <li>一路立体声输出LINEOUT，支持single/differ</li> <li>两路模拟输入：MIC1,MIC2</li> <li>MIC支持single/differ,</li> <li>支持同时playback和record(全双工模式)</li> <li>DAC及ADC均支持DRC</li> <li>支持mono模式，最高支持 2 通道</li> </ul> <h4 id=22032>2.20.3.2内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-131-1 id=__codelineno-131-1 name=__codelineno-131-1></a>Device Drivers ---&gt;
<a href=#__codelineno-131-2 id=__codelineno-131-2 name=__codelineno-131-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-131-3 id=__codelineno-131-3 name=__codelineno-131-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-131-4 id=__codelineno-131-4 name=__codelineno-131-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-131-5 id=__codelineno-131-5 name=__codelineno-131-5></a>Allwinner SoC Audio support V2 ---&gt;
<a href=#__codelineno-131-6 id=__codelineno-131-6 name=__codelineno-131-6></a>&lt;*&gt; Allwinner AAUDIO support
<a href=#__codelineno-131-7 id=__codelineno-131-7 name=__codelineno-131-7></a>&lt;*&gt; Allwinner DAUDIO Support
<a href=#__codelineno-131-8 id=__codelineno-131-8 name=__codelineno-131-8></a>&lt;*&gt; Allwinner Function Components
<a href=#__codelineno-131-9 id=__codelineno-131-9 name=__codelineno-131-9></a>&lt;*&gt; Components Rx Sync
</code></pre></div> <h4 id=22033-dts>2.20.3.3 DTS配置.</h4> <p><strong>2.20.3.3.1 DeviceTree 配置说明</strong> 设备树为芯片平台的模块配置，面对芯片特性进行配 置，设备树文件的路径为：lichee/linux-4.9/arch/arm/boot/dts/sun8iw21p1.dtsi</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-132-1 id=__codelineno-132-1 name=__codelineno-132-1></a>codec:codec@0x02030000 {
<a href=#__codelineno-132-2 id=__codelineno-132-2 name=__codelineno-132-2></a>#sound-dai-cells = &lt;0&gt;;
<a href=#__codelineno-132-3 id=__codelineno-132-3 name=__codelineno-132-3></a>compatible = "allwinner,sunxi-snd-codec";
<a href=#__codelineno-132-4 id=__codelineno-132-4 name=__codelineno-132-4></a>reg = &lt;0x0 0x02030000 0x0 0x34C&gt;;
<a href=#__codelineno-132-5 id=__codelineno-132-5 name=__codelineno-132-5></a>clocks = &lt;&amp;clk_pll_audio&gt;,
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-133-1 id=__codelineno-133-1 name=__codelineno-133-1></a>&lt;&amp;clk_codec_dac&gt;,
<a href=#__codelineno-133-2 id=__codelineno-133-2 name=__codelineno-133-2></a>&lt;&amp;clk_codec_adc&gt;;
<a href=#__codelineno-133-3 id=__codelineno-133-3 name=__codelineno-133-3></a>status = "disabled";
<a href=#__codelineno-133-4 id=__codelineno-133-4 name=__codelineno-133-4></a>};
<a href=#__codelineno-133-5 id=__codelineno-133-5 name=__codelineno-133-5></a>codec_plat:codec_plat {
<a href=#__codelineno-133-6 id=__codelineno-133-6 name=__codelineno-133-6></a>#sound-dai-cells = &lt;0&gt;;
<a href=#__codelineno-133-7 id=__codelineno-133-7 name=__codelineno-133-7></a>compatible = "allwinner,sunxi-snd-aaudio";
<a href=#__codelineno-133-8 id=__codelineno-133-8 name=__codelineno-133-8></a>playback_cma = &lt;128&gt;;
<a href=#__codelineno-133-9 id=__codelineno-133-9 name=__codelineno-133-9></a>capture_cma = &lt;128&gt;;
<a href=#__codelineno-133-10 id=__codelineno-133-10 name=__codelineno-133-10></a>tx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-133-11 id=__codelineno-133-11 name=__codelineno-133-11></a>rx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-133-12 id=__codelineno-133-12 name=__codelineno-133-12></a>dac_txdata = &lt;0x02030020&gt;;
<a href=#__codelineno-133-13 id=__codelineno-133-13 name=__codelineno-133-13></a>adc_txdata = &lt;0x02030040&gt;;
<a href=#__codelineno-133-14 id=__codelineno-133-14 name=__codelineno-133-14></a>status = "disabled";
<a href=#__codelineno-133-15 id=__codelineno-133-15 name=__codelineno-133-15></a>};
<a href=#__codelineno-133-16 id=__codelineno-133-16 name=__codelineno-133-16></a>codec_mach:codec_mach {
<a href=#__codelineno-133-17 id=__codelineno-133-17 name=__codelineno-133-17></a>compatible = "allwinner,sunxi-snd-mach";
<a href=#__codelineno-133-18 id=__codelineno-133-18 name=__codelineno-133-18></a>soundcard-mach,name = "audiocodec";
<a href=#__codelineno-133-19 id=__codelineno-133-19 name=__codelineno-133-19></a>soundcard-mach,pin-switches = "MIC1", "MIC2", "LINEIN",
<a href=#__codelineno-133-20 id=__codelineno-133-20 name=__codelineno-133-20></a>"LINEOUT", "SPK";
<a href=#__codelineno-133-21 id=__codelineno-133-21 name=__codelineno-133-21></a>soundcard-mach,routing = "MIC1_PIN", "MIC1",
<a href=#__codelineno-133-22 id=__codelineno-133-22 name=__codelineno-133-22></a>"MIC2_PIN", "MIC2",
<a href=#__codelineno-133-23 id=__codelineno-133-23 name=__codelineno-133-23></a>"LINEINL_PIN", "LINEIN",
<a href=#__codelineno-133-24 id=__codelineno-133-24 name=__codelineno-133-24></a>"LINEINR_PIN", "LINEIN",
<a href=#__codelineno-133-25 id=__codelineno-133-25 name=__codelineno-133-25></a>"LINEOUT", "LINEOUTL_PIN",
<a href=#__codelineno-133-26 id=__codelineno-133-26 name=__codelineno-133-26></a>"SPK", "LINEOUTL_PIN";
<a href=#__codelineno-133-27 id=__codelineno-133-27 name=__codelineno-133-27></a>status = "disabled";
<a href=#__codelineno-133-28 id=__codelineno-133-28 name=__codelineno-133-28></a>soundcard-mach,cpu {
<a href=#__codelineno-133-29 id=__codelineno-133-29 name=__codelineno-133-29></a>/* pll freq = 24.576M or 22.5792M * pll-fs */
<a href=#__codelineno-133-30 id=__codelineno-133-30 name=__codelineno-133-30></a>soundcard-mach,pll-fs = &lt;1&gt;;
<a href=#__codelineno-133-31 id=__codelineno-133-31 name=__codelineno-133-31></a>sound-dai = &lt;&amp;codec_plat&gt;;
<a href=#__codelineno-133-32 id=__codelineno-133-32 name=__codelineno-133-32></a>};
<a href=#__codelineno-133-33 id=__codelineno-133-33 name=__codelineno-133-33></a>soundcard-mach,codec {
<a href=#__codelineno-133-34 id=__codelineno-133-34 name=__codelineno-133-34></a>sound-dai = &lt;&amp;codec&gt;;
<a href=#__codelineno-133-35 id=__codelineno-133-35 name=__codelineno-133-35></a>};
<a href=#__codelineno-133-36 id=__codelineno-133-36 name=__codelineno-133-36></a>};
</code></pre></div> <p>配置项说明（仅对常用项进行展开）：</p> <p>AudioCodec模块由 3 个设备树节点构建。</p> <ol> <li>ASoC层codec: codec</li> </ol> <center>表2-128: AudioCodec codec节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>#sound-dai-cells</td> <td>machine层检测codec和platform节点的标志</td> </tr> <tr> <td>reg</td> <td>设置audiocodec寄存器起始地址和地址长度</td> </tr> <tr> <td>clocks</td> <td>设置audiocodec所需的时钟源和模块时钟</td> </tr> </tbody> </table> <ol> <li>ASoC层platform: codec_plat</li> </ol> <center>表2-129: AudioCodec codec_plat节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>#sound-dai-cells</td> <td>machine层检测codec和platform节点的标志</td> </tr> <tr> <td>playback_cma</td> <td>设置播放流DMA申请的size大小，必须为(2ˆn)Kbyte，默认 128</td> </tr> <tr> <td>capture_cma</td> <td>设置录音流DMA申请的size大小，必须为(2ˆn)Kbyte，默认 128</td> </tr> <tr> <td>tx_fifo_size</td> <td>设置播放流snd_pcm_runtime的fifo_size大小，用于声卡硬件参数<br>限定，默认 128</td> </tr> <tr> <td>rx_fifo_size</td> <td>设置录音流snd_pcm_runtime的fifo_size大小，用于声卡硬件参数<br>限定，默认 128</td> </tr> <tr> <td>dac_txdata</td> <td>设置播放流DMA搬运地址（audiocodec模块的tx_fifo寄存器地址）</td> </tr> <tr> <td>adc_txdata</td> <td>设置录音流DMA搬运地址（audiocodec模块的rx_fifo寄存器地址）</td> </tr> </tbody> </table> <ol> <li>ASoC层machine: codec_mach</li> </ol> <center>表2-130: AudioCodec codec_mach节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>soundcard-<br>mach</td> <td>machine层配置前缀</td> </tr> <tr> <td>name</td> <td>声卡名字</td> </tr> <tr> <td>pin-switches</td> <td>用于定义模块接口开关（需参考驱动代码dapm进行设定）</td> </tr> <tr> <td>routing</td> <td>用于定义模块接口开关所链接的dapm通路（需参考驱动代码dapm进<br>行设定）</td> </tr> <tr> <td>cpu</td> <td>machine层所绑定的cpu节点（即platform层），用sound-dai属<br>性指定节点</td> </tr> <tr> <td>codec</td> <td>machine层所绑定的codec节点（即codec层），用sound-dai属<br>性指定节点</td> </tr> <tr> <td>pll-fs</td> <td>指定模块时钟源频率（24.576M or 22.5792M * pll-fs）</td> </tr> </tbody> </table> <p><strong>2.20.3.3.2 board.dts板级配置说明</strong> </p> <p>board.dts用于保存板级平台设备差异化的信息的补充，面对 <strong>板型特性</strong> 进行配置，其配置信息会覆盖device tree默认配置信息，board.dts文件的路径为：/device/config/chips/v853/configs/{BOARD}/board.dts</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-134-1 id=__codelineno-134-1 name=__codelineno-134-1></a>&amp;codec {
<a href=#__codelineno-134-2 id=__codelineno-134-2 name=__codelineno-134-2></a>/* external-avcc; */
<a href=#__codelineno-134-3 id=__codelineno-134-3 name=__codelineno-134-3></a>/* avcc-supply = &lt;&amp;reg_aldo1&gt;; */
<a href=#__codelineno-134-4 id=__codelineno-134-4 name=__codelineno-134-4></a>avcc-vol = &lt;1800000&gt;; /* uv */
<a href=#__codelineno-134-5 id=__codelineno-134-5 name=__codelineno-134-5></a>lineout_vol = &lt;31&gt;;
<a href=#__codelineno-134-6 id=__codelineno-134-6 name=__codelineno-134-6></a>mic1gain = &lt;31&gt;;
<a href=#__codelineno-134-7 id=__codelineno-134-7 name=__codelineno-134-7></a>mic2gain = &lt;31&gt;;
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-135-1 id=__codelineno-135-1 name=__codelineno-135-1></a>adcdelaytime = &lt;0&gt;;
<a href=#__codelineno-135-2 id=__codelineno-135-2 name=__codelineno-135-2></a>/* lineout-single; */
<a href=#__codelineno-135-3 id=__codelineno-135-3 name=__codelineno-135-3></a>/* mic1-single; */
<a href=#__codelineno-135-4 id=__codelineno-135-4 name=__codelineno-135-4></a>/* mic2-single; */
<a href=#__codelineno-135-5 id=__codelineno-135-5 name=__codelineno-135-5></a>pa_pin_max = &lt;1&gt;; /* set pa */
<a href=#__codelineno-135-6 id=__codelineno-135-6 name=__codelineno-135-6></a>pa_pin_0 = &lt;&amp;pio PH 4 1 1 1 1&gt;;
<a href=#__codelineno-135-7 id=__codelineno-135-7 name=__codelineno-135-7></a>pa_pin_level_0 = &lt;1&gt;;
<a href=#__codelineno-135-8 id=__codelineno-135-8 name=__codelineno-135-8></a>pa_pin_msleep_0 = &lt;0&gt;;
<a href=#__codelineno-135-9 id=__codelineno-135-9 name=__codelineno-135-9></a>tx_hub_en;
<a href=#__codelineno-135-10 id=__codelineno-135-10 name=__codelineno-135-10></a>rx_sync_en;
<a href=#__codelineno-135-11 id=__codelineno-135-11 name=__codelineno-135-11></a>status = "okay";
<a href=#__codelineno-135-12 id=__codelineno-135-12 name=__codelineno-135-12></a>};
<a href=#__codelineno-135-13 id=__codelineno-135-13 name=__codelineno-135-13></a>&amp;codec_plat {
<a href=#__codelineno-135-14 id=__codelineno-135-14 name=__codelineno-135-14></a>status = "okay";
<a href=#__codelineno-135-15 id=__codelineno-135-15 name=__codelineno-135-15></a>};
<a href=#__codelineno-135-16 id=__codelineno-135-16 name=__codelineno-135-16></a>&amp;codec_mach {
<a href=#__codelineno-135-17 id=__codelineno-135-17 name=__codelineno-135-17></a>status = "okay";
<a href=#__codelineno-135-18 id=__codelineno-135-18 name=__codelineno-135-18></a>soundcard-mach,cpu {
<a href=#__codelineno-135-19 id=__codelineno-135-19 name=__codelineno-135-19></a>sound-dai = &lt;&amp;codec_plat&gt;;
<a href=#__codelineno-135-20 id=__codelineno-135-20 name=__codelineno-135-20></a>};
<a href=#__codelineno-135-21 id=__codelineno-135-21 name=__codelineno-135-21></a>soundcard-mach,codec {
<a href=#__codelineno-135-22 id=__codelineno-135-22 name=__codelineno-135-22></a>sound-dai = &lt;&amp;codec&gt;;
<a href=#__codelineno-135-23 id=__codelineno-135-23 name=__codelineno-135-23></a>};
<a href=#__codelineno-135-24 id=__codelineno-135-24 name=__codelineno-135-24></a>};
</code></pre></div> <p>配置项介绍：</p> <center>表2-131: AudioCodec模块板级配置项</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置值范围</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>status</td> <td>“okay”, “disabled”</td> <td>使能或关闭该节点驱动</td> </tr> <tr> <td>avcc-external</td> <td>注释为false,反之为<br>ture</td> <td>avcc电源是否为外围电路提供</td> </tr> <tr> <td>avcc-supply</td> <td>注释,引用pmu提供的<br>电源节点</td> <td>avcc若为外部pmu供电，可选择该项指定<br>对应的pmu电源</td> </tr> <tr> <td>avcc-vol u32</td> <td>（缺省值:<br>1800000 ）</td> <td>avcc电压值设定，单位uV，需符合实际硬<br>件需求</td> </tr> <tr> <td>dvcc-external</td> <td>注释为false,反之为<br>ture</td> <td>dvcc电源是否为外围电路提供</td> </tr> <tr> <td>dvcc-supply</td> <td>注释,引用pmu提供的<br>电源节点</td> <td>dvcc若为外部pmu供电，可选择该项指定<br>对应的pmu电源</td> </tr> <tr> <td>dvcc-vol</td> <td>u32（缺省值:<br>1800000 ）</td> <td>dvcc电压值设定，单位uV，需符合实际硬<br>件需求</td> </tr> <tr> <td>adc-dig-vol-<br>(n)</td> <td>0~255</td> <td>adc(n)数字音量，(n)代表adc序号，从 1<br>开始递增</td> </tr> <tr> <td>mic(n)_vol</td> <td>0~31</td> <td>mic(n)默认输入音量（增益），(n)代表<br>mic序号，从 1 开始递增</td> </tr> <tr> <td>dac-dig-vol</td> <td>0~63 dac</td> <td>数字总音量</td> </tr> <tr> <td>dac-dig-vol-<br>(n)</td> <td>0~255</td> <td>dac(n)数字音量，(n)代表dac序号，从 1<br>开始递增</td> </tr> <tr> <td>lineout-vol</td> <td>0~31</td> <td>lineout默认输出音量（增益）</td> </tr> <tr> <td>hp-vol</td> <td>0~7</td> <td>耳机默认输出音量（增益）</td> </tr> <tr> <td>pa-pin-max</td> <td>u32（正常为 1 或 2 ）</td> <td>标定外部功放芯片使能引脚数量</td> </tr> <tr> <td>pa-pin-(n)</td> <td>pio提供的引脚节点</td> <td>指定第(n)个功放使能引脚</td> </tr> <tr> <td>pa-pin-level-<br>(n)</td> <td>0~1</td> <td>指定功放芯片使能电平</td> </tr> <tr> <td>pa-pin-<br>msleep-(n)</td> <td>u32（正常小于 200 ）</td> <td>设置功放芯片使能所需的sleep时长，用于<br>规避pop声，单位ms</td> </tr> <tr> <td>adcdelaytime</td> <td>u32（需符合IC规格）</td> <td>设置adc录音延迟时长，单位ms</td> </tr> <tr> <td>tx-hub-en</td> <td>注释为false,反之为<br>ture</td> <td>选择是否注册txhub控件</td> </tr> <tr> <td>rx-sync-en</td> <td>注释为false,反之为<br>ture</td> <td>选择是否注册rxsync控件</td> </tr> </tbody> </table> <h4 id=22034-codec>2.20.3.4 codec数据通路</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-136-1 id=__codelineno-136-1 name=__codelineno-136-1></a>通过Lineout播歌
<a href=#__codelineno-136-2 id=__codelineno-136-2 name=__codelineno-136-2></a>Playback --&gt; DACL --&gt; LINEOUTL Output Select --&gt; LINEOUTL --&gt; LINEOUT
<a href=#__codelineno-136-3 id=__codelineno-136-3 name=__codelineno-136-3></a>Playback --&gt; DACR --&gt; LINEOUTR Output Select --&gt; LINEOUTR --&gt; LINEOUT
<a href=#__codelineno-136-4 id=__codelineno-136-4 name=__codelineno-136-4></a>录音
<a href=#__codelineno-136-5 id=__codelineno-136-5 name=__codelineno-136-5></a>MIC1 --&gt; MIC1 Input Select --&gt; ADC1 Input --&gt; ADC1 --&gt; Capture
<a href=#__codelineno-136-6 id=__codelineno-136-6 name=__codelineno-136-6></a>MIC2 --&gt; MIC2 Input Select --&gt; ADC2 Input --&gt; ADC2 --&gt; Capture
<a href=#__codelineno-136-7 id=__codelineno-136-7 name=__codelineno-136-7></a>LINE-in录音
<a href=#__codelineno-136-8 id=__codelineno-136-8 name=__codelineno-136-8></a>LINEINL --&gt; ADC1 Input --&gt; ADC1 --&gt; Capture
<a href=#__codelineno-136-9 id=__codelineno-136-9 name=__codelineno-136-9></a>LINEINR --&gt; ADC2 Input --&gt; ADC2 --&gt; Capture
</code></pre></div> <p>V853所有控件如下表：</p> <center>表2-132: amixer控件表</center> <table> <thead> <tr> <th>控件名称</th> <th>功能</th> <th>数值</th> </tr> </thead> <tbody> <tr> <td>ADC1 ADC2 swap</td> <td>将adc1和adc2进行通道<br>交换</td> <td></td> </tr> <tr> <td>ADC1 volume</td> <td>ADC1数字音量设置</td> <td>0~0xFF, 0:Mute;<br>1<sub>0xFF:-119.25dB</sub> 71.24dB,<br>0.75dB/step,默认0xA0=0dB</td> </tr> <tr> <td>ADC2 volume</td> <td>ADC2数字音量设置</td> <td>0~0xFF, 0:Mute;<br>1<sub>0xFF:-119.25dB</sub> 71.24dB,<br>0.75dB/step,默认0xA0=0dB</td> </tr> <tr> <td>ADCDRC</td> <td>开启ADC DRC功能</td> <td></td> </tr> <tr> <td>ADCHPF</td> <td>开启adc hpf功能</td> <td></td> </tr> <tr> <td>DAC volume</td> <td>DACL,DACR音量设置</td> <td>0~0xFF, 0:Mute;<br>1<sub>0xFF:-119.25dB</sub> 71.24dB,<br>0.75dB/step,默认0xA0=0dB</td> </tr> <tr> <td>DACDRC</td> <td>开启dac drc功能</td> <td></td> </tr> <tr> <td>DACHPF</td> <td>开启dac hpf功能</td> <td></td> </tr> <tr> <td>LINEIN Switch</td> <td>是否使能ADC-&gt;LINEIN<br>的通路</td> <td>0:关闭; 1:使能</td> </tr> <tr> <td>LINEINL gain<br>volume</td> <td>LINEINL增益</td> <td>0:0dB; 1:6dB</td> </tr> <tr> <td>LINEINR gain<br>volume</td> <td>LINEINR增益</td> <td>0:0dB; 1:6dB</td> </tr> <tr> <td>LINEOUT Output<br>Select</td> <td>Lineout输出选择</td> <td>0:单端; 1:差分</td> </tr> <tr> <td>LINEOUT Switch</td> <td>是否使能Lineout通路</td> <td>0:关闭; 1:使能</td> </tr> <tr> <td>LINEOUT volume</td> <td>Lineout音量设置</td> <td>0<sub>31,表示-43.5</sub>0dB</td> </tr> <tr> <td>MIC1 Input Select</td> <td>MIC1输入模式</td> <td>0:差分输入; 1:单端输入</td> </tr> <tr> <td>MIC1 Switch</td> <td>是否使能ADC1-&gt;MIC1的<br>通路</td> <td>0:关闭; 1:使能</td> </tr> <tr> <td>MIC1 gain volume</td> <td>MIC1增益</td> <td>0<sub>31,表示0</sub>36dB, 0:0dB,1<sub>3:6dB,<br>4</sub>31:9~36dB, 1dB/step</td> </tr> <tr> <td>MIC2 Input Select</td> <td>MIC2输入模式</td> <td>0:差分输入; 1:单端输入</td> </tr> <tr> <td>MIC2 Switch</td> <td>是否使能ADC2-&gt;MIC2的<br>通路</td> <td>0:关闭; 1:使能</td> </tr> <tr> <td>MIC2 gain volume</td> <td>MIC2增益</td> <td>0<sub>31,表示0</sub>36dB, 0:0dB,1<sub>3:6dB,<br>4</sub>31:9~36dB, 1dB/step</td> </tr> <tr> <td>SPK Switch</td> <td>是否使能Speaker通路(使<br>用功放)</td> <td>0:关闭; 1:使能</td> </tr> <tr> <td>digital volume</td> <td>数字端音量设置</td> <td>0<sub>63,表示-73.08</sub>0dB</td> </tr> <tr> <td>rx sync mode</td> <td>使能同步录音（和其它开启<br>rx sync mode的声卡）</td> <td></td> </tr> <tr> <td>tx hub mode</td> <td>使能同源播放（和其它开启<br>tx hub mode的声卡）</td> <td></td> </tr> </tbody> </table> <h3 id=2204-daudio>2.20.4 Daudio</h3> <h4 id=22041>2.20.4.1硬件特性</h4> <p>• 两路I2S/PCM,可用于蓝牙通话，语音采集，数字功放；</p> <p>• 支持主从模式</p> <ul> <li>支持Left-justified,Right-justified,Standar mode I2S,PCM mode</li> <li>支持i2s,pcm协议格式配置</li> <li>支持同时playback和record(全双工模式)</li> <li>支持8~192KHz采样率</li> <li>支持16,24,32bit采样精度</li> <li>支持 2 路MCLK输出</li> </ul> <h4 id=22042>2.20.4.2内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-137-1 id=__codelineno-137-1 name=__codelineno-137-1></a>Device Drivers ---&gt;
<a href=#__codelineno-137-2 id=__codelineno-137-2 name=__codelineno-137-2></a>    &lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-137-3 id=__codelineno-137-3 name=__codelineno-137-3></a>        &lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-137-4 id=__codelineno-137-4 name=__codelineno-137-4></a>            &lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-137-5 id=__codelineno-137-5 name=__codelineno-137-5></a>                Allwinner SoC Audio support V2 ---&gt;
<a href=#__codelineno-137-6 id=__codelineno-137-6 name=__codelineno-137-6></a>                &lt;*&gt; Allwinner AAUDIO support
<a href=#__codelineno-137-7 id=__codelineno-137-7 name=__codelineno-137-7></a>                &lt;*&gt; Allwinner DAUDIO Support
<a href=#__codelineno-137-8 id=__codelineno-137-8 name=__codelineno-137-8></a>                &lt;*&gt; Allwinner Function Components
<a href=#__codelineno-137-9 id=__codelineno-137-9 name=__codelineno-137-9></a>                &lt;*&gt; Components Rx Sync
</code></pre></div> <h4 id=22043-dts>2.20.4.3 DTS配置.</h4> <p><strong>2.20.4.3.1 DeviceTree 配置说明</strong> 设备树为芯片平台的模块配置，面对芯片特性进行配置，设备树文件的路径为：lichee/linux-4.9/arch/arm/boot/dts/sun8iw21p1.dtsi</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-138-1 id=__codelineno-138-1 name=__codelineno-138-1></a>daudio0_plat:daudio0_plat@0x02032000 {
<a href=#__codelineno-138-2 id=__codelineno-138-2 name=__codelineno-138-2></a>#sound-dai-cells = &lt;0&gt;;
<a href=#__codelineno-138-3 id=__codelineno-138-3 name=__codelineno-138-3></a>compatible = "allwinner,sunxi-snd-plat-daudio";
<a href=#__codelineno-138-4 id=__codelineno-138-4 name=__codelineno-138-4></a>reg = &lt;0x0 0x02032000 0x0 0x7c&gt;;
<a href=#__codelineno-138-5 id=__codelineno-138-5 name=__codelineno-138-5></a>clocks = &lt;&amp;clk_pll_audio&gt;, &lt;&amp;clk_i2s0&gt;;
<a href=#__codelineno-138-6 id=__codelineno-138-6 name=__codelineno-138-6></a>playback_cma = &lt;128&gt;;
<a href=#__codelineno-138-7 id=__codelineno-138-7 name=__codelineno-138-7></a>capture_cma = &lt;128&gt;;
<a href=#__codelineno-138-8 id=__codelineno-138-8 name=__codelineno-138-8></a>tx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-138-9 id=__codelineno-138-9 name=__codelineno-138-9></a>rx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-138-10 id=__codelineno-138-10 name=__codelineno-138-10></a>status = "disabled";
<a href=#__codelineno-138-11 id=__codelineno-138-11 name=__codelineno-138-11></a>};
<a href=#__codelineno-138-12 id=__codelineno-138-12 name=__codelineno-138-12></a>daudio0_mach:daudio0_mach{
<a href=#__codelineno-138-13 id=__codelineno-138-13 name=__codelineno-138-13></a>compatible = "allwinner,sunxi-snd-mach";
<a href=#__codelineno-138-14 id=__codelineno-138-14 name=__codelineno-138-14></a>soundcard-mach,format = "i2s";
<a href=#__codelineno-138-15 id=__codelineno-138-15 name=__codelineno-138-15></a>soundcard-mach,name = "snddaudio0";
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-139-1 id=__codelineno-139-1 name=__codelineno-139-1></a>status = "disabled";
<a href=#__codelineno-139-2 id=__codelineno-139-2 name=__codelineno-139-2></a>soundcard-mach,cpu {
<a href=#__codelineno-139-3 id=__codelineno-139-3 name=__codelineno-139-3></a>sound-dai = &lt;&amp;daudio0_plat&gt;;
<a href=#__codelineno-139-4 id=__codelineno-139-4 name=__codelineno-139-4></a>};
<a href=#__codelineno-139-5 id=__codelineno-139-5 name=__codelineno-139-5></a>soundcard-mach,codec {
<a href=#__codelineno-139-6 id=__codelineno-139-6 name=__codelineno-139-6></a>};
<a href=#__codelineno-139-7 id=__codelineno-139-7 name=__codelineno-139-7></a>};
<a href=#__codelineno-139-8 id=__codelineno-139-8 name=__codelineno-139-8></a>daudio1_plat:daudio1_plat@0x02033000 {
<a href=#__codelineno-139-9 id=__codelineno-139-9 name=__codelineno-139-9></a>#sound-dai-cells = &lt;0&gt;;
<a href=#__codelineno-139-10 id=__codelineno-139-10 name=__codelineno-139-10></a>compatible = "allwinner,sunxi-snd-plat-daudio";
<a href=#__codelineno-139-11 id=__codelineno-139-11 name=__codelineno-139-11></a>reg = &lt;0x0 0x02033000 0x0 0x7c&gt;;
<a href=#__codelineno-139-12 id=__codelineno-139-12 name=__codelineno-139-12></a>clocks = &lt;&amp;clk_pll_audio&gt;, &lt;&amp;clk_i2s1&gt;;
<a href=#__codelineno-139-13 id=__codelineno-139-13 name=__codelineno-139-13></a>playback_cma = &lt;128&gt;;
<a href=#__codelineno-139-14 id=__codelineno-139-14 name=__codelineno-139-14></a>capture_cma = &lt;128&gt;;
<a href=#__codelineno-139-15 id=__codelineno-139-15 name=__codelineno-139-15></a>tx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-139-16 id=__codelineno-139-16 name=__codelineno-139-16></a>rx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-139-17 id=__codelineno-139-17 name=__codelineno-139-17></a>status = "disabled";
<a href=#__codelineno-139-18 id=__codelineno-139-18 name=__codelineno-139-18></a>};
<a href=#__codelineno-139-19 id=__codelineno-139-19 name=__codelineno-139-19></a>daudio1_mach:daudio1_mach{
<a href=#__codelineno-139-20 id=__codelineno-139-20 name=__codelineno-139-20></a>compatible = "allwinner,sunxi-snd-mach";
<a href=#__codelineno-139-21 id=__codelineno-139-21 name=__codelineno-139-21></a>soundcard-mach,format = "i2s";
<a href=#__codelineno-139-22 id=__codelineno-139-22 name=__codelineno-139-22></a>soundcard-mach,name = "snddaudio1";
<a href=#__codelineno-139-23 id=__codelineno-139-23 name=__codelineno-139-23></a>status = "disabled";
<a href=#__codelineno-139-24 id=__codelineno-139-24 name=__codelineno-139-24></a>soundcard-mach,cpu {
<a href=#__codelineno-139-25 id=__codelineno-139-25 name=__codelineno-139-25></a>sound-dai = &lt;&amp;daudio1_plat&gt;;
<a href=#__codelineno-139-26 id=__codelineno-139-26 name=__codelineno-139-26></a>};
<a href=#__codelineno-139-27 id=__codelineno-139-27 name=__codelineno-139-27></a>soundcard-mach,codec {
<a href=#__codelineno-139-28 id=__codelineno-139-28 name=__codelineno-139-28></a>};
<a href=#__codelineno-139-29 id=__codelineno-139-29 name=__codelineno-139-29></a>};
</code></pre></div> <p>配置项说明（仅对常用项进行展开）：</p> <p>I2S/PCM模块由 2 个或 3 个设备树节点构建。</p> <ol> <li>ASoC层codec:非必须节点，若无，则绑定虚拟codec节点。</li> <li>ASoC层platform: daudio(n)_plat</li> </ol> <center>表2-133: I2S/PCM daudio(n)_plat节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>#sound-dai-cells</td> <td>machine层检测codec和platform节点的标志</td> </tr> <tr> <td>reg</td> <td>设置I2S/PCM寄存器起始地址和地址长度</td> </tr> <tr> <td>clocks</td> <td>设置I2S/PCM所需的时钟源和模块时钟</td> </tr> <tr> <td>playback_cma</td> <td>设置播放流DMA申请的size大小，必须为(2ˆn)Kbyte，默认 128</td> </tr> <tr> <td>capture_cma</td> <td>设置录音流DMA申请的size大小，必须为(2ˆn)Kbyte，默认 128</td> </tr> <tr> <td>tx_fifo_size</td> <td>设置播放流snd_pcm_runtime的fifo_size大小，用于声卡硬件参数<br>限定，默认 128</td> </tr> <tr> <td>rx_fifo_size</td> <td>设置录音流snd_pcm_runtime的fifo_size大小，用于声卡硬件参数<br>限定，默认 128</td> </tr> </tbody> </table> <ol> <li>ASoC层machine: daudio(n)_mach</li> </ol> <center>表2-134: I2S/PCM daudio(n)_mach节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>soundcard-mach</td> <td>machine层配置前缀</td> </tr> <tr> <td>name</td> <td>声卡名字</td> </tr> <tr> <td>cpu</td> <td>machine层所绑定的cpu节点（即platform层），用<br>sound-dai属性指定节点</td> </tr> <tr> <td>codec</td> <td>machine层所绑定的codec节点（即codec层），用<br>sound-dai属性指定节点。若该子节点下无sound-dai属性，<br>即代表使用虚拟codec，用于辅助生成声卡</td> </tr> <tr> <td>pll-fs</td> <td>指定模块时钟源频率（24.576M or 22.5792M * pll-fs）</td> </tr> </tbody> </table> <p><strong>说明</strong></p> <ul> <li><strong><em>daudio(n)_plat</em></strong> <strong>代表</strong> <strong><em>daudio0_plat, daudio1_plat,</em></strong> <strong>···（取决于芯片规格）；</strong></li> <li><strong><em>daudio(n)_mach</em></strong> <strong>代表</strong> <strong><em>daudio0_mach, daudio1_mach,</em></strong> <strong>···（取决于芯片规格）；</strong></li> </ul> <p><strong>2.20.4.3.2 board.dts板级配置说明</strong> board.dts用于保存板级平台设备差异化的信息的补 充，面对 <strong>板型特性</strong> 进行配置，其配置信息会覆盖device tree默认配置信息，board.dts文件的 路径为：/device/config/chips/v853/configs/{BOARD}/board.dts</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-140-1 id=__codelineno-140-1 name=__codelineno-140-1></a>&amp;daudio0_plat {
<a href=#__codelineno-140-2 id=__codelineno-140-2 name=__codelineno-140-2></a>tdm_num = &lt;0&gt;;
<a href=#__codelineno-140-3 id=__codelineno-140-3 name=__codelineno-140-3></a>tx_pin = &lt;0&gt;;
<a href=#__codelineno-140-4 id=__codelineno-140-4 name=__codelineno-140-4></a>rx_pin = &lt;0&gt;;
<a href=#__codelineno-140-5 id=__codelineno-140-5 name=__codelineno-140-5></a>/* pinctrl_used; */
<a href=#__codelineno-140-6 id=__codelineno-140-6 name=__codelineno-140-6></a>/* pinctrl-names= "default","sleep"; */
<a href=#__codelineno-140-7 id=__codelineno-140-7 name=__codelineno-140-7></a>/* pinctrl-0 = &lt;&amp;daudio0_pins_a&gt;; */
<a href=#__codelineno-140-8 id=__codelineno-140-8 name=__codelineno-140-8></a>/* pinctrl-1 = &lt;&amp;daudio0_pins_b&gt;; */
<a href=#__codelineno-140-9 id=__codelineno-140-9 name=__codelineno-140-9></a>tx_hub_en;
<a href=#__codelineno-140-10 id=__codelineno-140-10 name=__codelineno-140-10></a>rx_sync_en;
<a href=#__codelineno-140-11 id=__codelineno-140-11 name=__codelineno-140-11></a>status = "okay";
<a href=#__codelineno-140-12 id=__codelineno-140-12 name=__codelineno-140-12></a>};
<a href=#__codelineno-140-13 id=__codelineno-140-13 name=__codelineno-140-13></a>&amp;daudio0_mach {
<a href=#__codelineno-140-14 id=__codelineno-140-14 name=__codelineno-140-14></a>soundcard-mach,format = "i2s";
<a href=#__codelineno-140-15 id=__codelineno-140-15 name=__codelineno-140-15></a>soundcard-mach,frame-master = &lt;&amp;daudio0_cpu&gt;;
<a href=#__codelineno-140-16 id=__codelineno-140-16 name=__codelineno-140-16></a>soundcard-mach,bitclock-master = &lt;&amp;daudio0_cpu&gt;;
<a href=#__codelineno-140-17 id=__codelineno-140-17 name=__codelineno-140-17></a>/* soundcard-mach,frame-inversion; */
<a href=#__codelineno-140-18 id=__codelineno-140-18 name=__codelineno-140-18></a>/* soundcard-mach,bitclock-inversion; */
<a href=#__codelineno-140-19 id=__codelineno-140-19 name=__codelineno-140-19></a>soundcard-mach,slot-num = &lt;2&gt;;
<a href=#__codelineno-140-20 id=__codelineno-140-20 name=__codelineno-140-20></a>soundcard-mach,slot-width = &lt;32&gt;;
<a href=#__codelineno-140-21 id=__codelineno-140-21 name=__codelineno-140-21></a>status = "okay";
<a href=#__codelineno-140-22 id=__codelineno-140-22 name=__codelineno-140-22></a>daudio0_cpu: soundcard-mach,cpu {
<a href=#__codelineno-140-23 id=__codelineno-140-23 name=__codelineno-140-23></a>sound-dai = &lt;&amp;daudio0_plat&gt;;
<a href=#__codelineno-140-24 id=__codelineno-140-24 name=__codelineno-140-24></a>soundcard-mach,pll-fs = &lt;1&gt;; /* pll freq = 24.576M or 22.5792M * pll-fs */
<a href=#__codelineno-140-25 id=__codelineno-140-25 name=__codelineno-140-25></a>soundcard-mach,mclk-fs = &lt;0&gt;; /* mclk freq = pcm rate * mclk-fs */
<a href=#__codelineno-140-26 id=__codelineno-140-26 name=__codelineno-140-26></a>};
<a href=#__codelineno-140-27 id=__codelineno-140-27 name=__codelineno-140-27></a>daudio0_codec: soundcard-mach,codec {
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-141-1 id=__codelineno-141-1 name=__codelineno-141-1></a>};
<a href=#__codelineno-141-2 id=__codelineno-141-2 name=__codelineno-141-2></a>};
<a href=#__codelineno-141-3 id=__codelineno-141-3 name=__codelineno-141-3></a>&amp;daudio1_plat {
<a href=#__codelineno-141-4 id=__codelineno-141-4 name=__codelineno-141-4></a>tdm_num = &lt;1&gt;;
<a href=#__codelineno-141-5 id=__codelineno-141-5 name=__codelineno-141-5></a>tx_pin = &lt;0&gt;;
<a href=#__codelineno-141-6 id=__codelineno-141-6 name=__codelineno-141-6></a>rx_pin = &lt;0&gt;;
<a href=#__codelineno-141-7 id=__codelineno-141-7 name=__codelineno-141-7></a>/* pinctrl_used; */
<a href=#__codelineno-141-8 id=__codelineno-141-8 name=__codelineno-141-8></a>/* pinctrl-names= "default","sleep"; */
<a href=#__codelineno-141-9 id=__codelineno-141-9 name=__codelineno-141-9></a>/* pinctrl-0 = &lt;&amp;daudio1_pins_a&gt;; */
<a href=#__codelineno-141-10 id=__codelineno-141-10 name=__codelineno-141-10></a>/* pinctrl-1 = &lt;&amp;daudio1_pins_b&gt;; */
<a href=#__codelineno-141-11 id=__codelineno-141-11 name=__codelineno-141-11></a>tx_hub_en;
<a href=#__codelineno-141-12 id=__codelineno-141-12 name=__codelineno-141-12></a>rx_sync_en;
<a href=#__codelineno-141-13 id=__codelineno-141-13 name=__codelineno-141-13></a>status = "disabled";
<a href=#__codelineno-141-14 id=__codelineno-141-14 name=__codelineno-141-14></a>};
<a href=#__codelineno-141-15 id=__codelineno-141-15 name=__codelineno-141-15></a>&amp;daudio1_mach {
<a href=#__codelineno-141-16 id=__codelineno-141-16 name=__codelineno-141-16></a>soundcard-mach,format = "i2s";
<a href=#__codelineno-141-17 id=__codelineno-141-17 name=__codelineno-141-17></a>soundcard-mach,frame-master = &lt;&amp;daudio1_cpu&gt;;
<a href=#__codelineno-141-18 id=__codelineno-141-18 name=__codelineno-141-18></a>soundcard-mach,bitclock-master = &lt;&amp;daudio1_cpu&gt;;
<a href=#__codelineno-141-19 id=__codelineno-141-19 name=__codelineno-141-19></a>/* soundcard-mach,frame-inversion; */
<a href=#__codelineno-141-20 id=__codelineno-141-20 name=__codelineno-141-20></a>/* soundcard-mach,bitclock-inversion; */
<a href=#__codelineno-141-21 id=__codelineno-141-21 name=__codelineno-141-21></a>soundcard-mach,slot-num = &lt;2&gt;;
<a href=#__codelineno-141-22 id=__codelineno-141-22 name=__codelineno-141-22></a>soundcard-mach,slot-width = &lt;32&gt;;
<a href=#__codelineno-141-23 id=__codelineno-141-23 name=__codelineno-141-23></a>status = "disabled";
<a href=#__codelineno-141-24 id=__codelineno-141-24 name=__codelineno-141-24></a>daudio1_cpu: soundcard-mach,cpu {
<a href=#__codelineno-141-25 id=__codelineno-141-25 name=__codelineno-141-25></a>sound-dai = &lt;&amp;daudio1_plat&gt;;
<a href=#__codelineno-141-26 id=__codelineno-141-26 name=__codelineno-141-26></a>soundcard-mach,pll-fs = &lt;1&gt;; /* pll freq = 24.576M or 22.5792M * pll-fs */
<a href=#__codelineno-141-27 id=__codelineno-141-27 name=__codelineno-141-27></a>soundcard-mach,mclk-fs = &lt;0&gt;; /* mclk freq = pcm rate * mclk-fs */
<a href=#__codelineno-141-28 id=__codelineno-141-28 name=__codelineno-141-28></a>};
<a href=#__codelineno-141-29 id=__codelineno-141-29 name=__codelineno-141-29></a>daudio1_codec: soundcard-mach,codec {
<a href=#__codelineno-141-30 id=__codelineno-141-30 name=__codelineno-141-30></a>};
<a href=#__codelineno-141-31 id=__codelineno-141-31 name=__codelineno-141-31></a>};
</code></pre></div> <p>配置项介绍：</p> <center>表2-135: I2S/PCM模块板级配置项</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置值范围</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>status</td> <td>“okay”, “disabled”</td> <td>使能或关闭该节点驱动</td> </tr> <tr> <td>tdm-num</td> <td>0~3</td> <td>指定I2S序号，需和daudio(n)_plat的(n)<br>对应</td> </tr> <tr> <td>tx-pin</td> <td>0~3</td> <td>指定I2S所使用的DOUT引脚序号</td> </tr> <tr> <td>rx-pin</td> <td>0~3</td> <td>指定I2S所使用的DIN引脚序号</td> </tr> <tr> <td>tx-hub-en</td> <td>注释为false,反之为<br>ture</td> <td>选择是否注册txhub控件</td> </tr> <tr> <td>rx-sync-en</td> <td>注释为false,反之为<br>ture</td> <td>选择是否注册rxsync控件</td> </tr> <tr> <td>format</td> <td>“i2s”,“right_j”,“left_j”,<br>“dsp_a”,“dsp_b”</td> <td>选择tdm协议格式</td> </tr> <tr> <td>frame-master</td> <td>cpu子节点，codec子<br>节点</td> <td>选择LRCK信号主模式</td> </tr> <tr> <td>bitclock-<br>master</td> <td>cpu子节点，codec子<br>节点</td> <td>选择BCLK信号主模式</td> </tr> <tr> <td>frame-<br>inversion</td> <td>注释为false,反之为<br>ture</td> <td>LRCK信号是否翻转</td> </tr> <tr> <td>bitclock-<br>inversion</td> <td>注释为false,反之为<br>ture</td> <td>BCLK信号是否翻转</td> </tr> <tr> <td>slot-num</td> <td>1~16</td> <td>slot数量（可简单理解为支持最大通道数）</td> </tr> <tr> <td>slot-width</td> <td>8, 16, 24, 32</td> <td>单个slot宽度（可简单理解为支持最大数据精<br>度）</td> </tr> <tr> <td>mclk-fp</td> <td>注释为false,反之为<br>ture</td> <td>ture: mclk以固定频段输出；false: mclk以<br>采样率倍数输出</td> </tr> <tr> <td>mclk-fs</td> <td>u32</td> <td>固定频段：mclk = mclk-fs * 12.288M or 11.2896M<br>采样率倍数：mclk = mclk-fs * pcm rate</td> </tr> </tbody> </table> <h3 id=2205-dmic>2.20.5 DMIC.</h3> <p>硬件特性</p> <p>• 支持 4 路输入</p> <ul> <li>支持8~48KHz采样率</li> <li>支持16/24bit采样精度</li> </ul> <h4 id=22051>2.20.5.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-142-1 id=__codelineno-142-1 name=__codelineno-142-1></a>Device Drivers ---&gt;
<a href=#__codelineno-142-2 id=__codelineno-142-2 name=__codelineno-142-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-142-3 id=__codelineno-142-3 name=__codelineno-142-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-142-4 id=__codelineno-142-4 name=__codelineno-142-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-142-5 id=__codelineno-142-5 name=__codelineno-142-5></a>Allwinner SoC Audio support V2 ---&gt;
<a href=#__codelineno-142-6 id=__codelineno-142-6 name=__codelineno-142-6></a>&lt;*&gt; Allwinner DMIC support
</code></pre></div> <h4 id=22052-dts>2.20.5.2 DTS配置.</h4> <p><strong>2.20.5.2.1 DeviceTree 配置说明</strong> 设备树为芯片平台的模块配置，面对芯片特性进行配 置，设备树文件的路径为：lichee/linux-4.9/arch/arm/boot/dts/sun8iw21p1.dtsi</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-143-1 id=__codelineno-143-1 name=__codelineno-143-1></a>dmic_plat:dmic_plat@0x02031000 {
<a href=#__codelineno-143-2 id=__codelineno-143-2 name=__codelineno-143-2></a>#sound-dai-cells = &lt;0&gt;;
<a href=#__codelineno-143-3 id=__codelineno-143-3 name=__codelineno-143-3></a>compatible = "allwinner,sunxi-snd-plat-dmic";
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-144-1 id=__codelineno-144-1 name=__codelineno-144-1></a>reg = &lt;0x0 0x02031000 0x0 0x50&gt;;
<a href=#__codelineno-144-2 id=__codelineno-144-2 name=__codelineno-144-2></a>clocks = &lt;&amp;clk_pll_audio&gt;, &lt;&amp;clk_dmic&gt;;
<a href=#__codelineno-144-3 id=__codelineno-144-3 name=__codelineno-144-3></a>capture_cma = &lt;128&gt;;
<a href=#__codelineno-144-4 id=__codelineno-144-4 name=__codelineno-144-4></a>rx_fifo_size = &lt;128&gt;;
<a href=#__codelineno-144-5 id=__codelineno-144-5 name=__codelineno-144-5></a>status = "disabled";
<a href=#__codelineno-144-6 id=__codelineno-144-6 name=__codelineno-144-6></a>};
<a href=#__codelineno-144-7 id=__codelineno-144-7 name=__codelineno-144-7></a>dmic_mach:dmic_mach{
<a href=#__codelineno-144-8 id=__codelineno-144-8 name=__codelineno-144-8></a>compatible = "allwinner,sunxi-snd-mach";
<a href=#__codelineno-144-9 id=__codelineno-144-9 name=__codelineno-144-9></a>soundcard-mach,name = "snddmic";
<a href=#__codelineno-144-10 id=__codelineno-144-10 name=__codelineno-144-10></a>soundcard-mach,capture_only;
<a href=#__codelineno-144-11 id=__codelineno-144-11 name=__codelineno-144-11></a>status = "disabled";
<a href=#__codelineno-144-12 id=__codelineno-144-12 name=__codelineno-144-12></a>soundcard-mach,cpu {
<a href=#__codelineno-144-13 id=__codelineno-144-13 name=__codelineno-144-13></a>sound-dai = &lt;&amp;dmic_plat&gt;;
<a href=#__codelineno-144-14 id=__codelineno-144-14 name=__codelineno-144-14></a>};
<a href=#__codelineno-144-15 id=__codelineno-144-15 name=__codelineno-144-15></a>soundcard-mach,codec {
<a href=#__codelineno-144-16 id=__codelineno-144-16 name=__codelineno-144-16></a>};
<a href=#__codelineno-144-17 id=__codelineno-144-17 name=__codelineno-144-17></a>};
</code></pre></div> <p>配置项说明（仅对常用项进行展开）：</p> <p>DMIC模块由 2 个设备树节点构建。</p> <ol> <li>ASoC层codec:无，绑定虚拟codec节点。</li> <li>ASoC层platform: dmic_plat</li> </ol> <center>表2-136: DMIC dmic_plat节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>#sound-dai-cells</td> <td>machine层检测codec和platform节点的标志</td> </tr> <tr> <td>reg</td> <td>设置DMIC寄存器起始地址和地址长度</td> </tr> <tr> <td>clocks</td> <td>设置DMIC所需的时钟源和模块时钟</td> </tr> <tr> <td>capture_cma</td> <td>设置录音流DMA申请的size大小，必须为(2ˆn)Kbyte，默认 128</td> </tr> <tr> <td>rx_fifo_size</td> <td>设置录音流snd_pcm_runtime的fifo_size大小，用于声卡硬件参数<br>限定，默认 128</td> </tr> </tbody> </table> <ol> <li>ASoC层machine: dmic_mach</li> </ol> <center>表2-137: DMIC dmic_mach节点配置项(linux4.9)</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>soundcard-<br>mach</td> <td>machine层配置前缀</td> </tr> <tr> <td>name</td> <td>声卡名字</td> </tr> <tr> <td>cpu</td> <td>machine层所绑定的cpu节点（即platform层），用sound-dai属性<br>指定节点</td> </tr> <tr> <td>codec</td> <td>machine层所绑定的codec节点（即codec层），用sound-dai属性<br>指定节点（使用虚拟codec）</td> </tr> <tr> <td>capture_only</td> <td>设置仅录音，不进行播放流设备创建<br>pll-fs 指定模块时钟源频率（24.576M or 22.5792M * pll-fs）</td> </tr> </tbody> </table> <p><strong>2.20.5.2.2 board.dts板级配置说明</strong> board.dts用于保存板级平台设备差异化的信息的补 充，面对 <strong>板型特性</strong> 进行配置，其配置信息会覆盖device tree默认配置信息，board.dts文件的 路径为：/device/config/chips/v853/configs/{BOARD}/board.dts</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-145-1 id=__codelineno-145-1 name=__codelineno-145-1></a>&amp;dmic_plat {
<a href=#__codelineno-145-2 id=__codelineno-145-2 name=__codelineno-145-2></a>    rx_chmap = &lt;0x76543210&gt;;
<a href=#__codelineno-145-3 id=__codelineno-145-3 name=__codelineno-145-3></a>    data_vol = &lt;0xB0&gt;;
<a href=#__codelineno-145-4 id=__codelineno-145-4 name=__codelineno-145-4></a>    rxdelaytime = &lt;0&gt;;
<a href=#__codelineno-145-5 id=__codelineno-145-5 name=__codelineno-145-5></a>    pinctrl_used;
<a href=#__codelineno-145-6 id=__codelineno-145-6 name=__codelineno-145-6></a>    pinctrl-names = "default","sleep";
<a href=#__codelineno-145-7 id=__codelineno-145-7 name=__codelineno-145-7></a>    pinctrl-0 = &lt;&amp;dmic_pins_a&gt;;
<a href=#__codelineno-145-8 id=__codelineno-145-8 name=__codelineno-145-8></a>    pinctrl-1 = &lt;&amp;dmic_pins_b&gt;;
<a href=#__codelineno-145-9 id=__codelineno-145-9 name=__codelineno-145-9></a>    rx_sync_en;
<a href=#__codelineno-145-10 id=__codelineno-145-10 name=__codelineno-145-10></a>    status = "disabled";
<a href=#__codelineno-145-11 id=__codelineno-145-11 name=__codelineno-145-11></a>};
<a href=#__codelineno-145-12 id=__codelineno-145-12 name=__codelineno-145-12></a>&amp;dmic_mach {
<a href=#__codelineno-145-13 id=__codelineno-145-13 name=__codelineno-145-13></a>    status = "disabled";
<a href=#__codelineno-145-14 id=__codelineno-145-14 name=__codelineno-145-14></a>    soundcard-mach,cpu {
<a href=#__codelineno-145-15 id=__codelineno-145-15 name=__codelineno-145-15></a>        sound-dai = &lt;&amp;dmic_plat&gt;;
<a href=#__codelineno-145-16 id=__codelineno-145-16 name=__codelineno-145-16></a>        soundcard-mach,pll-fs = &lt;1&gt;; /* pll freq = 24.576M or 22.5792M * pll-fs */
<a href=#__codelineno-145-17 id=__codelineno-145-17 name=__codelineno-145-17></a>    };
<a href=#__codelineno-145-18 id=__codelineno-145-18 name=__codelineno-145-18></a>    soundcard-mach,codec {
<a href=#__codelineno-145-19 id=__codelineno-145-19 name=__codelineno-145-19></a>    };
<a href=#__codelineno-145-20 id=__codelineno-145-20 name=__codelineno-145-20></a>};
</code></pre></div> <p>配置项介绍：</p> <center>表2-138: DMIC模块板级配置项</center> <table> <thead> <tr> <th>配置项名称</th> <th>配置值范围</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>status</td> <td>“okay”, “disabled”</td> <td>使能或关闭该节点驱动</td> </tr> <tr> <td>rx-sync-en</td> <td>注释为false,反之为<br>ture</td> <td>选择是否注册rxsync控件</td> </tr> <tr> <td>avcc-<br>supply</td> <td>注释,引用pmu提供的<br>电源节点</td> <td>avcc若为外部pmu供电，可选择该项指定对应的<br>pmu电源</td> </tr> </tbody> </table> <h3 id=2206-rx_sync>2.20.6 RX_SYNC多声卡同步功能</h3> <p>RX_SYNC功能用于同时使用到两个录音声卡(不同音频硬件接口)，可以保证两个声卡同时开始录音，保证延迟稳定不变。</p> <p>例如内部ADC+外部ADC(使用I2S)的语音方案，它就可以保证内部ADC和I2S RX的同步性。</p> <p>AudioCodec, I2S, DMIC均可以使用RX_SYNC功能，除了它们对应的驱动配置外，还需要额外配置内核,dts等地方。</p> <h4 id=22061>2.20.6.1内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-146-1 id=__codelineno-146-1 name=__codelineno-146-1></a>Device Drivers ---&gt;
<a href=#__codelineno-146-2 id=__codelineno-146-2 name=__codelineno-146-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-146-3 id=__codelineno-146-3 name=__codelineno-146-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-146-4 id=__codelineno-146-4 name=__codelineno-146-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-146-5 id=__codelineno-146-5 name=__codelineno-146-5></a>Allwinner SoC Audio support V2 ---&gt;
<a href=#__codelineno-146-6 id=__codelineno-146-6 name=__codelineno-146-6></a>&lt;*&gt; Allwinner AAUDIO support
<a href=#__codelineno-146-7 id=__codelineno-146-7 name=__codelineno-146-7></a>&lt;*&gt; Allwinner DAUDIO Support
<a href=#__codelineno-146-8 id=__codelineno-146-8 name=__codelineno-146-8></a>&lt;*&gt; Allwinner Function Components
<a href=#__codelineno-146-9 id=__codelineno-146-9 name=__codelineno-146-9></a>&lt;*&gt; Components Rx Sync
</code></pre></div> <h4 id=22062-dts>2.20.6.2 dts配置.</h4> <p>在希望使用到rx_sync功能的音频模块上添加rx_sync_en = &lt;1&gt;字段:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-147-1 id=__codelineno-147-1 name=__codelineno-147-1></a>codec:codec@2030000 {
<a href=#__codelineno-147-2 id=__codelineno-147-2 name=__codelineno-147-2></a>    rx_sync_en = &lt;0x01&gt;;
<a href=#__codelineno-147-3 id=__codelineno-147-3 name=__codelineno-147-3></a>};
<a href=#__codelineno-147-4 id=__codelineno-147-4 name=__codelineno-147-4></a>dmic:dmic@2031000 {
<a href=#__codelineno-147-5 id=__codelineno-147-5 name=__codelineno-147-5></a>    rx_sync_en = &lt;0x01&gt;;
<a href=#__codelineno-147-6 id=__codelineno-147-6 name=__codelineno-147-6></a>};
<a href=#__codelineno-147-7 id=__codelineno-147-7 name=__codelineno-147-7></a>daudio0:daudio@2032000 {
<a href=#__codelineno-147-8 id=__codelineno-147-8 name=__codelineno-147-8></a>    rx_sync_en = &lt;0x01&gt;;
<a href=#__codelineno-147-9 id=__codelineno-147-9 name=__codelineno-147-9></a>};
</code></pre></div> <p>注意，配置了rx_sync_en字段的模块，需要都开启录音后，才会真正开始录音。</p> <p>一般我们会使用multi插件将两个声卡数据合并(默认asound.conf中添加了CaptureMulti1可供参考)，arecord -DCaptureMulti1 -f S16_LE -r 16000 -c 7 /tmp/test.wav &amp;。</p> <h3 id=2207>2.20.7 标案音频测试方法.</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令</p> <h4 id=22071>2.20.7.1播放</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-148-1 id=__codelineno-148-1 name=__codelineno-148-1></a>通过LINEOUT-&gt;Speaker播放
<a href=#__codelineno-148-2 id=__codelineno-148-2 name=__codelineno-148-2></a>amixer -Dhw:audiocodec cset name='LINEOUTL Output Select' 1
<a href=#__codelineno-148-3 id=__codelineno-148-3 name=__codelineno-148-3></a>amixer -Dhw:audiocodec cset name='LINEOUTR Output Select' 1
<a href=#__codelineno-148-4 id=__codelineno-148-4 name=__codelineno-148-4></a>amixer -Dhw:audiocodec cset name='LINEOUT Switch' 1
<a href=#__codelineno-148-5 id=__codelineno-148-5 name=__codelineno-148-5></a>amixer -D hw:audiocodec cset name='LINEOUT volume' 15
<a href=#__codelineno-148-6 id=__codelineno-148-6 name=__codelineno-148-6></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
<a href=#__codelineno-148-7 id=__codelineno-148-7 name=__codelineno-148-7></a>或者利用默认/etc/asound.conf配置的pcm设备进行播放：
<a href=#__codelineno-148-8 id=__codelineno-148-8 name=__codelineno-148-8></a>aplay -Ddefault /mnt/UDISK/1KHz_0dB_16000.wav
<a href=#__codelineno-148-9 id=__codelineno-148-9 name=__codelineno-148-9></a>通过Headphone播放
<a href=#__codelineno-148-10 id=__codelineno-148-10 name=__codelineno-148-10></a>amixer -D hw:audiocodec cset name='Headphone Switch' 1
<a href=#__codelineno-148-11 id=__codelineno-148-11 name=__codelineno-148-11></a>amixer -D hw:audiocodec cset name='Headphone volume' 3
<a href=#__codelineno-148-12 id=__codelineno-148-12 name=__codelineno-148-12></a>aplay -Dhw:audiocodec /mnt/UDISK/1KHz_0dB_16000.wav
</code></pre></div> <h4 id=22072>2.20.7.2录音</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-149-1 id=__codelineno-149-1 name=__codelineno-149-1></a>通过内部的MIC1,MIC2录制双通道
<a href=#__codelineno-149-2 id=__codelineno-149-2 name=__codelineno-149-2></a>amixer -D hw:audiocodec cset name='MIC1 Input Select' 0
<a href=#__codelineno-149-3 id=__codelineno-149-3 name=__codelineno-149-3></a>amixer -D hw:audiocodec cset name='MIC2 Input Select' 0
<a href=#__codelineno-149-4 id=__codelineno-149-4 name=__codelineno-149-4></a>amixer -D hw:audiocodec cset name='MIC1 Switch' 1
<a href=#__codelineno-149-5 id=__codelineno-149-5 name=__codelineno-149-5></a>amixer -D hw:audiocodec cset name='MIC2 Switch' 1
<a href=#__codelineno-149-6 id=__codelineno-149-6 name=__codelineno-149-6></a>amixer -D hw:audiocodec cset name='MIC1 gain volume' 19
<a href=#__codelineno-149-7 id=__codelineno-149-7 name=__codelineno-149-7></a>amixer -D hw:audiocodec cset name='MIC2 gain volume' 19
<a href=#__codelineno-149-8 id=__codelineno-149-8 name=__codelineno-149-8></a>arecord -Dhw:audiocodec -f S16_LE -r 16000 -c 2 /tmp/test.wav
</code></pre></div> <h2 id=221-f133>2.21 F133音频接口</h2> <p>F133包含多个音频模块，分别是内置AudioCodec,I2S1,I2S2,DMIC,SPDIF。</p> <h3 id=2211>2.21.1 时钟源.</h3> <p>F133中，音频模块的时钟源来自pll_audio0以及pll_audio1_div5。</p> <p>pll_audio0可以输出22.5792M的时钟,而pll_audio1_div5输出24.576M的时钟，分别支 持44.1k系列，48k系列的播放录音。</p> <h3 id=2212-audiocodec>2.21.2 AudioCodec</h3> <h4 id=22121>2.21.2.1硬件特性</h4> <p>• 两路DAC</p> <ul> <li>支持16bit,20bit有效采样精度</li> <li>支持8KHz~192KHz采样率</li> <li>三路ADC</li> <li>支持16bit,20bit有效采样精度</li> <li>支持8KHz~48KHz采样率</li> <li>模拟输出：</li> <li>一路立体声输出HPOUTL,HPOUTR</li> <li>模拟差分输入：</li> <li>一路差分麦克风输入MIC3P/N</li> <li>一路立体声line-in输入LINEINL,LINEINR</li> <li>一路立体声FM-in输入FMINL,FMINR</li> <li>支持同时playback和record(全双工模式)</li> <li>DAC及ADC均支持DRC</li> </ul> <h4 id=22122>2.21.2.2内核配置</h4> <p>kernel_menuconfig配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-150-1 id=__codelineno-150-1 name=__codelineno-150-1></a>Device Drivers ---&gt;
<a href=#__codelineno-150-2 id=__codelineno-150-2 name=__codelineno-150-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-150-3 id=__codelineno-150-3 name=__codelineno-150-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-150-4 id=__codelineno-150-4 name=__codelineno-150-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-150-5 id=__codelineno-150-5 name=__codelineno-150-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-150-6 id=__codelineno-150-6 name=__codelineno-150-6></a>&lt;*&gt; Allwinner Sun20iw1 Codec Support
<a href=#__codelineno-150-7 id=__codelineno-150-7 name=__codelineno-150-7></a>&lt;*&gt; Allwinner Audio Simple Card
<a href=#__codelineno-150-8 id=__codelineno-150-8 name=__codelineno-150-8></a>[ ] Allwinner RX SYNC Support
</code></pre></div> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>Allwinner Sun20iw1 Codec Support</td> <td>audiocodec</td> </tr> <tr> <td>Allwinner Audio Simple Card</td> <td>绑定声卡</td> </tr> <tr> <td>Allwinner RX SYNC Support</td> <td>同步功能组件</td> </tr> </tbody> </table> <h4 id=22123-dts>2.21.2.3 DTS配置.</h4> <p>board.dts板级配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-151-1 id=__codelineno-151-1 name=__codelineno-151-1></a>&amp;codec {
<a href=#__codelineno-151-2 id=__codelineno-151-2 name=__codelineno-151-2></a>/* MIC and headphone gain setting */
<a href=#__codelineno-151-3 id=__codelineno-151-3 name=__codelineno-151-3></a>mic1gain = &lt;0x1F&gt;;
<a href=#__codelineno-151-4 id=__codelineno-151-4 name=__codelineno-151-4></a>mic2gain = &lt;0x1F&gt;;
<a href=#__codelineno-151-5 id=__codelineno-151-5 name=__codelineno-151-5></a>mic3gain = &lt;0x1F&gt;;
<a href=#__codelineno-151-6 id=__codelineno-151-6 name=__codelineno-151-6></a>/* ADC/DAC DRC/HPF func enabled */
<a href=#__codelineno-151-7 id=__codelineno-151-7 name=__codelineno-151-7></a>¦ /* 0x1:DAP_HP_EN; 0x2:DAP_SPK_EN; 0x3:DAP_HPSPK_EN */
<a href=#__codelineno-151-8 id=__codelineno-151-8 name=__codelineno-151-8></a>adcdrc_cfg = &lt;0x0&gt;;
<a href=#__codelineno-151-9 id=__codelineno-151-9 name=__codelineno-151-9></a>adchpf_cfg = &lt;0x1&gt;;
<a href=#__codelineno-151-10 id=__codelineno-151-10 name=__codelineno-151-10></a>dacdrc_cfg = &lt;0x0&gt;;
<a href=#__codelineno-151-11 id=__codelineno-151-11 name=__codelineno-151-11></a>dachpf_cfg = &lt;0x0&gt;;
<a href=#__codelineno-151-12 id=__codelineno-151-12 name=__codelineno-151-12></a>/* Volume about */
<a href=#__codelineno-151-13 id=__codelineno-151-13 name=__codelineno-151-13></a>digital_vol = &lt;0x00&gt;;
<a href=#__codelineno-151-14 id=__codelineno-151-14 name=__codelineno-151-14></a>lineout_vol = &lt;0x1a&gt;;
<a href=#__codelineno-151-15 id=__codelineno-151-15 name=__codelineno-151-15></a>headphonegain = &lt;0x03&gt;;
<a href=#__codelineno-151-16 id=__codelineno-151-16 name=__codelineno-151-16></a>/* Pa enabled about */
<a href=#__codelineno-151-17 id=__codelineno-151-17 name=__codelineno-151-17></a>pa_level = &lt;0x01&gt;;
<a href=#__codelineno-151-18 id=__codelineno-151-18 name=__codelineno-151-18></a>pa_pwr_level = &lt;0x01&gt;;
<a href=#__codelineno-151-19 id=__codelineno-151-19 name=__codelineno-151-19></a>pa_msleep_time = &lt;0x78&gt;;
<a href=#__codelineno-151-20 id=__codelineno-151-20 name=__codelineno-151-20></a>/* gpio-spk = &lt;&amp;pio PF 2 GPIO_ACTIVE_HIGH&gt;;*/
<a href=#__codelineno-151-21 id=__codelineno-151-21 name=__codelineno-151-21></a>/* gpio-spk-pwr = &lt;&amp;pio PF 4 GPIO_ACTIVE_HIGH&gt;; */
<a href=#__codelineno-151-22 id=__codelineno-151-22 name=__codelineno-151-22></a>/* CMA config about */
<a href=#__codelineno-151-23 id=__codelineno-151-23 name=__codelineno-151-23></a>playback_cma = &lt;128&gt;;
<a href=#__codelineno-151-24 id=__codelineno-151-24 name=__codelineno-151-24></a>capture_cma = &lt;256&gt;;
<a href=#__codelineno-151-25 id=__codelineno-151-25 name=__codelineno-151-25></a>/* regulator about */
<a href=#__codelineno-151-26 id=__codelineno-151-26 name=__codelineno-151-26></a>/* avcc-supply = &lt;&amp;reg_aldo1&gt;; */
<a href=#__codelineno-151-27 id=__codelineno-151-27 name=__codelineno-151-27></a>/* hpvcc-supply = &lt;&amp;reg_eldo1&gt;; */
<a href=#__codelineno-151-28 id=__codelineno-151-28 name=__codelineno-151-28></a>status = "okay";
<a href=#__codelineno-151-29 id=__codelineno-151-29 name=__codelineno-151-29></a>};
</code></pre></div> <table> <thead> <tr> <th>部分配置项名称</th> <th>配置取值</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>mic3gain</td> <td>0-31</td> <td>mic3增益</td> </tr> <tr> <td>digital_vol</td> <td>0-63</td> <td>DAC数字音量</td> </tr> <tr> <td>headphonegain</td> <td>0-7</td> <td>耳机播放增益</td> </tr> <tr> <td>pa_level</td> <td>0-1</td> <td>功放芯片使能电平</td> </tr> <tr> <td>pa_pwr_level</td> <td>0-1</td> <td>功放供电使能电平</td> </tr> <tr> <td>pa_msleep_time</td> <td>u32,一般小于 200 x</td> <td>u32,一般小于 200 设置功放芯片使能所需sleep时间</td> </tr> <tr> <td>status</td> <td>“okay”/“disable”</td> <td>使能或者关闭本节点</td> </tr> </tbody> </table> <h3 id=2213-daudio>2.21.3 Daudio</h3> <h4 id=22131>2.21.3.1硬件特性</h4> <p>• 两路I2S/PCM I2S1 I2S2</p> <ul> <li>支持8-192k采样率</li> <li>支持16 24 32采样精度</li> <li>支持1-16多通道录音播放</li> <li>支持 5 种TDM模式</li> <li>I2S standard mode</li> <li>Left-justified mode</li> <li>Right-justified mode</li> <li>DSP-A mode(short frame PCM mode)</li> <li>DSP-B mode(long frame PCM mode)</li> <li>支持回环模式</li> <li>支持同时playback和capture</li> <li>支持多声卡同步录音</li> </ul> <h4 id=22132>2.21.3.2内核配置</h4> <p>kernel_menuconfig配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-152-1 id=__codelineno-152-1 name=__codelineno-152-1></a>Device Drivers ---&gt;
<a href=#__codelineno-152-2 id=__codelineno-152-2 name=__codelineno-152-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-152-3 id=__codelineno-152-3 name=__codelineno-152-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-152-4 id=__codelineno-152-4 name=__codelineno-152-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-152-5 id=__codelineno-152-5 name=__codelineno-152-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-152-6 id=__codelineno-152-6 name=__codelineno-152-6></a>&lt;*&gt; Allwinner Audio Simple Card
<a href=#__codelineno-152-7 id=__codelineno-152-7 name=__codelineno-152-7></a>&lt;*&gt; Allwinner Digital Audio Support
<a href=#__codelineno-152-8 id=__codelineno-152-8 name=__codelineno-152-8></a>[ ] Allwinner RX SYNC Support
</code></pre></div> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>Allwinner Sun20iw1 Codec Support</td> <td>I2S/PCM</td> </tr> <tr> <td>Allwinner Audio Simple Card</td> <td>绑定声卡</td> </tr> <tr> <td>Allwinner RX SYNC Support</td> <td>同步功能组件</td> </tr> </tbody> </table> <h4 id=22133-dts>2.21.3.3 DTS配置.</h4> <p>board.dts板级配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-153-1 id=__codelineno-153-1 name=__codelineno-153-1></a>&amp;daudio1 {
<a href=#__codelineno-153-2 id=__codelineno-153-2 name=__codelineno-153-2></a>mclk_div = &lt;0x01&gt;;
<a href=#__codelineno-153-3 id=__codelineno-153-3 name=__codelineno-153-3></a>frametype = &lt;0x00&gt;;
<a href=#__codelineno-153-4 id=__codelineno-153-4 name=__codelineno-153-4></a>tdm_config = &lt;0x01&gt;;
<a href=#__codelineno-153-5 id=__codelineno-153-5 name=__codelineno-153-5></a>sign_extend = &lt;0x00&gt;;
<a href=#__codelineno-153-6 id=__codelineno-153-6 name=__codelineno-153-6></a>msb_lsb_first = &lt;0x00&gt;;
<a href=#__codelineno-153-7 id=__codelineno-153-7 name=__codelineno-153-7></a>pcm_lrck_period = &lt;0x80&gt;;
<a href=#__codelineno-153-8 id=__codelineno-153-8 name=__codelineno-153-8></a>slot_width_select = &lt;0x20&gt;;
<a href=#__codelineno-153-9 id=__codelineno-153-9 name=__codelineno-153-9></a>pinctrl-names = "default", "sleep";
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-154-1 id=__codelineno-154-1 name=__codelineno-154-1></a>pinctrl-0 = &lt;&amp;daudio1_pins_a&gt;;
<a href=#__codelineno-154-2 id=__codelineno-154-2 name=__codelineno-154-2></a>pinctrl-1 = &lt;&amp;daudio1_pins_b&gt;;
<a href=#__codelineno-154-3 id=__codelineno-154-3 name=__codelineno-154-3></a>pinctrl_used = &lt;0x0&gt;;
<a href=#__codelineno-154-4 id=__codelineno-154-4 name=__codelineno-154-4></a>status = "disabled";
<a href=#__codelineno-154-5 id=__codelineno-154-5 name=__codelineno-154-5></a>};
<a href=#__codelineno-154-6 id=__codelineno-154-6 name=__codelineno-154-6></a>&amp;sounddaudio1 {
<a href=#__codelineno-154-7 id=__codelineno-154-7 name=__codelineno-154-7></a>status = "disabled";
<a href=#__codelineno-154-8 id=__codelineno-154-8 name=__codelineno-154-8></a>daudio1_master: simple-audio-card,codec {
<a href=#__codelineno-154-9 id=__codelineno-154-9 name=__codelineno-154-9></a>/* sound-dai = &lt;&amp;ac108&gt;; */
<a href=#__codelineno-154-10 id=__codelineno-154-10 name=__codelineno-154-10></a>};
<a href=#__codelineno-154-11 id=__codelineno-154-11 name=__codelineno-154-11></a>};
</code></pre></div> <p>设备树配置sun20iw1p1.dtsi</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-155-1 id=__codelineno-155-1 name=__codelineno-155-1></a>daudio1:daudio@2033000 {
<a href=#__codelineno-155-2 id=__codelineno-155-2 name=__codelineno-155-2></a>#sound-dai-cells = &lt;0&gt;;
<a href=#__codelineno-155-3 id=__codelineno-155-3 name=__codelineno-155-3></a>compatible = "allwinner,sunxi-daudio";
<a href=#__codelineno-155-4 id=__codelineno-155-4 name=__codelineno-155-4></a>reg = &lt;0x0 0x02033000 0x0 0xa0&gt;;
<a href=#__codelineno-155-5 id=__codelineno-155-5 name=__codelineno-155-5></a>clocks = &lt;&amp;ccu CLK_PLL_AUDIO0&gt;,
<a href=#__codelineno-155-6 id=__codelineno-155-6 name=__codelineno-155-6></a>¦&lt;&amp;ccu CLK_I2S1&gt;,
<a href=#__codelineno-155-7 id=__codelineno-155-7 name=__codelineno-155-7></a>¦&lt;&amp;ccu CLK_BUS_I2S1&gt;;
<a href=#__codelineno-155-8 id=__codelineno-155-8 name=__codelineno-155-8></a>clock-names = "pll_audio", "i2s1", "i2s1_bus";
<a href=#__codelineno-155-9 id=__codelineno-155-9 name=__codelineno-155-9></a>resets = &lt;&amp;ccu RST_BUS_I2S1&gt;;
<a href=#__codelineno-155-10 id=__codelineno-155-10 name=__codelineno-155-10></a>dmas = &lt;&amp;dma 4&gt;, &lt;&amp;dma 4&gt;;
<a href=#__codelineno-155-11 id=__codelineno-155-11 name=__codelineno-155-11></a>dma-names = "tx", "rx";
<a href=#__codelineno-155-12 id=__codelineno-155-12 name=__codelineno-155-12></a>interrupts-extended = &lt;&amp;plic0 43 IRQ_TYPE_LEVEL_HIGH&gt;;
<a href=#__codelineno-155-13 id=__codelineno-155-13 name=__codelineno-155-13></a>sign_extend = &lt;0x00&gt;;
<a href=#__codelineno-155-14 id=__codelineno-155-14 name=__codelineno-155-14></a>tx_data_mode = &lt;0x00&gt;;
<a href=#__codelineno-155-15 id=__codelineno-155-15 name=__codelineno-155-15></a>rx_data_mode = &lt;0x00&gt;;
<a href=#__codelineno-155-16 id=__codelineno-155-16 name=__codelineno-155-16></a>msb_lsb_first = &lt;0x00&gt;;
<a href=#__codelineno-155-17 id=__codelineno-155-17 name=__codelineno-155-17></a>pcm_lrck_period = &lt;0x80&gt;;
<a href=#__codelineno-155-18 id=__codelineno-155-18 name=__codelineno-155-18></a>slot_width_select = &lt;0x20&gt;;
<a href=#__codelineno-155-19 id=__codelineno-155-19 name=__codelineno-155-19></a>frametype = &lt;0x00&gt;;
<a href=#__codelineno-155-20 id=__codelineno-155-20 name=__codelineno-155-20></a>tdm_config = &lt;0x01&gt;;
<a href=#__codelineno-155-21 id=__codelineno-155-21 name=__codelineno-155-21></a>tdm_num = &lt;0x01&gt;;
<a href=#__codelineno-155-22 id=__codelineno-155-22 name=__codelineno-155-22></a>mclk_div = &lt;0x00&gt;;
<a href=#__codelineno-155-23 id=__codelineno-155-23 name=__codelineno-155-23></a>clk_parent = &lt;0x01&gt;;
<a href=#__codelineno-155-24 id=__codelineno-155-24 name=__codelineno-155-24></a>capture_cma = &lt;128&gt;;
<a href=#__codelineno-155-25 id=__codelineno-155-25 name=__codelineno-155-25></a>playback_cma = &lt;128&gt;;
<a href=#__codelineno-155-26 id=__codelineno-155-26 name=__codelineno-155-26></a>tx_num = &lt;4&gt;;
<a href=#__codelineno-155-27 id=__codelineno-155-27 name=__codelineno-155-27></a>tx_chmap1 = &lt;0x76543210&gt;;
<a href=#__codelineno-155-28 id=__codelineno-155-28 name=__codelineno-155-28></a>tx_chmap0 = &lt;0xFEDCBA98&gt;;
<a href=#__codelineno-155-29 id=__codelineno-155-29 name=__codelineno-155-29></a>rx_num = &lt;4&gt;;
<a href=#__codelineno-155-30 id=__codelineno-155-30 name=__codelineno-155-30></a>rx_chmap3 = &lt;0x03020100&gt;;
<a href=#__codelineno-155-31 id=__codelineno-155-31 name=__codelineno-155-31></a>rx_chmap2 = &lt;0x07060504&gt;;
<a href=#__codelineno-155-32 id=__codelineno-155-32 name=__codelineno-155-32></a>rx_chmap1 = &lt;0x0B0A0908&gt;;
<a href=#__codelineno-155-33 id=__codelineno-155-33 name=__codelineno-155-33></a>rx_chmap0 = &lt;0x0F0E0D0C&gt;;
<a href=#__codelineno-155-34 id=__codelineno-155-34 name=__codelineno-155-34></a>asrc_function_en = &lt;0x00&gt;;
<a href=#__codelineno-155-35 id=__codelineno-155-35 name=__codelineno-155-35></a>rx_sync_en = &lt;0x00&gt;;
<a href=#__codelineno-155-36 id=__codelineno-155-36 name=__codelineno-155-36></a>device_type = "daudio1";
<a href=#__codelineno-155-37 id=__codelineno-155-37 name=__codelineno-155-37></a>status = "disabled";
<a href=#__codelineno-155-38 id=__codelineno-155-38 name=__codelineno-155-38></a>};
<a href=#__codelineno-155-39 id=__codelineno-155-39 name=__codelineno-155-39></a>sounddaudio1: sounddaudio1@20330a0 {
<a href=#__codelineno-155-40 id=__codelineno-155-40 name=__codelineno-155-40></a>reg = &lt;0x0 0x020330a0 0x0 0x4&gt;;
<a href=#__codelineno-155-41 id=__codelineno-155-41 name=__codelineno-155-41></a>compatible = "sunxi,simple-audio-card";
<a href=#__codelineno-155-42 id=__codelineno-155-42 name=__codelineno-155-42></a>simple-audio-card,name = "snddaudio1";
<a href=#__codelineno-155-43 id=__codelineno-155-43 name=__codelineno-155-43></a>simple-audio-card,format = "i2s";
<a href=#__codelineno-155-44 id=__codelineno-155-44 name=__codelineno-155-44></a>status = "disabled";
<a href=#__codelineno-155-45 id=__codelineno-155-45 name=__codelineno-155-45></a>simple-audio-card,cpu {
<a href=#__codelineno-155-46 id=__codelineno-155-46 name=__codelineno-155-46></a>sound-dai = &lt;&amp;daudio1&gt;;
<a href=#__codelineno-155-47 id=__codelineno-155-47 name=__codelineno-155-47></a>};
<a href=#__codelineno-155-48 id=__codelineno-155-48 name=__codelineno-155-48></a>};
</code></pre></div> <table> <thead> <tr> <th>部分配置项名称</th> <th>配置取值</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>status</td> <td>“okay”<br>“disable”</td> <td>使能或者关闭snddaudio驱动</td> </tr> <tr> <td>mclk_div</td> <td>0-192</td> <td>mclk分频系数，取值为<br>0/½/4/8/12/16/24/32/48/64/96/128/176/192</td> </tr> <tr> <td>frametype</td> <td>0-1</td> <td>0:short frame(1 clock width) 1:long<br>frame(2 clock width)</td> </tr> <tr> <td>tdm_config</td> <td>0-1</td> <td>0:PCM mode 1:I2S mode</td> </tr> <tr> <td>sign_extend</td> <td>0-1</td> <td>0:zero pending 1:sign extend</td> </tr> <tr> <td>msb_lsb_first</td> <td>0-1</td> <td>0:msb first 1:lsb first</td> </tr> <tr> <td>pcm_lrck_period</td> <td>16/32/64/128/256</td> <td>一般可配置为16/32/64/128/256个<br>bclk</td> </tr> <tr> <td>slot_width_select</td> <td>8/16/32</td> <td>slot支持8/16/32bit宽度</td> </tr> <tr> <td>tx_data_mode</td> <td>0/½/3</td> <td>0:16bit linear PCM 1:reserved<br>2:8bit u-law 3:8bit a-law</td> </tr> <tr> <td>rx_data_mode</td> <td>0/½/3</td> <td>0:16bit linear PCM 1:reserved<br>2:8bit u-law 3:8bit a-law</td> </tr> <tr> <td>simple-audio-card,name</td> <td>string</td> <td>声卡名称</td> </tr> <tr> <td>simple-audio-card,format</td> <td>string</td> <td>I2S tdm模式,取值为<br>“i2s”/“right_j”/“left_j”/“dsp_a”/“dsp_b”</td> </tr> <tr> <td>simple-audio-card,frame-<br>master</td> <td>注释为false,反<br>之为true</td> <td>配置frame clk主从关系，不配置则<br>soc为主，反之soc为从</td> </tr> <tr> <td>simple-audio-card,bitclock-<br>master</td> <td>注释为false,反<br>之为true</td> <td>配置bit clk主从关系，不配置则soc为<br>主，反之soc为从</td> </tr> <tr> <td>simple-audio-card,frame-<br>inversion</td> <td>注释为false,反<br>之为true</td> <td>配置frame clk极性取反;不配置则是正<br>常极性</td> </tr> <tr> <td>simple-audio-card,bitclock-<br>inversion</td> <td>注释为false,反<br>之为true</td> <td>配置bit clk极性取反;不配置则是正常<br>极性</td> </tr> <tr> <td>simple-audio-<br>card,capture_only</td> <td>注释为false,反<br>之为true</td> <td>仅支持录音</td> </tr> <tr> <td>simple-audio-<br>card,playback_only</td> <td>注释为false,反<br>之为true</td> <td>仅支持播放</td> </tr> </tbody> </table> <h3 id=2214-dmic>2.21.4 DMIC.</h3> <h4 id=22141>2.21.4.1硬件特性</h4> <ul> <li>支持8-48k采样率</li> <li>支持16 24采样精度</li> <li>支持1-8多通道录音播放</li> <li>支持多声卡同步录音</li> </ul> <h4 id=22142>2.21.4.2内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-156-1 id=__codelineno-156-1 name=__codelineno-156-1></a>Device Drivers ---&gt;
<a href=#__codelineno-156-2 id=__codelineno-156-2 name=__codelineno-156-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-156-3 id=__codelineno-156-3 name=__codelineno-156-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-156-4 id=__codelineno-156-4 name=__codelineno-156-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-156-5 id=__codelineno-156-5 name=__codelineno-156-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-156-6 id=__codelineno-156-6 name=__codelineno-156-6></a>&lt;*&gt; Allwinner Audio Simple Card
<a href=#__codelineno-156-7 id=__codelineno-156-7 name=__codelineno-156-7></a>&lt;*&gt; Allwinner DMIC Support
<a href=#__codelineno-156-8 id=__codelineno-156-8 name=__codelineno-156-8></a>[ ] Allwinner RX SYNC Support
</code></pre></div> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>Allwinner Sun20iw1 Codec Support</td> <td>dmic</td> </tr> <tr> <td>Allwinner Audio Simple Card</td> <td>绑定声卡</td> </tr> <tr> <td>Allwinner RX SYNC Support</td> <td>同步功能组件</td> </tr> </tbody> </table> <h4 id=22143-dts>2.21.4.3 DTS配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-157-1 id=__codelineno-157-1 name=__codelineno-157-1></a>&amp;dmic {
<a href=#__codelineno-157-2 id=__codelineno-157-2 name=__codelineno-157-2></a>pinctrl-names = "default","sleep";
<a href=#__codelineno-157-3 id=__codelineno-157-3 name=__codelineno-157-3></a>pinctrl-0 = &lt;&amp;dmic_pins_a&gt;;
<a href=#__codelineno-157-4 id=__codelineno-157-4 name=__codelineno-157-4></a>pinctrl-1 = &lt;&amp;dmic_pins_b&gt;;
<a href=#__codelineno-157-5 id=__codelineno-157-5 name=__codelineno-157-5></a>rx_sync_en = &lt;0x00&gt;;
<a href=#__codelineno-157-6 id=__codelineno-157-6 name=__codelineno-157-6></a>status = "okay";
<a href=#__codelineno-157-7 id=__codelineno-157-7 name=__codelineno-157-7></a>};
<a href=#__codelineno-157-8 id=__codelineno-157-8 name=__codelineno-157-8></a>&amp;dmic_codec {
<a href=#__codelineno-157-9 id=__codelineno-157-9 name=__codelineno-157-9></a>status = "okay";
<a href=#__codelineno-157-10 id=__codelineno-157-10 name=__codelineno-157-10></a>};
<a href=#__codelineno-157-11 id=__codelineno-157-11 name=__codelineno-157-11></a>&amp;sounddmic {
<a href=#__codelineno-157-12 id=__codelineno-157-12 name=__codelineno-157-12></a>status = "okay";
<a href=#__codelineno-157-13 id=__codelineno-157-13 name=__codelineno-157-13></a>};
</code></pre></div> <table> <thead> <tr> <th>部分配置项名称</th> <th>配置取值</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>status</td> <td>“okay”/“disable”</td> <td>使能或者关闭本节点</td> </tr> <tr> <td>rx_sync_en</td> <td>注释为false反之为true</td> <td>是否注册rx_sync组件</td> </tr> </tbody> </table> <h3 id=2215-spdif>2.21.5 SPDIF</h3> <h4 id=22151>2.21.5.1硬件特性</h4> <ul> <li>支持22.05-192k采样率</li> <li>支持16 24采样精度</li> <li>支持1-2多通道录音播放</li> <li>支持多声卡同步录音</li> <li>支持回环模式</li> <li>支持IEC-60958协议</li> <li>支持IEC-61937协议</li> </ul> <h4 id=22152>2.21.5.2内核配置</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-158-1 id=__codelineno-158-1 name=__codelineno-158-1></a>Device Drivers ---&gt;
<a href=#__codelineno-158-2 id=__codelineno-158-2 name=__codelineno-158-2></a>&lt;*&gt; Sound card support ---&gt;
<a href=#__codelineno-158-3 id=__codelineno-158-3 name=__codelineno-158-3></a>&lt;*&gt; Advanced Linux Sound Architecture ---&gt;
<a href=#__codelineno-158-4 id=__codelineno-158-4 name=__codelineno-158-4></a>&lt;*&gt; ALSA for SoC audio support ---&gt;
<a href=#__codelineno-158-5 id=__codelineno-158-5 name=__codelineno-158-5></a>Allwinner SoC Audio support ---&gt;
<a href=#__codelineno-158-6 id=__codelineno-158-6 name=__codelineno-158-6></a>&lt;*&gt; Allwinner Audio Simple Card
<a href=#__codelineno-158-7 id=__codelineno-158-7 name=__codelineno-158-7></a>&lt;*&gt; Allwinner SPDIF Support
<a href=#__codelineno-158-8 id=__codelineno-158-8 name=__codelineno-158-8></a>[ ] Allwinner RX SYNC Support
</code></pre></div> <table> <thead> <tr> <th>配置项名称</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>Allwinner Sun20iw1 Codec Support</td> <td>spdif</td> </tr> <tr> <td>Allwinner Audio Simple Card</td> <td>绑定声卡</td> </tr> <tr> <td>Allwinner RX SYNC Support</td> <td>同步功能组件</td> </tr> </tbody> </table> <h4 id=22153-dts>2.21.5.3 DTS配置.</h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-159-1 id=__codelineno-159-1 name=__codelineno-159-1></a>&amp;spdif {
<a href=#__codelineno-159-2 id=__codelineno-159-2 name=__codelineno-159-2></a>pinctrl-names = "default","sleep";
<a href=#__codelineno-159-3 id=__codelineno-159-3 name=__codelineno-159-3></a>pinctrl-0 = &lt;&amp;spdif_pins_a&gt;;
<a href=#__codelineno-159-4 id=__codelineno-159-4 name=__codelineno-159-4></a>pinctrl-1 = &lt;&amp;spdif_pins_b&gt;;
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-160-1 id=__codelineno-160-1 name=__codelineno-160-1></a>rx_sync_en = &lt;0x00&gt;;
<a href=#__codelineno-160-2 id=__codelineno-160-2 name=__codelineno-160-2></a>status = "okay";
<a href=#__codelineno-160-3 id=__codelineno-160-3 name=__codelineno-160-3></a>};
<a href=#__codelineno-160-4 id=__codelineno-160-4 name=__codelineno-160-4></a>&amp;soundspdif {
<a href=#__codelineno-160-5 id=__codelineno-160-5 name=__codelineno-160-5></a>status = "okay";
<a href=#__codelineno-160-6 id=__codelineno-160-6 name=__codelineno-160-6></a>};
</code></pre></div> <table> <thead> <tr> <th>部分配置项名称</th> <th>配置取值</th> <th>配置项说明</th> </tr> </thead> <tbody> <tr> <td>status</td> <td>“okay” “disable”</td> <td>使能或者关闭本节点</td> </tr> <tr> <td>rx_sync_en</td> <td>注释为false反之为true</td> <td>是否注册rx_sync组件</td> </tr> </tbody> </table> <h3 id=2216>2.21.6 标案音频测试方法.</h3> <p>该章节主要介绍在标案上进行播歌，录音的测试命令</p> <h5 id=22161>2.21.6.1播放</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-161-1 id=__codelineno-161-1 name=__codelineno-161-1></a>通过Headphone播放
<a href=#__codelineno-161-2 id=__codelineno-161-2 name=__codelineno-161-2></a>1.开机后推送测试音频48000.wav到小机端,pc命令：adb push 48000.wav /tmp/
<a href=#__codelineno-161-3 id=__codelineno-161-3 name=__codelineno-161-3></a>2.播放该音频文件, aplay /tmp/48000.wav
</code></pre></div> <h5 id=22162>2.21.6.2录音</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-162-1 id=__codelineno-162-1 name=__codelineno-162-1></a>mic:
<a href=#__codelineno-162-2 id=__codelineno-162-2 name=__codelineno-162-2></a>1.使能mic3通路：amixer set "ADC3 Input MIC3 Boost" on
<a href=#__codelineno-162-3 id=__codelineno-162-3 name=__codelineno-162-3></a>2.设置mic3增益：amixer cset name="MIC3 gain volume" 31
<a href=#__codelineno-162-4 id=__codelineno-162-4 name=__codelineno-162-4></a>3.录音5s：arecord -D hw:audiocodec -f S16_LE -r 44100 -c 1 /tmp/test.wav --period-size 1024
<a href=#__codelineno-162-5 id=__codelineno-162-5 name=__codelineno-162-5></a>--buffer-size 4096 -d 5
<a href=#__codelineno-162-6 id=__codelineno-162-6 name=__codelineno-162-6></a>linein:
<a href=#__codelineno-162-7 id=__codelineno-162-7 name=__codelineno-162-7></a>1.使能linein通路：amixer set "ADC1 Input LINEINL" on;amixer set "ADC2 Input LINEINR" on
<a href=#__codelineno-162-8 id=__codelineno-162-8 name=__codelineno-162-8></a>2.设置linein增益：amixer cset name="LINEINL gain volume" 1;amixer cset name="LINEINR gain
<a href=#__codelineno-162-9 id=__codelineno-162-9 name=__codelineno-162-9></a>volume" 1
<a href=#__codelineno-162-10 id=__codelineno-162-10 name=__codelineno-162-10></a>3.录音5s：arecord -D hw:audiocodec -f S16_LE -r 44100 -c 2 /tmp/test.wav --period-size 1024
<a href=#__codelineno-162-11 id=__codelineno-162-11 name=__codelineno-162-11></a>--buffer-size 4096 -d 5
<a href=#__codelineno-162-12 id=__codelineno-162-12 name=__codelineno-162-12></a>fmin:
<a href=#__codelineno-162-13 id=__codelineno-162-13 name=__codelineno-162-13></a>1.使能fmin通路：amixer set "ADC1 Input FMINL" on;amixer set "ADC2 Input FMINR" on
<a href=#__codelineno-162-14 id=__codelineno-162-14 name=__codelineno-162-14></a>2.设置fmin增益：amixer cset name="FMINL gain volume" 1;amixer cset name="FMINR gain volume" 1
<a href=#__codelineno-162-15 id=__codelineno-162-15 name=__codelineno-162-15></a>3.录音5s：arecord -D hw:audiocodec -f S16_LE -r 44100 -c 2 /tmp/test.wav --period-size 1024
<a href=#__codelineno-162-16 id=__codelineno-162-16 name=__codelineno-162-16></a>--buffer-size 4096 -d 5
<a href=#__codelineno-162-17 id=__codelineno-162-17 name=__codelineno-162-17></a>I2S:
<a href=#__codelineno-162-18 id=__codelineno-162-18 name=__codelineno-162-18></a>1.推送音频文件到小机端:adb push 16000.wav /tmp/16000.wav
</code></pre></div> <p>2.配置I2S Loopback功能:amixer -D hw:snddaudio2 cset name='sunxi daudio loopback debug' 1 3.开始录音：arecord -D hw:snddaudio2 -f S16_LE -r 44100 -c 2 /tmp/test_su.wav --period-size1024 --buffer-size 4096 &amp; 4.开始播放：aplay -D hw:snddaudio2 /tmp/16000.wav 5.aplay播放结束后，killall arecord结束录音任务 6.通过adb命令把test_su.wav拉出来，在PC端查看音频数据是否跟播放的内容一致</p> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2022 100ask Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "header.autohide", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=https://unpkg.com/d3@6.7.0/dist/d3.min.js></script> <script src=https://unpkg.com/markmap-lib@0.14.1/dist/browser/index.min.js></script> <script src=https://unpkg.com/markmap-view@0.14.0/dist/index.min.js></script> </body> </html>