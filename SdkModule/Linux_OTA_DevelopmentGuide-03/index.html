<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tina SDK Docs Start Page."><meta name=author content=100askTeam><link href=https://github.com/DongshanPI/TinaSDK-Docs.git/SdkModule/Linux_OTA_DevelopmentGuide-03/ rel=canonical><link href=../Linux_OTA_DevelopmentGuide-02/ rel=prev><link href=../Linux_OTA_DevelopmentGuide-04/ rel=next><link rel=icon href=../../favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Tina_SWUpdate_OTA介绍 - 全志Linux Tina-SDK开发完全手册</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-LZX4K52CZ1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-LZX4K52CZ1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-LZX4K52CZ1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#3-tina-swupdate-ota class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=https://tina.100ask.net title="全志Linux Tina-SDK开发完全手册" class="md-header__button md-logo" aria-label="全志Linux Tina-SDK开发完全手册" data-md-component=logo> <svg id=图层_1 data-name="图层 1" xmlns=http://www.w3.org/2000/svg viewbox="0 0 400 400"><defs><style>.cls-1{fill:#151f45;fill-rule:evenodd;}</style></defs><title>东山派1号LOGO定稿</title><path class=cls-1 d=M339.43,62.45A195.41,195.41,0,0,0,61.92,337.64l-.08.2.55.27.67.67A195.41,195.41,0,1,0,339.43,62.45ZM208.26,19.36a181,181,0,0,1,121.26,53c2.44,2.48,4.83,5,7.15,7.59H208.26Zm0,166.87h44.23v-14H208.26v-35.9H269l5.19,0c11.24-.11,20.56-.23,30.47,6.14,20.17,12.89,15.49,40.5,15.49,40.57l-.08.44c-3.18,34.71-41.83,31.18-42,31.18l-.55,0H208.26ZM19.89,200.62A181.39,181.39,0,0,1,194.22,19.36V80H149.68c-4,0-6.06,0-8.22-.08-11-.23-23.75-.47-33.26,1.77C100.61,83.45,92.12,86.91,85,93.52s-12.58,16.31-13.88,30.35h.08a10.59,10.59,0,0,0-.36,1.53c-.15,1.34-.35,3.23-.43,5.51-.39,11.71,2,34.28,23.28,47.3,14.43,8.8,28.58,8.49,43.6,8.14,2.24,0,4.52-.12,8.49-.12h48.4v28.31H20.4C20.05,209.94,19.89,205.3,19.89,200.62Zm174.33-64.33v35.9h-48.4c-1.88,0-5.34.12-8.76.2-12.9.27-25.09.55-36-6.14C85.83,157,84.13,140.11,84.45,131.34l0-1.22.12,0,.47-5C86,115,89.76,108.22,94.59,103.7s11.13-7.08,16.79-8.42c8-1.84,19.74-1.65,29.84-1.45,3.7.08,7.32.16,8.46.16h44.54v28.27H152.67v14ZM22,228.57H194.22v19.07A157.63,157.63,0,0,0,68.88,324.59,180.64,180.64,0,0,1,22,228.57ZM294.92,356c-.59.4-1.18.75-1.81,1.1-.9.55-1.85,1.11-2.79,1.58a6.64,6.64,0,0,1-.95.55,181.66,181.66,0,0,1-176.3,0c-.27-.16-.59-.32-.86-.47-.91-.51-1.81-1.07-2.72-1.58l-2-1.18a180,180,0,0,1-28.31-21.15,143.82,143.82,0,0,1,248.49-4.09A179.72,179.72,0,0,1,294.92,356Zm42.74-35.78a158,158,0,0,0-129.4-72.85V228.57h69.12c4.6.32,52.1,2.52,56.58-43.6.36-2.36,5.27-37.08-21.74-54.38-13.41-8.61-24.65-8.49-38.14-8.33H208.26V94H348a181.41,181.41,0,0,1-10.34,226.19Z /><path class=cls-1 d=M294.92,356a30,30,0,0,1-3.93-2c-11.52-5-17.07-9.2-21.43-12.94-2.28-1.92-6.84-6.13-8.26-8.14-8.81-12.58-9.75-9.86-12-6-1.14,2-8.1,9.59-9.87,11.16a58,58,0,0,1-15.29,9.6,58.91,58.91,0,0,1-31.81,3.93c-33.81-5.35-34.68-28.23-45.1-27.48-3.77,10.34-23.51,25.4-36.25,30.43-1.1.43-2.24.9-3.46,1.37-1.53.59-3.11,1.18-4.8,1.69l-6,1.66c-2.52,1-1.14.35-2.28,1.33,1.37.75-.32.4,1.69.47,2.71.08,10-2.67,13.4-4l1-.39c5.46-2.16,9.55-4.64,13.76-6.8l-8.81,6.45c-.47.31-1.33.82-1.65,1l-1.53,1.3-.59.51,1.45,0,65.7-1.54-8.8-4.24c-2.84-1.77-7.16-5.35-8.65-7.9,15.09,14.15,42.73,17.45,64.12,9.55,4.76-1.77,13.37-6.84,15.77-9.52-6.09,8.22-11.8,9.17-18.13,12.47-1.73.86-.9.39-1.8,1.1l68.09.12h1.5a7.13,7.13,0,0,0-.55-.55c-2.68-2.4-8.34-4.88-11-8.1,3.81,1.69,8.65,4.28,13.8,6.52a62.09,62.09,0,0,0,11.28,3.74,15.82,15.82,0,0,0,2,.24c1.93-.08.47.19,1.77-.44C306,358.79,299.4,357.61,294.92,356Zm-83-76.51c-1.53-2.32-2.83-4.36-4.48-7.35-8.34-15.34-9.87,2.32-22.14,16.12-7.55,8.49-22.1,19.66-32.16,22.84,1.18.95-1.46,5.47,11.6-2.75,3.77-2.36,5.86-3.81,9.16-5.86a.3.3,0,0,1-.16-.08c-.16-.15.12-.74.87-1.73a22.41,22.41,0,0,1,2.08-1.81c1-.74,2-1.49,3-2.16a24,24,0,0,1,4.05-2.2,24.51,24.51,0,0,1,4.95-1.61,24.85,24.85,0,0,1,5-.47h28.74A102.79,102.79,0,0,1,211.88,279.45Zm-24.14,18.76a20.53,20.53,0,0,0-4.41.82,34,34,0,0,0-5.11,1.93,29.38,29.38,0,0,1-3.14,1.37c-1.46,3.23-1.54,2.72-8,7.24-3.18,2.24-7.47,4.24-10.26,6.72,3.07,5.58,12.07,11.29,18.09,14.31,1.3.63,2.71,1.26,4.21,1.85a7.93,7.93,0,0,1,2.12-3.89l3.07-3.3a18.45,18.45,0,0,0,2.47-4.53,39.27,39.27,0,0,0,1.89-6.21A65.14,65.14,0,0,0,189.9,307c.28-2.71.43-4.91.43-6.6v-2.28C189.62,298.13,188.8,298.17,187.74,298.21Zm61.06,14.94.78-1.3a59.82,59.82,0,0,1-11.08-5.94c-.47-.27-.91-.59-1.38-.86-1.22-.75-2.44-1.62-3.66-2.52-.59-.43-.94-.71-.94-.71-2.28-1.81-4.56-3.81-6.76-5.93v2.24h-10.7c-.47,1.81-.82,3.3-1,4.44a53.25,53.25,0,0,0-.63,5.7,71.55,71.55,0,0,0-.23,8.22c0,2.12.15,4.17.35,6.21s.43,3.74.71,5.15a4.23,4.23,0,0,0,1.06,2.6,2.37,2.37,0,0,0,1.34.43,5.31,5.31,0,0,0,2-.47c1-.36,1.57-.63,2-.83a1.43,1.43,0,0,1,.94-.23,1.21,1.21,0,0,1,.71.51c.12.27-.28.7-1.3,1.33a13.2,13.2,0,0,1-1.53.83c-.59.27-1.54.75-2.83,1.41s-2.28,1.18-2.95,1.54a15.09,15.09,0,0,1-1.85.86,1.27,1.27,0,0,1-1.38-.08c-.19-.07-.43-.43-.7-1a12,12,0,0,1-.67-3.3c-.2-1.61-.32-2.95-.4-4.09s-.07-3.34-.11-6.57,0-5.54.11-7a65.82,65.82,0,0,1,1.11-7.7,35.56,35.56,0,0,1,1.53-5.74l.82-2.24h-19c0,.94,0,2.12,0,3.61s-.08,3.86-.2,7.08-.43,6.53-.87,9.75a58.42,58.42,0,0,1-1.73,8.46,30.58,30.58,0,0,1-2.28,6,6.57,6.57,0,0,1-1.29,1.89,58.67,58.67,0,0,0,15.61,2,63,63,0,0,0,26.18-6.33,51.9,51.9,0,0,0,16.16-12l0-.08a7.77,7.77,0,0,1,.63-.66l.08-.08c.23-.28.51-.55.74-.87a7.6,7.6,0,0,0,.56-.59l0,0c-6.88-5.38-16.67-9.24-19.7-15.76,6.72,4.24,11.44,8.1,19.58,11.79A10.52,10.52,0,0,0,248.8,313.15Z /><path class=cls-1 d=M94.4,356.25s1.51,13.27,20.32,7,0,.6,0,.6L152.2,340l-46.33,16.24Z /><polygon class=cls-1 points="285.18 360.33 299.87 364.24 295.9 358.28 280.17 349.47 276.37 351.72 285.18 360.33"/><path class=cls-1 d=M153.67,312.3l6.26,7.88,18.67-4.47-1.21-13-1.32-.66s-3,.14-3,.72S153.67,312.3,153.67,312.3Z /><path class=cls-1 d=M249.32,312.18l-.81,1.34c-.57.9-1.38,2.13-2.23,3.23a7.4,7.4,0,0,1-.52.65c-.25.33-.53.61-.77.9l-.08.08a6.48,6.48,0,0,0-.65.7l0,.08c-.69.61.44-.86.44-.86l-22.8-9.51,2.47-9.11,7.41,2.09,1,.73c1.25.94,2.51,1.84,3.76,2.61.49.29.93.62,1.42.9A61.07,61.07,0,0,0,249.32,312.18Z /><path class=cls-1 d=M109.89,361.78s154.27-.06,184.2,2.46l-8.8-7.65L244,340l-28.67,15.32H186.72L156.21,340s-17.87,12.11-18,12.12S109.89,361.78,109.89,361.78Z /></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 全志Linux Tina-SDK开发完全手册 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Tina_SWUpdate_OTA介绍 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/en/ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=/zh/ hreflang=zh class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/DongshanPI/TinaSDK-Docs/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> DongshanPI/TinaSDK-Docs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 0.站点指南 </a> </li> <li class=md-tabs__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-01/ class=md-tabs__link> 1.构建工具使用 </a> </li> <li class=md-tabs__item> <a href=../Linux_U-boot_DevelopmentGuide-01/ class=md-tabs__link> 2.Bootloader开发 </a> </li> <li class=md-tabs__item> <a href=../Linux_SID_DevelopmentGuide-01/ class=md-tabs__link> 3.Linux驱动开发 </a> </li> <li class=md-tabs__item> <a href=../Linux_PWM_DevelopmentGuide-01/ class=md-tabs__link> 4.基础组件软件库 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../Linux_Deploy_DevelopmentGuide-01/ class=md-tabs__link> 5.系统开发 </a> </li> <li class=md-tabs__item> <a href=../../ProjectActualCombat/GUI-LvglExample-01/ class=md-tabs__link> 6.应用示例与项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://tina.100ask.net title="全志Linux Tina-SDK开发完全手册" class="md-nav__button md-logo" aria-label="全志Linux Tina-SDK开发完全手册" data-md-component=logo> <svg id=图层_1 data-name="图层 1" xmlns=http://www.w3.org/2000/svg viewbox="0 0 400 400"><defs><style>.cls-1{fill:#151f45;fill-rule:evenodd;}</style></defs><title>东山派1号LOGO定稿</title><path class=cls-1 d=M339.43,62.45A195.41,195.41,0,0,0,61.92,337.64l-.08.2.55.27.67.67A195.41,195.41,0,1,0,339.43,62.45ZM208.26,19.36a181,181,0,0,1,121.26,53c2.44,2.48,4.83,5,7.15,7.59H208.26Zm0,166.87h44.23v-14H208.26v-35.9H269l5.19,0c11.24-.11,20.56-.23,30.47,6.14,20.17,12.89,15.49,40.5,15.49,40.57l-.08.44c-3.18,34.71-41.83,31.18-42,31.18l-.55,0H208.26ZM19.89,200.62A181.39,181.39,0,0,1,194.22,19.36V80H149.68c-4,0-6.06,0-8.22-.08-11-.23-23.75-.47-33.26,1.77C100.61,83.45,92.12,86.91,85,93.52s-12.58,16.31-13.88,30.35h.08a10.59,10.59,0,0,0-.36,1.53c-.15,1.34-.35,3.23-.43,5.51-.39,11.71,2,34.28,23.28,47.3,14.43,8.8,28.58,8.49,43.6,8.14,2.24,0,4.52-.12,8.49-.12h48.4v28.31H20.4C20.05,209.94,19.89,205.3,19.89,200.62Zm174.33-64.33v35.9h-48.4c-1.88,0-5.34.12-8.76.2-12.9.27-25.09.55-36-6.14C85.83,157,84.13,140.11,84.45,131.34l0-1.22.12,0,.47-5C86,115,89.76,108.22,94.59,103.7s11.13-7.08,16.79-8.42c8-1.84,19.74-1.65,29.84-1.45,3.7.08,7.32.16,8.46.16h44.54v28.27H152.67v14ZM22,228.57H194.22v19.07A157.63,157.63,0,0,0,68.88,324.59,180.64,180.64,0,0,1,22,228.57ZM294.92,356c-.59.4-1.18.75-1.81,1.1-.9.55-1.85,1.11-2.79,1.58a6.64,6.64,0,0,1-.95.55,181.66,181.66,0,0,1-176.3,0c-.27-.16-.59-.32-.86-.47-.91-.51-1.81-1.07-2.72-1.58l-2-1.18a180,180,0,0,1-28.31-21.15,143.82,143.82,0,0,1,248.49-4.09A179.72,179.72,0,0,1,294.92,356Zm42.74-35.78a158,158,0,0,0-129.4-72.85V228.57h69.12c4.6.32,52.1,2.52,56.58-43.6.36-2.36,5.27-37.08-21.74-54.38-13.41-8.61-24.65-8.49-38.14-8.33H208.26V94H348a181.41,181.41,0,0,1-10.34,226.19Z /><path class=cls-1 d=M294.92,356a30,30,0,0,1-3.93-2c-11.52-5-17.07-9.2-21.43-12.94-2.28-1.92-6.84-6.13-8.26-8.14-8.81-12.58-9.75-9.86-12-6-1.14,2-8.1,9.59-9.87,11.16a58,58,0,0,1-15.29,9.6,58.91,58.91,0,0,1-31.81,3.93c-33.81-5.35-34.68-28.23-45.1-27.48-3.77,10.34-23.51,25.4-36.25,30.43-1.1.43-2.24.9-3.46,1.37-1.53.59-3.11,1.18-4.8,1.69l-6,1.66c-2.52,1-1.14.35-2.28,1.33,1.37.75-.32.4,1.69.47,2.71.08,10-2.67,13.4-4l1-.39c5.46-2.16,9.55-4.64,13.76-6.8l-8.81,6.45c-.47.31-1.33.82-1.65,1l-1.53,1.3-.59.51,1.45,0,65.7-1.54-8.8-4.24c-2.84-1.77-7.16-5.35-8.65-7.9,15.09,14.15,42.73,17.45,64.12,9.55,4.76-1.77,13.37-6.84,15.77-9.52-6.09,8.22-11.8,9.17-18.13,12.47-1.73.86-.9.39-1.8,1.1l68.09.12h1.5a7.13,7.13,0,0,0-.55-.55c-2.68-2.4-8.34-4.88-11-8.1,3.81,1.69,8.65,4.28,13.8,6.52a62.09,62.09,0,0,0,11.28,3.74,15.82,15.82,0,0,0,2,.24c1.93-.08.47.19,1.77-.44C306,358.79,299.4,357.61,294.92,356Zm-83-76.51c-1.53-2.32-2.83-4.36-4.48-7.35-8.34-15.34-9.87,2.32-22.14,16.12-7.55,8.49-22.1,19.66-32.16,22.84,1.18.95-1.46,5.47,11.6-2.75,3.77-2.36,5.86-3.81,9.16-5.86a.3.3,0,0,1-.16-.08c-.16-.15.12-.74.87-1.73a22.41,22.41,0,0,1,2.08-1.81c1-.74,2-1.49,3-2.16a24,24,0,0,1,4.05-2.2,24.51,24.51,0,0,1,4.95-1.61,24.85,24.85,0,0,1,5-.47h28.74A102.79,102.79,0,0,1,211.88,279.45Zm-24.14,18.76a20.53,20.53,0,0,0-4.41.82,34,34,0,0,0-5.11,1.93,29.38,29.38,0,0,1-3.14,1.37c-1.46,3.23-1.54,2.72-8,7.24-3.18,2.24-7.47,4.24-10.26,6.72,3.07,5.58,12.07,11.29,18.09,14.31,1.3.63,2.71,1.26,4.21,1.85a7.93,7.93,0,0,1,2.12-3.89l3.07-3.3a18.45,18.45,0,0,0,2.47-4.53,39.27,39.27,0,0,0,1.89-6.21A65.14,65.14,0,0,0,189.9,307c.28-2.71.43-4.91.43-6.6v-2.28C189.62,298.13,188.8,298.17,187.74,298.21Zm61.06,14.94.78-1.3a59.82,59.82,0,0,1-11.08-5.94c-.47-.27-.91-.59-1.38-.86-1.22-.75-2.44-1.62-3.66-2.52-.59-.43-.94-.71-.94-.71-2.28-1.81-4.56-3.81-6.76-5.93v2.24h-10.7c-.47,1.81-.82,3.3-1,4.44a53.25,53.25,0,0,0-.63,5.7,71.55,71.55,0,0,0-.23,8.22c0,2.12.15,4.17.35,6.21s.43,3.74.71,5.15a4.23,4.23,0,0,0,1.06,2.6,2.37,2.37,0,0,0,1.34.43,5.31,5.31,0,0,0,2-.47c1-.36,1.57-.63,2-.83a1.43,1.43,0,0,1,.94-.23,1.21,1.21,0,0,1,.71.51c.12.27-.28.7-1.3,1.33a13.2,13.2,0,0,1-1.53.83c-.59.27-1.54.75-2.83,1.41s-2.28,1.18-2.95,1.54a15.09,15.09,0,0,1-1.85.86,1.27,1.27,0,0,1-1.38-.08c-.19-.07-.43-.43-.7-1a12,12,0,0,1-.67-3.3c-.2-1.61-.32-2.95-.4-4.09s-.07-3.34-.11-6.57,0-5.54.11-7a65.82,65.82,0,0,1,1.11-7.7,35.56,35.56,0,0,1,1.53-5.74l.82-2.24h-19c0,.94,0,2.12,0,3.61s-.08,3.86-.2,7.08-.43,6.53-.87,9.75a58.42,58.42,0,0,1-1.73,8.46,30.58,30.58,0,0,1-2.28,6,6.57,6.57,0,0,1-1.29,1.89,58.67,58.67,0,0,0,15.61,2,63,63,0,0,0,26.18-6.33,51.9,51.9,0,0,0,16.16-12l0-.08a7.77,7.77,0,0,1,.63-.66l.08-.08c.23-.28.51-.55.74-.87a7.6,7.6,0,0,0,.56-.59l0,0c-6.88-5.38-16.67-9.24-19.7-15.76,6.72,4.24,11.44,8.1,19.58,11.79A10.52,10.52,0,0,0,248.8,313.15Z /><path class=cls-1 d=M94.4,356.25s1.51,13.27,20.32,7,0,.6,0,.6L152.2,340l-46.33,16.24Z /><polygon class=cls-1 points="285.18 360.33 299.87 364.24 295.9 358.28 280.17 349.47 276.37 351.72 285.18 360.33"/><path class=cls-1 d=M153.67,312.3l6.26,7.88,18.67-4.47-1.21-13-1.32-.66s-3,.14-3,.72S153.67,312.3,153.67,312.3Z /><path class=cls-1 d=M249.32,312.18l-.81,1.34c-.57.9-1.38,2.13-2.23,3.23a7.4,7.4,0,0,1-.52.65c-.25.33-.53.61-.77.9l-.08.08a6.48,6.48,0,0,0-.65.7l0,.08c-.69.61.44-.86.44-.86l-22.8-9.51,2.47-9.11,7.41,2.09,1,.73c1.25.94,2.51,1.84,3.76,2.61.49.29.93.62,1.42.9A61.07,61.07,0,0,0,249.32,312.18Z /><path class=cls-1 d=M109.89,361.78s154.27-.06,184.2,2.46l-8.8-7.65L244,340l-28.67,15.32H186.72L156.21,340s-17.87,12.11-18,12.12S109.89,361.78,109.89,361.78Z /></svg> </a> 全志Linux Tina-SDK开发完全手册 </label> <div class=md-nav__source> <a href=https://github.com/DongshanPI/TinaSDK-Docs/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> DongshanPI/TinaSDK-Docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../.. class="md-nav__link "> <span class=md-ellipsis> 0.站点指南 </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 0.站点指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../SupportHardware/ class=md-nav__link> <span class=md-ellipsis> 配套硬件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 1.构建工具使用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 1.构建工具使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> TinaSDK_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> TinaSDK_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> Tina环境搭建 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Tina编译与烧写 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> uboot与kernel定制开发 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemSoftware_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 系统定制开发 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> 2.Bootloader开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 2.Bootloader开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> U-boot_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> U-boot_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 编译方法介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> U-Boot功能与配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> U-Boot常用命令介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 调试方法与烧写 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_U-boot_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 常用接口函数 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 3.Linux驱动开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 3.Linux驱动开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> SID_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> SID_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块设计 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 接口设计 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SID_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 可测试性与其他说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> GPIO_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> GPIO_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 使用示例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GPIO_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> MIPI_CSI_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> MIPI_CSI_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> V4L2接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MIPI_CSI_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> MMC_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> MMC_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MMC_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> RTC_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> RTC_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_RTC_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> SPI_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> SPI_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPI_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> Standby_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Standby_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Standby_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Standby_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Standby_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> <span class=md-ellipsis> TWI_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> TWI_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_TWI_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> <span class=md-ellipsis> UART_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> UART_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_UART_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> <span class=md-ellipsis> USB_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> USB_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_USB_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 附录 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_11> <label class=md-nav__link for=__nav_4_11 id=__nav_4_11_label tabindex=0> <span class=md-ellipsis> Key_快速配置使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_11_label aria-expanded=false> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> Key_快速配置使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> GPIO-Key </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> ADC-Key </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Key_Quick_Configuration_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> AXP-Key </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_12> <label class=md-nav__link for=__nav_4_12 id=__nav_4_12_label tabindex=0> <span class=md-ellipsis> PMU_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_12_label aria-expanded=false> <label class=md-nav__title for=__nav_4_12> <span class="md-nav__icon md-icon"></span> PMU_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块使用范例 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PMU_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_13> <label class=md-nav__link for=__nav_4_13 id=__nav_4_13_label tabindex=0> <span class=md-ellipsis> Wi-Fi_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_13_label aria-expanded=false> <label class=md-nav__title for=__nav_4_13> <span class="md-nav__icon md-icon"></span> Wi-Fi_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi简介 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi模组移植 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi_manager与Softap介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Wi-Fi_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 常见问题 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> 4.基础组件软件库 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 4.基础组件软件库 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> PWM_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> PWM_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_PWM_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_PWM_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> MPP_sample_使用说明 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> MPP_sample_使用说明 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-01/ class=md-nav__link> <span class=md-ellipsis> 简述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-02/ class=md-nav__link> <span class=md-ellipsis> 配置编译测试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-03/ class=md-nav__link> <span class=md-ellipsis> 分类情况 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-04/ class=md-nav__link> <span class=md-ellipsis> 各平台支持情况 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-05/ class=md-nav__link> <span class=md-ellipsis> 测试方法 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_MPP_Sample_Instructions-06/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> Camera_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Camera_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块开发 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 模块配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 模块调试常见问题 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Camera_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> camera功能测试 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> E907_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> E907_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 启动E907环境 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> AMP环境搭建 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 开发使用 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_E907_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 其他 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> LCD_调试指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> LCD_调试指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 硬件参数说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 调试方法 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_LCD_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 总结 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> Display_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Display_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块接口概述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 操作与接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 输出设备介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> IOCTL接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> sysfs接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-08/ class=md-nav__link> <span class=md-ellipsis> 数据结构 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Display_DevelopmentGuide-09/ class=md-nav__link> <span class=md-ellipsis> 调试 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> 图形系统_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> 图形系统_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> MiniGUI </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> QT </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> EFL与GTK+ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> WebKitGtk与DirectFB </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> Wayland </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> LVGL </span> </a> </li> <li class=md-nav__item> <a href=../Linux_GraphicsSystem_DevelopmentGuide-08/ class=md-nav__link> <span class=md-ellipsis> Flutter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> 音频_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> 音频_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 常用工具及调试方法 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 常用接口说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 开机音乐功能 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_AudioFrequency_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 各平台音频模块注意事项 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> WiFi_RF测试_使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> WiFi_RF测试_使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> WiFi测试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> XRADIO系列模组 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> RTL系列模组 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_WiFi_RFTest_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> SRRC认证 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex=0> <span class=md-ellipsis> 各平台多媒体格式支持列表 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> 各平台多媒体格式支持列表 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Support_List_Multimedia_Formats_Each_Platform-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Support_List_Multimedia_Formats_Each_Platform-02/ class=md-nav__link> <span class=md-ellipsis> 芯片 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex=0> <span class=md-ellipsis> 配网_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> 配网_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Distribution_Network_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Distribution_Network_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> wifimanager-v2.0配网 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Distribution_Network_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 测试说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> 网络性能_参考指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> 网络性能_参考指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Network_Performance_Reference_Guide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Network_Performance_Reference_Guide-02/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi性能测试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Network_Performance_Reference_Guide-03/ class=md-nav__link> <span class=md-ellipsis> 蓝牙与WIFI蓝牙共存测试 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> 5.系统开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 5.系统开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 系统配置_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 系统配置_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 系统配置介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 设备树介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 设备树的使用与调试 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Deploy_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> 分区表说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> 系统调试_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> 系统调试_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SystemDebug_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemDebug_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 调试方法及工具 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> 系统裁剪_参考指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> 系统裁剪_参考指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SystemClipping_Reference_Guide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SystemClipping_Reference_Guide-02/ class=md-nav__link> <span class=md-ellipsis> 系统裁剪介绍 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 启动优化_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 启动优化_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_systemStartup_Optimization-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_systemStartup_Optimization-02/ class=md-nav__link> <span class=md-ellipsis> 启动速度优化简介 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_systemStartup_Optimization-03/ class=md-nav__link> <span class=md-ellipsis> Tina启动速度优化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> SPINAND_UBI_离线烧录_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> SPINAND_UBI_离线烧录_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Spinubi_OfflineBurning_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Spinubi_OfflineBurning_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 数据布局说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Spinubi_OfflineBurning_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 调整内存说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> NOR_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> NOR_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 模块介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 接口描述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_NOR_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 使用例子 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_7> <label class=md-nav__link for=__nav_6_7 id=__nav_6_7_label tabindex=0> <span class=md-ellipsis> SPINAND 开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_7_label aria-expanded=false> <label class=md-nav__title for=__nav_6_7> <span class="md-nav__icon md-icon"></span> SPINAND 开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_SPINAND_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPINAND_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 流程设计 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_SPINAND_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 模块配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_8> <label class=md-nav__link for=__nav_6_8 id=__nav_6_8_label tabindex=0> <span class=md-ellipsis> 存储_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_8_label aria-expanded=false> <label class=md-nav__title for=__nav_6_8> <span class="md-nav__icon md-icon"></span> 存储_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 分区管理 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 系统挂载 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 文件系统支持情况 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> UBI_VS._NFTL </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> rootfs_data及UDISK </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Save_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> 关键数据保护 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_9 checked> <label class=md-nav__link for=__nav_6_9 id=__nav_6_9_label tabindex=0> <span class=md-ellipsis> OTA_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_9_label aria-expanded=true> <label class=md-nav__title for=__nav_6_9> <span class="md-nav__icon md-icon"></span> OTA_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> ota-burnboot介绍 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Tina_SWUpdate_OTA介绍 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Tina_SWUpdate_OTA介绍 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#3-tina-swupdate-ota class=md-nav__link> <span class=md-ellipsis> 3 Tina SWUpdate OTA 介绍 </span> </a> <nav class=md-nav aria-label="3 Tina SWUpdate OTA 介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-swupdate class=md-nav__link> <span class=md-ellipsis> 3.1 swupdate 介绍 </span> </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> <span class=md-ellipsis> 3.2 配置 </span> </a> </li> <li class=md-nav__item> <a href=#33-ota class=md-nav__link> <span class=md-ellipsis> 3.3 OTA 包 </span> </a> </li> <li class=md-nav__item> <a href=#34-recovery class=md-nav__link> <span class=md-ellipsis> 3.4 recovery 系统方案举例 </span> </a> </li> <li class=md-nav__item> <a href=#35-ab class=md-nav__link> <span class=md-ellipsis> 3.5 AB 系统方案举例 </span> </a> </li> <li class=md-nav__item> <a href=#36-swupdate_cmdsh class=md-nav__link> <span class=md-ellipsis> 3.6 辅助脚本swupdate_cmd.sh </span> </a> </li> <li class=md-nav__item> <a href=#37 class=md-nav__link> <span class=md-ellipsis> 3.7 版本号 </span> </a> </li> <li class=md-nav__item> <a href=#38 class=md-nav__link> <span class=md-ellipsis> 3.8 签名校验 </span> </a> </li> <li class=md-nav__item> <a href=#39 class=md-nav__link> <span class=md-ellipsis> 3.9 压缩 </span> </a> </li> <li class=md-nav__item> <a href=#310-ota class=md-nav__link> <span class=md-ellipsis> 3.10 调用OTA </span> </a> </li> <li class=md-nav__item> <a href=#311_1 class=md-nav__link> <span class=md-ellipsis> 3.11 裁剪 </span> </a> </li> <li class=md-nav__item> <a href=#312 class=md-nav__link> <span class=md-ellipsis> 3.12 调试 </span> </a> </li> <li class=md-nav__item> <a href=#313 class=md-nav__link> <span class=md-ellipsis> 3.13 测试固件示例 </span> </a> </li> <li class=md-nav__item> <a href=#314 class=md-nav__link> <span class=md-ellipsis> 3.14 升级定制分区 </span> </a> </li> <li class=md-nav__item> <a href=#3143 class=md-nav__link> <span class=md-ellipsis> 3.14.3 需要备份 </span> </a> </li> <li class=md-nav__item> <a href=#315-handler class=md-nav__link> <span class=md-ellipsis> 3.15 handler 说明 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> Tina_misc-upgrade介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> Tina_upgrade_app介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_OTA_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 注意事项与问题排查 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_10> <label class=md-nav__link for=__nav_6_10 id=__nav_6_10_label tabindex=0> <span class=md-ellipsis> syslog_使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_10_label aria-expanded=false> <label class=md-nav__title for=__nav_6_10> <span class="md-nav__icon md-icon"></span> syslog_使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> syslog相关软件工具 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> 不同syslog方案的对比 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> 其他注意事项 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_syslog_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> 在Tina中使用syslog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_11> <label class=md-nav__link for=__nav_6_11 id=__nav_6_11_label tabindex=0> <span class=md-ellipsis> 安全_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_11_label aria-expanded=false> <label class=md-nav__title for=__nav_6_11> <span class="md-nav__icon md-icon"></span> 安全_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 安全系统基础 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 安全启动 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 安全操作系统 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> TA/CA开发环境 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-06/ class=md-nav__link> <span class=md-ellipsis> 安全存储 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-07/ class=md-nav__link> <span class=md-ellipsis> 安全性增强的Linux </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-08/ class=md-nav__link> <span class=md-ellipsis> 量产工具 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Security_DevelopmentGuide-09/ class=md-nav__link> <span class=md-ellipsis> 参考资料 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_12> <label class=md-nav__link for=__nav_6_12 id=__nav_6_12_label tabindex=0> <span class=md-ellipsis> 功耗管理_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_12_label aria-expanded=false> <label class=md-nav__title for=__nav_6_12> <span class="md-nav__icon md-icon"></span> 功耗管理_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> Tina功耗管理框架概述 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> Tina休眠唤醒系统简介 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-04/ class=md-nav__link> <span class=md-ellipsis> 差异化方案说明 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Power_Consumption_Management_DevelopmentGuide-05/ class=md-nav__link> <span class=md-ellipsis> FAQ问题及处理方法 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_13> <label class=md-nav__link for=__nav_6_13 id=__nav_6_13_label tabindex=0> <span class=md-ellipsis> 内存优化_开发指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_13_label aria-expanded=false> <label class=md-nav__title for=__nav_6_13> <span class="md-nav__icon md-icon"></span> 内存优化_开发指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Memory_Optimization_DevelopmentGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Memory_Optimization_DevelopmentGuide-02/ class=md-nav__link> <span class=md-ellipsis> 内存使用情况分析 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Memory_Optimization_DevelopmentGuide-03/ class=md-nav__link> <span class=md-ellipsis> 内存优化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_14> <label class=md-nav__link for=__nav_6_14 id=__nav_6_14_label tabindex=0> <span class=md-ellipsis> 存储性能_参考指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_14_label aria-expanded=false> <label class=md-nav__title for=__nav_6_14> <span class="md-nav__icon md-icon"></span> 存储性能_参考指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-02/ class=md-nav__link> <span class=md-ellipsis> 经验性能值 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-03/ class=md-nav__link> <span class=md-ellipsis> 顺序与随机读写性能 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Storage_Performance_Reference_Guide-04/ class=md-nav__link> <span class=md-ellipsis> 读写性能的影响因素 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_15> <label class=md-nav__link for=__nav_6_15 id=__nav_6_15_label tabindex=0> <span class=md-ellipsis> 打包流程_说明指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_15_label aria-expanded=false> <label class=md-nav__title for=__nav_6_15> <span class="md-nav__icon md-icon"></span> 打包流程_说明指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-02/ class=md-nav__link> <span class=md-ellipsis> 打包工具介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-03/ class=md-nav__link> <span class=md-ellipsis> 打包脚本分析 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-04/ class=md-nav__link> <span class=md-ellipsis> 获得打包后的分区镜像文件 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-05/ class=md-nav__link> <span class=md-ellipsis> 打包常见问题FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Packaging_Process_DescriptionGuide-06/ class=md-nav__link> <span class=md-ellipsis> 打包流程总结 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_16> <label class=md-nav__link for=__nav_6_16 id=__nav_6_16_label tabindex=0> <span class=md-ellipsis> 量产测试_使用指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_16_label aria-expanded=false> <label class=md-nav__title for=__nav_6_16> <span class="md-nav__icon md-icon"></span> 量产测试_使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-01/ class=md-nav__link> <span class=md-ellipsis> 概述与介绍 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-02/ class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-03/ class=md-nav__link> <span class=md-ellipsis> 测试环境搭建 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-04/ class=md-nav__link> <span class=md-ellipsis> 量产测试流程 </span> </a> </li> <li class=md-nav__item> <a href=../Linux_Mass_Production_UserGuide-05/ class=md-nav__link> <span class=md-ellipsis> 各平台Tinatest场景验证表 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> 6.应用示例与项目 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 6.应用示例与项目 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> LVGL开发实战 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> LVGL开发实战 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ProjectActualCombat/GUI-LvglExample-01/ class=md-nav__link> <span class=md-ellipsis> 2048小游戏 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#3-tina-swupdate-ota class=md-nav__link> <span class=md-ellipsis> 3 Tina SWUpdate OTA 介绍 </span> </a> <nav class=md-nav aria-label="3 Tina SWUpdate OTA 介绍"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-swupdate class=md-nav__link> <span class=md-ellipsis> 3.1 swupdate 介绍 </span> </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> <span class=md-ellipsis> 3.2 配置 </span> </a> </li> <li class=md-nav__item> <a href=#33-ota class=md-nav__link> <span class=md-ellipsis> 3.3 OTA 包 </span> </a> </li> <li class=md-nav__item> <a href=#34-recovery class=md-nav__link> <span class=md-ellipsis> 3.4 recovery 系统方案举例 </span> </a> </li> <li class=md-nav__item> <a href=#35-ab class=md-nav__link> <span class=md-ellipsis> 3.5 AB 系统方案举例 </span> </a> </li> <li class=md-nav__item> <a href=#36-swupdate_cmdsh class=md-nav__link> <span class=md-ellipsis> 3.6 辅助脚本swupdate_cmd.sh </span> </a> </li> <li class=md-nav__item> <a href=#37 class=md-nav__link> <span class=md-ellipsis> 3.7 版本号 </span> </a> </li> <li class=md-nav__item> <a href=#38 class=md-nav__link> <span class=md-ellipsis> 3.8 签名校验 </span> </a> </li> <li class=md-nav__item> <a href=#39 class=md-nav__link> <span class=md-ellipsis> 3.9 压缩 </span> </a> </li> <li class=md-nav__item> <a href=#310-ota class=md-nav__link> <span class=md-ellipsis> 3.10 调用OTA </span> </a> </li> <li class=md-nav__item> <a href=#311_1 class=md-nav__link> <span class=md-ellipsis> 3.11 裁剪 </span> </a> </li> <li class=md-nav__item> <a href=#312 class=md-nav__link> <span class=md-ellipsis> 3.12 调试 </span> </a> </li> <li class=md-nav__item> <a href=#313 class=md-nav__link> <span class=md-ellipsis> 3.13 测试固件示例 </span> </a> </li> <li class=md-nav__item> <a href=#314 class=md-nav__link> <span class=md-ellipsis> 3.14 升级定制分区 </span> </a> </li> <li class=md-nav__item> <a href=#3143 class=md-nav__link> <span class=md-ellipsis> 3.14.3 需要备份 </span> </a> </li> <li class=md-nav__item> <a href=#315-handler class=md-nav__link> <span class=md-ellipsis> 3.15 handler 说明 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Tina_SWUpdate_OTA介绍</h1> <h2 id=3-tina-swupdate-ota>3 Tina SWUpdate OTA 介绍</h2> <h3 id=31-swupdate>3.1 swupdate 介绍</h3> <h4 id=311>3.1.1 简介</h4> <p>SWUpdate 是一个开源的OTA 框架，提供了一种灵活可靠的方式来更新嵌入式系统上的软件。</p> <p>官方源码：</p> <p><a href=https://github.com/sbabic/swupdate>https://github.com/sbabic/swupdate</a></p> <p>官方文档：</p> <p><a href=http://sbabic.github.io/swupdate/ >http://sbabic.github.io/swupdate/</a></p> <p>非官方翻译的中文文档：</p> <p><a href=https://zqb-all.github.io/swupdate/ >https://zqb-all.github.io/swupdate/</a></p> <p>源码自带文档：</p> <p>解压tina/dl/swupdate-xxx.tar.xz ，解压后的doc 目录下即为此版本源码附带的文档。</p> <p>社区论坛：</p> <p><a href=https://groups.google.com/forum/#!forum/swupdate>https://groups.google.com/forum/#!forum/swupdate</a></p> <h4 id=312-tina>3.1.2 移植到tina 的改动</h4> <p>移植到tina 主要做了以下修改：</p> <p>• 位置在package/allwinner/swupdate。</p> <p>• 仿照busybox，添加了配置项，可通过make menuconfig 直接配置。</p> <p>• 添加patch，支持了更新boot0,uboot。</p> <p>• 添加了自启动脚本。</p> <p>• 默认启动progress 在后台，输出到串口。这样升级时会打印进度条。实际方案不需要的话，可去除。客户应用可参考progress 源码，自行获取进度信息。</p> <p>• 默认启动一个脚本swupdate_cmd.sh，负责完善参数，最终调用swupdate。脚本介绍详见后续章节。</p> <h3 id=32>3.2 配置</h3> <h4 id=321-recovery>3.2.1 recovery 系统介绍</h4> <p>若选用主系统+recovery 系统的方式，则需要一个recovery 系统。</p> <p>recovery 系统是一个带initramfs 的kernel。对应的配置文件是target/allwinner/xxx/defconfig_ota。</p> <p>如果没有此文件，可以拷贝defconfig 为defconfig_ota，再做配置裁剪。</p> <h4 id=322>3.2.2 系统配置命令</h4> <p>对于主系统，使用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>make menuconfig
</code></pre></div> <p>配置结果保存在：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>target/allwinner/xxx/defconfig
</code></pre></div> <p>对于recovery 系统，使用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>make ota_menuconfig
</code></pre></div> <p>配置结果保存在：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>target/allwinner/xxx/defconfig_ota
</code></pre></div> <h4 id=323-recovery-swupdate>3.2.3 主系统和recovery 都需要的swupdate 包</h4> <p>选上swupdate 包。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a>Allwinner --&gt; [*]swupdate
</code></pre></div> <p>swupdate 中还有很多细分选项，一般用默认配置即可。需要的话可以做一些调整，比如裁剪掉网络部分。</p> <p>swupdate 会依赖选中uboot-envtools 包，以提供用户空间读写env 分区的功能。</p> <h4 id=324-recovery-wifimanager-daemon>3.2.4 主系统和recovery 都需要的wifimanager daemon</h4> <p>如果想从网络升级，则需要启动系统自动联网。</p> <p>一种实现方式是，使用wifimanager daemon 。当然，如果用户自己在脚本或应用中去做联网，则不需要此选项。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>Allwinner
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>---&gt; &lt;*&gt; wifimanager
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a>---&gt; [*] Enable wifimanager daemon support
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a>---&gt; &lt;*&gt; wifimanager-daemon-demo..................... Tina wifimanager
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a>daemon demo
</code></pre></div> <h4 id=325>3.2.5 配置主系统</h4> <p>就以上提到的几个包，暂时没有只针对主系统的需要选的包。</p> <h4 id=326>3.2.6 编译主系统</h4> <p>正常make 即生成主系统。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>make
</code></pre></div> <h4 id=327-recovery>3.2.7 配置recovery 系统</h4> <p>对于recovey 系统，需要选上ramdisk，同时建议使用xz 压缩方式以节省flash 空间。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>make ota_menuconfig
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>    ---&gt; Target Images
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a>        ---&gt; [*] ramdisk
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>            ---&gt; Compression (xz)
</code></pre></div> <p>选上recovery 后缀，避免编译recovery 系统时，影响到主系统。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>make ota_menuconfig
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>    ---&gt; Target Images
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>        ---&gt; [*] customize image name
<a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a>            ---&gt; Boot Image(kernel) name suffix (boot_recovery.img/boot_initramfs_recovery.img)
<a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a>            ---&gt; Rootfs Image name suffix (rootfs_recovery.img)
</code></pre></div> <h4 id=328-recovery>3.2.8 编译recovery 系统</h4> <p>要编译生成recovery 系统，可使用： swupdate_make_recovery_img 或手工调用： make -j16 TARGET_CONFIG=./target/allwinner/xxx/defconfig_ota 编译得到： out/xxx/boot_initramfs_recovery.img</p> <h4 id=329-env>3.2.9 配置env</h4> <p>本方案推荐使用env 来保存信息，不使用misc 分区。</p> <p>uboot 会从env 分区读取启动命令，并根据启动命令来启动系统。只要我们能在用户空间改动到env，即可控制下次启动的系统。</p> <h5 id=3291-boot_partition>3.2.9.1 boot_partition 变量</h5> <p>增加一个boot_partition 变量，用于指定要启动的内核所在分区。</p> <p>配置env 主要是修改boot_normal 命令，将要启动的分区独立成boot_partition 变量。</p> <p>即从：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>boot_normal=fatload sunxi_flash boot 40007fc0 uImage;bootm 40007fc0
</code></pre></div> <p>改成：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a>boot_partition=boot
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>boot_normal=fatload sunxi_flash ${boot_partition} 40007fc0 uImage;bootm 40007fc0
</code></pre></div> <p>这样可以通过控制boot_partition 来直接选择下次要启动的系统，无需uboot 介入。uboot 只需按照boot_normal 启动即可。</p> <p>对于recovery 方案，可设置boot_partition 为boot 或recovery。OTA 切换系统时，只需要改变此变量即可达到切换主系统和recovery 系统的目的。</p> <p>对于AB 系统方案，可设置为boot_partition 为bootA 或bootB。OTA 切换系统时，只需要改变此变量即可达到切换kernel 的目的。</p> <h5 id=3292-root_partition>3.2.9.2 root_partition 变量</h5> <p>增加一个root_partition 变量，用于指定要启动的rootfs 所在分区。</p> <p>uboot 会解析分区表，找出此变量指定的分区并在cmdline 中指定root 参数。</p> <p>例如，在env 中设置：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a>root_partition=rootfs
</code></pre></div> <p>则启动时uboot 会遍历分区表，找到名字为rootfs 的分区，假设找到的分区为/dev/nand0p4，则在cmdline 中增加root=/dev/nand0p4。</p> <p>kernel 需要挂载rootfs 时，取出root 参数，则得知需要挂载/dev/nand0p4 分区。</p> <p>对于recovery 方案，就一直设置root_partition 为rootfs 即可。主系统需要从rootfs 分区读取数据，而recovery 系统使用initramfs，无需从rootfs 分区读取数据</p> <p>即可正常运行OTA 应用等。当然，recovery 系统中要更新rootfs 的话，还是会访问(写入)rootfs 分区的，但这个动作就跟env 的root_partition 无关了。</p> <p>对于AB 系统方案，可设置root_partition 为rootfsA 或rootfsB，以匹配不同的系统。OTA切换系统时，只需要改变此变量即可达到切换rootfs 的目的。</p> <h4 id=3210-env>3.2.10 配置备份env</h4> <p>由于写入env 时断电，可能导致env 的数据被破坏，因此需要支持备份env。</p> <h5 id=32101-env-env>3.2.10.1 方式一：env 分区扩展为存放两份env</h5> <p>此方式是在uboot 中进行定制实现，非社区原生方案。</p> <p>可在uboot源码中搜索CONFIG_SUNXI_ENV_NOT_BACKUP, 若存在则说明支持此功能。</p> <p>支持此功能后，只要uboot不配置CONFIG_SUNXI_ENV_NOT_BACKUP，则此功能默认开启。uboot会将env数据在同一分区中进行备份。</p> <p>启用方法：</p> <ol> <li>修改分区表，将env 分区扩大到128k*2=256k。</li> </ol> <p>工作方式： uboot 检测到env 分区足够大，则激活env 备份功能，认为0-128k 存放第一份env 数据，128k-256k 存放第二份env 数据。由于env 数据本身带有CRC 校验，所</p> <p>以可判断一份env 是否完整。启动时，uboot 会对两份env 进行同步，若某一份损坏则取另一份进行覆盖，若两份均完整，则以第一份为准。</p> <p>对于用户空间的fw_printenv，默认只会更新第一份env，即执行fw_setenv 之后两份env 就有差异了，要到下次启动才由uboot 进行同步。若更新env 的过程中发</p> <p>生掉电，则第一份env不完整，重新启动时，uboot 会识别到并用第二份env 覆盖第一份。</p> <p>确认是否生效：</p> <p>1.直接观察。 用户空间控制台执行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>hexdump -C /dev/by-name/env
</code></pre></div> <p>确认是否存在两份。</p> <p>2.尝试破坏env。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a>dd if=/dev/zero of=/dev/by-name/env bs=1k count=1
</code></pre></div> <p>损坏第一份env，重启看能否正常启动，并尝试</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a>fw_printenv
<a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a>hexdump -C /dev/by-name/env
</code></pre></div> <p>确认env 分区数据是否正常。</p> <h5 id=32102-env-redund>3.2.10.2 方式二：增加env-redund 分区</h5> <p>此方式是uboot 原生功能。虽然也需要修改sunxi 的env 读取代码进行适配，但总体读写逻辑是社区原生的。 启用方法：</p> <p>1.增加env-redund 分区。</p> <p>将env 分区复制一份，分区名改为env-redund。</p> <p>注意只是分区名修改为env-redund，其downloadfile 仍然指定为env.fex</p> <p>2.支持在打包时制作冗余env。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>make menuconfig --&gt; Global build settings --&gt; [*] sunxi make redundant env data
</code></pre></div> <p>注意事项： 启用上述选项之后，打包时会调用mkenvimage 工具来制作env，对env 的格式有一定要求。</p> <p>如注释和有效配置不能合并在一行。</p> <p>若env-x.x.cfg 中存在类似如下配置</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a>bootcmd=run setargs_nand boot_normal#default nand boot
</code></pre></div> <p>则需要改成：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a>#default nand boot
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a>bootcmd=run setargs_nand boot_normal
</code></pre></div> <p>3.配置uboot 并重新编译uboot bin。</p> <p>以r328 spinand 方案为例。</p> <p>在</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a>lichee/brandy-2.0/u-boot-2018/configs/sun8iw18p1_defconfig
</code></pre></div> <p>中增加配置：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-19-1 id=__codelineno-19-1 name=__codelineno-19-1></a>CONFIG_SUNXI_REDUNDAND_ENVIRONMENT=y
</code></pre></div> <p>重新编译uboot。</p> <p>4.修改fw_env.config</p> <p>拷贝</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a>package/utils/uboot-envtools/files/fw_env.config
</code></pre></div> <p>到</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a>target/allwinner/&lt;board&gt;/base-files/etc/ （若使用procd-init）
<a href=#__codelineno-21-2 id=__codelineno-21-2 name=__codelineno-21-2></a>target/allwinner/&lt;board&gt;/busybox-init-base-files/etc/ （若使用busybox-init）
</code></pre></div> <p>修改拷贝后的fw_env.config，增加备份env 的配置。</p> <p>例如原本最后一行为：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a>/dev/by-name/env 0x0000 0x20000
</code></pre></div> <p>则增加一行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a>/dev/by-name/env-redund 0x0000 0x20000
</code></pre></div> <p>这样用户空间的fw_printenv 和fw_setenv 即可正确处理两份env。</p> <h4 id=3211>3.2.11 配置启动脚本</h4> <p>procd-init 是默认配置好的。</p> <p>busybox-init 需要手工配置下。</p> <p>参考《Tina System init 使用说明文档》, 拷贝</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-24-1 id=__codelineno-24-1 name=__codelineno-24-1></a>&lt;tina&gt;/package/busybox-init-base-files/files/etc/init.d/load_script.conf
</code></pre></div> <p>到</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-25-1 id=__codelineno-25-1 name=__codelineno-25-1></a>&lt;tina&gt;/target/allwinner/&lt;platform&gt;/busybox-init-base-files/etc/init.d/
</code></pre></div> <p>并在其中添加一行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-26-1 id=__codelineno-26-1 name=__codelineno-26-1></a>swupdate_autorun
</code></pre></div> <h3 id=33-ota>3.3 OTA 包</h3> <p>OTA 包中，需要包含sw-description 文件，以及本次升级会用到的各个文件，例如kernel，rootfs。</p> <p>整个OTA 包是cpio 格式，且要求sw-description 文件在第一个。</p> <h4 id=331-ota-sw-description>3.3.1 OTA 策略描述文件：sw-description</h4> <p>sw-description 文件是swupdate 官方规定的，OTA 策略的描述文件，具体语法可参考swupdate官方文档。</p> <p>tina 提供了几个示例：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-27-1 id=__codelineno-27-1 name=__codelineno-27-1></a>target/allwinner/generic/swupdate/sw-description-ab
<a href=#__codelineno-27-2 id=__codelineno-27-2 name=__codelineno-27-2></a>target/allwinner/generic/swupdate/sw-description
</code></pre></div> <p>也可以自行为具体的方案编写描述文件：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-28-1 id=__codelineno-28-1 name=__codelineno-28-1></a>target/allwinner/&lt;board&gt;/swupdate/sw-description
</code></pre></div> <p>本文件在SDK 中的存放路径和名字没有限定，只要最终打包进OTA 包中，重命名为swdescription并放在第一个文件即可。</p> <h4 id=332-ota-sw-subimgscfg>3.3.2 OTA 包配置文件：sw-subimgs.cfg</h4> <p>sw-subimgs.cfg 是tina 提供的，用于指示如何生成OTA 包。</p> <p>基本格式为</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-29-1 id=__codelineno-29-1 name=__codelineno-29-1></a>swota_file_list=(
<a href=#__codelineno-29-2 id=__codelineno-29-2 name=__codelineno-29-2></a>#表示把文件xxx拷贝到swupdate目录下，重命名为yyy，并把yyy打包到最终的OTA包中
<a href=#__codelineno-29-3 id=__codelineno-29-3 name=__codelineno-29-3></a>xxx:yyy
<a href=#__codelineno-29-4 id=__codelineno-29-4 name=__codelineno-29-4></a>)
<a href=#__codelineno-29-5 id=__codelineno-29-5 name=__codelineno-29-5></a>swota_copy_file_list=(
<a href=#__codelineno-29-6 id=__codelineno-29-6 name=__codelineno-29-6></a>#表示把文件xxx拷贝到swupdate目录下，重命名为yyy，但不把yyy打包到最终的OTA包中
<a href=#__codelineno-29-7 id=__codelineno-29-7 name=__codelineno-29-7></a>xxx:yyy
<a href=#__codelineno-29-8 id=__codelineno-29-8 name=__codelineno-29-8></a>)
</code></pre></div> <p>swota_copy_file_list 存在的原因是，有一些文件我们只需要其sha256 值，而不需要文件本身。例如使用差分包配合readback handler 时，readback handler 需</p> <p>要原始镜像的sha256值用于校验。</p> <p>例子:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-30-1 id=__codelineno-30-1 name=__codelineno-30-1></a>swota_file_list=(
<a href=#__codelineno-30-2 id=__codelineno-30-2 name=__codelineno-30-2></a>#将target/allwinner/generic/swupdate/sw-description-ab-sign拷贝成sw-description，后续同理。
<a href=#__codelineno-30-3 id=__codelineno-30-3 name=__codelineno-30-3></a>target/allwinner/generic/swupdate/sw-description-ab-sign:sw-description
<a href=#__codelineno-30-4 id=__codelineno-30-4 name=__codelineno-30-4></a>out/${TARGET_BOARD}/uboot.img:uboot
<a href=#__codelineno-30-5 id=__codelineno-30-5 name=__codelineno-30-5></a>out/${TARGET_BOARD}/boot0.img:boot0
<a href=#__codelineno-30-6 id=__codelineno-30-6 name=__codelineno-30-6></a>out/${TARGET_BOARD}/image/boot.fex.gz:kernel.gz
<a href=#__codelineno-30-7 id=__codelineno-30-7 name=__codelineno-30-7></a>out/${TARGET_BOARD}/image/rootfs.fex.gz:rootfs.gz
<a href=#__codelineno-30-8 id=__codelineno-30-8 name=__codelineno-30-8></a>out/${TARGET_BOARD}/image/rootfs.fex.zst:rootfs.zst
<a href=#__codelineno-30-9 id=__codelineno-30-9 name=__codelineno-30-9></a>)
</code></pre></div> <p>tina 提供了几个示例：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-31-1 id=__codelineno-31-1 name=__codelineno-31-1></a>target/allwinner/generic/swupdate/sw-subimgs.cfg # 普通系统，recovery系统，整包升级。这是其余demo的基础版本。
<a href=#__codelineno-31-2 id=__codelineno-31-2 name=__codelineno-31-2></a>target/allwinner/generic/swupdate/sw-subimgs-ab.cfg # 改为AB系统。
<a href=#__codelineno-31-3 id=__codelineno-31-3 name=__codelineno-31-3></a>target/allwinner/generic/swupdate/sw-subimgs-secure.cfg # 改为安全系统。
<a href=#__codelineno-31-4 id=__codelineno-31-4 name=__codelineno-31-4></a>target/allwinner/generic/swupdate/sw-subimgs-ab-rdiff.cfg # 改为AB方案，差分方案。
<a href=#__codelineno-31-5 id=__codelineno-31-5 name=__codelineno-31-5></a>target/allwinner/generic/swupdate/sw-subimgs-readback.cfg # 增加回读校验。
<a href=#__codelineno-31-6 id=__codelineno-31-6 name=__codelineno-31-6></a>target/allwinner/generic/swupdate/sw-subimgs-sign.cfg # 增加签名校验。
<a href=#__codelineno-31-7 id=__codelineno-31-7 name=__codelineno-31-7></a>target/allwinner/generic/swupdate/sw-subimgs-ubi.cfg # 改为ubi方案。
</code></pre></div> <p>也可以自行为具体的方案编写描述文件。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-32-1 id=__codelineno-32-1 name=__codelineno-32-1></a>target/allwinner/&lt;board&gt;/swupdate/sw-subimgs.cfg
</code></pre></div> <p>本文件在SDK 中的路径需位于target/allwinner/<board>/swupdate 目录下，或target/allwinner/generic/swupdate 目录下。</board></p> <p>名字需要命名为sw-subimg.cfg 或sw-subimgsxxx.cfg，其中xxx 可自定义。</p> <p>这个限定主要是为了方便打包函数处理。在打包时，命令行传入参数xxx，则会使用swsubimgsxxx.cfg 进行打包。</p> <h4 id=333-ota-swupdate_pack_swu>3.3.3 OTA 包生成：swupdate_pack_swu</h4> <p>在build/envsetup.sh 中提供了一个swupdate_pack_swu 函数。 可以参考该函数，自行实现一套打包swupdate 升级包的脚本。也可以直接使用，使用方式如下。</p> <ol> <li>准备好sw-descrition 文件，具体作用和语法请参考swupdate 说明文档。</li> <li>准备好sw-subimgs.cfg 文件，里面需要每一行列出一个打包需要的子镜像文件，即内核，rootfs 等。可以使用冒号分隔，前面为SDK 中的文件，后面为打包进OTA 包的文件名。若没有冒号则使用原文件名字。使用相对于tina 根目录的相对路径进行描述。其中第一个必须为swdescription。</li> <li>编译好所需的子镜像，例如主系统的内核和rootfs，recovery 系统等。</li> <li>执行swupdate_pack_swu 生成swupdate 升级包。不带参数执行，则会在特定路径下寻找sw-subimgs.cfg，解析配置生成OTA 包。带参数-xx 执行，则会在特定路径下寻找swsubimgs-xx.cfg，解析配置生成OTA 包。例如执行swupdate_pack_swu -sign，则会寻找sw-subimgs-sign.cfg，如此方便配置多个不同用途的sw-subimgs-xx.cfg。</li> </ol> <p>注：不同介质使用的boot0/uboot 镜像不同，swupate_pack_swu 需要sys_config.fex 中的storage_type 配置明确指出介质类型，才能取得正确的boot0.img 和</p> <p>uboot.img 具体可直接查看build/envsetup.sh 中swupdate_pack_swu 的实现。</p> <h3 id=34-recovery>3.4 recovery 系统方案举例</h3> <h4 id=341-env>3.4.1 配置分区和env</h4> <p>在分区表中，增加一个recovery 分区，用于保存recovery 系统。</p> <p>size 根据实际recovery 系统的大小，再加点裕量。</p> <p>download_file 可以留空，因为OTA 第一步就是写入一个recovery 系统。</p> <p>当然也可以配置上download_file，并在打包固件之前先编译好recovery 系统，一并打包到固件中，这样出厂就带recovery 系统，后续的OTA 执行过程，可以考</p> <p>虑不写入recovert 系统，用现成的，直接重启并升级主系统。</p> <p>在env 中指定：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-33-1 id=__codelineno-33-1 name=__codelineno-33-1></a>boot_partition=boot
<a href=#__codelineno-33-2 id=__codelineno-33-2 name=__codelineno-33-2></a>root_partition=rootfs
</code></pre></div> <p>并配置boot_normal 命令，从$boot_partition 变量指定的分区加载系统。</p> <h4 id=342>3.4.2 配置主系统</h4> <p>lunch 选择方案后, make menuconfig, 选上swupdate。</p> <h4 id=343-recovery>3.4.3 配置recovery 系统</h4> <p>假设没有现成的recovery 系统配置，则我们从主系统配置修改得到。lunch 选择方案后, 拷贝配置文件。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-34-1 id=__codelineno-34-1 name=__codelineno-34-1></a>cdevice
<a href=#__codelineno-34-2 id=__codelineno-34-2 name=__codelineno-34-2></a>cp defconfig defconfig_ota
</code></pre></div> <p>根据上文介绍，make ota_menuconfig 选上swupdate, ramdisk, recovery 后缀等必要的配置。</p> <p>recovery 系统整个运行在ram 中，如果系统过大会无法启动，所以需要进行裁剪。make ota_menuconfig, 将不必要的包尽量从recovery 系统中去掉。</p> <h4 id=344-sw-description>3.4.4 准备sw-description</h4> <p>这里我们直接使用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-35-1 id=__codelineno-35-1 name=__codelineno-35-1></a>target/allwinner/generic/swupdate/sw-description
</code></pre></div> <p>内容如下，中文部分是注释，原文件中没有。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-36-1 id=__codelineno-36-1 name=__codelineno-36-1></a>/* 固定格式，最外层为software = { } */
<a href=#__codelineno-36-2 id=__codelineno-36-2 name=__codelineno-36-2></a>software =
<a href=#__codelineno-36-3 id=__codelineno-36-3 name=__codelineno-36-3></a>{
<a href=#__codelineno-36-4 id=__codelineno-36-4 name=__codelineno-36-4></a>    /* 版本号和描述*/
<a href=#__codelineno-36-5 id=__codelineno-36-5 name=__codelineno-36-5></a>    version = "0.1.0";
<a href=#__codelineno-36-6 id=__codelineno-36-6 name=__codelineno-36-6></a>    description = "Firmware update for Tina Project";
<a href=#__codelineno-36-7 id=__codelineno-36-7 name=__codelineno-36-7></a>    /*
<a href=#__codelineno-36-8 id=__codelineno-36-8 name=__codelineno-36-8></a>    * 外层tag，stable，
<a href=#__codelineno-36-9 id=__codelineno-36-9 name=__codelineno-36-9></a>    * 没有特殊含义，就理解为一个字符串标志即可。
<a href=#__codelineno-36-10 id=__codelineno-36-10 name=__codelineno-36-10></a>    * 可以修改，调用的时候传入匹配的字符串即可
<a href=#__codelineno-36-11 id=__codelineno-36-11 name=__codelineno-36-11></a>    */
<a href=#__codelineno-36-12 id=__codelineno-36-12 name=__codelineno-36-12></a>    stable = {
<a href=#__codelineno-36-13 id=__codelineno-36-13 name=__codelineno-36-13></a>                /*
<a href=#__codelineno-36-14 id=__codelineno-36-14 name=__codelineno-36-14></a>                * 内层tag，upgrade_recovery,
<a href=#__codelineno-36-15 id=__codelineno-36-15 name=__codelineno-36-15></a>                * 当调用swupdate xxx -e stable,upgrade_recovery时，就会匹配到这部分，执行｛｝内的动作，
<a href=#__codelineno-36-16 id=__codelineno-36-16 name=__codelineno-36-16></a>                 * 可以修改，调用的时候传入匹配的字符串即可
<a href=#__codelineno-36-17 id=__codelineno-36-17 name=__codelineno-36-17></a>                */
<a href=#__codelineno-36-18 id=__codelineno-36-18 name=__codelineno-36-18></a>                /* upgrade recovery,uboot,boot0 ==&gt; change swu_mode,boot_partition ==&gt; reboot */
<a href=#__codelineno-36-19 id=__codelineno-36-19 name=__codelineno-36-19></a>                upgrade_recovery = {
<a href=#__codelineno-36-20 id=__codelineno-36-20 name=__codelineno-36-20></a>                /* 这部分是为了在主系统中，升级recovery系统，升级uboot和boot0 */
<a href=#__codelineno-36-21 id=__codelineno-36-21 name=__codelineno-36-21></a>                /* upgrade recovery */
<a href=#__codelineno-36-22 id=__codelineno-36-22 name=__codelineno-36-22></a>                images: ( /* 处理各个image */
<a href=#__codelineno-36-23 id=__codelineno-36-23 name=__codelineno-36-23></a>                    {
<a href=#__codelineno-36-24 id=__codelineno-36-24 name=__codelineno-36-24></a>                        filename = "recovery"; /* 源文件是OTA包中的recovery文件*/
<a href=#__codelineno-36-25 id=__codelineno-36-25 name=__codelineno-36-25></a>                        device = "/dev/by-name/recovery"; /* 要写到/dev/by-name/recovery节点中, 这
<a href=#__codelineno-36-26 id=__codelineno-36-26 name=__codelineno-36-26></a>                        个节点在tina上就对应recovery分区*/
<a href=#__codelineno-36-27 id=__codelineno-36-27 name=__codelineno-36-27></a>                        installed-directly = true; /* 流式升级，即从网络升级时边下载边写入, 而不是先完
<a href=#__codelineno-36-28 id=__codelineno-36-28 name=__codelineno-36-28></a>                        整下载到本地再写入，避免占用额外的RAM或ROM */
<a href=#__codelineno-36-29 id=__codelineno-36-29 name=__codelineno-36-29></a>                    },
<a href=#__codelineno-36-30 id=__codelineno-36-30 name=__codelineno-36-30></a>                    {
<a href=#__codelineno-36-31 id=__codelineno-36-31 name=__codelineno-36-31></a>                        filename = "uboot"; /* 源文件是OTA包中的uboot文件*/
<a href=#__codelineno-36-32 id=__codelineno-36-32 name=__codelineno-36-32></a>                        type = "awuboot"; /* type为awuboot，则swupdate会调用对应的handler做处理*/
<a href=#__codelineno-36-33 id=__codelineno-36-33 name=__codelineno-36-33></a>                    },
<a href=#__codelineno-36-34 id=__codelineno-36-34 name=__codelineno-36-34></a>                    {
<a href=#__codelineno-36-35 id=__codelineno-36-35 name=__codelineno-36-35></a>                        filename = "boot0"; /* 源文件是OTA包中的boot0文件*/
<a href=#__codelineno-36-36 id=__codelineno-36-36 name=__codelineno-36-36></a>                        type = "awboot0"; /* type为awuboot，则swupdate会调用对应的handler做处理*/
<a href=#__codelineno-36-37 id=__codelineno-36-37 name=__codelineno-36-37></a>                    }
<a href=#__codelineno-36-38 id=__codelineno-36-38 name=__codelineno-36-38></a>                );
<a href=#__codelineno-36-39 id=__codelineno-36-39 name=__codelineno-36-39></a>                /* image处理完之后，需要设置一些标志，切换状态*/
<a href=#__codelineno-36-40 id=__codelineno-36-40 name=__codelineno-36-40></a>                /* change swu_mode to upgrade_kernel,boot_partition to recovery &amp; reboot*/
<a href=#__codelineno-36-41 id=__codelineno-36-41 name=__codelineno-36-41></a>                bootenv: ( /* 处理bootenv，会修改uboot的env分区*/
<a href=#__codelineno-36-42 id=__codelineno-36-42 name=__codelineno-36-42></a>                    {
<a href=#__codelineno-36-43 id=__codelineno-36-43 name=__codelineno-36-43></a>                        /* 设置env:swu_mode=upgrade_kernel, 这是为了记录OTA进度*/
<a href=#__codelineno-36-44 id=__codelineno-36-44 name=__codelineno-36-44></a>                        name = "swu_mode";
<a href=#__codelineno-36-45 id=__codelineno-36-45 name=__codelineno-36-45></a>                        value = "upgrade_kernel";
<a href=#__codelineno-36-46 id=__codelineno-36-46 name=__codelineno-36-46></a>                    },
<a href=#__codelineno-36-47 id=__codelineno-36-47 name=__codelineno-36-47></a>                    {
<a href=#__codelineno-36-48 id=__codelineno-36-48 name=__codelineno-36-48></a>                        /* 设置env:boot_partition=recovery, 这是为了切换系统，下次uboot就会启动
<a href=#__codelineno-36-49 id=__codelineno-36-49 name=__codelineno-36-49></a>                        recovery系统(kernel位于recovery分区) */
<a href=#__codelineno-36-50 id=__codelineno-36-50 name=__codelineno-36-50></a>                        name = "boot_partition";
<a href=#__codelineno-36-51 id=__codelineno-36-51 name=__codelineno-36-51></a>                        value = "recovery";
<a href=#__codelineno-36-52 id=__codelineno-36-52 name=__codelineno-36-52></a>                    },
<a href=#__codelineno-36-53 id=__codelineno-36-53 name=__codelineno-36-53></a>                    {
<a href=#__codelineno-36-54 id=__codelineno-36-54 name=__codelineno-36-54></a>                        /* 设置env:swu_next=reboot, 这是为了跟外部脚本配合，指示外部脚本做reboot动作*/
<a href=#__codelineno-36-55 id=__codelineno-36-55 name=__codelineno-36-55></a>                        name = "swu_next";
<a href=#__codelineno-36-56 id=__codelineno-36-56 name=__codelineno-36-56></a>                        value = "reboot";
<a href=#__codelineno-36-57 id=__codelineno-36-57 name=__codelineno-36-57></a>                    }
<a href=#__codelineno-36-58 id=__codelineno-36-58 name=__codelineno-36-58></a>                    /* 实际有什么其他需求，都可以灵活增删标志来解决, 外部脚本和应用可通过fw_setenv/
<a href=#__codelineno-36-59 id=__codelineno-36-59 name=__codelineno-36-59></a>                    fw_printenv操作env */
<a href=#__codelineno-36-60 id=__codelineno-36-60 name=__codelineno-36-60></a>                    /* 注意，以上几个env，是一起在ram中修改好再写入的, 不会出现部分写入部分未写入的情况*/
<a href=#__codelineno-36-61 id=__codelineno-36-61 name=__codelineno-36-61></a>                );
<a href=#__codelineno-36-62 id=__codelineno-36-62 name=__codelineno-36-62></a>            };
<a href=#__codelineno-36-63 id=__codelineno-36-63 name=__codelineno-36-63></a>            /*
<a href=#__codelineno-36-64 id=__codelineno-36-64 name=__codelineno-36-64></a>            * 内层tag，upgrade_kernel,
<a href=#__codelineno-36-65 id=__codelineno-36-65 name=__codelineno-36-65></a>            * 当调用swupdate xxx -e stable,upgrade_kernel时，就会匹配到这部分，执行｛｝内的动作，
<a href=#__codelineno-36-66 id=__codelineno-36-66 name=__codelineno-36-66></a>            * 可以修改，调用的时候传入匹配的字符串即可。
<a href=#__codelineno-36-67 id=__codelineno-36-67 name=__codelineno-36-67></a>            */
<a href=#__codelineno-36-68 id=__codelineno-36-68 name=__codelineno-36-68></a>            /* upgrade kernel,rootfs ==&gt; change sw_mode */
<a href=#__codelineno-36-69 id=__codelineno-36-69 name=__codelineno-36-69></a>            upgrade_kernel = {
<a href=#__codelineno-36-70 id=__codelineno-36-70 name=__codelineno-36-70></a>            /* upgrade kernel,rootfs */
<a href=#__codelineno-36-71 id=__codelineno-36-71 name=__codelineno-36-71></a>            /* image部分，不赘述*/
<a href=#__codelineno-36-72 id=__codelineno-36-72 name=__codelineno-36-72></a>          images: (
<a href=#__codelineno-36-73 id=__codelineno-36-73 name=__codelineno-36-73></a>                {
<a href=#__codelineno-36-74 id=__codelineno-36-74 name=__codelineno-36-74></a>                    filename = "kernel";
<a href=#__codelineno-36-75 id=__codelineno-36-75 name=__codelineno-36-75></a>                    device = "/dev/by-name/boot";
<a href=#__codelineno-36-76 id=__codelineno-36-76 name=__codelineno-36-76></a>                    installed-directly = true;
<a href=#__codelineno-36-77 id=__codelineno-36-77 name=__codelineno-36-77></a>                },
<a href=#__codelineno-36-78 id=__codelineno-36-78 name=__codelineno-36-78></a>                {
<a href=#__codelineno-36-79 id=__codelineno-36-79 name=__codelineno-36-79></a>                    filename = "rootfs";
<a href=#__codelineno-36-80 id=__codelineno-36-80 name=__codelineno-36-80></a>                    device = "/dev/by-name/rootfs";
<a href=#__codelineno-36-81 id=__codelineno-36-81 name=__codelineno-36-81></a>                    installed-directly = true;
<a href=#__codelineno-36-82 id=__codelineno-36-82 name=__codelineno-36-82></a>                }
<a href=#__codelineno-36-83 id=__codelineno-36-83 name=__codelineno-36-83></a>            );
<a href=#__codelineno-36-84 id=__codelineno-36-84 name=__codelineno-36-84></a>            /* change sw_mode to upgrade_usr,change boot_partition to boot */
<a href=#__codelineno-36-85 id=__codelineno-36-85 name=__codelineno-36-85></a>            bootenv: (
<a href=#__codelineno-36-86 id=__codelineno-36-86 name=__codelineno-36-86></a>                {
<a href=#__codelineno-36-87 id=__codelineno-36-87 name=__codelineno-36-87></a>                    /* 设置env:swu_mode=upgrade_usr, 这是为了记录OTA进度*/
<a href=#__codelineno-36-88 id=__codelineno-36-88 name=__codelineno-36-88></a>                    name = "swu_mode";
<a href=#__codelineno-36-89 id=__codelineno-36-89 name=__codelineno-36-89></a>                    value = "upgrade_usr";
<a href=#__codelineno-36-90 id=__codelineno-36-90 name=__codelineno-36-90></a>                },
<a href=#__codelineno-36-91 id=__codelineno-36-91 name=__codelineno-36-91></a>                {
<a href=#__codelineno-36-92 id=__codelineno-36-92 name=__codelineno-36-92></a>                    /* 设置env:boot_partition=boot, 这是为了切换系统，下次uboot就会启动主系统(
<a href=#__codelineno-36-93 id=__codelineno-36-93 name=__codelineno-36-93></a>                    kernel位于boot分区) */
<a href=#__codelineno-36-94 id=__codelineno-36-94 name=__codelineno-36-94></a>                    name = "boot_partition";
<a href=#__codelineno-36-95 id=__codelineno-36-95 name=__codelineno-36-95></a>                    value = "boot";
<a href=#__codelineno-36-96 id=__codelineno-36-96 name=__codelineno-36-96></a>                }
<a href=#__codelineno-36-97 id=__codelineno-36-97 name=__codelineno-36-97></a>            );
<a href=#__codelineno-36-98 id=__codelineno-36-98 name=__codelineno-36-98></a>        };
<a href=#__codelineno-36-99 id=__codelineno-36-99 name=__codelineno-36-99></a>        /* 内层tag，upgrade_usr,
<a href=#__codelineno-36-100 id=__codelineno-36-100 name=__codelineno-36-100></a>        当调用swupdate xxx -e stable,upgrade_usr时，就会匹配到这部分，执行｛｝内的动作，
<a href=#__codelineno-36-101 id=__codelineno-36-101 name=__codelineno-36-101></a>         可以修改，调用的时候传入匹配的字符串即可*/
<a href=#__codelineno-36-102 id=__codelineno-36-102 name=__codelineno-36-102></a>        /* upgrade usr ==&gt; clean ==&gt; reboot */
<a href=#__codelineno-36-103 id=__codelineno-36-103 name=__codelineno-36-103></a>        upgrade_usr = {
<a href=#__codelineno-36-104 id=__codelineno-36-104 name=__codelineno-36-104></a>            /*
<a href=#__codelineno-36-105 id=__codelineno-36-105 name=__codelineno-36-105></a>            * misc-upgrade的小容量方案，将usr拆成独立分区了。
<a href=#__codelineno-36-106 id=__codelineno-36-106 name=__codelineno-36-106></a>                  * 这里我们不需要，如果保留的话，不做任何image操作即可。
<a href=#__codelineno-36-107 id=__codelineno-36-107 name=__codelineno-36-107></a>            * 也可以彻底删除这一部分，并将上面的upgrade_usr改掉。
<a href=#__codelineno-36-108 id=__codelineno-36-108 name=__codelineno-36-108></a>                  */
<a href=#__codelineno-36-109 id=__codelineno-36-109 name=__codelineno-36-109></a>            /* upgrade usr */
<a href=#__codelineno-36-110 id=__codelineno-36-110 name=__codelineno-36-110></a>            /* OTA结束，清空各种标志*/
<a href=#__codelineno-36-111 id=__codelineno-36-111 name=__codelineno-36-111></a>            /* clean swu_param,swu_software,swu_mode &amp; reboot */
<a href=#__codelineno-36-112 id=__codelineno-36-112 name=__codelineno-36-112></a>            bootenv: (
<a href=#__codelineno-36-113 id=__codelineno-36-113 name=__codelineno-36-113></a>                {
<a href=#__codelineno-36-114 id=__codelineno-36-114 name=__codelineno-36-114></a>                    name = "swu_param";
<a href=#__codelineno-36-115 id=__codelineno-36-115 name=__codelineno-36-115></a>                    value = "";
<a href=#__codelineno-36-116 id=__codelineno-36-116 name=__codelineno-36-116></a>                },
<a href=#__codelineno-36-117 id=__codelineno-36-117 name=__codelineno-36-117></a>                {
<a href=#__codelineno-36-118 id=__codelineno-36-118 name=__codelineno-36-118></a>                    name = "swu_software";
<a href=#__codelineno-36-119 id=__codelineno-36-119 name=__codelineno-36-119></a>                    value = "";
<a href=#__codelineno-36-120 id=__codelineno-36-120 name=__codelineno-36-120></a>                },
<a href=#__codelineno-36-121 id=__codelineno-36-121 name=__codelineno-36-121></a>                {
<a href=#__codelineno-36-122 id=__codelineno-36-122 name=__codelineno-36-122></a>                    name = "swu_mode";
<a href=#__codelineno-36-123 id=__codelineno-36-123 name=__codelineno-36-123></a>                    value = "";
<a href=#__codelineno-36-124 id=__codelineno-36-124 name=__codelineno-36-124></a>                },
<a href=#__codelineno-36-125 id=__codelineno-36-125 name=__codelineno-36-125></a>                {
<a href=#__codelineno-36-126 id=__codelineno-36-126 name=__codelineno-36-126></a>                    name = "swu_next";
<a href=#__codelineno-36-127 id=__codelineno-36-127 name=__codelineno-36-127></a>                    value = "reboot";
<a href=#__codelineno-36-128 id=__codelineno-36-128 name=__codelineno-36-128></a>                }
<a href=#__codelineno-36-129 id=__codelineno-36-129 name=__codelineno-36-129></a>            );
<a href=#__codelineno-36-130 id=__codelineno-36-130 name=__codelineno-36-130></a>        };
<a href=#__codelineno-36-131 id=__codelineno-36-131 name=__codelineno-36-131></a>    };
<a href=#__codelineno-36-132 id=__codelineno-36-132 name=__codelineno-36-132></a>    /* 当没有匹配上面的tag，进入对应的处理流程时，则运行到此处。我们默认清除掉一些状态*/
<a href=#__codelineno-36-133 id=__codelineno-36-133 name=__codelineno-36-133></a>    /* when not call with -e xxx,xxx just clean */
<a href=#__codelineno-36-134 id=__codelineno-36-134 name=__codelineno-36-134></a>    bootenv: (
<a href=#__codelineno-36-135 id=__codelineno-36-135 name=__codelineno-36-135></a>        {
<a href=#__codelineno-36-136 id=__codelineno-36-136 name=__codelineno-36-136></a>            name = "swu_param";
<a href=#__codelineno-36-137 id=__codelineno-36-137 name=__codelineno-36-137></a>            value = "";
<a href=#__codelineno-36-138 id=__codelineno-36-138 name=__codelineno-36-138></a>        },
<a href=#__codelineno-36-139 id=__codelineno-36-139 name=__codelineno-36-139></a>        {
<a href=#__codelineno-36-140 id=__codelineno-36-140 name=__codelineno-36-140></a>            name = "swu_software";
<a href=#__codelineno-36-141 id=__codelineno-36-141 name=__codelineno-36-141></a>            value = "";
<a href=#__codelineno-36-142 id=__codelineno-36-142 name=__codelineno-36-142></a>        },
<a href=#__codelineno-36-143 id=__codelineno-36-143 name=__codelineno-36-143></a>        {
<a href=#__codelineno-36-144 id=__codelineno-36-144 name=__codelineno-36-144></a>            name = "swu_mode";
<a href=#__codelineno-36-145 id=__codelineno-36-145 name=__codelineno-36-145></a>            value = "";
<a href=#__codelineno-36-146 id=__codelineno-36-146 name=__codelineno-36-146></a>        },
<a href=#__codelineno-36-147 id=__codelineno-36-147 name=__codelineno-36-147></a>        {
<a href=#__codelineno-36-148 id=__codelineno-36-148 name=__codelineno-36-148></a>            name = "swu_version";
<a href=#__codelineno-36-149 id=__codelineno-36-149 name=__codelineno-36-149></a>            value = "";
<a href=#__codelineno-36-150 id=__codelineno-36-150 name=__codelineno-36-150></a>        }
<a href=#__codelineno-36-151 id=__codelineno-36-151 name=__codelineno-36-151></a>    );
<a href=#__codelineno-36-152 id=__codelineno-36-152 name=__codelineno-36-152></a>}
</code></pre></div> <p><strong>说明：</strong></p> <p>升级过程会进行两次重启。具体的： （1）升级recovery 分区(recovery)，uboot(uboot)，boot0(boot0) 。设置boot_partition为recovery。 （2）重启，进入recovery 系统。 （3）升级内核(kernel) 和rootfs(rootfs) 。设置boot_partition 为boot。 （4）重启，进入主系统，升级完成。</p> <h4 id=345-sw-subimgscfg>3.4.5 准备sw-subimgs.cfg</h4> <p>我们直接看下tina 默认的：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-37-1 id=__codelineno-37-1 name=__codelineno-37-1></a>target/allwinner/generic/swupdate/sw-subimgs.cfg
</code></pre></div> <p>内容如下，中文部分是注释，原文件中没有。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-38-1 id=__codelineno-38-1 name=__codelineno-38-1></a>swota_file_list=(
<a href=#__codelineno-38-2 id=__codelineno-38-2 name=__codelineno-38-2></a>#取得sw-description，放到OTA包中。
<a href=#__codelineno-38-3 id=__codelineno-38-3 name=__codelineno-38-3></a>#注意第一行必须为sw-description。如果源文件不叫sw-description，可在此处加:sw-description做一次重命名
<a href=#__codelineno-38-4 id=__codelineno-38-4 name=__codelineno-38-4></a>target/allwinner/generic/swupdate/sw-description
<a href=#__codelineno-38-5 id=__codelineno-38-5 name=__codelineno-38-5></a>#取得boot_initramfs_recovery.img，重命名为recovery，放到OTA包中。以下雷同
<a href=#__codelineno-38-6 id=__codelineno-38-6 name=__codelineno-38-6></a>out/${TARGET_BOARD}/boot_initramfs_recovery.img:recovery
<a href=#__codelineno-38-7 id=__codelineno-38-7 name=__codelineno-38-7></a>#uboot.img和boot0.img是执行swupdate_pack_swu时自动拷贝得到的，需配置sys_config.fex中的
<a href=#__codelineno-38-8 id=__codelineno-38-8 name=__codelineno-38-8></a>storage_type
<a href=#__codelineno-38-9 id=__codelineno-38-9 name=__codelineno-38-9></a>out/${TARGET_BOARD}/uboot.img:uboot
<a href=#__codelineno-38-10 id=__codelineno-38-10 name=__codelineno-38-10></a>#注：boot0没有修改的话，以下这行可去除，其他雷同，可按需升级
<a href=#__codelineno-38-11 id=__codelineno-38-11 name=__codelineno-38-11></a>out/${TARGET_BOARD}/boot0.img:boot0
<a href=#__codelineno-38-12 id=__codelineno-38-12 name=__codelineno-38-12></a>out/${TARGET_BOARD}/boot.img:kernel
<a href=#__codelineno-38-13 id=__codelineno-38-13 name=__codelineno-38-13></a>out/${TARGET_BOARD}/rootfs.img:rootfs
<a href=#__codelineno-38-14 id=__codelineno-38-14 name=__codelineno-38-14></a>#下面这行是给小容量方案预留的，目前注释掉
<a href=#__codelineno-38-15 id=__codelineno-38-15 name=__codelineno-38-15></a>#out/${TARGET_BOARD}/usr.img:usr
<a href=#__codelineno-38-16 id=__codelineno-38-16 name=__codelineno-38-16></a>)
</code></pre></div> <p><strong>说明：</strong> 指明打包swupdate 升级包所需的各个文件的位置。这些文件会被拷贝到out 目录下，再生成swupdate OTA 包。</p> <h4 id=346-ota>3.4.6 编译OTA 包所需的子镜像</h4> <p>编译kernel 和rootfs。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-39-1 id=__codelineno-39-1 name=__codelineno-39-1></a>make
</code></pre></div> <p>编译recovery 系统。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-40-1 id=__codelineno-40-1 name=__codelineno-40-1></a>swupdate_make_recovery_img
</code></pre></div> <p>编译uboot。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-41-1 id=__codelineno-41-1 name=__codelineno-41-1></a>muboot
</code></pre></div> <p>打包，若需要升级boot0/uboot，则是必要步骤，打包会将boot0 和uboot 拷贝到out 目录下，并对头部参数等进行修改。生成的固件也可用于测试。注：如果希</p> <p>望生成的固件的recovery分区是有系统的，则需要先编译recovery 系统，再打包。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-42-1 id=__codelineno-42-1 name=__codelineno-42-1></a>pack / pack -s
</code></pre></div> <p>生成OTA 包。因为我们使用的就是sw-subimgs.cfg，所以不同带参数。</p> <p>注意，如果方案目录下存在sw-subimgs.cfg，则优先用方案目录下的。没有方案特定配置才用generic 下的。如果需要升级boot0/uboot，需要配置好</p> <p>sys_config.fex 中的storage_type参数，swupdate_pack_swu 才能正确拷贝对应的boot0/uboot。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-43-1 id=__codelineno-43-1 name=__codelineno-43-1></a>swupdate_pack_swu
</code></pre></div> <h4 id=347-ota>3.4.7 执行OTA</h4> <h5 id=3471-ota>3.4.7.1 准备OTA 包</h5> <p>对于测试来说，直接推入。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-44-1 id=__codelineno-44-1 name=__codelineno-44-1></a>adb push out/&lt;board&gt;/swupdate/&lt;board&gt;.swu /mnt/UDISK
</code></pre></div> <p>实际应用时, 可从先从网络下载到本地, 再调用swupdate, 也可以直接传入url 给swupdate。</p> <h5 id=3472-swupdate>3.4.7.2 调用swupdate</h5> <p>若使用原生的swupdate，则调用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-45-1 id=__codelineno-45-1 name=__codelineno-45-1></a>swupdate -i /mnt/UDISK/&lt;board&gt;.swu -e stable,upgrade_recovery
</code></pre></div> <p>但这样不会在自启动的时候帮我们准备好swupdate 所需的-e 参数。</p> <p>我们可以使用辅助脚本：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-46-1 id=__codelineno-46-1 name=__codelineno-46-1></a>swupdate_cmd.sh -i /mnt/UDISK/&lt;board&gt;.swu -e stable,upgrade_recovery
</code></pre></div> <h3 id=35-ab>3.5 AB 系统方案举例</h3> <h4 id=351-env>3.5.1 配置分区和env</h4> <p>在分区表中，将原有的boot 分区和rootfs 分区，分区名改为bootA 和rootfsA。</p> <p>将这两个分区配置拷贝一份，即新增两个分区，并把名字改为bootB 和rootfsB。</p> <p>这样flash 中就存在A 系统(bootA+rootfsA) 和B 系统(bootB+rootfsB)。</p> <p>一般是一个系统烧录两份。即分区表中的bootA 和bootB 都指定的boot.fex，rootfsA 和rootfsB 都指定的rootfs.fex。</p> <p>在env 中，指定：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-47-1 id=__codelineno-47-1 name=__codelineno-47-1></a>boot_partition=bootA
<a href=#__codelineno-47-2 id=__codelineno-47-2 name=__codelineno-47-2></a>root_partition=rootfsA
</code></pre></div> <p>并配置boot_normal 命令，从$boot_partition 变量指定的分区加载系统。</p> <h4 id=352>3.5.2 配置主系统</h4> <p>lunch 选择方案后, make menuconfig, 选上swupdate。</p> <h4 id=353-recovery>3.5.3 配置recovery 系统</h4> <p>AB 系统方案没有使用recovery 系统，无需配置和生成。</p> <h4 id=354-sw-description>3.5.4 准备sw-description</h4> <p>这里我们直接使用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-48-1 id=__codelineno-48-1 name=__codelineno-48-1></a>target/allwinner/generic/swupdate/sw-description-ab
</code></pre></div> <p>内容如下，中文部分是注释，原文件中没有。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-49-1 id=__codelineno-49-1 name=__codelineno-49-1></a>/* 固定格式，最外层为software = { } */
<a href=#__codelineno-49-2 id=__codelineno-49-2 name=__codelineno-49-2></a>software =
<a href=#__codelineno-49-3 id=__codelineno-49-3 name=__codelineno-49-3></a>{
<a href=#__codelineno-49-4 id=__codelineno-49-4 name=__codelineno-49-4></a>/* 版本号和描述*/
<a href=#__codelineno-49-5 id=__codelineno-49-5 name=__codelineno-49-5></a>version = "0.1.0";
<a href=#__codelineno-49-6 id=__codelineno-49-6 name=__codelineno-49-6></a>description = "Firmware update for Tina Project";
<a href=#__codelineno-49-7 id=__codelineno-49-7 name=__codelineno-49-7></a>/*
<a href=#__codelineno-49-8 id=__codelineno-49-8 name=__codelineno-49-8></a>
<a href=#__codelineno-49-9 id=__codelineno-49-9 name=__codelineno-49-9></a>* 外层tag，stable，
<a href=#__codelineno-49-10 id=__codelineno-49-10 name=__codelineno-49-10></a>* 没有特殊含义，就理解为一个字符串标志即可。
<a href=#__codelineno-49-11 id=__codelineno-49-11 name=__codelineno-49-11></a>* 可以修改，调用的时候传入匹配的字符串即可。
<a href=#__codelineno-49-12 id=__codelineno-49-12 name=__codelineno-49-12></a>  */
<a href=#__codelineno-49-13 id=__codelineno-49-13 name=__codelineno-49-13></a>  stable = {
<a href=#__codelineno-49-14 id=__codelineno-49-14 name=__codelineno-49-14></a>  /*
<a href=#__codelineno-49-15 id=__codelineno-49-15 name=__codelineno-49-15></a>* 内层tag，now_A_next_B,
<a href=#__codelineno-49-16 id=__codelineno-49-16 name=__codelineno-49-16></a>* 当调用swupdate xxx -e stable,now_A_next_B时，就会匹配到这部分，执行｛｝内的动作，
<a href=#__codelineno-49-17 id=__codelineno-49-17 name=__codelineno-49-17></a> * 可以修改，调用的时候传入匹配的字符串即可。
<a href=#__codelineno-49-18 id=__codelineno-49-18 name=__codelineno-49-18></a>   */
<a href=#__codelineno-49-19 id=__codelineno-49-19 name=__codelineno-49-19></a>   /* now in systemA, we need to upgrade systemB(bootB, rootfsB) */
<a href=#__codelineno-49-20 id=__codelineno-49-20 name=__codelineno-49-20></a>   now_A_next_B = {
<a href=#__codelineno-49-21 id=__codelineno-49-21 name=__codelineno-49-21></a>   /* 这部分是描述，当前处于A系统，需要更新B系统，该执行的动作。执行完后下次启动为B系统*/
<a href=#__codelineno-49-22 id=__codelineno-49-22 name=__codelineno-49-22></a>   images: ( /* 处理各个image */
<a href=#__codelineno-49-23 id=__codelineno-49-23 name=__codelineno-49-23></a>   {
<a href=#__codelineno-49-24 id=__codelineno-49-24 name=__codelineno-49-24></a>   filename = "kernel"; /* 源文件是OTA包中的kernel文件*/
<a href=#__codelineno-49-25 id=__codelineno-49-25 name=__codelineno-49-25></a>   device = "/dev/by-name/bootB"; /* 要写到/dev/by-name/bootB节点中, 这个节点
<a href=#__codelineno-49-26 id=__codelineno-49-26 name=__codelineno-49-26></a>   在tina上就对应bootB分区*/
<a href=#__codelineno-49-27 id=__codelineno-49-27 name=__codelineno-49-27></a>   installed-directly = true; /* 流式升级，即从网络升级时边下载边写入, 而不是先完
<a href=#__codelineno-49-28 id=__codelineno-49-28 name=__codelineno-49-28></a>   整下载到本地再写入，避免占用额外的RAM或ROM */
<a href=#__codelineno-49-29 id=__codelineno-49-29 name=__codelineno-49-29></a>   },
<a href=#__codelineno-49-30 id=__codelineno-49-30 name=__codelineno-49-30></a>   {
<a href=#__codelineno-49-31 id=__codelineno-49-31 name=__codelineno-49-31></a>   filename = "rootfs"; /* 同上，但处理rootfs，不赘述*/
<a href=#__codelineno-49-32 id=__codelineno-49-32 name=__codelineno-49-32></a>   device = "/dev/by-name/rootfsB";
<a href=#__codelineno-49-33 id=__codelineno-49-33 name=__codelineno-49-33></a>   installed-directly = true;
<a href=#__codelineno-49-34 id=__codelineno-49-34 name=__codelineno-49-34></a>   },
<a href=#__codelineno-49-35 id=__codelineno-49-35 name=__codelineno-49-35></a>   {
<a href=#__codelineno-49-36 id=__codelineno-49-36 name=__codelineno-49-36></a>filename = "uboot"; /* 源文件是OTA包中的uboot文件*/
<a href=#__codelineno-49-37 id=__codelineno-49-37 name=__codelineno-49-37></a>type = "awuboot"; /* type为awuboot，则swupdate会调用对应的handler做处理*/
<a href=#__codelineno-49-38 id=__codelineno-49-38 name=__codelineno-49-38></a>},
<a href=#__codelineno-49-39 id=__codelineno-49-39 name=__codelineno-49-39></a>{
<a href=#__codelineno-49-40 id=__codelineno-49-40 name=__codelineno-49-40></a>filename = "boot0"; /* 源文件是OTA包中的boot0文件*/
<a href=#__codelineno-49-41 id=__codelineno-49-41 name=__codelineno-49-41></a>type = "awboot0"; /* type为awuboot，则swupdate会调用对应的handler做处理*/
<a href=#__codelineno-49-42 id=__codelineno-49-42 name=__codelineno-49-42></a>}
<a href=#__codelineno-49-43 id=__codelineno-49-43 name=__codelineno-49-43></a>);
<a href=#__codelineno-49-44 id=__codelineno-49-44 name=__codelineno-49-44></a>/* image处理完之后，需要设置一些标志，切换状态*/
<a href=#__codelineno-49-45 id=__codelineno-49-45 name=__codelineno-49-45></a>bootenv: ( /* 处理bootenv，会修改uboot的env分区*/
<a href=#__codelineno-49-46 id=__codelineno-49-46 name=__codelineno-49-46></a>{
<a href=#__codelineno-49-47 id=__codelineno-49-47 name=__codelineno-49-47></a>/* 设置env:swu_mode=upgrade_kernel, 这是为了记录OTA进度, 对于AB系统来说，此时
<a href=#__codelineno-49-48 id=__codelineno-49-48 name=__codelineno-49-48></a>已经升级完成，置空*/
<a href=#__codelineno-49-49 id=__codelineno-49-49 name=__codelineno-49-49></a>name = "swu_mode";
<a href=#__codelineno-49-50 id=__codelineno-49-50 name=__codelineno-49-50></a>value = "";
<a href=#__codelineno-49-51 id=__codelineno-49-51 name=__codelineno-49-51></a>},
<a href=#__codelineno-49-52 id=__codelineno-49-52 name=__codelineno-49-52></a>{
<a href=#__codelineno-49-53 id=__codelineno-49-53 name=__codelineno-49-53></a>/* 设置env:boot_partition=bootB, 这是为了切换系统，下次uboot就会启动B系统(
<a href=#__codelineno-49-54 id=__codelineno-49-54 name=__codelineno-49-54></a>kernel位于bootB分区) */
<a href=#__codelineno-49-55 id=__codelineno-49-55 name=__codelineno-49-55></a>name = "boot_partition";
<a href=#__codelineno-49-56 id=__codelineno-49-56 name=__codelineno-49-56></a>value = "bootB";
<a href=#__codelineno-49-57 id=__codelineno-49-57 name=__codelineno-49-57></a>},
<a href=#__codelineno-49-58 id=__codelineno-49-58 name=__codelineno-49-58></a>{
<a href=#__codelineno-49-59 id=__codelineno-49-59 name=__codelineno-49-59></a>/* 设置env:root_partition=rootfsB, 这是为了切换系统，下次uboot就会通过cmdline
<a href=#__codelineno-49-60 id=__codelineno-49-60 name=__codelineno-49-60></a>指示挂载B系统的rootfs */
<a href=#__codelineno-49-61 id=__codelineno-49-61 name=__codelineno-49-61></a>name = "root_partition";
<a href=#__codelineno-49-62 id=__codelineno-49-62 name=__codelineno-49-62></a>value = "rootfsB";
<a href=#__codelineno-49-63 id=__codelineno-49-63 name=__codelineno-49-63></a>},
<a href=#__codelineno-49-64 id=__codelineno-49-64 name=__codelineno-49-64></a>{
<a href=#__codelineno-49-65 id=__codelineno-49-65 name=__codelineno-49-65></a>/* 兼容另外的切换方式，可以先不管*/
<a href=#__codelineno-49-66 id=__codelineno-49-66 name=__codelineno-49-66></a>name = "systemAB_next";
<a href=#__codelineno-49-67 id=__codelineno-49-67 name=__codelineno-49-67></a>value = "B";
<a href=#__codelineno-49-68 id=__codelineno-49-68 name=__codelineno-49-68></a>},
<a href=#__codelineno-49-69 id=__codelineno-49-69 name=__codelineno-49-69></a>{
<a href=#__codelineno-49-70 id=__codelineno-49-70 name=__codelineno-49-70></a>/* 设置env:swu_next=reboot, 这是为了跟外部脚本配合，指示外部脚本做reboot动作*/
<a href=#__codelineno-49-71 id=__codelineno-49-71 name=__codelineno-49-71></a>name = "swu_next";
<a href=#__codelineno-49-72 id=__codelineno-49-72 name=__codelineno-49-72></a>value = "reboot";
<a href=#__codelineno-49-73 id=__codelineno-49-73 name=__codelineno-49-73></a>}
<a href=#__codelineno-49-74 id=__codelineno-49-74 name=__codelineno-49-74></a>);
<a href=#__codelineno-49-75 id=__codelineno-49-75 name=__codelineno-49-75></a>};
<a href=#__codelineno-49-76 id=__codelineno-49-76 name=__codelineno-49-76></a>/*
<a href=#__codelineno-49-77 id=__codelineno-49-77 name=__codelineno-49-77></a>
<a href=#__codelineno-49-78 id=__codelineno-49-78 name=__codelineno-49-78></a>* 内层tag，now_B_next_A,
<a href=#__codelineno-49-79 id=__codelineno-49-79 name=__codelineno-49-79></a>* 当调用swupdate xxx -e stable,now_B_next_A时，就会匹配到这部分，执行｛｝内的动作，
<a href=#__codelineno-49-80 id=__codelineno-49-80 name=__codelineno-49-80></a> * 可以修改，调用的时候传入匹配的字符串即可
<a href=#__codelineno-49-81 id=__codelineno-49-81 name=__codelineno-49-81></a>   */
<a href=#__codelineno-49-82 id=__codelineno-49-82 name=__codelineno-49-82></a>   /* now in systemB, we need to upgrade systemA(bootA, rootfsA) */
<a href=#__codelineno-49-83 id=__codelineno-49-83 name=__codelineno-49-83></a>   now_B_next_A = {
<a href=#__codelineno-49-84 id=__codelineno-49-84 name=__codelineno-49-84></a>   /* 这里面就不赘述了, 跟上面基本一致，只是AB互换了*/
<a href=#__codelineno-49-85 id=__codelineno-49-85 name=__codelineno-49-85></a>   images: (
<a href=#__codelineno-49-86 id=__codelineno-49-86 name=__codelineno-49-86></a>   {
<a href=#__codelineno-49-87 id=__codelineno-49-87 name=__codelineno-49-87></a>   filename = "kernel";
<a href=#__codelineno-49-88 id=__codelineno-49-88 name=__codelineno-49-88></a>   device = "/dev/by-name/bootA";
<a href=#__codelineno-49-89 id=__codelineno-49-89 name=__codelineno-49-89></a>   installed-directly = true;
<a href=#__codelineno-49-90 id=__codelineno-49-90 name=__codelineno-49-90></a>   },
<a href=#__codelineno-49-91 id=__codelineno-49-91 name=__codelineno-49-91></a>   {
<a href=#__codelineno-49-92 id=__codelineno-49-92 name=__codelineno-49-92></a>   filename = "rootfs";
<a href=#__codelineno-49-93 id=__codelineno-49-93 name=__codelineno-49-93></a>   device = "/dev/by-name/rootfsA";
<a href=#__codelineno-49-94 id=__codelineno-49-94 name=__codelineno-49-94></a>   installed-directly = true;
<a href=#__codelineno-49-95 id=__codelineno-49-95 name=__codelineno-49-95></a>   },
<a href=#__codelineno-49-96 id=__codelineno-49-96 name=__codelineno-49-96></a>{
<a href=#__codelineno-49-97 id=__codelineno-49-97 name=__codelineno-49-97></a>filename = "uboot";
<a href=#__codelineno-49-98 id=__codelineno-49-98 name=__codelineno-49-98></a>type = "awuboot";
<a href=#__codelineno-49-99 id=__codelineno-49-99 name=__codelineno-49-99></a>},
<a href=#__codelineno-49-100 id=__codelineno-49-100 name=__codelineno-49-100></a>{
<a href=#__codelineno-49-101 id=__codelineno-49-101 name=__codelineno-49-101></a>filename = "boot0";
<a href=#__codelineno-49-102 id=__codelineno-49-102 name=__codelineno-49-102></a>type = "awboot0";
<a href=#__codelineno-49-103 id=__codelineno-49-103 name=__codelineno-49-103></a>}
<a href=#__codelineno-49-104 id=__codelineno-49-104 name=__codelineno-49-104></a>);
<a href=#__codelineno-49-105 id=__codelineno-49-105 name=__codelineno-49-105></a>bootenv: (
<a href=#__codelineno-49-106 id=__codelineno-49-106 name=__codelineno-49-106></a>{
<a href=#__codelineno-49-107 id=__codelineno-49-107 name=__codelineno-49-107></a>name = "swu_mode";
<a href=#__codelineno-49-108 id=__codelineno-49-108 name=__codelineno-49-108></a>value = "";
<a href=#__codelineno-49-109 id=__codelineno-49-109 name=__codelineno-49-109></a>},
<a href=#__codelineno-49-110 id=__codelineno-49-110 name=__codelineno-49-110></a>{
<a href=#__codelineno-49-111 id=__codelineno-49-111 name=__codelineno-49-111></a>name = "boot_partition";
<a href=#__codelineno-49-112 id=__codelineno-49-112 name=__codelineno-49-112></a>value = "bootA";
<a href=#__codelineno-49-113 id=__codelineno-49-113 name=__codelineno-49-113></a>},
<a href=#__codelineno-49-114 id=__codelineno-49-114 name=__codelineno-49-114></a>{
<a href=#__codelineno-49-115 id=__codelineno-49-115 name=__codelineno-49-115></a>name = "root_partition";
<a href=#__codelineno-49-116 id=__codelineno-49-116 name=__codelineno-49-116></a>value = "rootfsA";
<a href=#__codelineno-49-117 id=__codelineno-49-117 name=__codelineno-49-117></a>},
<a href=#__codelineno-49-118 id=__codelineno-49-118 name=__codelineno-49-118></a>{
<a href=#__codelineno-49-119 id=__codelineno-49-119 name=__codelineno-49-119></a>name = "systemAB_next";
<a href=#__codelineno-49-120 id=__codelineno-49-120 name=__codelineno-49-120></a>value = "A";
<a href=#__codelineno-49-121 id=__codelineno-49-121 name=__codelineno-49-121></a>},
<a href=#__codelineno-49-122 id=__codelineno-49-122 name=__codelineno-49-122></a>{
<a href=#__codelineno-49-123 id=__codelineno-49-123 name=__codelineno-49-123></a>name = "swu_next";
<a href=#__codelineno-49-124 id=__codelineno-49-124 name=__codelineno-49-124></a>value = "reboot";
<a href=#__codelineno-49-125 id=__codelineno-49-125 name=__codelineno-49-125></a>}
<a href=#__codelineno-49-126 id=__codelineno-49-126 name=__codelineno-49-126></a>);
<a href=#__codelineno-49-127 id=__codelineno-49-127 name=__codelineno-49-127></a>};
<a href=#__codelineno-49-128 id=__codelineno-49-128 name=__codelineno-49-128></a>};
<a href=#__codelineno-49-129 id=__codelineno-49-129 name=__codelineno-49-129></a>/* 当没有匹配上面的tag，进入对应的处理流程时，则运行到此处。我们默认清除掉一些状态*/
<a href=#__codelineno-49-130 id=__codelineno-49-130 name=__codelineno-49-130></a>/* when not call with -e xxx,xxx just clean */
<a href=#__codelineno-49-131 id=__codelineno-49-131 name=__codelineno-49-131></a>bootenv: (
<a href=#__codelineno-49-132 id=__codelineno-49-132 name=__codelineno-49-132></a>{
<a href=#__codelineno-49-133 id=__codelineno-49-133 name=__codelineno-49-133></a>name = "swu_param";
<a href=#__codelineno-49-134 id=__codelineno-49-134 name=__codelineno-49-134></a>value = "";
<a href=#__codelineno-49-135 id=__codelineno-49-135 name=__codelineno-49-135></a>},
<a href=#__codelineno-49-136 id=__codelineno-49-136 name=__codelineno-49-136></a>{
<a href=#__codelineno-49-137 id=__codelineno-49-137 name=__codelineno-49-137></a>name = "swu_software";
<a href=#__codelineno-49-138 id=__codelineno-49-138 name=__codelineno-49-138></a>value = "";
<a href=#__codelineno-49-139 id=__codelineno-49-139 name=__codelineno-49-139></a>},
<a href=#__codelineno-49-140 id=__codelineno-49-140 name=__codelineno-49-140></a>{
<a href=#__codelineno-49-141 id=__codelineno-49-141 name=__codelineno-49-141></a>name = "swu_mode";
<a href=#__codelineno-49-142 id=__codelineno-49-142 name=__codelineno-49-142></a>value = "";
<a href=#__codelineno-49-143 id=__codelineno-49-143 name=__codelineno-49-143></a>},
<a href=#__codelineno-49-144 id=__codelineno-49-144 name=__codelineno-49-144></a>{
<a href=#__codelineno-49-145 id=__codelineno-49-145 name=__codelineno-49-145></a>name = "swu_version";
<a href=#__codelineno-49-146 id=__codelineno-49-146 name=__codelineno-49-146></a>value = "";
<a href=#__codelineno-49-147 id=__codelineno-49-147 name=__codelineno-49-147></a>}
<a href=#__codelineno-49-148 id=__codelineno-49-148 name=__codelineno-49-148></a>);
<a href=#__codelineno-49-149 id=__codelineno-49-149 name=__codelineno-49-149></a>}
</code></pre></div> <p><strong>说明：</strong></p> <p>升级过程会进行一次重启。具体的： （1）升级kernel 和rootfs 到另一个系统所在分区，升级uboot(uboot)，boot0(boot0) 。设置boot_partition 为切换系统。 （2）重启，进入新系统。</p> <h4 id=355-sw-subimgscfg>3.5.5 准备sw-subimgs.cfg</h4> <p>我们直接看下tina 默认的：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-50-1 id=__codelineno-50-1 name=__codelineno-50-1></a>target/allwinner/generic/swupdate/sw-subimgs-ab.cfg
</code></pre></div> <p>内容如下，中文部分是注释，原文件中没有。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-51-1 id=__codelineno-51-1 name=__codelineno-51-1></a>swota_file_list=(
<a href=#__codelineno-51-2 id=__codelineno-51-2 name=__codelineno-51-2></a>#取得sw-description-ab, 重命名成sw-description, 放到OTA包中。
<a href=#__codelineno-51-3 id=__codelineno-51-3 name=__codelineno-51-3></a>#注意第一行必须为sw-description
<a href=#__codelineno-51-4 id=__codelineno-51-4 name=__codelineno-51-4></a>target/allwinner/generic/swupdate/sw-description-ab:sw-description
<a href=#__codelineno-51-5 id=__codelineno-51-5 name=__codelineno-51-5></a>#取得uboot.img，重命名为uboot，放到OTA包中。以下雷同
<a href=#__codelineno-51-6 id=__codelineno-51-6 name=__codelineno-51-6></a>#uboot.img和boot0.img是执行swupdate_pack_swu时自动拷贝得到的，需配置sys_config.fex中的
<a href=#__codelineno-51-7 id=__codelineno-51-7 name=__codelineno-51-7></a>storage_type
<a href=#__codelineno-51-8 id=__codelineno-51-8 name=__codelineno-51-8></a>out/${TARGET_BOARD}/uboot.img:uboot
<a href=#__codelineno-51-9 id=__codelineno-51-9 name=__codelineno-51-9></a>#注：boot0没有修改的话，以下这行可去除，其他雷同，可按需升级
<a href=#__codelineno-51-10 id=__codelineno-51-10 name=__codelineno-51-10></a>out/${TARGET_BOARD}/boot0.img:boot0
<a href=#__codelineno-51-11 id=__codelineno-51-11 name=__codelineno-51-11></a>out/${TARGET_BOARD}/boot.img:kernel
<a href=#__codelineno-51-12 id=__codelineno-51-12 name=__codelineno-51-12></a>out/${TARGET_BOARD}/rootfs.img:rootfs
<a href=#__codelineno-51-13 id=__codelineno-51-13 name=__codelineno-51-13></a>)
</code></pre></div> <p>说明： 指明打包swupdate 升级包所需的各个文件的位置。这些文件会被拷贝到out 目录下，再生成 swupdate OTA 包。</p> <h4 id=356-ota>3.5.6 编译OTA 包所需的子镜像</h4> <p>编译kernel 和rootfs。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-52-1 id=__codelineno-52-1 name=__codelineno-52-1></a>make
</code></pre></div> <p>编译uboot。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-53-1 id=__codelineno-53-1 name=__codelineno-53-1></a>muboot
</code></pre></div> <p>打包，若需要升级boot0/uboot，则是必要步骤，打包会将boot0 和uboot 拷贝到out 目录下，并对头部参数等进行修改。生成的固件也可用于测试。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-54-1 id=__codelineno-54-1 name=__codelineno-54-1></a>pack / pack -s
</code></pre></div> <p>生成OTA 包。因为我们使用的是sw-subimgs-ab.cfg，所以调用时带参数-ab。</p> <p>注意，如果方案目录下存在sw-subimgs-ab.cfg，则优先用方案目录下的。没有方案特定配置才用generic 下的。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-55-1 id=__codelineno-55-1 name=__codelineno-55-1></a>swupdate_pack_swu -ab
</code></pre></div> <h4 id=357-ota>3.5.7 执行OTA</h4> <h5 id=3571-ota>3.5.7.1 准备OTA 包</h5> <p>对于测试来说，直接推入。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-56-1 id=__codelineno-56-1 name=__codelineno-56-1></a>adb push out/&lt;board&gt;/swupdate/&lt;board&gt;.swu /mnt/UDISK
</code></pre></div> <p>实际应用时, 可从先从网络下载到本地, 再调用swupdate, 也可以直接传入url 给swupdate。</p> <h5 id=3572-ab>3.5.7.2 判断AB 系统</h5> <p>对于AB 系统方案来说，必须判断当前所处系统，才能知道需要升级哪个分区的数据。</p> <p>判断当前是处于A 系统还是B 系统。</p> <p>方式一：直接使用fw_printenv 读取判断当前的boot_partition 和root_partition 的值。</p> <h5 id=3573-swupdate>3.5.7.3 调用swupdate</h5> <p>若使用原生的swupdate，则调用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-57-1 id=__codelineno-57-1 name=__codelineno-57-1></a>当前处于A系统：
<a href=#__codelineno-57-2 id=__codelineno-57-2 name=__codelineno-57-2></a>
<a href=#__codelineno-57-3 id=__codelineno-57-3 name=__codelineno-57-3></a>swupdate -i /mnt/UDISK/&lt;board&gt;.swu -e stable,now_A_next_B
<a href=#__codelineno-57-4 id=__codelineno-57-4 name=__codelineno-57-4></a>
<a href=#__codelineno-57-5 id=__codelineno-57-5 name=__codelineno-57-5></a>当前处于B系统：
<a href=#__codelineno-57-6 id=__codelineno-57-6 name=__codelineno-57-6></a>
<a href=#__codelineno-57-7 id=__codelineno-57-7 name=__codelineno-57-7></a>swupdate -i /mnt/UDISK/&lt;board&gt;.swu -e stable,now_B_next_A
</code></pre></div> <p>但这样不会在自启动的时候帮我们准备好swupdate 所需的-e 参数。</p> <p>我们可以使用辅助脚本：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-58-1 id=__codelineno-58-1 name=__codelineno-58-1></a>当前处于A系统：
<a href=#__codelineno-58-2 id=__codelineno-58-2 name=__codelineno-58-2></a>swupdate_cmd.sh -i /mnt/UDISK/&lt;board&gt;.swu -e stable,now_A_next_B
<a href=#__codelineno-58-3 id=__codelineno-58-3 name=__codelineno-58-3></a>
<a href=#__codelineno-58-4 id=__codelineno-58-4 name=__codelineno-58-4></a>当前处于B系统：
<a href=#__codelineno-58-5 id=__codelineno-58-5 name=__codelineno-58-5></a>swupdate_cmd.sh -i /mnt/UDISK/&lt;board&gt;.swu -e stable,now_B_next_A
</code></pre></div> <h3 id=36-swupdate_cmdsh>3.6 辅助脚本swupdate_cmd.sh</h3> <p>为什么需要辅助脚本？</p> <p>因为我们需要启动时能自动调用swupdate，自动传递合适的-e 参数给swupdate, 需要在合适的时候调用重启。</p> <p>具体可直接看下脚本内容。</p> <p>其基本思路是，当带参数调用时，脚本从传入的参数中，取出”-e xxx,yyy” 部分，将其余参数原样保存为env 的swu_param 变量。</p> <p>取出的”-e xxx,yyy” 中的xxx 保存到env 的swu_software 变量, yyy 保存为env 的swu_mode变量。</p> <p>然后就取出变量，循环调用。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-59-1 id=__codelineno-59-1 name=__codelineno-59-1></a>swupdate $swu_param -e "$swu_software,$swu_mode"
</code></pre></div> <p>sw-description 中可以通过改变env 的swu_software 和swu_mode 变量，来影响下次的调用参数。</p> <p>实际应用时，可不使用此脚本，直接在主应用中，调用swupdate 即可。但要自行做好-e 参数的处理。</p> <h3 id=37>3.7 版本号</h3> <h4 id=371>3.7.1 使用方式</h4> <p>在sw-descriptionwen 文件中，会配置一个版本号字符串，如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-60-1 id=__codelineno-60-1 name=__codelineno-60-1></a>software =
<a href=#__codelineno-60-2 id=__codelineno-60-2 name=__codelineno-60-2></a>{
<a href=#__codelineno-60-3 id=__codelineno-60-3 name=__codelineno-60-3></a>version = "1.0.0";
<a href=#__codelineno-60-4 id=__codelineno-60-4 name=__codelineno-60-4></a>...
<a href=#__codelineno-60-5 id=__codelineno-60-5 name=__codelineno-60-5></a>}
</code></pre></div> <p>如果需要在升级时检查版本号，则可使用-N 参数，传入的参数代表小机端当前的版本号。如果不需要，则不传递-N 参数，忽略版本号即可。</p> <p>swupdate 会进行比较，如果OTA 包中sw-descriptionwen 文件配置的版本号小于当前版本号，则不允许升级。</p> <p>如何在小机端保存，获取，更新版本号，需要自定义, swupdate 没有规定具体的方式。</p> <h4 id=372>3.7.2 实现例子</h4> <p>应用可以按自己的逻辑维护版本号，不依赖系统env 等，只需按照swupate 要求传递参数即可。</p> <p>此处提供一种依赖系统env 的实现方式供参考。</p> <p>1.初始化设备端版本号。</p> <p>首先需要定义设备端的版本号存放在哪，如何获取。</p> <p>本方法定义设备端的版本号保存于env 之中，用swu_version 记录。则在SDK 中，需在env-x.x.cfg 中添加一行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-61-1 id=__codelineno-61-1 name=__codelineno-61-1></a>swu_version=1.0.0
</code></pre></div> <p>表示此时版本为1.0.0，烧录固件后可执行fw_printenv 查看。</p> <p>此步骤如果不做，则第一次烧录固件后env 中不存在swu_version，调用swupdate 时也无法传入获得并版本号，则第一次升级时不会检查版本。</p> <p>注：这是tina 自定义的，可修改。只要读写这个版本号的地方均配套修改即可。实际应用时版本号可以存在任意分区中，或者存放在文件系统的文件中，或者硬编</p> <p>码在系统和应用的二进制中，swupdate 未做限制。</p> <p>2.在sw-description 中，设置OTA 包版本号。</p> <p>升级时如果检查到OTA 包的sw-description 中的version，小于通过-N 参数传入的版本号，则不允许升级。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-62-1 id=__codelineno-62-1 name=__codelineno-62-1></a>software =
<a href=#__codelineno-62-2 id=__codelineno-62-2 name=__codelineno-62-2></a>{
<a href=#__codelineno-62-3 id=__codelineno-62-3 name=__codelineno-62-3></a>version = "2.0.0";
<a href=#__codelineno-62-4 id=__codelineno-62-4 name=__codelineno-62-4></a>...
</code></pre></div> <p>例如当设备端的env 中设置了swu_version=2.0.0, 则调用swupdate_cmd.sh 时，会自动获取此参数并在调用swupdate 时传入-N 2.0.0。</p> <p>此时若OTA 包中定义了version = “1.0.0” , 则此时升级会降低版本号，拒绝升级。</p> <p>此时若OTA 包中定义了version = “2.0.0” , 则此次升级不会降低版本号，可以升级。</p> <p>此时若OTA 包中定义了version = “3.0.0” , 则此次升级不会降低版本号，可以升级。</p> <p>注：这是swupdate 原生的OTA 包版本号规则，不是tina 自定义的。</p> <p>3.更新设备端版本号。</p> <p>本方式版本号定义在env 中，则升级kernel 和rootfs 分区不会自动更新版本号，需要主动修改env。</p> <p>若版本号是记录于rootfs 的某个文件，则不必在sw_description 中添加这种操作，因为更新rootfs 时版本号就自然更新了。但缺点是版本号跟rootfs 绑定了，每</p> <p>次OTA 必须升级rootfs 才能更新版本号。</p> <p>添加一个设置version 代表swu_version 的env 操作, 在OTA 时自动更新版本号。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-63-1 id=__codelineno-63-1 name=__codelineno-63-1></a>software =
<a href=#__codelineno-63-2 id=__codelineno-63-2 name=__codelineno-63-2></a>{
<a href=#__codelineno-63-3 id=__codelineno-63-3 name=__codelineno-63-3></a>    #表示这个OTA包的版本号，给swupdate读取检查的。原生规定的。
<a href=#__codelineno-63-4 id=__codelineno-63-4 name=__codelineno-63-4></a>    version = "2.0.0";
<a href=#__codelineno-63-5 id=__codelineno-63-5 name=__codelineno-63-5></a>    ...
<a href=#__codelineno-63-6 id=__codelineno-63-6 name=__codelineno-63-6></a>    bootenv: (
<a href=#__codelineno-63-7 id=__codelineno-63-7 name=__codelineno-63-7></a>        ...
<a href=#__codelineno-63-8 id=__codelineno-63-8 name=__codelineno-63-8></a>        {
<a href=#__codelineno-63-9 id=__codelineno-63-9 name=__codelineno-63-9></a>            #表示这个OTA包的版本号，OTA时会写入env分区，用于在下次OTA时读出作为-N参数的值。
<a href=#__codelineno-63-10 id=__codelineno-63-10 name=__codelineno-63-10></a>            Tina自定义的。
<a href=#__codelineno-63-11 id=__codelineno-63-11 name=__codelineno-63-11></a>            name = "swu_version";
<a href=#__codelineno-63-12 id=__codelineno-63-12 name=__codelineno-63-12></a>            value = "2.0.0";
<a href=#__codelineno-63-13 id=__codelineno-63-13 name=__codelineno-63-13></a>        }
<a href=#__codelineno-63-14 id=__codelineno-63-14 name=__codelineno-63-14></a>            ...
<a href=#__codelineno-63-15 id=__codelineno-63-15 name=__codelineno-63-15></a>        );
<a href=#__codelineno-63-16 id=__codelineno-63-16 name=__codelineno-63-16></a>    ...
<a href=#__codelineno-63-17 id=__codelineno-63-17 name=__codelineno-63-17></a>}
</code></pre></div> <p>注意，这么做的话，更新版本时需要修改env 中的版本号，以使得新的固件包拥有新的版本号，以及更新sw-description 的两个位置，一处是最上面的version = </p> <p>xxx 的版本号，一处是bootenv 操作中的版本号，以使得OTA 包拥有新的版本号，以及能在OTA 时写入新版本号。</p> <ol> <li>读取设备端版本号传给swupdate。</li> </ol> <p>假如小机端是用脚本调用，则可用如下方式读取并传给swupdate：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-64-1 id=__codelineno-64-1 name=__codelineno-64-1></a>swu_version=$(fw_printenv -n swu_version)
<a href=#__codelineno-64-2 id=__codelineno-64-2 name=__codelineno-64-2></a>swupdate ... -N $swu_version
</code></pre></div> <p>更好的方式是判断非空才传入，如此可支持不在env 中提前配置好swu_version。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-65-1 id=__codelineno-65-1 name=__codelineno-65-1></a>check_version_para=""
<a href=#__codelineno-65-2 id=__codelineno-65-2 name=__codelineno-65-2></a>[ x"$swu_version" != x"" ] &amp;&amp; {
<a href=#__codelineno-65-3 id=__codelineno-65-3 name=__codelineno-65-3></a>echo "now version is $swu_version"
<a href=#__codelineno-65-4 id=__codelineno-65-4 name=__codelineno-65-4></a>check_version_para="-N $swu_version"
<a href=#__codelineno-65-5 id=__codelineno-65-5 name=__codelineno-65-5></a>}
<a href=#__codelineno-65-6 id=__codelineno-65-6 name=__codelineno-65-6></a>swupdate ... $check_version_para
</code></pre></div> <p>注： 如果不使用版本号，则不在env 中设置swu_version，也不在bootenv 中写swu_version 即可。</p> <p>如果sw_description 中的版本号一直保持v1.0.0，也总是能升级。</p> <h3 id=38>3.8 签名校验</h3> <h4 id=381>3.8.1 检验原理</h4> <p>OTA 包中包含了sw-decsription 文件和各个具体的镜像，如kernel，rootfs。</p> <p>如果对整个OTA 包进行完整校验，则会对流式升级造成影响，要求必须把整个OTA 包下载下来，才能判断出校验是否通过。</p> <p>为了避免上述问题，swupdate 的校验是分镜像的，首先从OTA 包最前面取出两个文件，即swdescription和sw-description.sig，使用传入的公钥校验sw-</p> <p>description，校验通过则认为sw-description 可信，则说明其中描述的image 和sha256 也是可信的。</p> <p>后续无需再使用公钥，直接校验每个镜像的sha256 即可。因此可以逐个镜像处理，无需全部下载完毕再处理。</p> <h4 id=382>3.8.2 配置</h4> <p>swupdate 支持使用签名校验功能，需要在编译时选中对应功能。</p> <p>出于安全考虑，一旦使能了校验，则swupdate 不再支持不使用签名的更新调用。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-66-1 id=__codelineno-66-1 name=__codelineno-66-1></a>make menuconfig ---&gt;
<a href=#__codelineno-66-2 id=__codelineno-66-2 name=__codelineno-66-2></a>    Allwinner ---&gt;
<a href=#__codelineno-66-3 id=__codelineno-66-3 name=__codelineno-66-3></a>        &lt;*&gt; swupdate ---&gt;
<a href=#__codelineno-66-4 id=__codelineno-66-4 name=__codelineno-66-4></a>            [*] Enable verification of signed images
<a href=#__codelineno-66-5 id=__codelineno-66-5 name=__codelineno-66-5></a>                Signature verification algorithm (RSA PKCS#1.5) ---&gt;(选择校验算法，此处以RSA为例)
</code></pre></div> <p>注意，recovery 系统也需要对应进行配置，即：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-67-1 id=__codelineno-67-1 name=__codelineno-67-1></a>make ota_menuconfig ---&gt; ...(重复以上配置)
</code></pre></div> <h4 id=383>3.8.3 使用方法</h4> <p>在PC 端使用私钥签名OTA 包。</p> <p>在小机端调用swupdate 时，使用-k 参数传入公钥。</p> <h4 id=384-key>3.8.4 初始化key</h4> <p>Tina 封装了一条命令，生成默认的密钥对。执行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-68-1 id=__codelineno-68-1 name=__codelineno-68-1></a>swupdate_init_key
</code></pre></div> <p>执行后会使用默认密码生成密钥对并拷贝到指定目录：</p> <p>密码/私钥/公钥：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-69-1 id=__codelineno-69-1 name=__codelineno-69-1></a>password:tina/target/allwinner/方案名/swupdate/swupdate_priv.password
<a href=#__codelineno-69-2 id=__codelineno-69-2 name=__codelineno-69-2></a>private key:tina/target/allwinner/方案名/swupdate/swupdate_priv.pem
<a href=#__codelineno-69-3 id=__codelineno-69-3 name=__codelineno-69-3></a>public key:tina/target/allwinner/方案名/swupdate/swupdate_public.pem
<a href=#__codelineno-69-4 id=__codelineno-69-4 name=__codelineno-69-4></a>
<a href=#__codelineno-69-5 id=__codelineno-69-5 name=__codelineno-69-5></a>公钥拷贝到base-files中，供使用procd-init的方案使用
<a href=#__codelineno-69-6 id=__codelineno-69-6 name=__codelineno-69-6></a>public key:tina/target/allwinner/方案名/base-files/swupdate_public.pem
<a href=#__codelineno-69-7 id=__codelineno-69-7 name=__codelineno-69-7></a>公钥拷贝到busybox-init-base-files中，供使用busybox-init的方案使用
<a href=#__codelineno-69-8 id=__codelineno-69-8 name=__codelineno-69-8></a>public key:tina/target/allwinner/方案名/busybox-init-base-files/swupdate_public.pem
</code></pre></div> <p>此步骤仅为方便调试使用，只需要做一次。</p> <p>用户也可使用自己的密码自行生成密钥，生成密钥的具体命令可参考build/envsetup.sh 中swupdate_init_key 的实现：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-70-1 id=__codelineno-70-1 name=__codelineno-70-1></a>local password="swupdate";
<a href=#__codelineno-70-2 id=__codelineno-70-2 name=__codelineno-70-2></a>echo "$password" &gt; swupdate_priv.password;
<a href=#__codelineno-70-3 id=__codelineno-70-3 name=__codelineno-70-3></a>echo "-------------------- init priv key --------------------";
<a href=#__codelineno-70-4 id=__codelineno-70-4 name=__codelineno-70-4></a>openssl genrsa -aes256 -passout file:swupdate_priv.password -out swupdate_priv.pem;
<a href=#__codelineno-70-5 id=__codelineno-70-5 name=__codelineno-70-5></a>echo "-------------------- init public key --------------------";
<a href=#__codelineno-70-6 id=__codelineno-70-6 name=__codelineno-70-6></a>openssl rsa -in swupdate_priv.pem -passin file:swupdate_priv.password -out
<a href=#__codelineno-70-7 id=__codelineno-70-7 name=__codelineno-70-7></a>swupdate_public.pem -outform PEM -pubout;
</code></pre></div> <p>生成的密钥如swupdate_init_key 一般放到tina/target/allwinner/方案名/swupdate/ 中，即可在打包OTA 包时自动使用。</p> <p>主要就是调用openssl 生成，私钥拷贝到SDK 指定目录，供生成OTA 包时使用。公钥放到设备端，供设备端执行OTA 时使用。</p> <p>密钥的作用是校验OTA 包，意味着拿到密钥的人即可生成可通过校验的OTA 包，因此正式产品中一般密钥只掌握在少数人手中，并采取适当措施避免泄漏或丢失。</p> <p>一种可参考的实践方式是，正式密钥做好备份，并仅部署在有权限管控的服务器上，只能代码入库后通过自动构建生成OTA 包，普通工程师无法拿到密钥自行本地</p> <p>生成用于正式产品的OTA包。</p> <h4 id=385-sw-description>3.8.5 修改sw-description</h4> <p>如上文所述，每个image 在使用时会校验sha256，因此需要在为每个更新文件在swdesctiption中添加sha256 属性，指定sha256 的值供更新过程校验。</p> <p>有独立镜像的文件才需要sha256 属性，例如images 中配置的文件。而bootenv 等直接写在sw-description 中的，则无需sha256 属性。</p> <p>目前脚本支持自动在生成OTA 包时，更新sha256 的值。但需要在sw-description 中，手工添加：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-71-1 id=__codelineno-71-1 name=__codelineno-71-1></a>sha256 = @文件名
</code></pre></div> <p>如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-72-1 id=__codelineno-72-1 name=__codelineno-72-1></a>$ git diff sw-description
<a href=#__codelineno-72-2 id=__codelineno-72-2 name=__codelineno-72-2></a>diff --git a/allwinner/cowbell-perf1/configs/sw-description b/allwinner/cowbell-perf1/
<a href=#__codelineno-72-3 id=__codelineno-72-3 name=__codelineno-72-3></a>configs/sw-description
<a href=#__codelineno-72-4 id=__codelineno-72-4 name=__codelineno-72-4></a>index ed04b64..467ac3b 100644
<a href=#__codelineno-72-5 id=__codelineno-72-5 name=__codelineno-72-5></a>--- a/allwinner/cowbell-perf1/configs/sw-description
<a href=#__codelineno-72-6 id=__codelineno-72-6 name=__codelineno-72-6></a>+++ b/allwinner/cowbell-perf1/configs/sw-description
<a href=#__codelineno-72-7 id=__codelineno-72-7 name=__codelineno-72-7></a>@@ -9,14 +9,17 @@ software =
<a href=#__codelineno-72-8 id=__codelineno-72-8 name=__codelineno-72-8></a>{
<a href=#__codelineno-72-9 id=__codelineno-72-9 name=__codelineno-72-9></a>filename = "boot_initramfs_recovery.img"
<a href=#__codelineno-72-10 id=__codelineno-72-10 name=__codelineno-72-10></a>device = "/dev/by-name/recovery";
<a href=#__codelineno-72-11 id=__codelineno-72-11 name=__codelineno-72-11></a>
<a href=#__codelineno-72-12 id=__codelineno-72-12 name=__codelineno-72-12></a>+ sha256 = "@boot_initramfs_recovery.img"
<a href=#__codelineno-72-13 id=__codelineno-72-13 name=__codelineno-72-13></a>  },
<a href=#__codelineno-72-14 id=__codelineno-72-14 name=__codelineno-72-14></a>  {
<a href=#__codelineno-72-15 id=__codelineno-72-15 name=__codelineno-72-15></a>  filename = "boot_package.fex"
<a href=#__codelineno-72-16 id=__codelineno-72-16 name=__codelineno-72-16></a>  type = "awuboot";
<a href=#__codelineno-72-17 id=__codelineno-72-17 name=__codelineno-72-17></a>+ sha256 = "@boot_package.fex"
<a href=#__codelineno-72-18 id=__codelineno-72-18 name=__codelineno-72-18></a>  },
<a href=#__codelineno-72-19 id=__codelineno-72-19 name=__codelineno-72-19></a>  {
<a href=#__codelineno-72-20 id=__codelineno-72-20 name=__codelineno-72-20></a>  filename = "boot0_nand.fex"
<a href=#__codelineno-72-21 id=__codelineno-72-21 name=__codelineno-72-21></a>  type = "awboot0";
<a href=#__codelineno-72-22 id=__codelineno-72-22 name=__codelineno-72-22></a>+ sha256 = "@boot0_nand.fex"
<a href=#__codelineno-72-23 id=__codelineno-72-23 name=__codelineno-72-23></a>  }
<a href=#__codelineno-72-24 id=__codelineno-72-24 name=__codelineno-72-24></a>  );
<a href=#__codelineno-72-25 id=__codelineno-72-25 name=__codelineno-72-25></a>  @@ -34,10 +37,12 @@ software =
<a href=#__codelineno-72-26 id=__codelineno-72-26 name=__codelineno-72-26></a>  {
<a href=#__codelineno-72-27 id=__codelineno-72-27 name=__codelineno-72-27></a>  filename = "boot.img";
<a href=#__codelineno-72-28 id=__codelineno-72-28 name=__codelineno-72-28></a>  device = "/dev/by-name/boot";
<a href=#__codelineno-72-29 id=__codelineno-72-29 name=__codelineno-72-29></a>+ sha256 = "@boot.img"
<a href=#__codelineno-72-30 id=__codelineno-72-30 name=__codelineno-72-30></a>  },
<a href=#__codelineno-72-31 id=__codelineno-72-31 name=__codelineno-72-31></a>  {
<a href=#__codelineno-72-32 id=__codelineno-72-32 name=__codelineno-72-32></a>  filename = "rootfs.img";
<a href=#__codelineno-72-33 id=__codelineno-72-33 name=__codelineno-72-33></a>  device = "/dev/by-name/rootfs";
<a href=#__codelineno-72-34 id=__codelineno-72-34 name=__codelineno-72-34></a>+ sha256 = "@rootfs.img"
<a href=#__codelineno-72-35 id=__codelineno-72-35 name=__codelineno-72-35></a>  }
<a href=#__codelineno-72-36 id=__codelineno-72-36 name=__codelineno-72-36></a>  );
<a href=#__codelineno-72-37 id=__codelineno-72-37 name=__codelineno-72-37></a>  bootenv: (
</code></pre></div> <p>在打包OTA 包时，脚本自动算出sha256 的值，并替换到上述位置，再完成OTA 包的生成。</p> <p>可参考：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-73-1 id=__codelineno-73-1 name=__codelineno-73-1></a>target/allwinner/generic/swupdate/sw-description-sign
<a href=#__codelineno-73-2 id=__codelineno-73-2 name=__codelineno-73-2></a>target/allwinner/generic/swupdate/sw-subimgs-sign.cfg
<a href=#__codelineno-73-3 id=__codelineno-73-3 name=__codelineno-73-3></a>注：
<a href=#__codelineno-73-4 id=__codelineno-73-4 name=__codelineno-73-4></a>调用swupdate_pack_swu 则会使用sw-subimgs.cfg，其中默认指定了使用sw-description做为最终的sw-description。
<a href=#__codelineno-73-5 id=__codelineno-73-5 name=__codelineno-73-5></a>调用swupdate_pack_swu -sign则会使用sw-subimgs-sign.cfg，其中默认指定了使用sw-description-sign做为
<a href=#__codelineno-73-6 id=__codelineno-73-6 name=__codelineno-73-6></a>最终的sw-description。
<a href=#__codelineno-73-7 id=__codelineno-73-7 name=__codelineno-73-7></a>即关键还是看使用哪份sw-subimgs.cfg，以及sw-subimgs.cfg中如何指定。
</code></pre></div> <h4 id=386-sw-descriptionsig>3.8.6 添加sw-description.sig</h4> <p>签名的OTA 包，需要生成签名文件sw-description.sig，并使其在OTA 包中，紧随在swdescription后面。</p> <p>目前脚本中自动处理。</p> <h4 id=387-ota>3.8.7 生成OTA 包</h4> <p>方法不变，脚本中会检测defconfig 的配置，并自动完成签名等动作。</p> <h4 id=388>3.8.8 将公钥放置到小机端</h4> <p>目前脚本中生成key 的时候，自动拷贝了。如需手工处理，可参考如下方式。</p> <p>对于procd-init：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-74-1 id=__codelineno-74-1 name=__codelineno-74-1></a>cdevice
<a href=#__codelineno-74-2 id=__codelineno-74-2 name=__codelineno-74-2></a>mkdir -p ./base-files
<a href=#__codelineno-74-3 id=__codelineno-74-3 name=__codelineno-74-3></a>cp swupdate_public.pem ./base-files/etc/
</code></pre></div> <p>对于busybox-init</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-75-1 id=__codelineno-75-1 name=__codelineno-75-1></a>cdevice
<a href=#__codelineno-75-2 id=__codelineno-75-2 name=__codelineno-75-2></a>mkdir -p ./busybox-init-base-files/
<a href=#__codelineno-75-3 id=__codelineno-75-3 name=__codelineno-75-3></a>cp swupdate_public.pem ./busybox-init-base-files/etc/
</code></pre></div> <h4 id=389>3.8.9 在小机端调用</h4> <p>在原本的命令基础上，加上-k /etc/swupdate_public.pem 即可, 如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-76-1 id=__codelineno-76-1 name=__codelineno-76-1></a>swupdate_cmd.sh -v -i /mnt/UDISK/tina-cowbell-perf1.swu -k /etc/swupdate_public.pem
</code></pre></div> <h3 id=39>3.9 压缩</h3> <p>swupdate 支持对镜像先解压，再写入目标位置，当前支持gzip 和zstd 两种压缩算法。</p> <h4 id=391>3.9.1 配置</h4> <p>使用gzip 压缩无需配置，使用zstd 则需选上</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-77-1 id=__codelineno-77-1 name=__codelineno-77-1></a>make menuconfig --&gt; Allwinner ---&gt; &lt;*&gt; swupdate --&gt; [*] Zstd compression support
</code></pre></div> <h4 id=392>3.9.2 生成压缩镜像</h4> <p>如果希望每次打包固件自动生成，则可修改scripts/pack_img.sh, 在function do_pack_tina()函数的最后加上压缩的动作。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-78-1 id=__codelineno-78-1 name=__codelineno-78-1></a>生成gz镜像:
<a href=#__codelineno-78-2 id=__codelineno-78-2 name=__codelineno-78-2></a>gzip -k -f boot.fex
<a href=#__codelineno-78-3 id=__codelineno-78-3 name=__codelineno-78-3></a>gzip -k -f rootfs.fex
<a href=#__codelineno-78-4 id=__codelineno-78-4 name=__codelineno-78-4></a>gzip -k -f recovery.fex #如果使用AB方案，则无需recovery
<a href=#__codelineno-78-5 id=__codelineno-78-5 name=__codelineno-78-5></a>生成lzma镜像:
<a href=#__codelineno-78-6 id=__codelineno-78-6 name=__codelineno-78-6></a>zstd -k -f boot.fex -T0
<a href=#__codelineno-78-7 id=__codelineno-78-7 name=__codelineno-78-7></a>zstd -k -f rootfs.fex -T0
<a href=#__codelineno-78-8 id=__codelineno-78-8 name=__codelineno-78-8></a>zstd -k -f recovery.fex -T0
</code></pre></div> <p>对于lzma，若需要调整压缩率，可指定0-19 的数字(数字越大，压缩率越高，耗时越长)，如</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-79-1 id=__codelineno-79-1 name=__codelineno-79-1></a>zstd -19 -k -f boot.fex -T0
<a href=#__codelineno-79-2 id=__codelineno-79-2 name=__codelineno-79-2></a>zstd -19 -k -f rootfs.fex -T0
<a href=#__codelineno-79-3 id=__codelineno-79-3 name=__codelineno-79-3></a>zstd -19 -k -f recovery.fex -T0
</code></pre></div> <p>如果不希望每次打包固件多耗时间，则需自行在生成OTA 包之前，使用上述命令制作好压缩镜像。原始的boot.fex，rootfs.fex, recovery.fex 在out/方案/image/目录下。</p> <h4 id=393-sw-subimgscfg>3.9.3 sw-subimgs.cfg 配置压缩镜像</h4> <p>以rootfs 为例，将原本未压缩的版本</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-80-1 id=__codelineno-80-1 name=__codelineno-80-1></a>out/${TARGET_BOARD}/rootfs.img:rootfs
</code></pre></div> <p>改成压缩的</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-81-1 id=__codelineno-81-1 name=__codelineno-81-1></a>out/${TARGET_BOARD}/image/rootfs.fex.gz:rootfs.gz
</code></pre></div> <p>或</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-82-1 id=__codelineno-82-1 name=__codelineno-82-1></a>out/${TARGET_BOARD}/image/rootfs.fex.zst:rootfs.zst
</code></pre></div> <p>注：为了方便差分包的处理，此处约定压缩镜像需以.gz 或.zst 结尾，生成差分项的脚本会检查后缀名，并自动解压。</p> <h4 id=394-sw-description>3.9.4 sw-description 配置压缩镜像</h4> <p>以rootfs 为例，将原本未压缩的版本</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-83-1 id=__codelineno-83-1 name=__codelineno-83-1></a>{
<a href=#__codelineno-83-2 id=__codelineno-83-2 name=__codelineno-83-2></a>    filename = "rootfs";
<a href=#__codelineno-83-3 id=__codelineno-83-3 name=__codelineno-83-3></a>    device = "/dev/by-name/rootfs";
<a href=#__codelineno-83-4 id=__codelineno-83-4 name=__codelineno-83-4></a>    installed-directly = true;
<a href=#__codelineno-83-5 id=__codelineno-83-5 name=__codelineno-83-5></a>    sha256 = "@rootfs";
<a href=#__codelineno-83-6 id=__codelineno-83-6 name=__codelineno-83-6></a>},
</code></pre></div> <p>换成</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-84-1 id=__codelineno-84-1 name=__codelineno-84-1></a>{
<a href=#__codelineno-84-2 id=__codelineno-84-2 name=__codelineno-84-2></a>    filename = "rootfs.gz";
<a href=#__codelineno-84-3 id=__codelineno-84-3 name=__codelineno-84-3></a>    device = "/dev/by-name/rootfs";
<a href=#__codelineno-84-4 id=__codelineno-84-4 name=__codelineno-84-4></a>    installed-directly = true;
<a href=#__codelineno-84-5 id=__codelineno-84-5 name=__codelineno-84-5></a>    sha256 = "@rootfs.gz";
<a href=#__codelineno-84-6 id=__codelineno-84-6 name=__codelineno-84-6></a>    compressed = "zlib";
<a href=#__codelineno-84-7 id=__codelineno-84-7 name=__codelineno-84-7></a>},
</code></pre></div> <p>或</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-85-1 id=__codelineno-85-1 name=__codelineno-85-1></a>{
<a href=#__codelineno-85-2 id=__codelineno-85-2 name=__codelineno-85-2></a>    filename = "rootfs.zst";
<a href=#__codelineno-85-3 id=__codelineno-85-3 name=__codelineno-85-3></a>    device = "/dev/by-name/rootfsB";
<a href=#__codelineno-85-4 id=__codelineno-85-4 name=__codelineno-85-4></a>    installed-directly = true;
<a href=#__codelineno-85-5 id=__codelineno-85-5 name=__codelineno-85-5></a>    sha256 = "@rootfs.zst";
<a href=#__codelineno-85-6 id=__codelineno-85-6 name=__codelineno-85-6></a>    compressed = "zstd";
<a href=#__codelineno-85-7 id=__codelineno-85-7 name=__codelineno-85-7></a>},
</code></pre></div> <h3 id=310-ota>3.10 调用OTA</h3> <p>swupdate_cmd.sh , 用于给swupdate 传入相关参数，切换更新状态，以及不断重试。</p> <h4 id=3101>3.10.1 进度条</h4> <p>swupdate 提供了progress 程序，该程序会在后台运行，从socket 获取进度信息，打印进度条到串口。</p> <p>具体方案可参考其实现(在swupdate 源码中搜索progress)，自行在应用中获取进度，通过屏 幕等其他方式进行指示。</p> <h4 id=3102>3.10.2 重启</h4> <p>1.调用swupdate 的时候加上-p reboot , 则swupdate 更新完毕后，会执行reboot。</p> <p>2.swupdate_cmd.sh 支持检测env 中的swu_next 变量，如果为reboot，则脚本中执行reboot。可在sw-description 中设置此变量。</p> <p>3.如果调用progress 的时候加上-r 参数，则progress 会在检测到更新完成后，执行reboot。</p> <h4 id=3103>3.10.3 本地升级示例</h4> <p>将生成的OTA 包推送到小机端，如放在/mnt/UDISK 目录下。</p> <p>PC 端执行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-86-1 id=__codelineno-86-1 name=__codelineno-86-1></a>adb push out/cowbell-perf1/swupdate/tina-cowbell-perf1.swu /mnt/UDISK
</code></pre></div> <p>小机端执行(不带签名校验版本)：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-87-1 id=__codelineno-87-1 name=__codelineno-87-1></a>swupdate_cmd.sh -i /mnt/UDISK/tina-cowbell-perf1.swu -e stable,upgrade_recovery
</code></pre></div> <p>小机端执行(带签名校验版本)：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-88-1 id=__codelineno-88-1 name=__codelineno-88-1></a>swupdate_cmd.sh -i /mnt/UDISK/tina-cowbell-perf1.swu -k /etc/swupdate_public.pem -e stable,upgrade_recovery
</code></pre></div> <h4 id=3104>3.10.4 网络升级示例</h4> <p>启动服务器：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-89-1 id=__codelineno-89-1 name=__codelineno-89-1></a>cd out/cowbell-perf1/swupdate/
<a href=#__codelineno-89-2 id=__codelineno-89-2 name=__codelineno-89-2></a>sudo python -m SimpleHTTPServer 80 #启动一个服务器
</code></pre></div> <p>小机端命令，使用-d -uxxx，xxx 为url。</p> <p>例如(不带签名校验版本)：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-90-1 id=__codelineno-90-1 name=__codelineno-90-1></a>swupdate_cmd.sh -d -uhttp://192.168.35.112/tina-cowbell-perf1.swu -e stable,upgrade_recovery
</code></pre></div> <p>例如(带签名校验版本)：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-91-1 id=__codelineno-91-1 name=__codelineno-91-1></a>swupdate_cmd.sh -d -uhttp://192.168.35.112/tina-cowbell-perf1.swu -k /etc/swupdate_public.pem -e stable,upgrade_recovery
</code></pre></div> <p>注：需依赖外部程序，提供自动联网支持。OTA 本身不处理联网。</p> <h4 id=3105>3.10.5 错误处理</h4> <p>如何判断swupdate 升级出错？</p> <p>1.调用swupdate 时获得并判断返回值是否为0。</p> <p>2.读取env 变量recovery_status。根据swupdate 官方文档，swupdate 开始执行时，会设置recovery_status=“progress”，升级完成会清除这个变量，升级失败则设置recovery_status=“failed”。</p> <h3 id=311_1>3.11 裁剪</h3> <p>swupdate 本身是可配置的, 不需要某些功能时，可将其裁剪掉。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-92-1 id=__codelineno-92-1 name=__codelineno-92-1></a>make menuconfig ---&gt;
<a href=#__codelineno-92-2 id=__codelineno-92-2 name=__codelineno-92-2></a>    Allwinner ---&gt;
<a href=#__codelineno-92-3 id=__codelineno-92-3 name=__codelineno-92-3></a>        &lt;*&gt; swupdate ---&gt;
</code></pre></div> <p>例如，不需要使用swupdate 来从网络下载OTA 包的话，则可将</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-93-1 id=__codelineno-93-1 name=__codelineno-93-1></a>[*] Enable image downloading
</code></pre></div> <p>取消掉。 不需要更新boot0/uboot 的话，则将</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-94-1 id=__codelineno-94-1 name=__codelineno-94-1></a>Image Handlers ---&gt;
<a href=#__codelineno-94-2 id=__codelineno-94-2 name=__codelineno-94-2></a>    [*] allwinner boot0/uboot
</code></pre></div> <p>取消掉</p> <h3 id=312>3.12 调试</h3> <h4 id=3121-swupdate>3.12.1 直接调用swupdate</h4> <p>目前swupdate_cmd.sh 主要有两个作用：</p> <p>1.自启动，无限重试。</p> <p>2.在主系统和recovery 系统中，传入不同的-e 参数给swupdate。</p> <p>出问题时，可以不使用swupdate_cmd.sh，手工直接调用swupdate，在后面加上合适的-e 参数，观察输出log。如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-95-1 id=__codelineno-95-1 name=__codelineno-95-1></a>swupdate -v -i xxx.swu -e stable,boot
<a href=#__codelineno-95-2 id=__codelineno-95-2 name=__codelineno-95-2></a>swupdate -v -i xxx.swu -e stable,recovery
</code></pre></div> <h4 id=3122>3.12.2 手工切换系统</h4> <p>按上述env 的配置，启动的系统，是由boot_partition 变量控制的。</p> <p>注意，需要/var/lock 目录存在且可写。</p> <p>切换到主系统：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-96-1 id=__codelineno-96-1 name=__codelineno-96-1></a>fw_setenv boot_partition boot
<a href=#__codelineno-96-2 id=__codelineno-96-2 name=__codelineno-96-2></a>reboot
</code></pre></div> <p>切换到recovery 系统：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-97-1 id=__codelineno-97-1 name=__codelineno-97-1></a>fw_setenv boot_partition recovery
<a href=#__codelineno-97-2 id=__codelineno-97-2 name=__codelineno-97-2></a>reboot
</code></pre></div> <p>观察当前变量：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-98-1 id=__codelineno-98-1 name=__codelineno-98-1></a>fw_printenv
</code></pre></div> <h4 id=3123-boot0uboot>3.12.3 更新boot0/uboot</h4> <p>目前更新boot0，uboot 实际功能是由另一个软件包ota-burnboot 完成的，swupdate 只是准备数据，并调用ota-burnboot 提供的动态库。</p> <p>如果更新失败，先尝试手工使用ota-burnboot0 xxx 和ota-burnuboot xxx 能否正常更新。以确定是ota-burnboot 的问题，还是swupdate 的问题。</p> <h4 id=3124-ota>3.12.4 解压OTA 包</h4> <p>swupdate 的OTA 包，本质上是一个cpio 格式的包，直接使用通用的cpio 解包命令即可。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-99-1 id=__codelineno-99-1 name=__codelineno-99-1></a>cpio -idv &lt; xxx.swu
</code></pre></div> <h4 id=3125-ota>3.12.5 校验OTA 包</h4> <p>当使能了签名校验，会对sw-description 签名生成sw-description.sig，如果校验失败，可以在PC 端手工验证下：</p> <p>使用RSA 时, build/envsetup.sh 中调用的命令是：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-100-1 id=__codelineno-100-1 name=__codelineno-100-1></a>openssl dgst -sha256 -sign "$priv_key_file" $password_para "$SWU_DIR/sw-description" &gt; "
<a href=#__codelineno-100-2 id=__codelineno-100-2 name=__codelineno-100-2></a>$SWU_DIR/sw-description.sig"
</code></pre></div> <p>则对应的密钥验证签名命令为：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-101-1 id=__codelineno-101-1 name=__codelineno-101-1></a>openssl dgst -prverify swupdate_priv.pem -sha256 -signature sw-description.sig swdescription
</code></pre></div> <p>公钥验证签名的命令为：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-102-1 id=__codelineno-102-1 name=__codelineno-102-1></a>openssl dgst -verify swupdate_public.pem -sha256 -signature sw-description.sig swdescription
</code></pre></div> <h3 id=313>3.13 测试固件示例</h3> <h4 id=3131>3.13.1 生成方式</h4> <p>一般而言，测试需要两个有差异的OTA 包，如，uboot 和kernel 的log 有差异，rootfs 的文件有差异。</p> <p>这样方法测试人员根据log 判断是否升级成功。</p> <h5 id=31311>3.13.1.1 准备工作</h5> <p>如果需要网络更新，OTA 不负责联网，所以需要选上wifimanager-daemon。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-103-1 id=__codelineno-103-1 name=__codelineno-103-1></a>Allwinner
<a href=#__codelineno-103-2 id=__codelineno-103-2 name=__codelineno-103-2></a>---&gt; &lt;*&gt; wifimanager
<a href=#__codelineno-103-3 id=__codelineno-103-3 name=__codelineno-103-3></a>---&gt; [*] Enable wifimanager daemon support
<a href=#__codelineno-103-4 id=__codelineno-103-4 name=__codelineno-103-4></a>---&gt; &lt;*&gt; wifimanager-daemon-demo..................... Tina wifimanager daemon demo
</code></pre></div> <h5 id=31312-1-ota-1>3.13.1.2 生成固件1 和OTA 包1</h5> <p>重新编译boot，使得编译时间更新：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-104-1 id=__codelineno-104-1 name=__codelineno-104-1></a>mboot
</code></pre></div> <p>创建文件以标记rootfs：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-105-1 id=__codelineno-105-1 name=__codelineno-105-1></a>cd target/allwinner/cowbell-ailabs_c1c/base-files
<a href=#__codelineno-105-2 id=__codelineno-105-2 name=__codelineno-105-2></a>rm -f OTA1 OTA2
<a href=#__codelineno-105-3 id=__codelineno-105-3 name=__codelineno-105-3></a>echo OTA1 &gt; OTA1
</code></pre></div> <p>重新编译recovery 系统：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-106-1 id=__codelineno-106-1 name=__codelineno-106-1></a>swupdate_make_recovery_img
</code></pre></div> <p>重新编译打包，使得编译时间更新：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-107-1 id=__codelineno-107-1 name=__codelineno-107-1></a>mp -j32
</code></pre></div> <p>生成OTA 包1：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-108-1 id=__codelineno-108-1 name=__codelineno-108-1></a>swupdate_pack_swu
</code></pre></div> <p>得到产物：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-109-1 id=__codelineno-109-1 name=__codelineno-109-1></a>cp out/cowbell-perf1/tina_cowbell-perf1_uart0.img tina_cowbell-perf1_uart0_OTA1.img
<a href=#__codelineno-109-2 id=__codelineno-109-2 name=__codelineno-109-2></a>cp out/cowbell-perf1/swupdate/tina-cowbell-perf1.swu tina-cowbell-perf1_OTA1.swu
</code></pre></div> <h5 id=31313-2-ota-2>3.13.1.3 生成固件2 和OTA 包2</h5> <p>重新编译uboot，使得编译时间更新：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-110-1 id=__codelineno-110-1 name=__codelineno-110-1></a>muboot
</code></pre></div> <p>创建文件以标记rootfs：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-111-1 id=__codelineno-111-1 name=__codelineno-111-1></a>cd target/allwinner/cowbell-ailabs_c1c/base-files
<a href=#__codelineno-111-2 id=__codelineno-111-2 name=__codelineno-111-2></a>rm -f OTA1 OTA2
<a href=#__codelineno-111-3 id=__codelineno-111-3 name=__codelineno-111-3></a>echo OTA2 &gt; OTA2
</code></pre></div> <p>重新编译recovery 系统：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-112-1 id=__codelineno-112-1 name=__codelineno-112-1></a>swupdate_make_recovery_img
</code></pre></div> <p>重新编译打包，使得编译时间更新：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-113-1 id=__codelineno-113-1 name=__codelineno-113-1></a>mp -j32
</code></pre></div> <p>生成OTA 包2：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-114-1 id=__codelineno-114-1 name=__codelineno-114-1></a>swupdate_pack_swu
</code></pre></div> <p>得到产物：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-115-1 id=__codelineno-115-1 name=__codelineno-115-1></a>cp out/cowbell-perf1/tina_cowbell-perf1_uart0.img tina_cowbell-perf1_uart0_OTA2.img
<a href=#__codelineno-115-2 id=__codelineno-115-2 name=__codelineno-115-2></a>cp out/cowbell-perf1/swupdate/tina-cowbell-perf1.swu tina-cowbell-perf1_OTA2.swu
</code></pre></div> <h4 id=3132>3.13.2 使用方式</h4> <p>任意选择一个OTA 固件烧录后，可在此基础上进行本地升级或网络升级。</p> <h5 id=31321>3.13.2.1 本地升级方式</h5> <p>PC 端执行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-116-1 id=__codelineno-116-1 name=__codelineno-116-1></a>adb push out/astar-parrot/swupdate/tina-cowbell-perf1_OTA1.swu /mnt/UDISK
</code></pre></div> <p>小机端执行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-117-1 id=__codelineno-117-1 name=__codelineno-117-1></a>swupdate_cmd.sh -i /mnt/UDISK/tina-cowbell-perf1_OTA1.swu
</code></pre></div> <h5 id=31322>3.13.2.2 网络升级方式</h5> <p>PC 端搭建服务器：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-118-1 id=__codelineno-118-1 name=__codelineno-118-1></a>sudo python -m SimpleHTTPServer 80
</code></pre></div> <p>小机端联网：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-119-1 id=__codelineno-119-1 name=__codelineno-119-1></a>wifi_connect_ap_test SSID 密码
</code></pre></div> <p>小机端执行：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-120-1 id=__codelineno-120-1 name=__codelineno-120-1></a>swupdate_cmd.sh -d -uhttp://192.168.xxx.xxx/tina-cowbell-perf1_OTA1.swu
</code></pre></div> <p>注明：启动后会自动联网，连网后等待OTA 后台脚本尝试更新。中途掉电重启后，正常会在启动后几十秒内，成功联网并开始继续更新。</p> <h5 id=31323>3.13.2.3 升级过程</h5> <p>升级过程会进行两次重启。具体的： （1）升级recovery 分区(boot_initramfs_recovery.img)，uboot(boot_package.fex)，boot0(boot0_nand.fex)。 （2）重启，进入recovery 系统。 （3）升级内核(boot，img) 和rootfs(rootfs.img)。 （4）重启，进入主系统，升级完成。</p> <h5 id=31324>3.13.2.4 判断升级</h5> <p>从log 中的时间和rootfs 文件可以判断当前运行的版本。</p> <p>例如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-121-1 id=__codelineno-121-1 name=__codelineno-121-1></a>OTA_1：
<a href=#__codelineno-121-2 id=__codelineno-121-2 name=__codelineno-121-2></a>boot0：[66]HELLO! BOOT0 is starting Dec 29 2018 16:15:59!
<a href=#__codelineno-121-3 id=__codelineno-121-3 name=__codelineno-121-3></a>uboot：U-Boot 2018.05-00015-g5068c23-dirty (Dec 29 2018 - 16:15:41 +0800) Allwinner Technology
<a href=#__codelineno-121-4 id=__codelineno-121-4 name=__codelineno-121-4></a>kernel：[ 0.000000] Linux version 4.9.118 (zhuangqiubin@Exdroid5) (gcc version 6.4.1 (
<a href=#__codelineno-121-5 id=__codelineno-121-5 name=__codelineno-121-5></a>OpenWrt/Linaro GCC 6.4-2017.11 2017-11) ) #189 SMP Sat Dec 29 08:13:38 UTC 2018 （注，进入控制台cat /proc/version 也可看到）
<a href=#__codelineno-121-6 id=__codelineno-121-6 name=__codelineno-121-6></a>rootfs：ls查看下，在根目录下有一个文件OTA1
<a href=#__codelineno-121-7 id=__codelineno-121-7 name=__codelineno-121-7></a>OTA_2：
<a href=#__codelineno-121-8 id=__codelineno-121-8 name=__codelineno-121-8></a>boot0: [66]HELLO! BOOT0 is starting Dec 29 2018 16:17:35!
<a href=#__codelineno-121-9 id=__codelineno-121-9 name=__codelineno-121-9></a>uboot: U-Boot 2018.05-00015-g5068c23-dirty (Dec 29 2018 - 16:17:17 +0800) Allwinner Technology
<a href=#__codelineno-121-10 id=__codelineno-121-10 name=__codelineno-121-10></a>kernel:[ 0.000000] Linux version 4.9.118 (zhuangqiubin@Exdroid5) (gcc version 6.4.1 (
<a href=#__codelineno-121-11 id=__codelineno-121-11 name=__codelineno-121-11></a>OpenWrt/Linaro GCC 6.4-2017.11 2017-11) ) #190 SMP Sat Dec 29 08:18:33 UTC 2018（注，进入控制台cat /proc/version 也可看到）
<a href=#__codelineno-121-12 id=__codelineno-121-12 name=__codelineno-121-12></a>rootfs：ls查看下，在根目录下有一个文件OTA2
</code></pre></div> <h3 id=314>3.14 升级定制分区</h3> <p>如果定制了一个分区，并需要对此分区进行OTA，则需要：</p> <p>1.确认需不需要备份。</p> <p>2.将分区文件加入OTA 包。</p> <p>3.确定升级策略，在sw-description 中增加对此分区的处理。</p> <h4 id=3141>3.14.1 备份</h4> <p>在OTA 过程随时可能掉电，如果掉电时正在升级分区mypart ，则重启后mypart 的数据是不完整的。</p> <p>是否需要备份主要取决于mypart 所保存的文件是否影响继续进行OTA。</p> <p>例如mypart 中保存的是开机音乐，被损坏的结果只是开机无声音，但开机后能正常继续OTA，则无需备份。</p> <p>例如mypart 中保存的是应用，且OTA 中途掉电后重启，需要应用负责联网从网络重新下载OTA 包，则需要备份，否则无法继续OTA，设备就无法恢复了。</p> <p>例如mypart 中保存的是dsp，启动过程没有有效的dsp 镜像会无法启动，则需要备份，否则无法启动也就无法继续OTA，设备就无法恢复了。</p> <h4 id=3142>3.14.2 无需备份</h4> <p>假设分区表中定义了：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-122-1 id=__codelineno-122-1 name=__codelineno-122-1></a>[partition]
<a href=#__codelineno-122-2 id=__codelineno-122-2 name=__codelineno-122-2></a>name = mypart
<a href=#__codelineno-122-3 id=__codelineno-122-3 name=__codelineno-122-3></a>size = 512
<a href=#__codelineno-122-4 id=__codelineno-122-4 name=__codelineno-122-4></a>downloadfile = "mypart.fex"
<a href=#__codelineno-122-5 id=__codelineno-122-5 name=__codelineno-122-5></a>user_type = 0x8000
</code></pre></div> <p>文件放在：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-123-1 id=__codelineno-123-1 name=__codelineno-123-1></a>out/${TARGET_BOARD}/image/mypart.fex
</code></pre></div> <p>则在sw-subimg.cfg 中增加一行（注意要放到sw-description 之后，因为sw-description 必须是第一个文件），将mypart.fex 打包到OTA 包中，重命名为mypart：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-124-1 id=__codelineno-124-1 name=__codelineno-124-1></a>out/${TARGET_BOARD}/image/mypart.fex:mypart
</code></pre></div> <p>在sw-description 中增加升级动作的定义。例如可以在升级rootfs 之后，升级该分区：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-125-1 id=__codelineno-125-1 name=__codelineno-125-1></a>software =
<a href=#__codelineno-125-2 id=__codelineno-125-2 name=__codelineno-125-2></a>{
<a href=#__codelineno-125-3 id=__codelineno-125-3 name=__codelineno-125-3></a>...
<a href=#__codelineno-125-4 id=__codelineno-125-4 name=__codelineno-125-4></a>stable = {
<a href=#__codelineno-125-5 id=__codelineno-125-5 name=__codelineno-125-5></a>...
<a href=#__codelineno-125-6 id=__codelineno-125-6 name=__codelineno-125-6></a>upgrade_kernel = {
<a href=#__codelineno-125-7 id=__codelineno-125-7 name=__codelineno-125-7></a>images: (
<a href=#__codelineno-125-8 id=__codelineno-125-8 name=__codelineno-125-8></a>...
<a href=#__codelineno-125-9 id=__codelineno-125-9 name=__codelineno-125-9></a>{
<a href=#__codelineno-125-10 id=__codelineno-125-10 name=__codelineno-125-10></a>filename = "rootfs";
<a href=#__codelineno-125-11 id=__codelineno-125-11 name=__codelineno-125-11></a>device = "/dev/by-name/rootfs";
<a href=#__codelineno-125-12 id=__codelineno-125-12 name=__codelineno-125-12></a>installed-directly = true;
<a href=#__codelineno-125-13 id=__codelineno-125-13 name=__codelineno-125-13></a>},
<a href=#__codelineno-125-14 id=__codelineno-125-14 name=__codelineno-125-14></a>{
<a href=#__codelineno-125-15 id=__codelineno-125-15 name=__codelineno-125-15></a>filename = "mypart";
<a href=#__codelineno-125-16 id=__codelineno-125-16 name=__codelineno-125-16></a>device = "/dev/by-name/mypart";
<a href=#__codelineno-125-17 id=__codelineno-125-17 name=__codelineno-125-17></a>installed-directly = true;
<a href=#__codelineno-125-18 id=__codelineno-125-18 name=__codelineno-125-18></a>}
<a href=#__codelineno-125-19 id=__codelineno-125-19 name=__codelineno-125-19></a>...
<a href=#__codelineno-125-20 id=__codelineno-125-20 name=__codelineno-125-20></a>);
<a href=#__codelineno-125-21 id=__codelineno-125-21 name=__codelineno-125-21></a>...
</code></pre></div> <h3 id=3143>3.14.3 需要备份</h3> <p>在分区表中定义好两个分区，这样升级过程掉电，总有一份是完整的。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-126-1 id=__codelineno-126-1 name=__codelineno-126-1></a>[partition]
<a href=#__codelineno-126-2 id=__codelineno-126-2 name=__codelineno-126-2></a>name = mypart
<a href=#__codelineno-126-3 id=__codelineno-126-3 name=__codelineno-126-3></a>size = 512
<a href=#__codelineno-126-4 id=__codelineno-126-4 name=__codelineno-126-4></a>downloadfile = "mypart.fex"
<a href=#__codelineno-126-5 id=__codelineno-126-5 name=__codelineno-126-5></a>user_type = 0x8000
<a href=#__codelineno-126-6 id=__codelineno-126-6 name=__codelineno-126-6></a>[partition]
<a href=#__codelineno-126-7 id=__codelineno-126-7 name=__codelineno-126-7></a>name = mypart-r
<a href=#__codelineno-126-8 id=__codelineno-126-8 name=__codelineno-126-8></a>size = 512
<a href=#__codelineno-126-9 id=__codelineno-126-9 name=__codelineno-126-9></a>downloadfile = "mypart.fex"
<a href=#__codelineno-126-10 id=__codelineno-126-10 name=__codelineno-126-10></a>user_type = 0x8000
</code></pre></div> <p>文件放在：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-127-1 id=__codelineno-127-1 name=__codelineno-127-1></a>out/${TARGET_BOARD}/image/mypart.fex
</code></pre></div> <p>则在sw-subimg.cfg 中增加一行（注意要放到sw-description 之后，因为sw-description 必</p> <p>须是第一个文件），将mypart.fex 打包到OTA 包中，重命名为mypart：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-128-1 id=__codelineno-128-1 name=__codelineno-128-1></a>out/${TARGET_BOARD}/image/mypart.fex:mypart
</code></pre></div> <p>有两个分区，则需要条件决定使用哪一个，可考虑在env 中定义一个变量：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-129-1 id=__codelineno-129-1 name=__codelineno-129-1></a>mypart_partition=mypart
</code></pre></div> <p>使用mypart 时，要先读取env 的mypart_partition 的值来决定要使用哪个分区。</p> <p>在sw-description 中，定义好要升级的分区和bootenv，保证每次升级那个未在使用的分区。</p> <p>这样即使掉电也无妨。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-130-1 id=__codelineno-130-1 name=__codelineno-130-1></a>software =
<a href=#__codelineno-130-2 id=__codelineno-130-2 name=__codelineno-130-2></a>{
<a href=#__codelineno-130-3 id=__codelineno-130-3 name=__codelineno-130-3></a>...
<a href=#__codelineno-130-4 id=__codelineno-130-4 name=__codelineno-130-4></a>stable = {
<a href=#__codelineno-130-5 id=__codelineno-130-5 name=__codelineno-130-5></a>upgrade_recovery = {
<a href=#__codelineno-130-6 id=__codelineno-130-6 name=__codelineno-130-6></a>images:
<a href=#__codelineno-130-7 id=__codelineno-130-7 name=__codelineno-130-7></a>{
<a href=#__codelineno-130-8 id=__codelineno-130-8 name=__codelineno-130-8></a>filename = "recovery";
<a href=#__codelineno-130-9 id=__codelineno-130-9 name=__codelineno-130-9></a>device = "/dev/by-name/recovery";
<a href=#__codelineno-130-10 id=__codelineno-130-10 name=__codelineno-130-10></a>installed-directly = true;
<a href=#__codelineno-130-11 id=__codelineno-130-11 name=__codelineno-130-11></a>},
<a href=#__codelineno-130-12 id=__codelineno-130-12 name=__codelineno-130-12></a>/* 更新mypart-r， 此时掉电，mypart分区是完整的*/
<a href=#__codelineno-130-13 id=__codelineno-130-13 name=__codelineno-130-13></a>{
<a href=#__codelineno-130-14 id=__codelineno-130-14 name=__codelineno-130-14></a>filename = "mypart-r";
<a href=#__codelineno-130-15 id=__codelineno-130-15 name=__codelineno-130-15></a>device = "/dev/by-name/mypart-r";
<a href=#__codelineno-130-16 id=__codelineno-130-16 name=__codelineno-130-16></a>installed-directly = true;
<a href=#__codelineno-130-17 id=__codelineno-130-17 name=__codelineno-130-17></a>}
<a href=#__codelineno-130-18 id=__codelineno-130-18 name=__codelineno-130-18></a>);
<a href=#__codelineno-130-19 id=__codelineno-130-19 name=__codelineno-130-19></a>bootenv: (
<a href=#__codelineno-130-20 id=__codelineno-130-20 name=__codelineno-130-20></a>{
<a href=#__codelineno-130-21 id=__codelineno-130-21 name=__codelineno-130-21></a>name = "swu_mode";
<a href=#__codelineno-130-22 id=__codelineno-130-22 name=__codelineno-130-22></a>value = "upgrade_kernel";
<a href=#__codelineno-130-23 id=__codelineno-130-23 name=__codelineno-130-23></a>},
<a href=#__codelineno-130-24 id=__codelineno-130-24 name=__codelineno-130-24></a>{
<a href=#__codelineno-130-25 id=__codelineno-130-25 name=__codelineno-130-25></a>name = "boot_partition";
<a href=#__codelineno-130-26 id=__codelineno-130-26 name=__codelineno-130-26></a>value = "recovery";
<a href=#__codelineno-130-27 id=__codelineno-130-27 name=__codelineno-130-27></a>},
<a href=#__codelineno-130-28 id=__codelineno-130-28 name=__codelineno-130-28></a>/* 设置这个env，指示下次启动，即启动到recovery分区时，配套使用mypart-r */
<a href=#__codelineno-130-29 id=__codelineno-130-29 name=__codelineno-130-29></a>{
<a href=#__codelineno-130-30 id=__codelineno-130-30 name=__codelineno-130-30></a>name = "mypart_partition";
<a href=#__codelineno-130-31 id=__codelineno-130-31 name=__codelineno-130-31></a>value = "mypart-r";
<a href=#__codelineno-130-32 id=__codelineno-130-32 name=__codelineno-130-32></a>},
<a href=#__codelineno-130-33 id=__codelineno-130-33 name=__codelineno-130-33></a>{
<a href=#__codelineno-130-34 id=__codelineno-130-34 name=__codelineno-130-34></a>name = "swu_next";
<a href=#__codelineno-130-35 id=__codelineno-130-35 name=__codelineno-130-35></a>value = "reboot";
<a href=#__codelineno-130-36 id=__codelineno-130-36 name=__codelineno-130-36></a>}
<a href=#__codelineno-130-37 id=__codelineno-130-37 name=__codelineno-130-37></a>);
<a href=#__codelineno-130-38 id=__codelineno-130-38 name=__codelineno-130-38></a>};
<a href=#__codelineno-130-39 id=__codelineno-130-39 name=__codelineno-130-39></a>upgrade_kernel = {
<a href=#__codelineno-130-40 id=__codelineno-130-40 name=__codelineno-130-40></a>images: (
<a href=#__codelineno-130-41 id=__codelineno-130-41 name=__codelineno-130-41></a>{
<a href=#__codelineno-130-42 id=__codelineno-130-42 name=__codelineno-130-42></a>filename = "kernel";
<a href=#__codelineno-130-43 id=__codelineno-130-43 name=__codelineno-130-43></a>device = "/dev/by-name/boot";
<a href=#__codelineno-130-44 id=__codelineno-130-44 name=__codelineno-130-44></a>installed-directly = true;
<a href=#__codelineno-130-45 id=__codelineno-130-45 name=__codelineno-130-45></a>},
<a href=#__codelineno-130-46 id=__codelineno-130-46 name=__codelineno-130-46></a>{
<a href=#__codelineno-130-47 id=__codelineno-130-47 name=__codelineno-130-47></a>filename = "rootfs";
<a href=#__codelineno-130-48 id=__codelineno-130-48 name=__codelineno-130-48></a>device = "/dev/by-name/rootfs";
<a href=#__codelineno-130-49 id=__codelineno-130-49 name=__codelineno-130-49></a>installed-directly = true;
<a href=#__codelineno-130-50 id=__codelineno-130-50 name=__codelineno-130-50></a>},
<a href=#__codelineno-130-51 id=__codelineno-130-51 name=__codelineno-130-51></a>/* 更新mypart， 此时掉电，mypart分区还是完整的*/
<a href=#__codelineno-130-52 id=__codelineno-130-52 name=__codelineno-130-52></a>{
<a href=#__codelineno-130-53 id=__codelineno-130-53 name=__codelineno-130-53></a>filename = "mypart-r";
<a href=#__codelineno-130-54 id=__codelineno-130-54 name=__codelineno-130-54></a>device = "/dev/by-name/mypart-r";
<a href=#__codelineno-130-55 id=__codelineno-130-55 name=__codelineno-130-55></a>installed-directly = true;
<a href=#__codelineno-130-56 id=__codelineno-130-56 name=__codelineno-130-56></a>}
<a href=#__codelineno-130-57 id=__codelineno-130-57 name=__codelineno-130-57></a>);
<a href=#__codelineno-130-58 id=__codelineno-130-58 name=__codelineno-130-58></a>bootenv: (
<a href=#__codelineno-130-59 id=__codelineno-130-59 name=__codelineno-130-59></a>{
<a href=#__codelineno-130-60 id=__codelineno-130-60 name=__codelineno-130-60></a>name = "swu_mode";
<a href=#__codelineno-130-61 id=__codelineno-130-61 name=__codelineno-130-61></a>value = "upgrade_usr";
<a href=#__codelineno-130-62 id=__codelineno-130-62 name=__codelineno-130-62></a>},
<a href=#__codelineno-130-63 id=__codelineno-130-63 name=__codelineno-130-63></a>/* 设置这个env，指示下次启动，即启动到正常系统时，使用mypart */
<a href=#__codelineno-130-64 id=__codelineno-130-64 name=__codelineno-130-64></a>{
<a href=#__codelineno-130-65 id=__codelineno-130-65 name=__codelineno-130-65></a>name = "mypart_partition";
<a href=#__codelineno-130-66 id=__codelineno-130-66 name=__codelineno-130-66></a>value = "mypart";
<a href=#__codelineno-130-67 id=__codelineno-130-67 name=__codelineno-130-67></a>},
<a href=#__codelineno-130-68 id=__codelineno-130-68 name=__codelineno-130-68></a>{
<a href=#__codelineno-130-69 id=__codelineno-130-69 name=__codelineno-130-69></a>name = "boot_partition";
<a href=#__codelineno-130-70 id=__codelineno-130-70 name=__codelineno-130-70></a>value = "boot";
<a href=#__codelineno-130-71 id=__codelineno-130-71 name=__codelineno-130-71></a>}
<a href=#__codelineno-130-72 id=__codelineno-130-72 name=__codelineno-130-72></a>);
<a href=#__codelineno-130-73 id=__codelineno-130-73 name=__codelineno-130-73></a>};
<a href=#__codelineno-130-74 id=__codelineno-130-74 name=__codelineno-130-74></a>...
</code></pre></div> <h3 id=315-handler>3.15 handler 说明</h3> <p>此处只对一些handler 做简介。</p> <p>具体的handler 的用法，请参考swupdate 官方文档说明。</p> <h4 id=3151-awboot>3.15.1 awboot</h4> <h5 id=31511-nandemmc>3.15.1.1 nand/emmc</h5> <p>全志拓展的handler，用于支持升级全志boot0 和uboot，实质上会调用外部的ota-burnboot包完成升级。</p> <p>目前只支持nand/emmc，详见ota-burnboot 章节。</p> <p>使用方式：</p> <p>选上handler 支持：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-131-1 id=__codelineno-131-1 name=__codelineno-131-1></a>make menuconfig ---&gt;
<a href=#__codelineno-131-2 id=__codelineno-131-2 name=__codelineno-131-2></a>Allwinner ---&gt;
<a href=#__codelineno-131-3 id=__codelineno-131-3 name=__codelineno-131-3></a>&lt;*&gt; swupdate ---&gt;
<a href=#__codelineno-131-4 id=__codelineno-131-4 name=__codelineno-131-4></a>Image Handlers --&gt;
<a href=#__codelineno-131-5 id=__codelineno-131-5 name=__codelineno-131-5></a>[*] allwinner boot0/uboot
</code></pre></div> <p>注意，recovery 系统也需要对应进行配置，即：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-132-1 id=__codelineno-132-1 name=__codelineno-132-1></a>make ota_menuconfig ---&gt; ...(重复以上配置)
</code></pre></div> <p>在sw-description 中指定type 即可：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-133-1 id=__codelineno-133-1 name=__codelineno-133-1></a>{
<a href=#__codelineno-133-2 id=__codelineno-133-2 name=__codelineno-133-2></a>filename = "uboot"; /* 源文件是OTA包中的uboot文件*/
<a href=#__codelineno-133-3 id=__codelineno-133-3 name=__codelineno-133-3></a>type = "awuboot"; /* type为awuboot，则swupdate会调用对应的handler做处理*/
<a href=#__codelineno-133-4 id=__codelineno-133-4 name=__codelineno-133-4></a>},
<a href=#__codelineno-133-5 id=__codelineno-133-5 name=__codelineno-133-5></a>{
<a href=#__codelineno-133-6 id=__codelineno-133-6 name=__codelineno-133-6></a>filename = "boot0"; /* 源文件是OTA包中的boot0文件*/
<a href=#__codelineno-133-7 id=__codelineno-133-7 name=__codelineno-133-7></a>type = "awboot0"; /* type为awuboot，则swupdate会调用对应的handler做处理*/
<a href=#__codelineno-133-8 id=__codelineno-133-8 name=__codelineno-133-8></a>}
</code></pre></div> <h5 id=31512-nor>3.15.1.2 nor</h5> <p>对于nor 方案，升级boot0/uboot 有掉电风险。如确需升级，可直接配置合适偏移即可，不使用awboot handler。</p> <p>例如已知boot0 存放在偏移为0 处，uboot 存放在偏移为24k 处，则配置：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-134-1 id=__codelineno-134-1 name=__codelineno-134-1></a>{
<a href=#__codelineno-134-2 id=__codelineno-134-2 name=__codelineno-134-2></a>filename = "boot0";
<a href=#__codelineno-134-3 id=__codelineno-134-3 name=__codelineno-134-3></a>device = "/dev/mtdblock0";
<a href=#__codelineno-134-4 id=__codelineno-134-4 name=__codelineno-134-4></a>installed-directly = true;
<a href=#__codelineno-134-5 id=__codelineno-134-5 name=__codelineno-134-5></a>},
<a href=#__codelineno-134-6 id=__codelineno-134-6 name=__codelineno-134-6></a>{
<a href=#__codelineno-134-7 id=__codelineno-134-7 name=__codelineno-134-7></a>filename = "uboot";
<a href=#__codelineno-134-8 id=__codelineno-134-8 name=__codelineno-134-8></a>device = "/dev/mtdblock0";
<a href=#__codelineno-134-9 id=__codelineno-134-9 name=__codelineno-134-9></a>offset = "24k"
<a href=#__codelineno-134-10 id=__codelineno-134-10 name=__codelineno-134-10></a>installed-directly = true;
<a href=#__codelineno-134-11 id=__codelineno-134-11 name=__codelineno-134-11></a>}
</code></pre></div> <h4 id=3152-readback>3.15.2 readback</h4> <p>用于支持在sw-description 中配置sha256，在升级后读出数据进行校验。</p> <p>一种应用场景是，在AB 系统差分升级时，应用差分包后读出校验，以确认差分得到的结果是对的，再切换系统。</p> <p>需选上对应handler。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-135-1 id=__codelineno-135-1 name=__codelineno-135-1></a>make menuconfig/make ota_menuconfig
<a href=#__codelineno-135-2 id=__codelineno-135-2 name=__codelineno-135-2></a>--&gt; Allwinner
<a href=#__codelineno-135-3 id=__codelineno-135-3 name=__codelineno-135-3></a>--&gt; swupdate
<a href=#__codelineno-135-4 id=__codelineno-135-4 name=__codelineno-135-4></a>--&gt; &lt;*&gt; Allow to add sha256 hash to each image
<a href=#__codelineno-135-5 id=__codelineno-135-5 name=__codelineno-135-5></a>make menuconfig/make ota_menuconfig
<a href=#__codelineno-135-6 id=__codelineno-135-6 name=__codelineno-135-6></a>--&gt; Allwinner
<a href=#__codelineno-135-7 id=__codelineno-135-7 name=__codelineno-135-7></a>--&gt; swupdate
<a href=#__codelineno-135-8 id=__codelineno-135-8 name=__codelineno-135-8></a>--&gt; Image Handlers
<a href=#__codelineno-135-9 id=__codelineno-135-9 name=__codelineno-135-9></a>--&gt; [*] readback
</code></pre></div> <h5 id=31521>3.15.2.1 示例</h5> <div class=highlight><pre><span></span><code><a href=#__codelineno-136-1 id=__codelineno-136-1 name=__codelineno-136-1></a>target/allwinner/generic/swupdate/sw-description-readback
<a href=#__codelineno-136-2 id=__codelineno-136-2 name=__codelineno-136-2></a>target/allwinner/generic/swupdate/sw-subimgs-readback.cfg
</code></pre></div> <h4 id=3153-ubi>3.15.3 ubi</h4> <p>用于ubi 方案。 需先选上MTD 支持：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-137-1 id=__codelineno-137-1 name=__codelineno-137-1></a>make menuconfig/make ota_menuconfig
<a href=#__codelineno-137-2 id=__codelineno-137-2 name=__codelineno-137-2></a>--&gt; swupdate
<a href=#__codelineno-137-3 id=__codelineno-137-3 name=__codelineno-137-3></a>--&gt; Swupdate Settings
<a href=#__codelineno-137-4 id=__codelineno-137-4 name=__codelineno-137-4></a>---&gt; General Configuration
<a href=#__codelineno-137-5 id=__codelineno-137-5 name=__codelineno-137-5></a>---&gt; [*] MTD support
</code></pre></div> <p>再选上对应handler：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-138-1 id=__codelineno-138-1 name=__codelineno-138-1></a>make menuconfig/make ota_menuconfig
<a href=#__codelineno-138-2 id=__codelineno-138-2 name=__codelineno-138-2></a>--&gt; swupdate
<a href=#__codelineno-138-3 id=__codelineno-138-3 name=__codelineno-138-3></a>--&gt; Image Handlers
<a href=#__codelineno-138-4 id=__codelineno-138-4 name=__codelineno-138-4></a>--&gt; [*] ubivol
</code></pre></div> <h5 id=31531>3.15.3.1 示例</h5> <p>请参考：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-139-1 id=__codelineno-139-1 name=__codelineno-139-1></a>target/allwinner/generic/swupdate/sw-subimgs-ubi.cfg
<a href=#__codelineno-139-2 id=__codelineno-139-2 name=__codelineno-139-2></a>target/allwinner/generic/swupdate/sw-description-ubi
</code></pre></div> <h4 id=3154-rdiff>3.15.4 rdiff</h4> <p>rdiff handle 用于差分包升级。</p> <p>需选上对应handler：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-140-1 id=__codelineno-140-1 name=__codelineno-140-1></a>make menuconfig/make ota_menuconfig
<a href=#__codelineno-140-2 id=__codelineno-140-2 name=__codelineno-140-2></a>--&gt; swupdate
<a href=#__codelineno-140-3 id=__codelineno-140-3 name=__codelineno-140-3></a>--&gt; Image Handlers
<a href=#__codelineno-140-4 id=__codelineno-140-4 name=__codelineno-140-4></a>--&gt; [*] rdiff
<a href=#__codelineno-140-5 id=__codelineno-140-5 name=__codelineno-140-5></a>#若使用AB系统方案，则无recovery系统，则make ota_menuconfig的配置可不做。
</code></pre></div> <h5 id=31541>3.15.4.1 特性</h5> <p>在https://librsync.github.io/page_rdiff.html 中指出</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-141-1 id=__codelineno-141-1 name=__codelineno-141-1></a>rdiff cannot update files in place: the output file must not be the same as the input file.
</code></pre></div> <p>即不支持原地更新，即应用差分包将A0 更新成A1，需要有足够空间存储A0 和A1，不能直接对A0 进行改动。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-142-1 id=__codelineno-142-1 name=__codelineno-142-1></a>rdiff does not currently check that the delta is being applied to the correct file. If a delta is applied to the wrong basis file, the results will be garbage.
</code></pre></div> <p>不校验原文件，如果将差分包应用于错误的文件，则会得到无效的输出文件，但不会报错。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-143-1 id=__codelineno-143-1 name=__codelineno-143-1></a>The basis file must allow random access. This means it must be a regular file rather than apipe or socket.
</code></pre></div> <p>原文件必须支持随机访问，因此不能从管道或socket 中获取原文件。 更多介绍请参考：<a href=https://librsync.github.io/ >https://librsync.github.io/</a></p> <h5 id=31542>3.15.4.2 示例</h5> <p>首先需要将方案修改为AB 系统的方案，请参考上文的“AB 系统方案举例”。</p> <p>swupdate 的配置文件请参考：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-144-1 id=__codelineno-144-1 name=__codelineno-144-1></a>target/allwinner/generic/swupdate/sw-description-ab-rdiff
<a href=#__codelineno-144-2 id=__codelineno-144-2 name=__codelineno-144-2></a>target/allwinner/generic/swupdate/sw-subimgs-ab-rdiff.cfg
</code></pre></div> <p>差分文件的生成使用rdiff：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-145-1 id=__codelineno-145-1 name=__codelineno-145-1></a>$ rdiff -h
<a href=#__codelineno-145-2 id=__codelineno-145-2 name=__codelineno-145-2></a>Usage: rdiff [OPTIONS] signature [BASIS [SIGNATURE]]
<a href=#__codelineno-145-3 id=__codelineno-145-3 name=__codelineno-145-3></a>[OPTIONS] delta SIGNATURE [NEWFILE [DELTA]]
<a href=#__codelineno-145-4 id=__codelineno-145-4 name=__codelineno-145-4></a>[OPTIONS] patch BASIS [DELTA [NEWFILE]]
</code></pre></div> <p>tina 封装了一条命令，用于解出两个swu 包并生成各个子镜像的差分文件。</p> <p>一种参考的差分包生成方式是，先按普通的升级方式生成整包。</p> <p>假设旧固件对应V1.swu，新固件对应V2.swu，则可使用：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-146-1 id=__codelineno-146-1 name=__codelineno-146-1></a>swupdate_make_delta V1.swu V2.swu
</code></pre></div> <p>生成差分文件。</p> <p>再将生成的差分文件，用于生成差分的OTA 包。</p> <p>例如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-147-1 id=__codelineno-147-1 name=__codelineno-147-1></a>make &amp;&amp; pack #生成V1固件
<a href=#__codelineno-147-2 id=__codelineno-147-2 name=__codelineno-147-2></a>swupdate_pack_swu -ab #得到out/r328s2-perf1/swupdate/tina-r328s2-perf1-ab.swu
<a href=#__codelineno-147-3 id=__codelineno-147-3 name=__codelineno-147-3></a>cp out/r328s2-perf1/swupdate/tina-r328s2-perf1-ab.swu V1.swu #保存V1的OTA包
<a href=#__codelineno-147-4 id=__codelineno-147-4 name=__codelineno-147-4></a>#进行一些修改
<a href=#__codelineno-147-5 id=__codelineno-147-5 name=__codelineno-147-5></a>make &amp;&amp; pack #生成V2固件
<a href=#__codelineno-147-6 id=__codelineno-147-6 name=__codelineno-147-6></a>swupdate_pack_swu -ab #得到out/r328s2-perf1/swupdate/tina-r328s2-perf1-ab.swu
<a href=#__codelineno-147-7 id=__codelineno-147-7 name=__codelineno-147-7></a>cp out/r328s2-perf1/swupdate/tina-r328s2-perf1-ab.swu V2.swu #保存V2的OTA包
<a href=#__codelineno-147-8 id=__codelineno-147-8 name=__codelineno-147-8></a>swupdate_make_delta V1.swu V2.swu #生成差分镜像
<a href=#__codelineno-147-9 id=__codelineno-147-9 name=__codelineno-147-9></a>swupdate_pack_swu -ab-rdiff #生成差分OTA包，这一步用到了刚刚生成的差分镜像
</code></pre></div> <h5 id=31543>3.15.4.3 开销问题</h5> <p>差分升级的主要好处在于节省传输的文件大小。而不是节省ram 和rom 的占用。</p> <p>设备端在进行差分升级时，需要使用版本匹配的旧版本镜像，加上差分包，生成新版本镜像。</p> <p>rsync 不支持原地更新，必须有额外的空间保存新生成的镜像。</p> <p>从掉电安全的角度考虑，在新版本镜像完整保存到flash 之前，旧版本镜像不能破坏，否则一旦中途掉电，将无法再次使用旧镜像+ 差分包生成新镜像，只能联网</p> <p>下载完整的OTA 包。</p> <p>以上限制，导致flash 必须在旧镜像之外，有足够flash 空间用于存放新的镜像。</p> <p>对于recovery 方案，原本的：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-148-1 id=__codelineno-148-1 name=__codelineno-148-1></a>从OTA包获取新recovery写入recovery分区--&gt;
<a href=#__codelineno-148-2 id=__codelineno-148-2 name=__codelineno-148-2></a>reboot --&gt;
<a href=#__codelineno-148-3 id=__codelineno-148-3 name=__codelineno-148-3></a>从OTA包获取新kernel写入boot分区--&gt;
<a href=#__codelineno-148-4 id=__codelineno-148-4 name=__codelineno-148-4></a>从OTA包获取新rootfs升级rootfs分区--&gt;
<a href=#__codelineno-148-5 id=__codelineno-148-5 name=__codelineno-148-5></a>reboot
</code></pre></div> <p>就需要变成：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-149-1 id=__codelineno-149-1 name=__codelineno-149-1></a>从OTA包获取recovery差分包，读recovery分区，生成新recovery暂存到文件系统中--&gt;
<a href=#__codelineno-149-2 id=__codelineno-149-2 name=__codelineno-149-2></a>从文件系统获取新recovery写入recovery分区--&gt;
<a href=#__codelineno-149-3 id=__codelineno-149-3 name=__codelineno-149-3></a>reboot --&gt;
<a href=#__codelineno-149-4 id=__codelineno-149-4 name=__codelineno-149-4></a>...
</code></pre></div> <p>总体较为麻烦，且需要文件系统足够大。 对于AB 方案，原本的：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-150-1 id=__codelineno-150-1 name=__codelineno-150-1></a>从OTA包获取新kernel写入bootB分区--&gt;
<a href=#__codelineno-150-2 id=__codelineno-150-2 name=__codelineno-150-2></a>从OTA包获取新rootfs写入rootfsB分区--&gt;
<a href=#__codelineno-150-3 id=__codelineno-150-3 name=__codelineno-150-3></a>reboot
</code></pre></div> <p>就需要变成：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-151-1 id=__codelineno-151-1 name=__codelineno-151-1></a>从OTA包获取kernel差分包，读出bootA分区，合并生成新kernel写入bootB分区--&gt;
<a href=#__codelineno-151-2 id=__codelineno-151-2 name=__codelineno-151-2></a>从OTA包获取rootfs差分包，读出rootfsA分区，合并生成新rootfs写入bootB分区--&gt;
<a href=#__codelineno-151-3 id=__codelineno-151-3 name=__codelineno-151-3></a>reboot
</code></pre></div> <p>不需要依赖额外的文件系统空间。</p> <p>因此，若希望节省ram/rom 占用，差分包并非解决的办法。若希望使用差分包，建议配合AB 系统使用。</p> <h5 id=31544>3.15.4.4 管理问题</h5> <p>差分包的一个麻烦问题在于，差分包必须跟设备端的版本匹配。而出厂之后的设备，可能存在多种版本。</p> <p>例如出厂为V1，当前最新为V4，则设备可能处于V1，V2，V3。此时若使用整包升级，则无需区分。</p> <p>若使用差分升级，一种策略是为每个旧版本生成一个差分包，则需要制作三个差分包V1_4，V2_4，V3_4，并在OTA 时先判断设备端和云端版本，再使用对应的差</p> <p>分包。</p> <p>另一种策略是，只为上一个版本生成差分包V3_4，并额外准备一个整包。在OTA 时先判断设备端版本和云端版本，若可相差一个版本则使用差分包，若跨版本则</p> <p>使用整包。不管哪一种，都需要应用做出额外的判断。这一点需要主应用和云端服务器做好处理。</p> <h5 id=31545>3.15.4.5 校验问题</h5> <p>目前社区支持的rdiff 本身并不包含较好的校验机制，即应用一个版本不对的差分包，也能跑完升级流程。这样一旦出错，就会导致机器变砖。</p> <p>一种可考虑的方式是搭配readback 使用，即在应用差分包，写入目标分区之后，将更新后的目标分区数据读出，校验其sha256 是否符合预期，校验成功才切换系</p> <p>统，校验失败则报错。</p> <p>可参考</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-152-1 id=__codelineno-152-1 name=__codelineno-152-1></a>target/allwinner/generic/swupdate/sw-description-ab-rdiff-sign
<a href=#__codelineno-152-2 id=__codelineno-152-2 name=__codelineno-152-2></a>target/allwinner/generic/swupdate/sw-subimgs-ab-rdiff-sign.cfg
</code></pre></div> <p>其中增加了readback 的处理。</p> <p>具体的，sw-subimgs-xxx.cfg 中可以配置swota_copy_file_list，指定一些文件只拷贝到swupdate 目录，不打包到最终的OTA 包（swu 文件）中。因为在这个场</p> <p>景下，我们需要原始的kernel, rootfs 等文件来计算sha256，但并不需要将其加入最终的OTA 包中。</p> <h5 id=31546-ubi>3.15.4.6 跟ubi 的配合问题</h5> <p>swupdate 官方目前没有支持rdiff 用于ubi 卷。</p> <p>目前采用增加预处理脚本的方式来兼容，即在执行rdiff handler 之前，先调用脚本使用ubiupdatevol创建一个可用于升级目标ubi 卷的fifo。随后rdiff handler 即</p> <p>可将此fifo 当作目标裸设备，无需特殊处理ubi 卷。在后处理脚本中，再通过填0 的方式，结束所有的ubiupdatevol。</p> <p>具体可参考如下文件夹中的配置和脚本：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-153-1 id=__codelineno-153-1 name=__codelineno-153-1></a>target/allwinner/r329-evb5/swupdate
</code></pre></div> <p>前提仍然是配置好AB 系统，使用方式：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-154-1 id=__codelineno-154-1 name=__codelineno-154-1></a># 编译系统，得到要烧录的固件，记为V1
<a href=#__codelineno-154-2 id=__codelineno-154-2 name=__codelineno-154-2></a>
<a href=#__codelineno-154-3 id=__codelineno-154-3 name=__codelineno-154-3></a>make &amp;&amp; pack
<a href=#__codelineno-154-4 id=__codelineno-154-4 name=__codelineno-154-4></a>
<a href=#__codelineno-154-5 id=__codelineno-154-5 name=__codelineno-154-5></a># 生成OTA包，此OTA包的各个分区镜像跟V1固件的镜像一致
<a href=#__codelineno-154-6 id=__codelineno-154-6 name=__codelineno-154-6></a>
<a href=#__codelineno-154-7 id=__codelineno-154-7 name=__codelineno-154-7></a>swupdate_pack_swu -ab
<a href=#__codelineno-154-8 id=__codelineno-154-8 name=__codelineno-154-8></a>cp out/r329-evb5/swupdate/tina-r329-evb5-ab.swu tina-r329-evb5-ab_V1.swu
<a href=#__codelineno-154-9 id=__codelineno-154-9 name=__codelineno-154-9></a>
<a href=#__codelineno-154-10 id=__codelineno-154-10 name=__codelineno-154-10></a># 进行修改，编译出V2的系统
<a href=#__codelineno-154-11 id=__codelineno-154-11 name=__codelineno-154-11></a>
<a href=#__codelineno-154-12 id=__codelineno-154-12 name=__codelineno-154-12></a>make &amp;&amp; pack
<a href=#__codelineno-154-13 id=__codelineno-154-13 name=__codelineno-154-13></a>
<a href=#__codelineno-154-14 id=__codelineno-154-14 name=__codelineno-154-14></a># 生成OTA包，此OTA包的各个分区镜像跟V2固件的镜像一致
<a href=#__codelineno-154-15 id=__codelineno-154-15 name=__codelineno-154-15></a>
<a href=#__codelineno-154-16 id=__codelineno-154-16 name=__codelineno-154-16></a>swupdate_pack_swu -ab
<a href=#__codelineno-154-17 id=__codelineno-154-17 name=__codelineno-154-17></a>cp out/r329-evb5/swupdate/tina-r329-evb5-ab.swu tina-r329-evb5-ab_V2.swu
<a href=#__codelineno-154-18 id=__codelineno-154-18 name=__codelineno-154-18></a>
<a href=#__codelineno-154-19 id=__codelineno-154-19 name=__codelineno-154-19></a># 此时tina-r329-evb5-ab_V2.swu 可用于正常的OTA升级
<a href=#__codelineno-154-20 id=__codelineno-154-20 name=__codelineno-154-20></a>
<a href=#__codelineno-154-21 id=__codelineno-154-21 name=__codelineno-154-21></a># 生成各个镜像的差分文件
<a href=#__codelineno-154-22 id=__codelineno-154-22 name=__codelineno-154-22></a>
<a href=#__codelineno-154-23 id=__codelineno-154-23 name=__codelineno-154-23></a>swupdate_make_delta ./tina-r329-evb5-ab_V1.swu ./tina-r329-evb5-ab_V2.swu
<a href=#__codelineno-154-24 id=__codelineno-154-24 name=__codelineno-154-24></a>
<a href=#__codelineno-154-25 id=__codelineno-154-25 name=__codelineno-154-25></a># 基于上一步得到的差分文件，生成差分OTA包
<a href=#__codelineno-154-26 id=__codelineno-154-26 name=__codelineno-154-26></a>
<a href=#__codelineno-154-27 id=__codelineno-154-27 name=__codelineno-154-27></a>swupdate_pack_swu -ab-rdiff
</code></pre></div> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2022 100ask Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "header.autohide", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=https://unpkg.com/d3@6.7.0/dist/d3.min.js></script> <script src=https://unpkg.com/markmap-lib@0.14.1/dist/browser/index.min.js></script> <script src=https://unpkg.com/markmap-view@0.14.0/dist/index.min.js></script> </body> </html>