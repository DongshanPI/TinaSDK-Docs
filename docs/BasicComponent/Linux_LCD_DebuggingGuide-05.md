# Linux_LCD_调试指南

## 7 FAQ

### 7.1 屏显示异常

总结过往经验，绝大部分屏显异常都是由于上下电时序和timing 不合理导致。

请看屏时序参数说明和屏驱动分解。

#### 7.2 黑屏-无背光

问题表现：完全黑屏，背光也没有。

有两种可能：

1. 屏驱动添加失败。驱动没有加载屏驱动，导致背光电源相关函数没有运行到。这个你可以通过调试方法定位下。
2. pwm 配置和背光电路的问题，pwm 的信息可以看pwm 信息和背光相关参数，另外就是直接测量下硬件测量下相关管脚和电压。

### 7.3 黑屏-有背光

黑屏但是有背光，可能有多种原因导致，请依次按以下步骤检查：

1. 没送图层。如果应用没有送任何图层那么表现的现象就是黑屏，通过查看显示信息一小节可以确定有没有送图层。如果确定没有图层，可以通过查看接口自带

  colorbar，确认屏能否正常显示。

2. SoC 端的显示接口模块没有供电。SoC 端模块没有供电自然无法传输视频信号到屏上。一般SoC 端模块供电的axp 名字叫做vcc-lcd，vcc-dsi，vcc33-lcd，

  vcc18-dsi 等。

3. 复位脚没有复位。如果有复位脚，请确保硬件连接正确，确保复位脚的复位操作有放到屏驱动中。

4. board.dts 中lcd0 有严重错误。第一个是lcd 的timing 太离谱，请严格按照屏手册中的提示来写！参考屏时序参数说明。第二个就是，接口类型搞错，比如接

  的DSI 屏，配置却写成LVDS 的。

5. 屏的初始化命令不对。包括各个步骤先后顺序，延时等，这个时候请找屏厂确认初始化命令。

### 7.4 闪屏

分为几种：

1. 屏的整体在闪。

  这个最大可能是背光电路的电压不稳定，检查电压。

2. 屏部分在闪，而且是概率性。

  board.dts 中的时序填写不合理。

3. 屏上由一个矩形区域在闪。

  屏极化导致，需要关机放一边再开机则不会。

### 7.5 条形波纹

有些LCD 屏的像素格式是18bit 色深（RGB666）或16bit 色深（RGB565），建议打开FRM功能，通过dither 的方式弥补色深，使显示达到24bit 色深（RGB888）

的效果。如下图所示，上图是色深为RGB66 的LCD 屏显示，下图是打开dither 后的显示，打开dither 后色彩渐变的地方过度平滑。

设置[lcd0] 的lcd_frm 属性可以改善这种现象。请看lcd_frm解释。

7.6 背光太亮或者太暗

请看背光相关参数。

7.7 重启断电测试屏异常

花屏的第一个原因是fps 过高，超过屏的限制：

FPS 异常是一件非常严重的事情，关系到整个操作系统的稳定，如果fps 过高会造成系统带宽增加，送显流程异常，fps 过高还会造成LCD 屏花屏不稳定，容易造

成LCD 屏损坏，FPS 过低则造成用户体验过差。

1. 通过查看查看显示信息一节，可以得知现在的实时统计的fps。

2. 如果fps 离正常值差很多，首先检查board.dts 中[lcd0] 节点，所填信息必须满足下面公式。

```
lcd_dclk_freq*num_of_pixel_clk=lcd_ht*lcd_vt*fps /1e9
```

其中，num_of_pixel_clk 通常为1，表示发送一个像素所需要的时钟周期为1 一个，低分辨率的MCU 和串行接口通常需要2 到3 个时钟周期才能发送完一个像素。

如果上面填写没有错，通过查看查看时钟信息一节可以确认下几个主要时钟的频率信息，把这些信息和board.dts 发给维护者进一步分析。

### 7.8 RGB 接口或者I8080 接口显示抖动有花纹

1. 改大时钟管脚的管脚驱动能力
  参考lcd_gpio_0一小节和pinctrl-0 和pinctrl-1，修改驱动能力，改大。

  还有另外一种写法，比如原来是：

  ```
  lcdclk = port:PD18<2><0><2><default>
  ```

  可以改成：

  ```
  lcdclk = port:PD18<2><0><3><default>
  ```

2. 修改时钟相位，也就是修改lcd_hv_clk_phase。由于发送端和接收端时钟相位的不同导致接收端解错若干位。

### 7.9 LCD 屏出现极化和残影

何谓液晶极化现象：实际上就是液晶电介质极化。就是在外界电场作用下，电介质内部沿电场方向产生感应偶极矩，在电解质表明出现极化电荷的现象叫做电介质

的极化。

通俗的讲就是在液晶面板施加一定电压后，会聚集大量电荷，当电压消失的时候，这些聚集的电荷也要释放，但由于介电效应，这些聚集的电荷不会立刻释放消

失，这些不会马上消失的惰性电荷造成了液晶的DC 残留从而形成了极化现象。

几种常见的液晶极化现象

1. 液晶长期静止某个画面的时候，切换到灰阶画面的时候出现屏闪，屏闪一段时间后消失。这种现象属于残留电荷放电的过程。

2. 液晶长期静止某个画面的时候，出现四周发黑中间发白的现象，业内称为黑白电视框异常。

3. 非法关机的时候，重新上电会出现屏闪，屏闪一定时间后消失。与第一种原因相同。

4. 残影现象：当液晶静止在一个画面比较久的情况下，切换其他画面出现的镜像残留。残影的本质来说是液晶DC 残留电荷导致，某种意义来说也属于液晶极化

  现象。

针对液晶屏出现极化和残影现象，有如下对策。
1. 调整vcom 电压大小。
  VCOM 是液晶分子偏转的参考电压，要求要稳定，对液晶显示有直接影响，具体的屏不同的话也是不同的。电压的具体值是根据输入的数据以及Vcom 电压大

  小来确定的，用来显示各种不同灰阶，也就是实现彩色显示GAMMA。Gamma 电压是用来控制显示器的灰阶的，一般情况下分为G0~G14，不同的Gamma 

  电压与Vcom 电压之间的压差造成液晶旋转角度不同从而形成亮度的差异，Vcom 电压最好的状况是位于G0 和G14 的中间值，这样液晶屏的闪烁状况会最

  好。

  调节vcom 电压的方式，如果屏管脚有vcom 管脚，直接调整相关电路，如果屏driver IC 提供寄存器接口，可以通过寄存器接口来调整大小。

2. 严格按照屏规定的上下电时序来对屏进行开关屏。许多极化残影现象并非长时间显示静止显示某个画面导致的，而是由于关机或者关屏时没有严格按照下电时

  序导致的，比如该关的电没关,或者延时不够。

## 8 总结

调试LCD 显示屏实际上就是调试发送端芯片（全志SoC）和接收端芯片（LCD 屏上的driver IC）的一个过程：

1. 添加屏驱动请看添加屏驱动步骤和屏驱动说明。
2. 仔细阅读屏手册以及driver IC 手册。
3. 仔细阅读硬件参数说明。
4. 确保LCD 所需要的各路电源管脚正常。